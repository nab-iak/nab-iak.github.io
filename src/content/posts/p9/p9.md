---
title: '单细胞RNA-seq分析'
published: 2025-05-14
image: './p9_cover.jpg'
description: '使用Seurat包进行scRNA-seq分析'
category: 'Bioinformatics'
tags: [scRNA-seq,Seurat,R,ZH-CN]
draft: false 
lang: 'en'
---
> - Cover Pic by [@void_0](https://www.pixiv.net/artworks/128293940)

<center><h1>-占坑，不咕-</h1></center>
- 近期优先  
- 先放三个用于提取本地10X数据的函数

## 10X data to SeuratObject

```r
rdMtx <- function(
    sample, 
    path = 'Data',
    project = NULL,
    min.features = 200, 
    min.cells = 3
){

    args <- list(
        mtx = paste(path,'/',sample,'_matrix.mtx.gz',sep=''),
        features = paste(path,'/',sample,'_features.tsv.gz',sep=''),
        cells = paste(path,'/',sample,'_barcodes.tsv.gz',sep='')
    )

    matrix <- do.call(ReadMtx, args)

    matrix <- CreateAssayObject(
        matrix
    )

    args2 <- list(
        matrix,
        min.features = min.features, 
        min.cells = min.cells
    )

    if (!is.null(project)) args2$project <- project
    
    matrix <- do.call(CreateSeuratObject, args2)

    return(matrix)
}
```

## Get Samples and Names

```r
getSampleList <- function(path = 'Data'){
    sampleList <- lapply(
    list.files(
        path = paste(path, '/', sep=''), 
        pattern = '_features.tsv.gz'
    ),
    function(x) {
        regmatches(x, regexpr("^[^_]+_[^_]+", x))
    }
) %>%
    unlist()
}

getNameList <- function(path = 'Data'){
    nameList <- lapply(
    list.files(
        paste(path, '/', sep=''), 
        pattern = '_features.tsv.gz'
    ),
    function(x) {
        regmatches(x, regexpr("(?<=_)[^_]+(?=_)", x, perl = TRUE))
    }
) %>% 
    unlist()
}
```

## Combine local 10X data into one SeuratObject

```r
get10xData <- function(path = 'Data'){
    sampleList <- getSampleList()
    nameList <- getNameList()

    Sample_list <- list()
    for (i in sampleList){
        Sample_list <- append(
            Sample_list,
            rdMtx(i, project = nameList[which(i == sampleList)])
        )
    }

    combined <- merge(Sample_list[[1]], y = Sample_list[-1], add.cell.ids = sampleList)
    return(combined)
}
```
