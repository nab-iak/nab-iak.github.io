---
title: 'ä½¿ç”¨mlr3è¿›è¡Œæœºå™¨å­¦ä¹ '
published: 2025-06-14
image: './p10_cover.jpg'
description: 'å†…å®¹å¤ªå¤šäº†æ‰“å¼€ä¼šå¡ï¼Œä»¥ååˆ†ç« '
category: 'Machine Learning'
tags: [mlr3,R,ZH-CN]
draft: false 
lang: 'en'
---
> - Cover Pic by [@æŠ è‚‰è‚šè„](https://www.pixiv.net/artworks/126561187)  

> [Applied Machine Learning Using mlr3 in R](https://mlr3book.mlr-org.com/)

## æœºå™¨å­¦ä¹ æµç¨‹

![image_1](./image_1.png)

1. å°†æ•°æ®é›†æ‹†åˆ†ä¸ºè®­ç»ƒé›†ä¸æµ‹è¯•é›†
2. é€‰æ‹©å­¦ä¹ å™¨ï¼Œç”¨è®­ç»ƒé›†æ„å»ºæ¨¡å‹
3. ä½¿ç”¨æ„å»ºçš„æ¨¡å‹å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹
4. åŸºäºé¢„æµ‹çš„ç»“æœå¯¹æ¨¡å‹ç”¨ä¸åŒçš„è¯„ä¼°å™¨è¿›è¡Œè¯„ä¼°
5. åŸºäºè¯„ä¼°ç»“æœè¯„ä»·æ¨¡å‹çš„æ€§èƒ½

## é¢„è®¾å­—å…¸

### é¢„è®¾çš„Taskåˆ—è¡¨

```r
mlr_tasks
```

```css
<DictionaryTask> with 11 stored values
Keys: breast_cancer, california_housing, german_credit, iris, mtcars,
  penguins, pima, sonar, spam, wine, zoo
```

### é¢„è®¾å­¦ä¹ å™¨åˆ—è¡¨

```r
mlr_learners
```

```css
<DictionaryLearner> with 27 stored values
Keys: classif.cv_glmnet, classif.debug, classif.featureless,
  classif.glmnet, classif.kknn, classif.lda, classif.log_reg,
  classif.multinom, classif.naive_bayes, classif.nnet, classif.qda,
  classif.ranger, classif.rpart, classif.svm, classif.xgboost,
  regr.cv_glmnet, regr.debug, regr.featureless, regr.glmnet, regr.kknn,
  regr.km, regr.lm, regr.nnet, regr.ranger, regr.rpart, regr.svm,
  regr.xgboost
```

### é¢„è®¾çš„è¯„ä¼°å™¨åˆ—è¡¨

```r
# 1
mlr_measures
# 2
msr()
```

```css
<DictionaryMeasure> with 62 stored values
Keys: aic, bic, classif.acc, classif.auc, classif.bacc, classif.bbrier,
  classif.ce, classif.costs, classif.dor, classif.fbeta, classif.fdr,
  classif.fn, classif.fnr, classif.fomr, classif.fp, classif.fpr,
  classif.logloss, classif.mauc_au1p, classif.mauc_au1u,
  classif.mauc_aunp, classif.mauc_aunu, classif.mauc_mu,
  classif.mbrier, classif.mcc, classif.npv, classif.ppv, classif.prauc,
  classif.precision, classif.recall, classif.sensitivity,
  classif.specificity, classif.tn, classif.tnr, classif.tp,
  classif.tpr, debug_classif, internal_valid_score, oob_error,
  regr.bias, regr.ktau, regr.mae, regr.mape, regr.maxae, regr.medae,
  regr.medse, regr.mse, regr.msle, regr.pbias, regr.pinball, regr.rmse,
  regr.rmsle, regr.rsq, regr.sae, regr.smape, regr.srho, regr.sse,
  selected_features, sim.jaccard, sim.phi, time_both, time_predict,
  time_train
```

```r
msr() %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 62 x 7</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>task_type</th><th scope=col>packages</th><th scope=col>predict_type</th><th scope=col>properties</th><th scope=col>task_properties</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>aic                </td><td>Akaike Information Criterion              </td><td>NA     </td><td>mlr3</td><td>NA      </td><td>na_score              , requires_learner      , requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>bic                </td><td>Bayesian Information Criterion            </td><td>NA     </td><td>mlr3</td><td>NA      </td><td>na_score              , requires_learner      , requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>classif.acc        </td><td>Classification Accuracy                   </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.auc        </td><td>Area Under the ROC Curve                  </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.bacc       </td><td>Balanced Accuracy                         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.bbrier     </td><td>Binary Brier Score                        </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td>weights</td><td>twoclass</td></tr>
 <tr><td>classif.ce         </td><td>Classification Error                      </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.costs      </td><td>Cost-sensitive Classification             </td><td>classif</td><td>mlr3</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.dor        </td><td>Diagnostic Odds Ratio                     </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fbeta      </td><td>F-beta score                              </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fdr        </td><td>False Discovery Rate                      </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fn         </td><td>False Negatives                           </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fnr        </td><td>False Negative Rate                       </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fomr       </td><td>False Omission Rate                       </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fp         </td><td>False Positives                           </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fpr        </td><td>False Positive Rate                       </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.logloss    </td><td>Log Loss                                  </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td>weights</td><td></td></tr>
 <tr><td>classif.mauc_au1p  </td><td>Weighted average 1 vs. 1 multiclass AUC   </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_au1u  </td><td>Average 1 vs. 1 multiclass AUC            </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunp  </td><td>Weighted average 1 vs. rest multiclass AUC</td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunu  </td><td>Average 1 vs. rest multiclass AUC         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_mu    </td><td>Multiclass mu AUC                         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mbrier     </td><td>Multiclass Brier Score                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mcc        </td><td>Matthews Correlation Coefficient          </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td></td></tr>
 <tr><td>classif.npv        </td><td>Negative Predictive Value                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.ppv        </td><td>Positive Predictive Value                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.prauc      </td><td>Precision-Recall Curve                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.precision  </td><td>Precision                                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.recall     </td><td>Recall                                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.sensitivity</td><td>Sensitivity                               </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
 <tr><td>classif.tnr         </td><td>True Negative Rate                                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.tp          </td><td>True Positives                                     </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.tpr         </td><td>True Positive Rate                                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td>twoclass</td></tr>
 <tr><td>debug_classif       </td><td>Debug Classification Measure                       </td><td>NA     </td><td>mlr3</td><td>response </td><td>na_score</td><td></td></tr>
 <tr><td>internal_valid_score</td><td>Internal Validation Score                          </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>na_score              , requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>oob_error           </td><td>Out-of-bag Error                                   </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>na_score              , requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>regr.bias           </td><td>Bias                                               </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.ktau           </td><td>Kendall's tau                                      </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.mae            </td><td>Mean Absolute Error                                </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.mape           </td><td>Mean Absolute Percent Error                        </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.maxae          </td><td>Max Absolute Error                                 </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.medae          </td><td>Median Absolute Error                              </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.medse          </td><td>Median Squared Error                               </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.mse            </td><td>Mean Squared Error                                 </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.msle           </td><td>Mean Squared Log Error                             </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.pbias          </td><td>Percent Bias                                       </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.pinball        </td><td>NA                                                 </td><td>regr   </td><td>mlr3</td><td>quantiles</td><td></td><td></td></tr>
 <tr><td>regr.rmse           </td><td>Root Mean Squared Error                            </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.rmsle          </td><td>Root Mean Squared Log Error                        </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.rsq            </td><td>NA                                                 </td><td>regr   </td><td>mlr3</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.sae            </td><td>Sum of Absolute Errors                             </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.smape          </td><td>Symmetric Mean Absolute Percent Error              </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.srho           </td><td>Spearman's rho                                     </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.sse            </td><td>Sum of Squared Errors                              </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>selected_features   </td><td>Absolute or Relative Frequency of Selected Features</td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_task         , requires_learner      , requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>sim.jaccard         </td><td>Jaccard Similarity Index                           </td><td>NA     </td><td>mlr3        , mlr3measures</td><td>NA       </td><td>requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>sim.phi             </td><td>Phi Coefficient Similarity                         </td><td>NA     </td><td>mlr3        , mlr3measures</td><td>NA       </td><td>requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>time_both           </td><td>Elapsed Time                                       </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>time_predict        </td><td>Elapsed Time                                       </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>time_train          </td><td>Elapsed Time                                       </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_learner      , requires_no_prediction</td><td></td></tr>
</tbody>
</table>

### è°ƒå–è¯¦æƒ…

```r
mlr_tasks$get('california_housing')
mlr_learners$get('classif.xgboost')
mlr_measures$get('regr.mse')
```

```css
[36m--[39m [1m[34m<TaskRegr>[39m (20640x10): California House Value[22m [36m-------------------------------[39m
* Target: median_house_value
* Properties: -
* Features (9):
  * dbl (8): households, housing_median_age, latitude, longitude,
  median_income, population, total_bedrooms, total_rooms
  * fct (1): ocean_proximity



[36m--[39m [1m[34m<LearnerClassifXgboost>[39m (classif.xgboost): Extreme Gradient Boosting[22m [36m--------[39m
* Model: -
* Parameters: nrounds=1000, nthread=1, verbose=0
* Validate: [34m<NULL>[39m
* Packages: [34mmlr3[39m, [34mmlr3learners[39m, and [34mxgboost[39m
* Predict Types: [response] and prob
* Feature Types: logical, integer, and numeric
* Encapsulation: none (fallback: -)
* Properties: hotstart_forward, importance, internal_tuning, missings,
multiclass, offset, twoclass, validation, and weights
* Other settings: use_weights = 'use'



[36m--[39m [1m[34m<MeasureRegrSimple>[39m (regr.mse): Mean Squared Error[22m [36m--------------------------[39m
* Packages: [34mmlr3[39m and [34mmlr3measures[39m
* Range: [0, Inf]
* Minimize: [34mTRUE[39m
* Average: macro
* Parameters: list()
* Properties: weights
* Predict type: response
* Predict sets: test
* Aggregator: mean()
```

## å›å½’çš„æµç¨‹

### ä»»åŠ¡åŒ–

#### åˆ›å»ºä»»åŠ¡

- `as_task_*()`
  - targetï¼šoutcome
  - idï¼šä»»åŠ¡åç§°
- è¿™é‡Œå°±ç”¨`as_task_regr()`ä»£æ›¿ä¸‹

```r
dt.tskR <- as_task_regr(dt, target = 'outcome')
```

- å¯¹outcomeä¸ç‰¹å¾å€¼çš„å›¾å½¢åŒ–æ¦‚æ‹¬
  - ç‰¹å¾å€¼è¿‡å¤šä¸å»ºè®®ï¼Œåˆæ…¢åˆçœ‹ä¸æ¸…

```r
library(mlr3viz)
autoplot(dt.tskR, type = 'pairs')
```

#### æ•°æ®æ£€ç´¢åŠæ•°æ®å¤„ç†

- å¯ä»¥é€šè¿‡`$`æ¢ç´¢ä»»åŠ¡é‡Œçš„å„ç§ä¿¡æ¯
- å¯¹äºå¯¼å…¥çš„åŸå§‹æ•°æ®è€Œè¨€
  - `dt.tskR$nrow`
  - `dt.tskR$ncol`
  - `dt.tskR$feature_names`
  - `dt.tskR$target_names`
  - `dt.tskR$row_ids`
  - `dt.tskR$col_info`
  - ......
- æœ‰äº›æ˜¯å‡½æ•°
  - `dt.tskR$clone()`
  - `dt.tskR$data()`
  - `dt.tskR$cbind()`
  - `dt.tskR$rbind()`
  - `dt.tskR$filter()`
  - `dt.tskR$select()`
  - `dt.tskR$head()`
  - ......

- è¿™ä¸¤ä¸ªè™½ç„¶ç»“æœä¸€æ ·ï¼Œ  
  ä½†æ˜¯ç¬¬ä¸€ä¸ªæ˜¯å…ˆè°ƒå–æ•´ä¸ªdataå†ç­›é€‰ï¼Œ  
  ç¬¬äºŒä¸ªåˆ™æ˜¯ç›´æ¥å……taské‡Œè°ƒå–ç¬¬äºŒè¡Œ

```r
housing.tskR$data()[2]
housing.tskR$data(rows = housing.tskR$row_ids[2])
```

- å‡½æ•°çš„ç”¨æ³•å’Œå¹³æ—¶çš„ç±»ä¼¼ï¼Œåªæ˜¯é›†æˆåˆ°äº†Taské‡Œé¢è€Œå·²

#### æ•°æ®å¤„ç†çš„å®ä¾‹

- æ³¨æ„ï¼Œ`dt.tskR$func()`æ˜¯å¯¹`dt.tsk`çš„å°±åœ°ä¿®æ”¹ï¼Œ  
  **ä¸éœ€è¦ä¿å­˜åˆ°æ–°çš„å˜é‡é‡Œ**

```r
# å…‹éš†ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„ä»»åŠ¡
dt.tskR2 <- dt.tskR$clone()
# é€‰æ‹©ç¬¬1â€“2è¡Œ
dt.tskR2$filter(1:2)
```

```r
# æ·»åŠ åˆ—
dt.tskR$cbind( 
  data.frame(x = c(150, 160))
)
# æ·»åŠ è¡Œ
dt.tskR_small$rbind( 
  data.frame(x1 = 23, x2 = 5, x3 = 170)
)
dt.tskR_small$data()
```

### å­¦ä¹ å™¨
>
> [mlr-org: Learners](https://mlr-org.com/learners.html)

- å­¦ä¹ å™¨çš„ç±»å‹æ˜¯`Learner`

#### åŒ…çš„åˆ†ç±»

- **mlr3**ï¼šä»…åŒ…å«ä¸€äº›åŸºç¡€çš„å­¦ä¹ å™¨
- **mlr3learners**ï¼šæ¯”`mlr3`åŒ…æ›´ä¸°å¯Œä¸”å¸¸ç”¨çš„å­¦ä¹ å™¨
- **mlr3proba**ï¼šç”Ÿå­˜å­¦ä¹ å™¨
- **mlr3cluster**ï¼šèšç±»å­¦ä¹ å™¨
- **mlr3extralearners**ï¼šä¸€äº›ä¸ç¨³å®šæˆ–è€…CRANä¸Šä¸å¯ç”¨çš„å­¦ä¹ å™¨
- **mlr3torch**ï¼šç¥ç»ç½‘ç»œç›¸å…³å­¦ä¹ å™¨

#### æŸ¥çœ‹å­¦ä¹ å™¨

- `lrn()`å¯ä»¥è°ƒå–å¯¹åº”å­¦ä¹ å™¨çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åŒ…å«ä¸‹åˆ—æ•°æ®
  - `$feature_types`ï¼šå­¦ä¹ å™¨å¯ä»¥å¤„ç†çš„ç‰¹å¾ç±»å‹
  - `$packages`ï¼šä½¿ç”¨è¯¥å­¦ä¹ å™¨éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…
  - `$properties`ï¼šå­¦ä¹ è€…çš„å±æ€§ï¼›ä¾‹å¦‚ï¼Œ**'missings'** å±æ€§è¡¨ç¤ºæ¨¡å‹å¯ä»¥å¤„ç†ç¼ºå¤±æ•°æ®ï¼Œè€Œ **'importance'** è¡¨ç¤ºå®ƒå¯ä»¥è®¡ç®—æ¯ä¸ªç‰¹å¾çš„ç›¸å¯¹é‡è¦æ€§
  - `$predict_types`ï¼šæ¨¡å‹èƒ½å¤Ÿåšå‡ºçš„é¢„æµ‹ç±»å‹
  - `$param_set`ï¼šå¯ç”¨è¶…å‚æ•°é›†

```r
lrn('regr.rpart')
```

```css
[36m--[39m [1m[34m<LearnerRegrRpart>[39m (regr.rpart): Regression Tree[22m [36m----------------------------[39m
* Model: -
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: [response]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, selected_features, and weights
* Other settings: use_weights = 'use'
```

#### ä¼ é€’å¤šä¸ªå­¦ä¹ å™¨

- `lrn()`çš„å¤æ•°å½¢`lrns()`å¯ä»¥è°ƒå–å¤šä¸ªå­¦ä¹ å™¨
- å…¶ä»–çš„ç±»ä¼¼çš„è¿˜æœ‰`tsks()`å’Œåç»­å‡ºç°çš„`msrs()`

```r
dt.lrnR.rpart_lm <- lrns(c('regr.rpart', 'regr.lm'))
dt.lrnR.rpart_lm
```

### åˆ†å‰²è®­ç»ƒé›†å’Œæµ‹è¯•é›†

- `partition()`ä¸­`ratio`ä¸ºè®­ç»ƒé›†å æ•´ä¸ªæ•°æ®é›†æ¯”ä¾‹

```r
dt.tskR.splits <- partition(dt.tsk, ratio = 0.7)
dt.tskR.splits
```

### è®­ç»ƒæ¨¡å‹

- `Learner`ä½œç”¨äº`Task`

```r
dt.lrnR.rpart <- lrn('regr.rpart')
dt.lrnR.rpart$train(dt.tsk)
```

- æ‹Ÿåˆçš„æ¨¡å‹å‚¨å­˜åœ¨`Learner$model`ä¸­

```r
dt.lrnR.rpart$model
```

- é€šè¿‡æŒ‡å®šå‚æ•°`row_ids`åˆ†é…è®­ç»ƒé›†

```r
dt.lrnR.rpart$train(dt.tskR, row_ids = dt.tskR.splits$train)
```

- ä¹Ÿå¯ä»¥æŒ‡å®šé¢„æµ‹ç±»å‹
  - `regr.rpart`ä¸èƒ½é€‰æ‹©responseä»¥å¤–çš„ç±»å‹
  - è¿™é‡Œé€‰æ‹©ç”¨ `regr.lm`æ¥é¢„æµ‹æ ‡å‡†è¯¯å·®

```r
dt.lrnR.lm <- lrn('regr.lm', predict_type = 'se')
```

- å¯ä»¥éšä¾¿çœ‹çœ‹åŒºåˆ«
  - åœ¨æŒ‡å®šäº†**se**åoutputé‡Œ`Predict Types`çš„æ¡†æ¡†ç»™åˆ°äº†`[se]`

```r
lrn('regr.lm')
lrn('regr.lm', predict_type = 'se')
```

```css

[36m--[39m [1m[34m<LearnerRegrLM>[39m (regr.lm): Linear Model[22m [36m-------------------------------------[39m
* Model: -
* Parameters: use_pred_offset=TRUE
* Packages: [34mmlr3[39m, [34mmlr3learners[39m, and [34mstats[39m
* Predict Types: [response] and se
* Feature Types: logical, integer, numeric, character, and factor
* Encapsulation: none (fallback: -)
* Properties: offset and weights
* Other settings: use_weights = 'use'


[36m--[39m [1m[34m<LearnerRegrLM>[39m (regr.lm): Linear Model[22m [36m-------------------------------------[39m
* Model: -
* Parameters: use_pred_offset=TRUE
* Packages: [34mmlr3[39m, [34mmlr3learners[39m, and [34mstats[39m
* Predict Types: response and [se]
* Feature Types: logical, integer, numeric, character, and factor
* Encapsulation: none (fallback: -)
* Properties: offset and weights
* Other settings: use_weights = 'use'
```

### é¢„æµ‹æ•°æ®

- ç”±äº`Learner$predict()`ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦å¦å¤–ä¿å­˜

```r
dt.lrnR.rpart.pred <- dt.lrnR.rpart$predict(dt.tskR, row_ids = dt.tskR.splits$test)
```

- å¯ä»¥ç®€å•çœ‹çœ‹è¿™äº›å¯¹è±¡çš„ç±»åˆ«

```r
dt.tskR %>% class()
dt.lrnR.rpart %>% class()
dt.lrnR.rpart.pred %>% class()
```

```css
'TaskRegr''TaskSupervised''Task''R6'
'LearnerRegrRpart''LearnerRegr''Learner''R6'
'PredictionRegr''Prediction''R6'
```

- `dt.lrnR.rpart.pred`ï¼šè¿”å›ä¸€ä¸ªé¢„æµ‹ç»“æœçš„æ–‡æœ¬è¾“å‡º
- `dt.lrnR.rpart.pred$truth`ï¼šè¿”å›çœŸå®å€¼å‘é‡
- `dt.lrnR.rpart.pred$responese`ï¼šè¿”å›é¢„æµ‹å“åº”å€¼å‘é‡

### å¯¹çœŸå®å€¼-é¢„æµ‹å€¼è¿›è¡Œç»˜å›¾

```r
autoplot(dt.lrnR.rpart.pred)
```

### è¶…å‚æ•°

- è®­ç»ƒæ¨¡å‹å‰éœ€è¦**é¢„å…ˆæŒ‡å®šçš„å‚æ•°**

#### è·å–è¶…å‚æ•°

```r
# 1
dt.lrnR.rpart$param_set
# 2
lrn('regr.rpart')$param_set
```

```css
<ParamSet(10)>
                id    class lower upper nlevels        default  value
            <char>   <char> <num> <num>   <num>         <list> <list>
 1:             cp ParamDbl     0     1     Inf           0.01 [NULL]
 2:     keep_model ParamLgl    NA    NA       2          FALSE [NULL]
 3:     maxcompete ParamInt     0   Inf     Inf              4 [NULL]
 4:       maxdepth ParamInt     1    30      30             30 [NULL]
 5:   maxsurrogate ParamInt     0   Inf     Inf              5 [NULL]
 6:      minbucket ParamInt     1   Inf     Inf <NoDefault[0]> [NULL]
 7:       minsplit ParamInt     1   Inf     Inf             20 [NULL]
 8: surrogatestyle ParamInt     0     1       2              0 [NULL]
 9:   usesurrogate ParamInt     0     2       3              2 [NULL]
10:           xval ParamInt     0   Inf     Inf             10      0
```

- å…¶ä¸­
  - **id**ï¼šè¶…å‚å
  - **class**ï¼šç±»åˆ«
  - **lower**ï¼šæœ€å°å¯è®¾å®šå€¼
  - **upper**ï¼šæœ€å¤§å¯è®¾å®šå€¼
  - **nlevels**ï¼šå¯è®¾å®šå€¼çš„ç§ç±»æ•°ç›®
  - **default**ï¼šåŸå‡½æ•°çš„é»˜è®¤å–å€¼
  - **value**ï¼šå½“å‰å–å€¼ï¼Œ`[NULL]`æ—¶ä½¿ç”¨`default`çš„å€¼

- å½“`cp`è®¾ç½®ä¸º`0.5`åï¼Œå¯ä»¥çœ‹åˆ°outputä¸­`cp`çš„valueå˜æˆäº†`0.5`

```r
lrn('regr.rpart', cp = 0.5)$param_set
```

```css
<ParamSet(10)>
                id    class lower upper nlevels        default  value
            <char>   <char> <num> <num>   <num>         <list> <list>
 1:             cp ParamDbl     0     1     Inf           0.01    0.5
 2:     keep_model ParamLgl    NA    NA       2          FALSE [NULL]
 3:     maxcompete ParamInt     0   Inf     Inf              4 [NULL]
 4:       maxdepth ParamInt     1    30      30             30 [NULL]
 5:   maxsurrogate ParamInt     0   Inf     Inf              5 [NULL]
 6:      minbucket ParamInt     1   Inf     Inf <NoDefault[0]> [NULL]
 7:       minsplit ParamInt     1   Inf     Inf             20 [NULL]
 8: surrogatestyle ParamInt     0     1       2              0 [NULL]
 9:   usesurrogate ParamInt     0     2       3              2 [NULL]
10:           xval ParamInt     0   Inf     Inf             10      0
```

- æŸ¥çœ‹å½“å‰æ¨¡å‹çš„è¶…å‚è®¾å®šæƒ…å†µ

```r
dt.lrnR.rpart$param_set$values
```

- å¯¹æŸ¥çœ‹å½“å‰æ¨¡å‹çš„è¶…å‚è®¾å®šå°±åœ°ä¿®æ”¹

```r
dt.lrnR.rpart$param_set$set_values(cp = 0.02ï¼Œminsplit = 10)
```

#### è¶…å‚ä¾èµ–å…³ç³»

- æ”¯æŒå‘é‡æœºä¸­çš„è¶…å‚æ›´åŠ å¤æ‚

```r
lrn('regr.svm')$param_set
```

```css
<ParamSet(14)>
Key: <id>
           id    class lower upper nlevels        default parents  value
       <char>   <char> <num> <num>   <num>         <list>  <list> <list>
 1: cachesize ParamDbl  -Inf   Inf     Inf             40  [NULL] [NULL]
 2:     coef0 ParamDbl  -Inf   Inf     Inf              0  kernel [NULL]
 3:      cost ParamDbl     0   Inf     Inf              1    type [NULL]
 4:     cross ParamInt     0   Inf     Inf              0  [NULL] [NULL]
 5:    degree ParamInt     1   Inf     Inf              3  kernel [NULL]
 6:   epsilon ParamDbl     0   Inf     Inf            0.1    type [NULL]
 7:    fitted ParamLgl    NA    NA       2           TRUE  [NULL] [NULL]
 8:     gamma ParamDbl     0   Inf     Inf <NoDefault[0]>  kernel [NULL]
 9:    kernel ParamFct    NA    NA       4         radial  [NULL] [NULL]
10:        nu ParamDbl  -Inf   Inf     Inf            0.5    type [NULL]
11:     scale ParamUty    NA    NA     Inf           TRUE  [NULL] [NULL]
12: shrinking ParamLgl    NA    NA       2           TRUE  [NULL] [NULL]
13: tolerance ParamDbl     0   Inf     Inf          0.001  [NULL] [NULL]
14:      type ParamFct    NA    NA       2 eps-regression  [NULL] [NULL]
```

- å¯ä»¥ä»`Learner$param_set$deps`ä¸­è·å¾—è¶…å‚ä¹‹é—´çš„ä¾èµ–å…³ç³»æ€»ç»“

```r
lrn('regr.svm')$param_set$deps
```

<table class='dataframe'>
<caption>A data.table: 6 x 3</caption>
<thead>
 <tr><th scope=col>id</th><th scope=col>on</th><th scope=col>cond</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>coef0  </td><td>kernel</td><td>polynomial    , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>cost   </td><td>type  </td><td>eps-regression, nu-regression , %s %%in%% {%s}</td></tr>
 <tr><td>degree </td><td>kernel</td><td>polynomial, %s == %s  </td></tr>
 <tr><td>epsilon</td><td>type  </td><td>eps-regression, %s == %s      </td></tr>
 <tr><td>gamma  </td><td>kernel</td><td>polynomial    , radial        , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>nu     </td><td>type  </td><td>nu-regression, %s == %s     </td></tr>
</tbody>
</table>

- æŸ¥çœ‹ä¸€ä¸‹è®¾ç½®çš„æ¡ä»¶

```r
for (i in 1:6){
 print(lrn('regr.svm')$param_set$deps[[i, 'cond']])
}
```

```css
CondAnyOf: x %in% {polynomial, sigmoid}
CondAnyOf: x %in% {eps-regression, nu-regression}
CondEqual: x == polynomial
CondEqual: x == eps-regression
CondAnyOf: x %in% {polynomial, radial, sigmoid}
CondEqual: x == nu-regression
```

- è¾“å‡ºä¸­`x`æ˜¯`on`çš„æŒ‡ä»£ï¼Œ  
  å½“è¢«ä¾èµ–çš„è¶…å‚`on`çš„è®¾ç½®æ»¡è¶³æŸæ¡ä»¶æ—¶ï¼Œ  
  `id`ä¸­çš„è¶…å‚æ‰èƒ½è¢«è®¾ç½®
- å¦‚æœ`on`è¶…å‚ä¸æ»¡è¶³æ¡ä»¶ï¼Œè®¾ç½®`id`è¶…å‚ä¼šæŠ¥é”™

#### åŸºå‡†å­¦ä¹ å™¨

- `regr.featureless`
  - å®ƒæ€»æ˜¯å°†æ–°å€¼é¢„æµ‹ä¸ºè®­ç»ƒæ•°æ®ä¸­ç›®æ ‡çš„å‡å€¼
  - å¦‚æœÂ `robust`Â è¶…å‚æ•°è®¾ç½®ä¸ºÂ `TRUE`ï¼Œåˆ™ä¸ºä¸­ä½æ•°
- ç”¨äº
  - æ¨¡å‹æ¯”è¾ƒ
  - å¤‡ç”¨å­¦ä¹ å™¨

```r
lrn('regr.featureless')
```

### æ¨¡å‹è¯„ä¼°

- `msr()`ç”¨äºå•ä¸ªè¯„ä¼°å™¨çš„è¯„ä¼°
- `msrs()`å¯ä»¥è¾“å…¥ä½¿ç”¨å¤šä¸ªè¯„ä¼°å™¨åç§°çš„å‘é‡

```r
# 1
msrR.mse_mae <- msrs(c('regr.mse', 'regr.mae'))
housing.lrnR.rpart.pred$score(msrR.mse_mae)
# 2
housing.lrnR.rpart.pred$score(msrs(c('regr.mse', 'regr.mae')))
```

- `mlr3`è¿˜æœ‰ä¸€äº›å…¶ä»–éè´¨é‡è¯„ä»·çš„è¯„ä¼°æŒ‡æ ‡
  - `msr('time_train')`ï¼šè®­ç»ƒæ¨¡å‹æ‰€èŠ±è´¹çš„æ—¶é—´
  - `msr('time_predict')`ï¼šæ¨¡å‹è¿›è¡Œé¢„æµ‹æ‰€éœ€çš„æ—¶é—´
  - `msr('time_both')`ï¼šè®­ç»ƒæ¨¡å‹ç„¶åè¿›è¡Œé¢„æµ‹æ‰€èŠ±è´¹çš„æ€»æ—¶é—´
  - `msr('selected_features')`ï¼š  
   æ¨¡å‹é€‰æ‹©çš„ç‰¹å¾æ•°é‡ï¼Œä»…å½“æ¨¡å‹å…·æœ‰`selected_features`å±æ€§æ—¶æ‰å¯ä½¿ç”¨

- `Measure$properties`æä¾›äº†è¯„ä¼°å™¨çš„å±æ€§

```r
msr('regr.mse')$properties
msr('time_train')$properties
```

```css
'weights'
'requires_learner''requires_no_prediction'
```

- è¯„ä¼°å™¨çš„è¶…å‚
  - å¯ä»¥æ³¨æ„åˆ°`time_train`çš„`Parameters`æ˜¯`list()`ï¼Œ  
   è¿™ä»£è¡¨æ˜¯ç©ºçš„
  - `selected_features`çš„`Parameters`æœ‰`normalize=FALSE`ï¼Œ  
   è¯´æ˜å¯ä»¥æå‰è®¾ç½®

```r
msr('time_train')
msr('selected_features')
```

```css
[36m--[39m [1m[34m<MeasureElapsedTime>[39m (time_train): Elapsed Time[22m [36m-----------------------------[39m
* Packages: [34mmlr3[39m
* Range: [0, Inf]
* Minimize: [34mTRUE[39m
* Average: macro
* Parameters: list()
* Properties: requires_learner and requires_no_prediction
* Predict type: NA
* Predict sets:
* Aggregator: mean()


[36m--[39m [1m[34m<MeasureSelectedFeatures>[39m (selected_features): Absolute or Relative Frequency[22m
* Packages: [34mmlr3[39m
* Range: [0, Inf]
* Minimize: [34mTRUE[39m
* Average: macro
* Parameters: normalize=FALSE
* Properties: requires_task, requires_learner, requires_model, and
requires_no_prediction
* Predict type: NA
* Predict sets:
* Aggregator: mean()
```

- è®¿é—®è¯„ä¼°å™¨çš„è¶…å‚ä¹Ÿæ˜¯ç”¨`$param_set`

```r
msr.sf <- msr('selected_features')
msr.sf$param_set
```

```css
<ParamSet(1)>
          id    class lower upper nlevels        default  value
      <char>   <char> <num> <num>   <num>         <list> <list>
1: normalize ParamLgl    NA    NA       2 <NoDefault[0]>  FALSE
```

- ä¿®æ”¹

```r
# 1
msr.sf$param_set$set_values(normalize = TRUE)
# 2
msr.sf$param_set$normalize <- TRUE
```

## åˆ†ç±»çš„æµç¨‹

- ä¸å›å½’çš„æµç¨‹ç›¸åŒï¼Œ  
  åªæ˜¯åŸºç¡€å¯¹è±¡åˆ†åˆ«ç»§æ‰¿è‡ª `TaskClassif`ã€`LearnerClassif` å’Œ `MeasureClassif`
- åˆ†ç±»æœ‰**äºŒå…ƒåˆ†ç±»**å’Œ**å¤šå…ƒåˆ†ç±»**ä¸¤ç§

### ä»»åŠ¡åŒ–

- è¿™é‡Œå°±ç›´æ¥è°ƒå–é¢„è®¾çš„ä»»åŠ¡è¿›è¡Œç»ƒä¹ 

```r
mlr_tasks %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 11 x 14</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>task_type</th><th scope=col>nrow</th><th scope=col>ncol</th><th scope=col>properties</th><th scope=col>lgl</th><th scope=col>int</th><th scope=col>dbl</th><th scope=col>chr</th><th scope=col>fct</th><th scope=col>ord</th><th scope=col>pxc</th><th scope=col>dte</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
 <tr><td>breast_cancer     </td><td>Wisconsin Breast Cancer</td><td>classif</td><td>  683</td><td>10</td><td>twoclass</td><td> 0</td><td>0</td><td> 0</td><td>0</td><td> 0</td><td>9</td><td>0</td><td>0</td></tr>
 <tr><td>california_housing</td><td>California House Value </td><td>regr   </td><td>20640</td><td>10</td><td></td><td> 0</td><td>0</td><td> 8</td><td>0</td><td> 1</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>german_credit     </td><td>German Credit          </td><td>classif</td><td> 1000</td><td>21</td><td>twoclass</td><td> 0</td><td>3</td><td> 0</td><td>0</td><td>14</td><td>3</td><td>0</td><td>0</td></tr>
 <tr><td>iris              </td><td>Iris Flowers           </td><td>classif</td><td>  150</td><td> 5</td><td>multiclass</td><td> 0</td><td>0</td><td> 4</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>mtcars            </td><td>Motor Trends           </td><td>regr   </td><td>   32</td><td>11</td><td></td><td> 0</td><td>0</td><td>10</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>penguins          </td><td>Palmer Penguins        </td><td>classif</td><td>  344</td><td> 8</td><td>multiclass</td><td> 0</td><td>3</td><td> 2</td><td>0</td><td> 2</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>pima              </td><td>Pima Indian Diabetes   </td><td>classif</td><td>  768</td><td> 9</td><td>twoclass</td><td> 0</td><td>0</td><td> 8</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>sonar             </td><td>Sonar: Mines vs. Rocks </td><td>classif</td><td>  208</td><td>61</td><td>twoclass</td><td> 0</td><td>0</td><td>60</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>spam              </td><td>HP Spam Detection      </td><td>classif</td><td> 4601</td><td>58</td><td>twoclass</td><td> 0</td><td>0</td><td>57</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>wine              </td><td>Wine Regions           </td><td>classif</td><td>  178</td><td>14</td><td>multiclass</td><td> 0</td><td>2</td><td>11</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>zoo               </td><td>Zoo Animals            </td><td>classif</td><td>  101</td><td>17</td><td>multiclass</td><td>15</td><td>1</td><td> 0</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
</tbody>
</table>

- åˆ†åˆ«ç”¨`german_credit`å’Œ`penguins`ä½œä¸ºäºŒå…ƒåˆ†ç±»å’Œå¤šå…ƒåˆ†ç±»çš„ä¾‹å­

```r
gc.tskC <- tsk('german_credit')
peng.tskC <- tsk('penguins')

gc.tskC
peng.tskC
```

```css
[36m--[39m [1m[34m<TaskClassif>[39m (1000x21): German Credit[22m [36m--------------------------------------[39m
* Target: credit_risk
* Target classes: good (positive class, 70%), bad (30%)
* Properties: twoclass
* Features (20):
  * fct (14): credit_history, employment_duration, foreign_worker, housing,
  job, other_debtors, other_installment_plans, people_liable,
  personal_status_sex, property, purpose, savings, status, telephone
  * int (3): age, amount, duration
  * ord (3): installment_rate, number_credits, present_residence


[36m--[39m [1m[34m<TaskClassif>[39m (344x8): Palmer Penguins[22m [36m--------------------------------------[39m
* Target: species
* Target classes: Adelie (44%), Gentoo (36%), Chinstrap (20%)
* Properties: multiclass
* Features (7):
  * int (3): body_mass, flipper_length, year
  * dbl (2): bill_depth, bill_length
  * fct (2): island, sex
```

### äºŒå…ƒåˆ†ç±»

#### Outcomeçš„åˆ†ç±»

```r
gc.tskC$class_names
gc.tskC$properties
```

```css
'good''bad'
'twoclass'
```

#### å®šä¹‰æ­£ç±»

```r
gc.tskC$positive <- 'good'
```

- å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªçº§åˆ«æ˜¯æ­£ç±»

#### å¯¹çœŸå®å€¼-é¢„æµ‹å€¼è¿›è¡Œç»˜å›¾

```r
autoplot(gc.tskC, type = 'duo') +
  theme(strip.text.y = element_text(angle = -45, size = 8))
```

#### é¢„æµ‹ç»“æœ

- `predict_type`å¯ä»¥é€‰æ‹©é¢„æµ‹å“åº”ç±»åˆ«`'response'`æˆ–è€…æ¦‚ç‡`'prob'`
  - é€‰æ‹©æ¦‚ç‡ä¹Ÿä¼šç»™å‡º`response`çš„ç»“æœ
  - æ‰€ä»¥å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œç”¨æ¦‚ç‡ä¼šæ›´å¥½

```r
lrn('classif.rpart') # 'response'æ˜¯é»˜è®¤
lrn('classif.rpart', predict_type = 'prob')
```

```r
# gc.tskC.splits <- partition(gc.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

gc.lrnC.rpart <- lrn('classif.rpart', predict_type = 'response')
gc.lrnC.rpart$train(gc.tskC, gc.tskC.splits$train)
gc.lrnC.rpart.pred <- gc.lrnC.rpart$predict(gc.tskC, gc.tskC.splits$test)
gc.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m300[39m observations:[22m [36m-----------------------------------[39m
 row_ids truth response
       6  good     good
       8  good      bad
      10   bad      bad
     ---   ---      ---
     992  good     good
     995  good     good
    1000  good      bad
```

```r
# gc.tskC.splits <- partition(gc.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

gc.lrnC.rpart <- lrn('classif.rpart', predict_type = 'prob')
gc.lrnC.rpart$train(gc.tskC, gc.tskC.splits$train)
gc.lrnC.rpart.pred <- gc.lrnC.rpart$predict(gc.tskC, gc.tskC.splits$test)
gc.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m300[39m observations:[22m [36m-----------------------------------[39m
 row_ids truth response  prob.good  prob.bad
       6  good     good 0.85667752 0.1433225
       8  good      bad 0.21739130 0.7826087
      10   bad      bad 0.29411765 0.7058824
     ---   ---      ---        ---       ---
     992  good     good 0.85667752 0.1433225
     995  good     good 0.85667752 0.1433225
    1000  good      bad 0.07692308 0.9230769
```

#### æ¨¡å‹è¯„ä¼°

- ä¸åŒç§ç±»çš„è¯„ä¼°å™¨å¯¹äº`response`å’Œ`prob`çš„é€‚ç”¨æ€§æ˜¯ä¸åŒçš„ï¼Œ  
  éœ€è¦æ‰¾åˆ°åˆé€‚çš„è¯„ä¼°å™¨

- å¯»æ‰¾æ”¯æŒåˆ†ç±»å¹¶ç”¨äºè¯„ä¼°æ¦‚ç‡çš„è¯„ä¼°å™¨

```r
as.data.table(msr())[
    task_type == 'classif' & predict_type == 'prob']
```

<table class='dataframe'>
<caption>A data.table: 7 x 7</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>task_type</th><th scope=col>packages</th><th scope=col>predict_type</th><th scope=col>properties</th><th scope=col>task_properties</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>classif.logloss  </td><td>Log Loss                                  </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td>weights</td><td></td></tr>
 <tr><td>classif.mauc_au1p</td><td>Weighted average 1 vs. 1 multiclass AUC   </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_au1u</td><td>Average 1 vs. 1 multiclass AUC            </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunp</td><td>Weighted average 1 vs. rest multiclass AUC</td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunu</td><td>Average 1 vs. rest multiclass AUC         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_mu  </td><td>Multiclass mu AUC                         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mbrier   </td><td>Multiclass Brier Score                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
</tbody>
</table>

- è¿™é‡Œä½¿ç”¨äº†3ç§è¯„ä¼°å™¨
  - `classif.mbrier`ï¼šç”¨é¢„æµ‹æ¦‚ç‡ä¸çœŸå®å€¼ä¹‹é—´çš„å¹³æ–¹å·®è¯„ä¼°`prob`çš„é¢„æµ‹ç»“æœ
  - `classif.logloss`ï¼šç”¨çœŸå®ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡çš„è´Ÿå¯¹æ•°è¯„ä¼°`prob`çš„é¢„æµ‹ç»“æœ
  - `classif.acc`ï¼šè¯„ä¼°`response`çš„é¢„æµ‹åˆ†ç±»ç»“æœ

```r
gc.lrnC.rpart.pred$score(msrs(c('classif.mbrier', 'classif.logloss', 'classif.acc')))
```

#### æ··æ·†çŸ©é˜µ

- `Prediction$confution`æŸ¥çœ‹æ··æ·†çŸ©é˜µ

```r
gc.lrnC.rpart.pred$confusion
```

```css
        truth
response good bad
    good  177  45
    bad    41  37
```

- é€šè¿‡`autoplot(Prediction)`å¯è§†åŒ–æ··æ·†çŸ©é˜µ

```r
autoplot(gc.lrnC.rpart.pred)
```

#### é˜ˆå€¼è®¾å®š

- `Prediction$set_threshold()`è®¾å®šé˜ˆå€¼
  - é˜ˆå€¼æ˜¯**åˆ¤æ–­ä¸ºæ­£ç±»**çš„é˜ˆå€¼ï¼Œå› æ­¤éœ€è¦æ­£ç¡®è®¾ç½®æ­£ç±»

```r
gc.lrnC.rpart.pred$set_threshold(YourThreshold)
```

### å¤šå…ƒåˆ†ç±»

#### Outcomeçš„åˆ†ç±»

```r
peng.tskC$class_names
peng.tskC$properties
```

```css
'Adelie''Chinstrap''Gentoo'
'multiclass'
```

#### æ²¡æœ‰å®šä¹‰æ­£ç±»

- å®šä¹‰äº†åè€Œä¼šæŠ¥é”™çš„

```r
peng.tskC$positive <- 'Adelie'
```

```css
Error in (function (rhs) : Setting the positive class is only feasible for binary classification
```

#### å¯¹çœŸå®å€¼-é¢„æµ‹å€¼è¿›è¡Œç»˜å›¾

```r
autoplot(peng.tskC, type = 'duo') +
  theme(strip.text.y = element_text(angle = -45, size = 8))
```

#### é¢„æµ‹ç»“æœ

```r
# peng.tskC.splits <- partition(peng.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

peng.lrnC.rpart <- lrn('classif.rpart', predict_type = 'response')
peng.lrnC.rpart$train(peng.tskC, peng.tskC.splits$train)
peng.lrnC.rpart.pred <- peng.lrnC.rpart$predict(peng.tskC, peng.lrnC.splits$test)
peng.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m103[39m observations:[22m [36m-----------------------------------[39m
 row_ids     truth  response
      11    Adelie    Adelie
      13    Adelie    Adelie
      14    Adelie    Adelie
     ---       ---       ---
     326 Chinstrap Chinstrap
     331 Chinstrap    Adelie
     338 Chinstrap Chinstrap
```

```r
# peng.tskC.splits <- partition(peng.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

peng.lrnC.rpart <- lrn('classif.rpart', predict_type = 'prob')
peng.lrnC.rpart$train(peng.tskC, peng.tskC.splits$train)
peng.lrnC.rpart.pred <- peng.lrnC.rpart$predict(peng.tskC, peng.lrnC.splits$test)
peng.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m103[39m observations:[22m [36m-----------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
      11    Adelie    Adelie   0.9537037     0.01851852  0.02777778
      13    Adelie    Adelie   0.9537037     0.01851852  0.02777778
      14    Adelie    Adelie   0.9537037     0.01851852  0.02777778
     ---       ---       ---         ---            ---         ---
     326 Chinstrap Chinstrap   0.0000000     1.00000000  0.00000000
     331 Chinstrap    Adelie   0.9537037     0.01851852  0.02777778
     338 Chinstrap Chinstrap   0.0000000     1.00000000  0.00000000
```

#### æ¨¡å‹è¯„ä¼°

- å¯»æ‰¾æ”¯æŒå¤šå…ƒåˆ†ç±»å¹¶ç”¨äºè¯„ä¼°æ¦‚ç‡çš„è¯„ä¼°å™¨

```r
as.data.table(msr())[
    task_type == 'classif' & predict_type == 'prob' &
    !sapply(task_properties, function(x) return('twoclass' %in% x))]
```

```r
peng.lrnC.rpart.pred$score(msrs(c('classif.mbrier', 'classif.logloss', 'classif.acc')))
```

#### æ··æ·†çŸ©é˜µ

- `Prediction$confution`æŸ¥çœ‹æ··æ·†çŸ©é˜µ

```r
gc.lrnC.rpart.pred$confusion
```

```css
        truth
response good bad
    good  177  45
    bad    41  37
```

- é€šè¿‡`autoplot(Prediction)`å¯è§†åŒ–æ··æ·†çŸ©é˜µ

```r
autoplot(gc.lrnC.rpart.pred)
```

#### é˜ˆå€¼è®¾å®š

- `Prediction$set_threshold()`è®¾å®šé˜ˆå€¼
  - ä¸äºŒå…ƒåˆ†ç±»ä¸åŒçš„æ˜¯ï¼Œå¤šå…ƒåˆ†ç±»éœ€è¦**ç»™æ¯ä¸€ä¸ªåˆ†ç±»**å•ç‹¬è®¾ç½®ä¸€ä¸ªé˜ˆå€¼

- åœ¨å¤šåˆ†ç±»é—®é¢˜ä¸­é˜ˆå€¼åŒ–çš„å·¥ä½œåŸç†
  - é¦–å…ˆä¸ºÂ `n`Â ä¸ªç±»åˆ«ä¸­çš„æ¯ä¸ªç±»åˆ«åˆ†é…ä¸€ä¸ªé˜ˆå€¼ï¼Œ  
   å°†æ¯ä¸ªç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡é™¤ä»¥è¿™äº›é˜ˆå€¼ï¼Œ  
   ä»¥è¿”å›Â `n`Â ä¸ªæ¯”ç‡ï¼Œç„¶åé€‰æ‹©æ¯”ç‡æœ€é«˜çš„ç±»åˆ«  
   ï¼ˆè¿™é‡Œçš„é˜ˆå€¼å…¶å®å°±æ˜¯æƒé‡äº†ï¼Œé˜ˆå€¼è¶Šå°ï¼Œæƒé‡è¶Šé«˜ï¼‰

- é€šè¿‡ä¼ é€’ä¸€ä¸ªå‘½åå‘é‡è¿›è¡Œæ›´æ”¹

```r
# éšä¾¿è®¾ç½®
peng.lrnC.rpart.pred$set_threshold(c(
 'Adelie' = 0.8,
 'Chinstrap' = 0.5,
 'Gentoo' = 0.2
))
```

- é€†åŠ æƒè®¾å®šé˜ˆå€¼
  - å°†æ–°é˜ˆå€¼è®¾ç½®ä¸ºè®­ç»ƒé›†ä¸­æ¯ä¸ªç±»åˆ«çš„æ¯”ä¾‹
  - åœ¨é€‰æ‹©æ¯”ç‡æœ€é«˜çš„æ ‡ç­¾ä¹‹å‰ï¼Œç”¨é¢„æµ‹æ¦‚ç‡é™¤ä»¥è¿™äº›ç±»åˆ«æ¯”ä¾‹

```r
# é€†åŠ æƒæ³•è®¾ç½®
peng.lrnC.rpart.pred$set_threshold(
 peng.tskC$truth(peng.tskC.splits$train) %>% 
  table() %>% 
  proportions()
)
```

## å®šä¹‰æ•°æ®role

- `Task$col_roles`èƒ½æ˜¾ç¤ºæ‰€æœ‰çš„role

```r
peng.tskC$col_roles
```

```css
$feature
'bill_depth''bill_length''flipper_length''island''sex''year''body_mass'
$target
'species'
$name
$order
$stratum
$group
$offset
$weights_learner
$weights_measure
```

- é€šè¿‡`Task$set_col_roles('col', roles = 'role')`æ¥é‡æ–°å®šä¹‰

```r
set_col_roles('body_mass', roles = 'feature')
```

## è¯„ä¼°ä¸åŸºå‡†æµ‹è¯•

### ç•™å‡ºæ³•ä¸è¯„åˆ†

- ç•™å‡ºæ³•å°±æ˜¯`partition()`çš„ç®€å•åˆ’åˆ†æ–¹æ³•
- è¯„ä¼°`Prediction$score`æ˜¯ç”¨æ¥ä¼°è®¡æœ€ç»ˆæ¨¡å‹çš„**æ³›åŒ–èƒ½åŠ›**
![image_2](./image_2.png)

## é‡é‡‡æ ·

### ç®€ä»‹

![image_3](./image_3.png)
**kæŠ˜äº¤å‰éªŒè¯ï¼ˆk-fold cross-validation, CVï¼‰**

- å°†æ•°æ®é›†æ‹†åˆ†ä¸ºkæŠ˜ï¼Œå…¶ä¸­k-1æŠ˜ç”¨äºæ¨¡å‹è®­ç»ƒï¼Œå‰©ä¸‹1æŠ˜ç”¨äºæµ‹è¯•æ•°æ®
- è¿‡ç¨‹é‡å¤è¿›è¡Œï¼Œç›´åˆ°æ¯ä¸€æŠ˜éƒ½è¢«ä½œä¸ºæµ‹è¯•é›†ä½¿ç”¨ä¸€æ¬¡
- å°†kä¸ªæ¨¡å‹çš„æ€§ä¼°è®¡å€¼æ±‡æ€»ï¼Œé€šå¸¸å–å¹³å‡å€¼

- **ç•™ä¸€æ³•äº¤å‰éªŒè¯ï¼ˆleave-one-out cross-validation, LOO-CVï¼‰**
  - CVçš„å˜ä½“ï¼Œç”¨äºæµ‹è¯•é›†çš„æ•°æ®ä¸æ˜¯ä¸€æŠ˜è€Œæ˜¯**ä¸€ä¸ªæ ·æœ¬**
- **å­é‡‡æ ·ï¼ˆsubsamplingï¼‰**
  - æŒ‰ä¸€å®šæ¯”ä¾‹**æ— æ”¾å›**åœ°æŠ½å–æ•°æ®ç”¨ä½œè®­ç»ƒé›†ï¼Œå‰©ä½™çš„æ ·æœ¬ä½œä¸ºæµ‹è¯•é›†
  - ä¸CVä¸åŒçš„æ˜¯ï¼Œæ¯æ¬¡æŠ½å–éƒ½æ˜¯éšæœºçš„ï¼Œæ„å‘³ç€æœ‰çš„æ ·æœ¬ä¼šè¢«é‡å¤æŠ½å–
  - å¹³å‡è€Œè¨€ï¼Œåœ¨è‡ªåŠ©é‡‡æ ·è¿‡ç¨‹ä¸­ï¼Œ  
   $1-e^{-1} \simeq 63.2\%$ çš„æ•°æ®ç‚¹å°†åŒ…å«åœ¨è®­ç»ƒé›†ä¸­ï¼Œ  
   è¿™äº›æ•°æ®ç‚¹è¢«ç§°ä¸º â€œè¢‹å†…â€ æ ·æœ¬ï¼ˆå¦å¤–36.8% è¢«ç§°ä¸º â€œè¢‹å¤–â€ æ ·æœ¬ï¼‰
- **è‡ªåŠ©é‡‡æ ·ï¼ˆbootstrappingï¼‰**
  - ç±»ä¼¼äºå­é‡‡æ ·ï¼Œä½†æ˜¯æŠ½å–æ ·æœ¬æ˜¯**æœ‰æ”¾å›çš„**
  - è‡ªåŠ©æ³•å·²ç»ä¸å¤ªå¸¸ç”¨ï¼Œ  
   å› ä¸ºè®­ç»ƒæ•°æ®ä¸­çš„é‡å¤è§‚æµ‹åœ¨æŸäº›æœºå™¨å­¦ä¹ è®¾ç½®ä¸­ä¼šå¯¼è‡´é—®é¢˜ï¼Œ  
   ç‰¹åˆ«æ˜¯ä¸æ¨¡å‹é€‰æ‹©æ–¹æ³•å’ŒåµŒå¥—é‡é‡‡æ ·ç»“åˆæ—¶  
   ï¼ˆå› ä¸ºåœ¨åµŒå¥—æ–¹æ¡ˆä¸­ï¼Œé‡å¤è§‚æµ‹å¯èƒ½ä¼šåŒæ—¶å‡ºç°åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­ï¼‰

![image_4](./image_4.png)
> [ä¸‰é‡äº¤å‰éªŒè¯ç¤ºæ„å›¾](https://mlr3book.mlr-org.com/chapters/chapter3/evaluation_and_benchmarking.html)

### æ„å»ºé‡é‡‡æ ·ç­–ç•¥

- æŸ¥çœ‹æ‰€æœ‰é‡é‡‡æ ·ç­–ç•¥

```r
mlr_resamplings %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 9 x 4</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>params</th><th scope=col>iters</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
 <tr><td>bootstrap  </td><td>Bootstrap                    </td><td>ratio  , repeats</td><td> 30</td></tr>
 <tr><td>custom     </td><td>Custom Splits                </td><td></td><td> NA</td></tr>
 <tr><td>custom_cv  </td><td>Custom Split Cross-Validation</td><td></td><td> NA</td></tr>
 <tr><td>cv         </td><td>Cross-Validation             </td><td>folds</td><td> 10</td></tr>
 <tr><td>holdout    </td><td>Holdout                      </td><td>ratio</td><td>  1</td></tr>
 <tr><td>insample   </td><td>Insample Resampling          </td><td></td><td>  1</td></tr>
 <tr><td>loo        </td><td>Leave-One-Out                </td><td></td><td> NA</td></tr>
 <tr><td>repeated_cv</td><td>Repeated Cross-Validation    </td><td>folds  , repeats</td><td>100</td></tr>
 <tr><td>subsampling</td><td>Subsampling                  </td><td>ratio  , repeats</td><td> 30</td></tr>
</tbody>
</table>

- åˆ›å»º`Resampling`å¯¹è±¡

```r
rsmp('cv', folds = 5)
```

```css
[36m--[39m [1m[34m<ResamplingCV>[39m : Cross-Validation[22m [36m-------------------------------------------[39m
* Iterations: [34m5[39m
* Instantiated: [34mFALSE[39m
* Parameters: folds=5
```

- `Resampling`å¯¹è±¡ä¹Ÿæœ‰å‚æ•°å¯ä»¥è®¾å®š  
  - å¯ä»¥ç”¨`Resampling$param_set`æŸ¥çœ‹
  - ä¹Ÿèƒ½ç”¨`rsmp.cv$param_set$set_values()`é‡æ–°è®¾å®šå‚æ•°

```r
rsmp.cv <- rsmp('cv')
rsmp.cv$param_set
```

```css
<ParamSet(1)>
       id    class lower upper nlevels        default  value
   <char>   <char> <int> <num>   <num>         <list> <list>
1:  folds ParamInt     2   Inf     Inf <NoDefault[0]>     10
```

```r
rsmp.cv$param_set$set_values(folds = 5)
rsmp.cv$param_set
```

```css
<ParamSet(1)>
       id    class lower upper nlevels        default  value
   <char>   <char> <int> <num>   <num>         <list> <list>
1:  folds ParamInt     2   Inf     Inf <NoDefault[0]>      5
```

- `Resampling$instantiate(Task)`å¯ä»¥æ‰‹åŠ¨æ„å»ºé‡é‡‡æ ·ç­–ç•¥ï¼Œ  
  ç”Ÿæˆæ‰€æœ‰çš„è®­ç»ƒé›†-æµ‹è¯•é›†æ‹†åˆ†

```r
rsmp.cv <- rsmp('cv', folds = 5)
rsmp.cv$instantiate(peng.tskC)

# ç¬¬ä¸€ä¸ªè®­ç»ƒé›†ä¸­å‰äº”ä¸ªæ ·æœ¬
rsmp.cv$train_set(1)[1:5]
# ç¬¬ä¸‰ä¸ªæµ‹è¯•é›†ä¸­å‰äº”ä¸ªæ ·æœ¬
rsmp.cv$test_set(3)[1:5]
```

### æ‰§è¡Œé‡é‡‡æ ·

- ä½¿ç”¨`resample()`æ‰§è¡Œé‡é‡‡æ ·ï¼Œå‚æ•°ä¾æ¬¡ä¸º`Task`ï¼Œ`Learner`ï¼Œ`Resampling`
  - æ³¨æ„ï¼Œè¿™é‡Œçš„`Learner`

```r
peng.lrnC.rpart.rr <- resample(peng.tskC, peng.lrnC.rpart, rsmp.cv)
peng.lrnC.rpart.rr
```

```css

[36m--[39m [1m[34m<ResampleResult>[39m with [34m5[39m resampling iterations[22m [36m-------------------------------[39m
  task_id    learner_id resampling_id iteration     prediction_test warnings
 penguins classif.rpart            cv         1 <PredictionClassif>        0
 penguins classif.rpart            cv         2 <PredictionClassif>        0
 penguins classif.rpart            cv         3 <PredictionClassif>        0
 penguins classif.rpart            cv         4 <PredictionClassif>        0
 penguins classif.rpart            cv         5 <PredictionClassif>        0
 errors
      0
      0
      0
      0
      0
```

- é»˜è®¤æ˜¯ä¸å‚¨å­˜æ‰€æœ‰è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹çš„ï¼Œ  
  å¦‚æœè¦å‚¨å­˜ï¼Œåˆ™éœ€è¦æŒ‡å®šå‚æ•°`store_models = TRUE`

```r
peng.lrnC.rpart.rr <- resample(peng.tskC, peng.lrnC.rpart, rsmp.cv, store_models = TRUE)
```

- æŸ¥çœ‹ç²¾å‡†åº¦è¯„ä¼°ç»“æœ

```r
# åˆ†å¼€çš„ç»“æœ
peng.lrnC.rpart.rr$score(msr('classif.acc'))
# æ•´åˆç»“æœ
peng.lrnC.rpart.rr$aggregate(msr('classif.acc'))
```

<table class='dataframe'>
<caption>A rr_score: 5 x 9</caption>
<thead>
 <tr><th scope=col>task</th><th scope=col>task_id</th><th scope=col>learner</th><th scope=col>learner_id</th><th scope=col>resampling</th><th scope=col>resampling_id</th><th scope=col>iteration</th><th scope=col>prediction_test</th><th scope=col>classif.acc</th></tr>
 <tr><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>&lt;environment: 0x10a09dc58&gt;</td><td>penguins</td><td>&lt;environment: 0x10c5640f0&gt;</td><td>classif.rpart</td><td>&lt;environment: 0x118978278&gt;</td><td>cv</td><td>1</td><td>&lt;environment: 0x11964f5b8&gt;</td><td>0.9130435</td></tr>
 <tr><td>&lt;environment: 0x10a09dc58&gt;</td><td>penguins</td><td>&lt;environment: 0x139a15978&gt;</td><td>classif.rpart</td><td>&lt;environment: 0x118978278&gt;</td><td>cv</td><td>2</td><td>&lt;environment: 0x119767f20&gt;</td><td>0.9130435</td></tr>
 <tr><td>&lt;environment: 0x10a09dc58&gt;</td><td>penguins</td><td>&lt;environment: 0x1395c69e0&gt;</td><td>classif.rpart</td><td>&lt;environment: 0x118978278&gt;</td><td>cv</td><td>3</td><td>&lt;environment: 0x1099dbc90&gt;</td><td>0.9710145</td></tr>
 <tr><td>&lt;environment: 0x10a09dc58&gt;</td><td>penguins</td><td>&lt;environment: 0x1391f6740&gt;</td><td>classif.rpart</td><td>&lt;environment: 0x118978278&gt;</td><td>cv</td><td>4</td><td>&lt;environment: 0x11a3bea58&gt;</td><td>0.9710145</td></tr>
 <tr><td>&lt;environment: 0x10a09dc58&gt;</td><td>penguins</td><td>&lt;environment: 0x1380535f0&gt;</td><td>classif.rpart</td><td>&lt;environment: 0x118978278&gt;</td><td>cv</td><td>5</td><td>&lt;environment: 0x10d1c6e00&gt;</td><td>0.9411765</td></tr>
</tbody>
</table>

```css
classif.acc: 0.941858482523444
```

- é»˜è®¤çš„æ•´åˆæ–¹å¼æ˜¯ä½¿ç”¨å¹³å‡å€¼ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–æ–¹å¼
  - è¿™é‡Œç”¨çš„æ˜¯å¾®å¹³å‡ï¼ˆmicro averageï¼‰
    - æŠŠé‡é‡‡æ ·è¿­ä»£ä¸­çš„é¢„æµ‹ç»“æœåˆå¹¶åˆ°ä¸€ä¸ª `Prediction` å¯¹è±¡ä¸­ï¼Œ  
    ç„¶åç›´æ¥åœ¨æ­¤å¯¹è±¡ä¸Šè®¡ç®—æŒ‡æ ‡
  - é»˜è®¤çš„èšåˆæ–¹æ³•ç±»å‹å¯ä»¥é€šè¿‡æŸ¥è¯¢`Measure`å¯¹è±¡çš„`$average`å­—æ®µæ¥æ‰¾åˆ°

```r
peng.lrnC.rpart.rr$aggregate(msr('classif.acc', average = 'micro'))
```

```css
classif.acc: 0.941860465116279
```

```r
msr('classif.ce')$average
```

```css
'macro'
```

- å®å¹³å‡å’Œå¾®å¹³å‡çš„è¯¦ç»†

```r
# macro
mean(mean(c(3, 5, 9)), mean(c(1, 5)))

# micro
mean(c(3, 5, 9, 1, 5))
 ```

![image_5](./image_5.png)
> `$score()` ä¸ `$aggregate()` ä¹‹é—´å·®å¼‚çš„ç¤ºä¾‹ï¼šå‰è€…åœ¨æ¯æ¬¡é‡é‡‡æ ·è¿­ä»£ä¸­å°†é¢„æµ‹ç»“æœèšåˆä¸ºå•ä¸ªåˆ†æ•°ï¼Œè€Œåè€…åˆ™åœ¨æ‰€æœ‰é‡é‡‡æ ·è¿­ä»£ä¸­èšåˆåˆ†æ•°

- å¯ä»¥ç”¨`autoplot.ResampleResult()`ç”Ÿæˆé‡é‡‡æ ·çš„ç»“æœ

```r
autoplot(peng.lrnC.rpart.rr, type = 'boxplot')
autoplot(peng.lrnC.rpart.rr, type = 'histogram')
```

### é‡é‡‡æ ·ç»“æœå¯¹è±¡

- `ResampleResult$$prediction()`æ‰“å°å•ä¸ªæ¨¡å‹çš„é¢„æµ‹ç»“æœï¼Œ  
  è¿™ä¸ªç»“æœæ˜¯æ•´åˆäº†å…¨éƒ¨æ¨¡å‹é¢„æµ‹çš„ç»“æœ
  - ç»„åˆåçš„é¢„æµ‹å¯¹è±¡å¯ç”¨äºæ‰‹åŠ¨è®¡ç®—å¾®å¹³å‡æ€§èƒ½ä¼°è®¡å€¼
- `ResampleResult$$predictions()`åˆ†åˆ«æ‰“å°æ‰€æœ‰æ¨¡å‹çš„é¢„æµ‹ç»“æœ

```r
peng.lrnC.rpart.rr$prediction()
peng.lrnC.rpart.rr$predictions()
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m344[39m observations:[22m [36m-----------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
       7    Adelie    Adelie  0.98290598     0.01709402  0.00000000
       9    Adelie    Adelie  0.98290598     0.01709402  0.00000000
      16    Adelie    Adelie  0.98290598     0.01709402  0.00000000
     ---       ---       ---         ---            ---         ---
     320 Chinstrap Chinstrap  0.05454545     0.92727273  0.01818182
     338 Chinstrap Chinstrap  0.05454545     0.92727273  0.01818182
     344 Chinstrap Chinstrap  0.05454545     0.92727273  0.01818182
```

```css
[[1]]

[36m--[39m [1m[34m<PredictionClassif>[39m for [34m69[39m observations:[22m [36m------------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
       7    Adelie    Adelie  0.98290598     0.01709402  0.00000000
       9    Adelie    Adelie  0.98290598     0.01709402  0.00000000
      16    Adelie    Adelie  0.98290598     0.01709402  0.00000000
     ---       ---       ---         ---            ---         ---
     315 Chinstrap Chinstrap  0.05882353     0.92156863  0.01960784
     317 Chinstrap Chinstrap  0.28571429     0.57142857  0.14285714
     335 Chinstrap Chinstrap  0.05882353     0.92156863  0.01960784

[[2]]

[36m--[39m [1m[34m<PredictionClassif>[39m for [34m69[39m observations:[22m [36m------------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
       4    Adelie    Adelie  0.97580645     0.02419355    0.000000
      12    Adelie    Adelie  0.97580645     0.02419355    0.000000
      25    Adelie    Adelie  0.97580645     0.02419355    0.000000
     ---       ---       ---         ---            ---         ---
     334 Chinstrap Chinstrap  0.08000000     0.92000000    0.000000
     340 Chinstrap    Gentoo  0.00990099     0.02970297    0.960396
     343 Chinstrap    Gentoo  0.00990099     0.02970297    0.960396

[[3]]

[36m--[39m [1m[34m<PredictionClassif>[39m for [34m69[39m observations:[22m [36m------------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
       5    Adelie    Adelie   0.9669421     0.03305785  0.00000000
      10    Adelie    Adelie   0.9669421     0.03305785  0.00000000
      14    Adelie    Adelie   0.9669421     0.03305785  0.00000000
     ---       ---       ---         ---            ---         ---
     322 Chinstrap Chinstrap   0.0754717     0.90566038  0.01886792
     337 Chinstrap Chinstrap   0.2500000     0.50000000  0.25000000
     339 Chinstrap Chinstrap   0.0754717     0.90566038  0.01886792

[[4]]

[36m--[39m [1m[34m<PredictionClassif>[39m for [34m69[39m observations:[22m [36m------------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
       8    Adelie    Adelie  0.96124031     0.03875969   0.0000000
      21    Adelie    Adelie  0.96124031     0.03875969   0.0000000
      22    Adelie    Adelie  0.96124031     0.03875969   0.0000000
     ---       ---       ---         ---            ---         ---
     336 Chinstrap Chinstrap  0.06382979     0.91489362   0.0212766
     341 Chinstrap    Adelie  0.96124031     0.03875969   0.0000000
     342 Chinstrap Chinstrap  0.06382979     0.91489362   0.0212766

[[5]]

[36m--[39m [1m[34m<PredictionClassif>[39m for [34m68[39m observations:[22m [36m------------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
       1    Adelie    Adelie  0.96363636     0.03636364  0.00000000
       2    Adelie    Adelie  0.96363636     0.03636364  0.00000000
       3    Adelie    Adelie  0.96363636     0.03636364  0.00000000
     ---       ---       ---         ---            ---         ---
     320 Chinstrap Chinstrap  0.05454545     0.92727273  0.01818182
     338 Chinstrap Chinstrap  0.05454545     0.92727273  0.01818182
     344 Chinstrap Chinstrap  0.05454545     0.92727273  0.01818182
```

- å¦‚æœåœ¨é‡é‡‡æ ·æ—¶æŒ‡å®šäº† `store_models = TRUE`ï¼Œ  
  ä¹Ÿå¯ä»¥åŒç†è°ƒå‡ºå­¦ä¹ å™¨
- `ResampleResult$learner`å¹¶ä¸æ˜¯èšåˆåçš„å­¦ä¹ å™¨ï¼Œ  
  è€Œæ˜¯**æœ€ç»ˆé€‰æ‹©å‡ºæ¥çš„æ¨¡å‹**

```r
peng.lrnC.rpart.rr$learner
peng.lrnC.rpart.rr$learners
```

```css
[36m--[39m [1m[34m<LearnerClassifRpart>[39m (classif.rpart): Classification Tree[22m [36m------------------[39m
* Model: -
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: response and [prob]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, multiclass, selected_features, twoclass,
and weights
* Other settings: use_weights = 'use'
```

```css
[[1]]

[36m--[39m [1m[34m<LearnerClassifRpart>[39m (classif.rpart): Classification Tree[22m [36m------------------[39m
* Model: rpart
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: response and [prob]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, multiclass, selected_features, twoclass,
and weights
* Other settings: use_weights = 'use'

[[2]]

[36m--[39m [1m[34m<LearnerClassifRpart>[39m (classif.rpart): Classification Tree[22m [36m------------------[39m
* Model: rpart
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: response and [prob]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, multiclass, selected_features, twoclass,
and weights
* Other settings: use_weights = 'use'

[[3]]

[36m--[39m [1m[34m<LearnerClassifRpart>[39m (classif.rpart): Classification Tree[22m [36m------------------[39m
* Model: rpart
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: response and [prob]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, multiclass, selected_features, twoclass,
and weights
* Other settings: use_weights = 'use'

[[4]]

[36m--[39m [1m[34m<LearnerClassifRpart>[39m (classif.rpart): Classification Tree[22m [36m------------------[39m
* Model: rpart
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: response and [prob]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, multiclass, selected_features, twoclass,
and weights
* Other settings: use_weights = 'use'

[[5]]

[36m--[39m [1m[34m<LearnerClassifRpart>[39m (classif.rpart): Classification Tree[22m [36m------------------[39m
* Model: rpart
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: response and [prob]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, multiclass, selected_features, twoclass,
and weights
* Other settings: use_weights = 'use'
```

- å¯ä»¥ç”¨`lapply()`æŸ¥çœ‹æ¯ä¸ªæ¨¡å‹ä¸­å˜é‡é‡è¦åº¦

```r
# æŸ¥çœ‹å…¨éƒ¨
lapply(
 peng.lrnC.rpart.rr$learners[2:3], 
 function(x) return(x$model$variable.importance)
)

# é€‰æ‹©å­é›†
lapply(
 peng.lrnC.rpart.rr$learners[2:3], 
 function(x) return(x$model$variable.importance)
)
```

### è‡ªå®šä¹‰é‡é‡‡æ ·

- `rsmp('custom')`ç”¨äºæ„å»º**ç•™å‡ºé‡é‡‡æ ·**
  - ç•™å‡ºé‡é‡‡æ ·éœ€è¦æ‰‹åŠ¨æ„å»ºæ ·æœ¬ID

```r
peng.rs.ho <- rsmp('custom')
peng.rs.ho.trainSets <- c(1:5, 153:158, 277:280)
peng.rs.ho$instantiate(
 peng.tskC,
 train = list(peng.rs.ho.trainSets, peng.rs.ho.trainSets + 5),
 test = list(peng.rs.ho.trainSets + 15, peng.rs.ho.trainSets + 25)
)
resample(peng.tskC, peng.lrnC.rpart, peng.rr.ho)$prediction()
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m30[39m observations:[22m [36m------------------------------------[39m
 row_ids     truth response prob.Adelie prob.Chinstrap prob.Gentoo
      16    Adelie   Gentoo   0.3333333      0.2666667         0.4
      17    Adelie   Gentoo   0.3333333      0.2666667         0.4
      18    Adelie   Gentoo   0.3333333      0.2666667         0.4
     ---       ---      ---         ---            ---         ---
     303 Chinstrap   Gentoo   0.3333333      0.2666667         0.4
     304 Chinstrap   Gentoo   0.3333333      0.2666667         0.4
     305 Chinstrap   Gentoo   0.3333333      0.2666667         0.4
```

- `rsmp('custom_cv')`ç”¨äºæ„å»º**CVé‡é‡‡æ ·**

```r
# ä»…é€‰ç”¨4ä¸ªæ ·æœ¬ï¼Œåˆ†åˆ«æ˜¯ç¬¬1ï¼Œ100ï¼Œ200ï¼Œ300è¡Œ
peng.tskC_small <- peng.tskC$filter(c(1, 100, 200, 300))
peng.rs.ccv <- rsmp('custom_cv')
# ç¬¬1ï¼Œ3è¡Œä¸ºè®­ç»ƒé›†ï¼Œ2ï¼Œ4è¡Œä¸ºæµ‹è¯•é›†
peng.rs.ccv.folds <- as.factor(c(1, 2, 1, 2))
peng.rs.ccv$instantiate(tskC_small, f = peng.rs.ccv.folds)
resample(peng.tskC_small, peng.lrnC.rpart, peng.rs.ccv)$predictions()
```

```css
Error in frame$yval2[where, 1L + nclass + 1L:nclass, drop = FALSE]: subscript out of bounds
```

- ç”±äºä¸Šé¢è«åå…¶å¦™åœ°æŠ¥é”™ï¼Œæ‰€ä»¥ç”¨äº†ä¸ªæ–°çš„

```r
# `$filter`æ˜¯å°±åœ°ä¿®æ”¹ï¼Œå¦‚æœæ”¹äº†çš„è¯è¿è¡Œï¼š
# peng.tskC <- tsk('penguins')
peng.tskC2 <- peng.tskC$clone()
peng.rs.ccv <- rsmp('custom_cv')
peng.rs.ccv.folds <- as.factor(c(rep(1,244),rep(2,100)))
peng.rs.ccv$instantiate(peng.tskC2, f = peng.rs.ccv.folds)
resample(peng.tskC2, peng.lrnC.rpart, peng.rs.ccv)$predictions()
```

```css
[[1]]

[36m--[39m [1m[34m<PredictionClassif>[39m for [34m244[39m observations:[22m [36m-----------------------------------[39m
 row_ids  truth  response prob.Adelie prob.Chinstrap prob.Gentoo
       1 Adelie Chinstrap           0              1           0
       2 Adelie Chinstrap           0              1           0
       3 Adelie Chinstrap           0              1           0
     ---    ---       ---         ---            ---         ---
     242 Gentoo    Gentoo           0              0           1
     243 Gentoo    Gentoo           0              0           1
     244 Gentoo    Gentoo           0              0           1

[[2]]

[36m--[39m [1m[34m<PredictionClassif>[39m for [34m100[39m observations:[22m [36m-----------------------------------[39m
 row_ids     truth response prob.Adelie prob.Chinstrap prob.Gentoo
     245    Gentoo   Gentoo   0.0212766              0   0.9787234
     246    Gentoo   Gentoo   0.0212766              0   0.9787234
     247    Gentoo   Gentoo   0.0212766              0   0.9787234
     ---       ---      ---         ---            ---         ---
     342 Chinstrap   Adelie   1.0000000              0   0.0000000
     343 Chinstrap   Gentoo   0.0212766              0   0.9787234
     344 Chinstrap   Adelie   1.0000000              0   0.0000000
```

### é‡é‡‡æ ·ä¸­çš„åˆ†ç»„ä¸åˆ†å±‚

#### åˆ†ç»„é‡é‡‡æ ·

- åœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å½¢ä¸‹ï¼Œåˆ†ç»„æ˜¯è‡³å…³é‡è¦çš„ï¼š
  - çºµå‘ç ”ç©¶ä¸­ï¼Œå¯¹åŒä¸€ä¸ªä¸ªä½“è¿›è¡Œå¤šä¸ªæ—¶é—´ç‚¹æµ‹é‡ï¼Œ  
   å¦‚æœä¸åˆ†ç»„ï¼Œå¯èƒ½ä¼šé«˜ä¼°æ¨¡å‹çš„æ³›åŒ–ï¼Œ  
   å› ä¸ºåŒä¸€ä¸ªä¸ªä½“çš„è§‚æµ‹å€¼å¯èƒ½åŒæ—¶å‡ºç°åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­

```r
peng.tskC <-  tsk('penguins')
peng.tskC$set_col_roles('year', 'group')

peng.rs.loo <- rsmp('loo')
peng.rs.loo$instantiate(peng.tskC)

table(peng.tskC$data(rows = peng.rs.loo$train_set(1), cols = 'year'))
table(peng.tskC$data(rows = peng.rs.loo$test_set(1), cols = 'year'))
```

```css
year
2007 2008 
 110  114 

year
2009 
 120 
```

- ç”¨CVè¯•äº†ä¸‹

```r
peng.tskC <-  tsk('penguins')
peng.tskC$set_col_roles('year', 'group')

peng.rs.cv <- rsmp('cv')
peng.rs.cv$instantiate(peng.tskC)

table(peng.tskC$data(rows = peng.rs.cv$train_set(1), cols = 'year'))
table(peng.tskC$data(rows = peng.rs.cv$test_set(1), cols = 'year'))
```

```css
year
2008 2009 
 114  120 

year
2007 
 110 
```

- ä¸Šé¢å¯ä»¥çœ‹å¾—å‡ºï¼Œ  
  2008ï¼Œ2009å¹´çš„æ•°æ®åˆ†é…åˆ°äº†**è®­ç»ƒé›†**ï¼Œ  
  è€Œ2007çš„æ•°æ®åˆ†é…åˆ°äº†**æµ‹è¯•é›†**
  - æ‰€ä»¥`factor`çš„ç¬¬ä¸€çº§ä¼šåˆ†é…åˆ°æµ‹è¯•é›†ä¸­

### åˆ†å±‚é‡é‡‡æ ·

- åˆ†å±‚èƒ½å¤Ÿç¡®ä¿åœ¨è®­ç»ƒé›†ä¸æµ‹è¯•é›†ä¸­æ ·æœ¬çš„**ç‰¹å¾åˆ†å¸ƒæ˜¯ç›¸åŒ**çš„ï¼Œ  
  ä»¥ä¿è¯æ³›åŒ–èƒ½åŠ›è¾ƒå°çš„åå·®
- å½“ä¸å¹³è¡¡æƒ…å†µä¸¥é‡æ—¶ï¼Œå°‘æ•°ç±»**å¯èƒ½æ ¹æœ¬ä¸ä¼šå‡ºç°**åœ¨è®­ç»ƒé›†ä¸­
  - å› æ­¤ï¼Œè¿™äº›é‡é‡‡æ ·è¿­ä»£ä¸­çš„ä¸­é—´æ¨¡å‹å°†æ°¸è¿œä¸ä¼šé¢„æµ‹ç¼ºå¤±çš„ç±»ï¼Œ  
   ä»è€Œå¯¼è‡´å¯¹ä»»ä½•æ²¡æœ‰åˆ†å±‚çš„é‡é‡‡æ ·ç­–ç•¥çš„æ€§èƒ½ä¼°è®¡äº§ç”Ÿè¯¯å¯¼
- ä¾ç„¶ç”¨`Task$set_col_roles()`æŒ‡å®š

```r
peng.tskC <-  tsk('penguins')
peng.tskC$set_col_roles('species', c('target', 'stratum'))

peng.rs.cv <- rsmp('cv', folds = 10)
peng.rs.cv$instantiate(peng.tskC)

fold1 = prop.table(table(peng.tskC$data(rows = peng.rs.cv$test_set(1),
  cols = 'species')))
fold2 = prop.table(table(peng.tskC$data(rows = peng.rs.cv$test_set(2),
  cols = 'species')))

rbind('Fold 1' = fold1, 'Fold 2' = fold2)
```

<table class='dataframe'>
<caption>A matrix: 2 x 3 of type dbl</caption>
<thead>
 <tr><th></th><th scope=col>Adelie</th><th scope=col>Chinstrap</th><th scope=col>Gentoo</th></tr>
</thead>
<tbody>
 <tr><th scope=row>Fold 1</th><td>0.4444444</td><td>0.1944444</td><td>0.3611111</td></tr>
 <tr><th scope=row>Fold 2</th><td>0.4444444</td><td>0.1944444</td><td>0.3611111</td></tr>
</tbody>
</table>

## åŸºå‡†æµ‹è¯•

### `benchmark()`

- `benchmark()`å¯ä»¥æ‰§è¡Œåœ¨æ¯ä¸ª`Task`å’Œ`Learner`ä¸Šçš„é‡é‡‡æ ·`resample()`ï¼Œ  
  ç„¶åæ‰‹æœºå®ƒä»¬çš„ç»“æœ
- é¦–å…ˆè°ƒç”¨`benchmark_grid()`å‡½æ•°æ„å»ºä¸€ä¸ª  
  ä¸åŒ`Task`ï¼Œ`Learner`ï¼Œå’Œ`Resampling`çš„ç­–ç•¥ç»„åˆ
- ï¼ˆæ‡’å¾—æ”¹å˜é‡åäº†ï¼Œå°±ç”¨æ•™ç¨‹ç»™çš„ï¼‰

```r
# è¿™é‡Œ`tasks`æ˜¯ä¸€ä¸ª`list`
# ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å¯ä»¥å…ˆ`as_task_*()`æ„å»ºå¥½ä»»åŠ¡ï¼Œå†ç”¨`list()`åˆ—è¡¨åŒ–
tasks <- tsks(c('german_credit', 'sonar')) 
learners <- lrns(c('classif.rpart', 'classif.ranger',
  'classif.featureless'), predict_type = 'prob')
rsmp_cv5 <- rsmp('cv', folds = 5)

design <- benchmark_grid(tasks, learners, rsmp_cv5)
```

- æœ¬æ¥ç”¨`head()`å¯ä»¥çœ‹çš„ï¼Œä½†æ˜¯åœ¨VS codeçš„ jupyter é‡Œå¥½åƒç”¨ä¸äº†ï¼Œ  
  æ‰€ä»¥æ¢äº†ç§`print()`çš„æ–¹å¼

```r
design %>% head()
```

<table class='dataframe'>
<caption>A benchmark_grid: 6 x 3</caption>
<thead>
 <tr><th scope=col>task</th><th scope=col>learner</th><th scope=col>resampling</th></tr>
 <tr><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>&lt;environment: 0x14a4fe818&gt;</td><td>&lt;environment: 0x13ad80320&gt;</td><td>&lt;environment: 0x10b13e698&gt;</td></tr>
 <tr><td>&lt;environment: 0x14a4fe818&gt;</td><td>&lt;environment: 0x139489040&gt;</td><td>&lt;environment: 0x10b13e698&gt;</td></tr>
 <tr><td>&lt;environment: 0x14a4fe818&gt;</td><td>&lt;environment: 0x10df71690&gt;</td><td>&lt;environment: 0x10b13e698&gt;</td></tr>
 <tr><td>&lt;environment: 0x14c562668&gt;</td><td>&lt;environment: 0x13ad80320&gt;</td><td>&lt;environment: 0x10fe429c0&gt;</td></tr>
 <tr><td>&lt;environment: 0x14c562668&gt;</td><td>&lt;environment: 0x139489040&gt;</td><td>&lt;environment: 0x10fe429c0&gt;</td></tr>
 <tr><td>&lt;environment: 0x14c562668&gt;</td><td>&lt;environment: 0x10df71690&gt;</td><td>&lt;environment: 0x10fe429c0&gt;</td></tr>
</tbody>
</table>

```r
print(design, cols =ncol(design))
```

```css
            task             learner resampling
          <char>              <char>     <char>
1: german_credit       classif.rpart         cv
2: german_credit      classif.ranger         cv
3: german_credit classif.featureless         cv
4:         sonar       classif.rpart         cv
5:         sonar      classif.ranger         cv
6:         sonar classif.featureless         cv
```

- è¿™é‡Œå¯ä»¥çœ‹åˆ°`design`å°±æ˜¯ä¸€ä¸ª`data.table`ï¼Œ  
  ç”Ÿæˆçš„åŸç†ä¹Ÿç±»ä¼¼äº`expand_grid()`
- å†…å®¹ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿›è¡Œä¿®æ”¹

- é»˜è®¤æƒ…å†µä¸‹ï¼Œ`benchmark_grid()` ä¼šåœ¨ä»»åŠ¡ä¸Šå®ä¾‹åŒ–é‡é‡‡æ ·ï¼Œ  
  è¿™æ„å‘³ç€ä¼šç”Ÿæˆå…·ä½“çš„è®­ç»ƒ - æµ‹è¯•åˆ†å‰²
  - ç”±äºæ­¤è¿‡ç¨‹æ˜¯éšæœºçš„ï¼Œå› æ­¤æœ‰å¿…è¦åœ¨è°ƒç”¨ `benchmark_grid()` ä¹‹å‰  
   **è®¾ç½®éšæœºç§å­**ï¼Œä»¥ç¡®ä¿æ•°æ®åˆ†å‰²çš„å¯é‡å¤æ€§

- åœ¨`benchmark_grid()`åˆ›å»ºåŸºå‡†æµ‹è¯•è®¾è®¡åï¼Œ  
  å°†è®¾è®¡è¡¨æ ¼ä¼ é€’ç»™`benchmark()`

```r
bmr <- benchmark(design)
bmr
```

```css
[36m--[39m [1m[34m<BenchmarkResult>[39m of [34m30[39m rows with [34m6[39m resampling run[22m [36m--------------------------[39m
 nr       task_id          learner_id resampling_id iters warnings errors
  1 german_credit       classif.rpart            cv     5        0      0
  2 german_credit      classif.ranger            cv     5        0      0
  3 german_credit classif.featureless            cv     5        0      0
  4         sonar       classif.rpart            cv     5        0      0
  5         sonar      classif.ranger            cv     5        0      0
  6         sonar classif.featureless            cv     5        0      0
```

- å¯ä»¥ç”¨`BenchmarkResult$score()`æŸ¥çœ‹æ¯ä¸ªå­¦ä¹ å™¨/ä»»åŠ¡/é‡é‡‡æ ·ç»„åˆçš„æ¯ä¸€æŠ˜çš„ç»“æœï¼Œ  
  ç”¨`BenchmarkResult$aggregate()`æŸ¥çœ‹æ¯ä¸ªå­¦ä¹ å™¨/ä»»åŠ¡/é‡é‡‡æ ·ç»„åˆçš„æ¯ä¸€æŠ˜çš„ç»“æœ
- æ³¨æ„ï¼Œè¿™é‡Œçš„`x.[rowVector,.(var1,var2,...)]`ç”¨æ³•æ˜¯`data.table`çš„ç‹¬æœ‰ç”¨æ³•

```r
bmr$score()[c(1, 7, 13), .(iteration, task_id, learner_id, classif.ce)]
```

<table class='dataframe'>
<caption>A bmr_score: 3 x 4</caption>
<thead>
 <tr><th scope=col>iteration</th><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1</td><td>german_credit</td><td>classif.rpart      </td><td>0.29</td></tr>
 <tr><td>2</td><td>german_credit</td><td>classif.ranger     </td><td>0.25</td></tr>
 <tr><td>3</td><td>german_credit</td><td>classif.featureless</td><td>0.31</td></tr>
</tbody>
</table>

```r
bmr$aggregate()[, .(task_id, learner_id, classif.ce)]
```

<table class='dataframe'>
<caption>A bmr_aggregate: 6 x 3</caption>
<thead>
 <tr><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>german_credit</td><td>classif.rpart      </td><td>0.2720000</td></tr>
 <tr><td>german_credit</td><td>classif.ranger     </td><td>0.2420000</td></tr>
 <tr><td>german_credit</td><td>classif.featureless</td><td>0.3000000</td></tr>
 <tr><td>sonar        </td><td>classif.rpart      </td><td>0.2792102</td></tr>
 <tr><td>sonar        </td><td>classif.ranger     </td><td>0.1782811</td></tr>
 <tr><td>sonar        </td><td>classif.featureless</td><td>0.4670151</td></tr>
</tbody>
</table>

- è¿™é‡Œä¹Ÿå¯ä»¥æ”¹æˆå…¶ä»–çš„è¯„ä¼°å™¨

```r
bmr$aggregate(msr('classif.acc'))[, .(task_id, learner_id, classif.acc)]
```

<table class='dataframe'>
<caption>A bmr_aggregate: 6 x 3</caption>
<thead>
 <tr><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>classif.acc</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>german_credit</td><td>classif.rpart      </td><td>0.7280000</td></tr>
 <tr><td>german_credit</td><td>classif.ranger     </td><td>0.7580000</td></tr>
 <tr><td>german_credit</td><td>classif.featureless</td><td>0.7000000</td></tr>
 <tr><td>sonar        </td><td>classif.rpart      </td><td>0.7207898</td></tr>
 <tr><td>sonar        </td><td>classif.ranger     </td><td>0.8217189</td></tr>
 <tr><td>sonar        </td><td>classif.featureless</td><td>0.5329849</td></tr>
</tbody>
</table>

### `BenchmarkResult`å¯¹è±¡

- `BenchmarkResult`å¯¹è±¡å…¶å®å°±æ˜¯å¤šä¸ª`ResampleResult`å¯¹è±¡çš„é›†åˆ

```r
bmrdt <- as.data.table(bmr)
bmrdt[1:2, .(task, learner, resampling, iteration)]
```

<table class='dataframe'>
<caption>A data.table: 2 x 4</caption>
<thead>
 <tr><th scope=col>task</th><th scope=col>learner</th><th scope=col>resampling</th><th scope=col>iteration</th></tr>
 <tr><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
 <tr><td>&lt;environment: 0x164aae688&gt;</td><td>&lt;environment: 0x14c201600&gt;</td><td>&lt;environment: 0x13ff88320&gt;</td><td>1</td></tr>
 <tr><td>&lt;environment: 0x164aae688&gt;</td><td>&lt;environment: 0x14a63e1b8&gt;</td><td>&lt;environment: 0x13ff88320&gt;</td><td>2</td></tr>
</tbody>
</table>

- å­˜å‚¨çš„ `ResampleResult` å¯ä»¥é€šè¿‡ `ResampleResult$resample_result(i)` æ–¹æ³•æå–
  - `i`æ˜¯æ‰§è¡Œçš„é‡é‡‡æ ·å®éªŒçš„ç´¢å¼•

```r
rr1 <- bmr$resample_result(1)
rr2 <- bmr$resample_result(2)

rr1
rr2
```

```css
[36m--[39m [1m[34m<ResampleResult>[39m with [34m5[39m resampling iterations[22m [36m-------------------------------[39m
       task_id    learner_id resampling_id iteration     prediction_test
 german_credit classif.rpart            cv         1 <PredictionClassif>
 german_credit classif.rpart            cv         2 <PredictionClassif>
 german_credit classif.rpart            cv         3 <PredictionClassif>
 german_credit classif.rpart            cv         4 <PredictionClassif>
 german_credit classif.rpart            cv         5 <PredictionClassif>
 warnings errors
        0      0
        0      0
        0      0
        0      0
        0      0


[36m--[39m [1m[34m<ResampleResult>[39m with [34m5[39m resampling iterations[22m [36m-------------------------------[39m
       task_id     learner_id resampling_id iteration     prediction_test
 german_credit classif.ranger            cv         1 <PredictionClassif>
 german_credit classif.ranger            cv         2 <PredictionClassif>
 german_credit classif.ranger            cv         3 <PredictionClassif>
 german_credit classif.ranger            cv         4 <PredictionClassif>
 german_credit classif.ranger            cv         5 <PredictionClassif>
 warnings errors
        0      0
        0      0
        0      0
        0      0
        0      0
```

- `ResampleResult$resample_results()`ä¹Ÿå¯ä»¥æ‰“å°æ‰€æœ‰çš„é‡é‡‡æ ·

```r
bmr$resample_results
```

<table class='dataframe'>
<caption>A data.table: 6 x 3</caption>
<thead>
 <tr><th scope=col>uhash</th><th scope=col>nr</th><th scope=col>resample_result</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>e3e12f28-dbeb-491f-9053-bf542a1a6eb7</td><td>1</td><td>&lt;environment: 0x13ae1b7c0&gt;</td></tr>
 <tr><td>01b8d3a8-9d06-4520-b3d9-a43dfe6eb620</td><td>2</td><td>&lt;environment: 0x13ae79ba0&gt;</td></tr>
 <tr><td>f859c5f2-80ba-4b18-8074-9fa3007c8e16</td><td>3</td><td>&lt;environment: 0x13ab7e918&gt;</td></tr>
 <tr><td>c844f002-4add-428c-9bc0-6f1cd7439ffb</td><td>4</td><td>&lt;environment: 0x148f66558&gt;</td></tr>
 <tr><td>bba8375a-f30e-4b44-8caa-c7b572d5b151</td><td>5</td><td>&lt;environment: 0x148ff9b30&gt;</td></tr>
 <tr><td>78cfe007-fbfd-4f2d-bcd2-3fba990295b5</td><td>6</td><td>&lt;environment: 0x13a9f3368&gt;</td></tr>
</tbody>
</table>

- `as_benchmark_result()` å¯ç”¨äºå°†å¯¹è±¡ä» `ResampleResult` è½¬æ¢ä¸º `BenchmarkResult`
- `c()` æ–¹æ³•å¯ç”¨äºåˆå¹¶å¤šä¸ª `BenchmarkResult` å¯¹è±¡
  - è¿™åœ¨å¤šå°æœºå™¨ä¸Šè¿›è¡Œå®éªŒæ—¶å¯èƒ½ä¼šå¾ˆæœ‰ç”¨

```r
bmr1 <- as_benchmark_result(rr1)
bmr2 <- as_benchmark_result(rr2)

c(bmr1, bmr2)
```

```css
[36m--[39m [1m[34m<BenchmarkResult>[39m of [34m10[39m rows with [34m2[39m resampling run[22m [36m--------------------------[39m
 nr       task_id     learner_id resampling_id iters warnings errors
  1 german_credit  classif.rpart            cv     5        0      0
  2 german_credit classif.ranger            cv     5        0      0
```

### å¯è§†åŒ–`BenchmarkResult`çš„è¯„ä¼°ç»“æœ

```r
autoplot(bmr, measure = msr('classif.acc'))
```

## äºŒå…ƒåˆ†ç±»å™¨çš„è¯„ä¼°

### æ··æ·†çŸ©é˜µï¼ˆConfusion Matrixï¼‰

- åŸºäºæ··æ·†çŸ©é˜µï¼Œå¯ä»¥è®¡ç®—ä»¥ä¸‹æŒ‡æ ‡
  - True Positive Rate (TPR), Sensitivity or Recall
  - True Negative Rate (TNR) or Specificity
  - False Positive Rate (FPR), or 1- Specificity
  - Positive Predictive Value (PPV) or Precision
  - Negative Predictive Value (NPV)
  - Accuracy (ACC)
  - F1-score
   $$2 \times \frac{Precision \times Recall}{Precision + Recall}$$

![image_6](./image_6.png)

- `mlr3measures::confusion_matrix()`å¯ä»¥ç”Ÿæˆæ··æ·†çŸ©é˜µ

```r
# å‡†å¤‡ä¸€ä¸‹æ•°æ®
gc.tskC <- tsk('german_credit')
gc.tskC.splits <- partition(gc.tskC)
gc.lrnC.ranger <- lrn('classif.ranger', predict_type = 'prob')
gc.lrnC.ranger$train(gc.tskC, row_ids = gc.tskC.splits$train)
gc.lrnC.ranger.pred <- gc.lrnC.ranger$predict(gc.tskC, row_ids = gc.tskC.splits$test)

# æ··æ·†çŸ©é˜µ
gc.cm.ranger <- mlr3measures::confusion_matrix(
    truth = gc.lrnC.ranger.pred$truth,
    response = gc.lrnC.ranger.pred$response, 
    positive = gc.tskC$positive
)
gc.cm.ranger
```

```css
        truth
response good bad
    good  207  60
    bad    26  37
acc :  0.7394; ce  :  0.2606; dor :  4.9096; f1  :  0.8280 
fdr :  0.2247; fnr :  0.1116; fomr:  0.4127; fpr :  0.6186 
mcc :  0.3128; npv :  0.5873; ppv :  0.7753; tnr :  0.3814 
tpr :  0.8884 
```

### å—è¯•è€…å·¥ä½œç‰¹å¾æ›²çº¿ï¼ˆROC curveï¼‰åˆ†æ

- å¯¹äºäºŒå…ƒåˆ†ç±»é—®é¢˜æœ€å¸¸ç”¨çš„è¯„ä¼°å™¨
- ç”±ä¸åŒé˜ˆå€¼è¿›è¡Œåˆ†ç±»æˆªæ–­æ—¶çš„FPRä¸TPRæ„æˆçš„ä¸€æ¡æ›²çº¿

- ROCæ›²çº¿å¯ä»¥ç”±`autoplot(Prediction)`ç”Ÿæˆ
  - **æ³¨æ„**ï¼š`Learner <- lrn('classif.*', predict_type = 'prob')`  
   å¿…é¡»æŒ‡å®šé¢„æµ‹çš„ç±»å‹ä¸º`'prob'`

```r
autoplot(gc.lrnC.ranger.pred, type = 'roc')
```

- ä½¿ç”¨`msr('classif.auc')`è°ƒç”¨è¯„ä¼°å™¨AUCåˆ†æ

```r
gc.lrnC.ranger.pred$score(msr('classif.auc'))
```

```css
classif.auc: 0.772628921745402
```

### ç²¾ç¡®ç‡ - å¬å›ç‡æ›²çº¿ï¼ˆPRCï¼‰

- PRCèƒ½å¤Ÿå¯è§†åŒ–é˜³æ€§é¢„æµ‹å€¼/ç²¾ç¡®ç‡ä¸çœŸé˜³æ€§ç‡/å¬å›ç‡çš„å…³ç³»
- PRCå¿½ç•¥äº†çœŸé˜´æ€§çš„æ•°é‡ï¼Œè¿™åœ¨ä¸å¹³è¡¡æ€»ä½“ä¸­å¾ˆæœ‰ç”¨ï¼Œ  
  å› ä¸ºé˜³æ€§ç±»åˆ«æ€»æ˜¯å°‘è§çš„ï¼Œå› æ­¤å…·æœ‰é«˜çœŸé˜³æ€§ç‡çš„åˆ†ç±»å™¨å¯èƒ½ä»ç„¶æä¾›çš„ä¿¡æ¯ä¸å¤š

```r
autoplot(gc.lrnC.ranger.pred, type = 'prc')
```

- ä½¿ç”¨`msr('classif.prauc')`è°ƒç”¨è¯„ä¼°å™¨PRC AUCåˆ†æ

```r
gc.lrnC.ranger.pred$score(msr('classif.prauc'))
```

```css
classif.prauc: 0.891557073290125
```

### å…¶ä»–çš„å¯è§†åŒ–

- å¯è§†åŒ–å…¶ä»–æ€§èƒ½æŒ‡æ ‡éšé˜ˆå€¼å˜åŒ–çš„å…³ç³»
  - è¿™é‡Œæ˜¯è¯¯æŠ¥ç‡ï¼ˆFPRï¼‰å’Œå‡†ç¡®ç‡ä¸ºä¾‹

```r
autoplot(gc.lrnC.ranger.pred, type = 'threshold', measure = msr('classif.fpr'))
autoplot(gc.lrnC.ranger.pred, type = 'threshold', measure = msr('classif.acc'))
```

- ä¸Šè¿°çš„å¯è§†åŒ–æ–¹æ³•åŒæ ·é€‚ç”¨äº`ResampleResult`å¯¹è±¡

## åŸºæœ¬è°ƒå‚æ–¹æ³•

### è°ƒå‚çš„æ•´ä½“æµç¨‹

![image_7](./image_7.png)

### æ¨¡å‹è°ƒä¼˜ï¼ˆModel Tuningï¼‰

- **æœç´¢ç©ºé—´ï¼ˆsearch spaceï¼‰/è°ƒä¼˜ç©ºé—´ï¼ˆtuning spaceï¼‰**
  - å¯ä¾›è°ƒæ•´çš„è¶…å‚é›†åˆ
- **ä¸å¯è°ƒè¶…å‚æ•°**
  - å°‘æ•°æ¨¡å‹çš„è®­ç»ƒå‡½æ•°æä¾›äº†å’Œè®­ç»ƒæ¨¡å‹ä¸ç›¸å¹²çš„è¶…å‚
  - ä¾‹å¦‚`lrn('classif.ranger')` ä¸­çš„ `verbose` æ§åˆ¶è®­ç»ƒæœŸé—´å‘ç”¨æˆ·æ˜¾ç¤ºå¤šå°‘ä¿¡æ¯

- å¯¹äºæ•°å€¼å‹çš„è¶…å‚ï¼Œéœ€è¦æŒ‡å®šè°ƒæ•´çš„èŒƒå›´
- ä½¿ç”¨`to_tune()`æ¥æ„å»ºè°ƒæ•´èŒƒå›´çš„ä¸‹é™ä¸ä¸Šé™

```r
learner <- lrn('classif.svm',
  type  = 'C-classification',
  kernel = 'radial',
  cost  = to_tune(1e-1, 1e5),
  gamma = to_tune(1e-1, 1)
)
learner
```

- å¦‚æœå¯¹ç”¨`to_tune()`æ ‡è®°äº†è¶…å‚çš„å­¦ä¹ å™¨è°ƒç”¨`Learner$train()`çš„è¯ä¼šæŠ›å‡ºé”™è¯¯

### ç»ˆæ­¢å™¨ï¼ˆTerminatorï¼‰

- ~~ç»ˆç»“è€…~~
- `mlr_terminators`å­˜å‚¨äº†æ‰€æœ‰ç»ˆæ­¢å™¨çš„ç§ç±»ï¼Œ  
  ä½¿ç”¨ `trm()` åˆ›å»ºç»ˆæ­¢å™¨

| Terminator <br>ç»ˆæ­¢å™¨             | Function call and default parameters <br>å‡½æ•°è°ƒç”¨å’Œé»˜è®¤å‚æ•° |
| ------------------------------ | -------------------------------------------------- |
| Clock TimeÂ <br>æ—¶é’Ÿæ—¶é—´            | `trm('clock_time')`                                |
| ComboÂ <br>ç»„åˆ                   | `trm('combo', any = TRUE)`                         |
| NoneÂ <br>æ—                      | `trm('none')`                                      |
| Number of EvaluationsÂ <br>è¯„ä¼°æ¬¡æ•° | `trm('evals', n_evals = 100, k = 0)`               |
| Performance LevelÂ <br>æ€§èƒ½æ°´å¹³     | `trm('perf_reached', level = 0.1)`                 |
| Run TimeÂ <br>è¿è¡Œæ—¶é—´              | `trm('run_time', secs = 30)`                       |
| StagnationÂ <br>åœæ»              | `trm('stagnation', iters = 10, threshold = 0)`     |

```r
mlr_terminators %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 9 x 4</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>properties</th><th scope=col>unit</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>clock_time            </td><td>Clock Time            </td><td>single-crit, multi-crit </td><td>seconds    </td></tr>
 <tr><td>combo                 </td><td>Combination           </td><td>single-crit, multi-crit </td><td>percent    </td></tr>
 <tr><td>evals                 </td><td>Number of Evaluation  </td><td>single-crit, multi-crit </td><td>evaluations</td></tr>
 <tr><td>none                  </td><td>None                  </td><td>single-crit, multi-crit </td><td>percent    </td></tr>
 <tr><td>perf_reached          </td><td>Performance Level     </td><td>single-crit</td><td>percent    </td></tr>
 <tr><td>run_time              </td><td>Run Time              </td><td>single-crit, multi-crit </td><td>seconds    </td></tr>
 <tr><td>stagnation            </td><td>Stagnation            </td><td>single-crit</td><td>percent    </td></tr>
 <tr><td>stagnation_batch      </td><td>Stagnation Batch      </td><td>single-crit</td><td>percent    </td></tr>
 <tr><td>stagnation_hypervolume</td><td>Stagnation Hypervolume</td><td>multi-crit</td><td>percent    </td></tr>
</tbody>
</table>

- æœ€å¸¸ç”¨çš„ç»ˆæ­¢æ¡ä»¶æ˜¯åœ¨ç‰¹å®šæ—¶é—´ï¼ˆ`trm('run_time'`ï¼‰ï¼Œ  
  æˆ–ç»™å®šè¯„ä¼°æ¬¡æ•°ï¼ˆ`trm('evals')`ï¼‰ååœæ­¢è°ƒä¼˜
  - é€‰æ‹©è¿è¡Œæ—¶é—´é€šå¸¸åŸºäºå®é™…è€ƒè™‘å’Œç›´è§‰
    - åœ¨è®¡ç®—é›†ç¾¤ä¸Šï¼Œä½¿ç”¨æ—¶é—´é™åˆ¶å¯èƒ½å¾ˆé‡è¦ï¼Œ  
    å› ä¸ºå¯èƒ½éœ€è¦ä¸ºè®¡ç®—ä»»åŠ¡æŒ‡å®šæœ€é•¿è¿è¡Œæ—¶é—´
  - `trm('perf_reached')`åœ¨è¾¾åˆ°æŒ‡å®šæ€§èƒ½æ°´å¹³æ—¶åœæ­¢è°ƒä¼˜
    - å¦‚æœæŸä¸ªæ€§èƒ½æ°´å¹³è¢«è®¤ä¸ºè¶³ä»¥æ»¡è¶³æ¨¡å‹çš„å®é™…åº”ç”¨ï¼Œè¿™ä¼šå¾ˆæœ‰å¸®åŠ©
    - ä½†æ˜¯ï¼Œå¦‚æœè®¾ç½®å¾—è¿‡äºä¹è§‚ï¼Œè°ƒä¼˜å¯èƒ½æ°¸è¿œä¸ä¼šç»ˆæ­¢
- `trm('stagnation')`åœ¨è®¾å®šæ•°é‡çš„`iterations`ä¸­æ²¡æœ‰å–å¾—å¤§äº`threshold`çš„è¿›å±•æ—¶åœæ­¢
  - å¯¹äºå¤æ‚çš„æœç´¢ç©ºé—´ï¼Œé˜ˆå€¼å¯èƒ½å¾ˆéš¾é€‰æ‹©
  - å› ä¸ºå°½ç®¡ä»æœ‰ï¼ˆå¯èƒ½å¾ˆå¤§çš„ï¼‰æ”¹è¿›ç©ºé—´ï¼Œä½†ä¼˜åŒ–å¯èƒ½ä¼šè¿‡æ—©åœæ­¢
- `trm('none')`ç”¨äºè‡ªè¡Œæ§åˆ¶ç»ˆæ­¢çš„è°ƒè°å™¨ï¼Œå› æ­¤æ­¤ç»ˆæ­¢æ¡ä»¶ä¸èµ·ä½œç”¨
- è¿™äº›ç»ˆæ­¢æ¡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨`trm('combo')`è‡ªç”±ç»„åˆï¼Œ  
  å¯ç”¨äºæŒ‡å®šè¶…å‚æ•°ä¼˜åŒ–åœ¨ä»»ä½•ç»ˆæ­¢æ¡ä»¶è§¦å‘æ—¶å®Œæˆï¼ˆ`any = TRUE`ï¼‰ï¼Œ  
  æˆ–è€…åœ¨æ‰€æœ‰ç»ˆæ­¢æ¡ä»¶è§¦å‘æ—¶å®Œæˆï¼ˆ`any = FALSE`ï¼‰

### ä½¿ç”¨`ti()`è¿›è¡Œå®ä¾‹è°ƒä¼˜ï¼ˆTuning Instanceï¼‰

- è¿™é‡Œç”¨`ti()`åˆ›å»ºäº†ä¸€ä¸ªå•ç›®æ ‡è°ƒä¼˜çš„`TuningInstanceBatchSingleCrit`å¯¹è±¡

```r
# è°ƒå–é¢„è®¾ä»»åŠ¡`'sonar'`
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚`cose`å’Œ`gamma`
 cost  = to_tune(1e-1, 1e5),
 gamma = to_tune(1e-1, 1),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 # è¿™é‡Œåªæœ‰ä¸€ä¸ª`Measure`ï¼Œæ‰€ä»¥æ˜¯å•ç›®æ ‡è°ƒä¼˜
 # å¦‚æœè¿™é‡Œæ˜¯`msrs(c('msr1','msr2'))`ï¼Œé‚£ä¹ˆå°±æ˜¯å¤šç›®æ ‡è°ƒä¼˜
 measures = msr('classif.ce'),
 # éå†æ•´ä¸ªç½‘æ ¼ï¼Œä¸è¿‡æ—©åœæ­¢ï¼Œå› æ­¤ä¸è®¾å®šç»ˆæ­¢å™¨
 terminator = trm('none')
)

instance
```

```css
<TuningInstanceBatchSingleCrit>
* State:  Not optimized
* Objective: <ObjectiveTuningBatch:classif.svm_on_sonar>
* Search Space:
       id    class lower upper nlevels
   <char>   <char> <num> <num>   <num>
1:   cost ParamDbl   0.1 1e+05     Inf
2:  gamma ParamDbl   0.1 1e+00     Inf
* Terminator: <TerminatorNone>
```

- å…¶å®è¿™é‡Œ`<TuningInstanceBatchSingleCrit>`å·²ç»çœ‹å¾—å‡ºæ˜¯å•ç›®æ ‡è°ƒä¼˜å¯¹è±¡äº†
- å¯ä»¥éšä¾¿çœ‹çœ‹`instance`çš„ç±»

```r
instance %>% class()
```

```css
'TuningInstanceBatchSingleCrit''OptimInstanceBatchSingleCrit''OptimInstanceBatch''OptimInstance''R6'
```

### è°ƒä¼˜å™¨ï¼ˆTunerï¼‰

#### è°ƒä¼˜å™¨ç§ç±»

- ä¸‹è¡¨ç»™å‡ºäº†å¯ç”¨çš„`Tuner`

| TunerÂ <br>è°ƒè°å™¨                                | Function callÂ <br>å‡½æ•°è°ƒç”¨ | PackageÂ <br>åŒ…   |
| -------------------------------------------- | ---------------------- | --------------- |
| Random SearchÂ <br>éšæœºæœç´¢                       | `tnr('random_search')` | `mlr3tuning`    |
| Grid SearchÂ <br>ç½‘æ ¼æœç´¢                         | `tnr('grid_search')`   | `mlr3tuning`    |
| Bayesian OptimizationÂ <br>è´å¶æ–¯ä¼˜åŒ–              | `tnr('mbo')`           | `mlr3mbo`       |
| CMA-ESÂ <br>åæ–¹å·®çŸ©é˜µè‡ªé€‚åº”è¿›åŒ–ç­–ç•¥                      | `tnr('cmaes')`         | `adagio`        |
| Iterated RacingÂ <br>è¿­ä»£ç«èµ›                     | `tnr('irace')`         | `irace`         |
| HyperbandÂ <br>è¶…å‚æ•°ä¼˜åŒ–ç®—æ³•                        | `tnr('hyperband')`     | `mlr3hyperband` |
| Generalized Simulated AnnealingÂ <br>å¹¿ä¹‰æ¨¡æ‹Ÿé€€ç«ç®—æ³• | `tnr('gensa')`         | `GenSA`         |
| Nonlinear OptimizationÂ <br>éçº¿æ€§ä¼˜åŒ–             | `tnr('nloptr')`        | `nloptr`        |

- ä½¿ç”¨`tnr()`æ¥è°ƒç”¨è°ƒä¼˜å™¨

```r
tnr('grid_search')
```

```css
<TunerBatchGridSearch>: Grid Search
* Parameters: batch_size=1, resolution=10
* Parameter classes: ParamLgl, ParamInt, ParamDbl, ParamFct
* Properties: dependencies, single-crit, multi-crit
* Packages: mlr3tuning, bbotk
```

#### è°ƒä¼˜ç­–ç•¥

- **æœç´¢ç­–ç•¥ï¼ˆSearch strategiesï¼‰**
  - ç½‘æ ¼æœç´¢å’Œéšæœºæœç´¢æ˜¯æœ€åŸºæœ¬çš„ç®—æ³•ï¼Œåœ¨åˆå§‹å®éªŒä¸­é€šå¸¸é¦–å…ˆè¢«é€‰ç”¨
  - **ç½‘æ ¼æœç´¢**
    - æ€è·¯æ˜¯è¯¦å°½åœ°è¯„ä¼°ç»™å®šè¶…å‚æ•°å€¼çš„æ¯ä¸€ç§å¯èƒ½ç»„åˆ
    - åˆ†ç±»è¶…å‚é€šå¸¸ä¼šåœ¨å…¶æ‰€æœ‰å¯èƒ½å–å€¼ä¸Šè¿›è¡Œè¯„ä¼°
    - æ•°å€¼å‹å’Œæ•´å‹è¶…å‚æ•°å€¼ä¼šæ ¹æ®ç»™å®šçš„åˆ†è¾¨ç‡  
    ï¼ˆå³æ¯ä¸ªè¶…å‚æ•°è¦å°è¯•çš„ä¸åŒå€¼çš„æ•°é‡ï¼‰ï¼Œ  
    åœ¨å…¶è¾¹ç•Œçº¦æŸï¼ˆä¸Šé™å’Œä¸‹é™ï¼‰å†…ç­‰è·åˆ†å¸ƒ
  - **éšæœºæœç´¢**
    - ä»é¢„å…ˆæŒ‡å®šçš„åˆ†å¸ƒï¼ˆé€šå¸¸æ˜¯å‡åŒ€åˆ†å¸ƒï¼‰ä¸­ä¸ºæ¯ä¸ªè¶…å‚æ•°ç‹¬ç«‹åœ°éšæœºé€‰æ‹©å€¼
  - è¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸å…·å¤‡é€‚åº”æ€§ï¼Œ  
   ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æå‡ºçš„é…ç½®éƒ½å¿½ç•¥äº†å…ˆå‰é…ç½®çš„æ€§èƒ½
  - ç”±äºå…¶ç®€å•æ€§ï¼Œ  
   ç½‘æ ¼æœç´¢å’Œéšæœºæœç´¢éƒ½å¯ä»¥å¤„ç†æ··åˆæœç´¢ç©ºé—´
   ï¼ˆå³è¶…å‚æ•°å¯ä»¥æ˜¯æ•°å€¼å‹ã€æ•´å‹æˆ–åˆ†ç±»å‹ï¼‰ä»¥åŠåˆ†å±‚æœç´¢ç©ºé—´

- **è‡ªé€‚åº”ç®—æ³•ï¼ˆAdaptive Algorithmsï¼‰**
  - è‡ªé€‚åº”ç®—æ³•ä»**å…ˆå‰è¯„ä¼°**çš„é…ç½®ä¸­å­¦ä¹ ï¼Œä»¥å¿«é€Ÿæ‰¾åˆ°è‰¯å¥½çš„é…ç½®
  - **è´å¶æ–¯ä¼˜åŒ–ï¼ˆBayesian Optimizationï¼‰**
    - ä½¿ç”¨**ä»£ç†æ¨¡å‹**æ¥è¿‘ä¼¼å¾…ä¼˜åŒ–çš„æœªçŸ¥å‡½æ•°
      - åœ¨è¶…å‚ä¼˜åŒ–ä¸­ï¼Œè¿™å°†æ˜¯ä»è¶…å‚é…ç½®åˆ°ä¼°è®¡çš„æ³›åŒ–æ€§èƒ½çš„æ˜ å°„
    - å¦‚æœé€‰æ‹©äº†åˆé€‚çš„ä»£ç†æ¨¡å‹ï¼Œä¾‹å¦‚éšæœºæ£®æ—ï¼Œ  
    è´å¶æ–¯ä¼˜åŒ–å¯ä»¥ç›¸å½“çµæ´»ï¼Œç”šè‡³å¯ä»¥å¤„ç†æ··åˆå’Œåˆ†å±‚æœç´¢ç©ºé—´
  - **åæ–¹å·®çŸ©é˜µè‡ªé€‚åº”è¿›åŒ–ç­–ç•¥**  
   **ï¼ˆCovariance Matrix Adaptation Evolution Strategyï¼‰**
    - åœ¨å€™é€‰ç‚¹ä¸Šç»´æŒä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œè¯¥åˆ†å¸ƒç”±ä¸€ä¸ªå‡å€¼å‘é‡å’Œåæ–¹å·®çŸ©é˜µè¡¨ç¤º  
    é€šè¿‡ä»è¿™ä¸ªåˆ†å¸ƒä¸­é‡‡æ ·ç”Ÿæˆä¸€ç»„æ–°çš„å€™é€‰ç‚¹ï¼Œæ¯ä¸ªå€™é€‰ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸å…¶æ€§èƒ½æˆæ­£æ¯”
    - åæ–¹å·®çŸ©é˜µä¼šéšç€æ—¶é—´è¿›è¡Œè°ƒæ•´ï¼Œä»¥åæ˜ æ€§èƒ½æ€åŠ¿
    - é€šè¿‡`miesmuschel`åŒ…ï¼Œåœ¨mlr3ä¸­è¿˜å¯ä½¿ç”¨æ›´å¤šè¿›åŒ–ç­–ç•¥
  - **è¿­ä»£ç«èµ›ç®—æ³•ï¼ˆIterated Racingï¼‰**
    - è¿­ä»£èˆå¼ƒé‚£äº›ç»ç»Ÿè®¡æ£€éªŒæ˜¾ç¤ºæ€§èƒ½ä¸ä½³çš„é…ç½®
    - é¦–å…ˆä»å‚æ•°åŒ–å¯†åº¦ä¸­éšæœºé‡‡æ ·çš„åˆå§‹é…ç½®ç¾¤ä½“ä¸­è¿›è¡Œ â€œç«èµ›â€ï¼Œ  
    ç„¶ååˆ©ç”¨ç«èµ›ä¸­å¹¸å­˜çš„é…ç½®æ¥éšæœºæ›´æ–°åç»­ç«èµ›çš„å¯†åº¦ï¼Œ  
    ä»¥ä¾¿èšç„¦äºæœç´¢ç©ºé—´ä¸­æœ‰å‰æ™¯çš„åŒºåŸŸï¼Œ  
    ä¾æ­¤ç±»æ¨
  - **è¶…å¸¦ç®—æ³•ï¼ˆHyperbandï¼‰/ å¤šä¿çœŸåº¦è¶…å‚æ•°ä¼˜åŒ–ï¼ˆMulti-fidelity HPOï¼‰**
    - ä¸€ç§è‡ªé€‚åº”æ–¹æ³•ï¼Œ  
    åˆ©ç”¨è®¡ç®—æˆæœ¬è¾ƒä½çš„ä½ä¿çœŸåº¦è¯„ä¼°çš„é¢„æµ‹èƒ½åŠ›  
    ï¼ˆå³è´¨é‡è¾ƒå·®çš„é¢„æµ‹ä¾‹å¦‚é‚£äº›ç”±è®­ç»ƒè½®æ•°è¾ƒå°‘çš„ç¥ç»ç½‘ç»œäº§ç”Ÿçš„é¢„æµ‹ï¼‰  
    æ¥æé«˜æ•´ä½“ä¼˜åŒ–æ•ˆç‡

#### ç­–ç•¥é€‰æ‹©

- **æœç´¢ç­–ç•¥**
  - å¦‚æœæœç´¢ç©ºé—´**è¾ƒå°**æˆ–ç»“æ„**ä¸å¤æ‚**ï¼Œ  
   ç½‘æ ¼æœç´¢æˆ–è®¸èƒ½å¤Ÿåœ¨åˆç†æ—¶é—´å†…è¯¦å°½è¯„ä¼°æ•´ä¸ªæœç´¢ç©ºé—´
  - ç”±äºé«˜çº¬åº¦çš„æœç´¢ç©ºé—´å¯¼è‡´çš„çš„**ç»´åº¦ç¾éš¾**ä»¥åŠå¯¹æ•°å€¼**æœç´¢ç©ºé—´çš„è¦†ç›–ä¸è¶³**ï¼Œ  
   é€šå¸¸**ä¸æ¨èä½¿ç”¨ç½‘æ ¼æœç´¢**
    - æ­¤æ—¶ï¼Œ**éšæœºæœç´¢**å¾€å¾€æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œ  
    å› ä¸ºå¯ä»¥è€ƒè™‘æ›´å¤šç‹¬ç‰¹å€¼
- **æ›´ä¼˜çš„ç®—æ³•**
  - é€‚ç”¨äºé«˜ç»´åº¦æˆ–ç»“æ„æ›´å¤æ‚çš„æœç´¢ç©ºé—´
  - **è¿›åŒ–ç­–ç•¥å’Œè´å¶æ–¯ä¼˜åŒ–**é—´çš„é€‰æ‹©
    - æ ¹æ®å‡½æ•°è¯„ä¼°çš„æˆæœ¬è¿›è¡Œé€‰æ‹©
    - **è¿›åŒ–ç­–ç•¥ï¼ˆevolutionary strategiesï¼‰**
      - è¶…å‚é…ç½®èƒ½å¤Ÿå¿«é€Ÿè¯„ä¼°æ—¶
    - **è´å¶æ–¯ä¼˜åŒ–ï¼ˆBayesian optimizationï¼‰**
      - æ¨¡å‹è¯„ä¼°è€—æ—¶ä¸”ä¼˜åŒ–é¢„ç®—æœ‰é™æ—¶
    - é€šå¸¸æ¨èåœ¨è¶…å‚ä¼˜åŒ–ä¸­ä½¿ç”¨**è´å¶æ–¯ä¼˜åŒ–**
      - è™½ç„¶è´å¶æ–¯ä¼˜åŒ–çš„ä¼˜åŒ–æˆæœ¬ç›¸å¯¹è¾ƒå¤§  
     ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œéƒ½è¦è®­ç»ƒä»£ç†æ¨¡å‹å¹¶ä¼˜åŒ–é‡‡é›†å‡½æ•°ï¼‰ï¼Œ  
     ä½†åœ¨è¯¸å¦‚æœºå™¨å­¦ä¹ æ¨¡å‹é‡é‡‡æ ·ç­‰å‡½æ•°è¯„ä¼°æˆæœ¬ç›¸å¯¹è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œ  
     è¿™ç§å½±å“è¾ƒå°
  - åœ¨è¶…å‚æ•°ä¼˜åŒ–é—®é¢˜æ¶‰åŠæœ‰æ„ä¹‰çš„**ä¿çœŸåº¦å‚æ•°**ï¼ˆä¾‹å¦‚ï¼Œè½®æ•°ã€æ ‘çš„æ•°é‡ã€æå‡è½®æ•°ï¼‰  
   ä¸”éœ€è¦**é«˜æ•ˆä½¿ç”¨ä¼˜åŒ–é¢„ç®—**çš„æƒ…å†µä¸‹ï¼Œ  
   åƒHyperbandè¿™æ ·çš„å¤šä¿çœŸåº¦è¶…å‚æ•°ä¼˜åŒ–ç®—æ³•å¯èƒ½å€¼å¾—è€ƒè™‘

#### è°ƒä¼˜å™¨å¤„ç†çš„ç±»å‹

- `Learner$param_classes`
  - æä¾›å¯ä»¥å¤„ç†å“ªäº›ç±»åˆ«çš„è¶…å‚æ•°
- `Learner$param_classes`
  - æä¾›å¯ä»¥å¤„ç†å“ªäº›ç‰¹æ€§

```r
tnr('grid_search')$param_classes
tnr('grid_search')$properties
```

```css
'ParamLgl''ParamInt''ParamDbl''ParamFct'
'dependencies''single-crit''multi-crit'
```

- ï¼ˆé‡æ–°å›é¡¾ä¸€ä¸‹å¦‚ä½•å»çœ‹è¶…å‚ç±»å‹ï¼‰
  - è¿™é‡Œçš„`class`å°±æ˜¯äº†

```r
lrn('classif.svm')$param_set
```

```css
<ParamSet(16)>
Key: <id>
                 id    class lower upper nlevels          default parents
             <char>   <char> <num> <num>   <num>           <list>  <list>
 1:       cachesize ParamDbl  -Inf   Inf     Inf               40  [NULL]
 2:   class.weights ParamUty    NA    NA     Inf           [NULL]  [NULL]
 3:           coef0 ParamDbl  -Inf   Inf     Inf                0  kernel
 4:            cost ParamDbl     0   Inf     Inf                1    type
 5:           cross ParamInt     0   Inf     Inf                0  [NULL]
 6: decision.values ParamLgl    NA    NA       2            FALSE  [NULL]
 7:          degree ParamInt     1   Inf     Inf                3  kernel
 8:         epsilon ParamDbl     0   Inf     Inf              0.1  [NULL]
 9:          fitted ParamLgl    NA    NA       2             TRUE  [NULL]
10:           gamma ParamDbl     0   Inf     Inf   <NoDefault[0]>  kernel
11:          kernel ParamFct    NA    NA       4           radial  [NULL]
12:              nu ParamDbl  -Inf   Inf     Inf              0.5    type
13:           scale ParamUty    NA    NA     Inf             TRUE  [NULL]
14:       shrinking ParamLgl    NA    NA       2             TRUE  [NULL]
15:       tolerance ParamDbl     0   Inf     Inf            0.001  [NULL]
16:            type ParamFct    NA    NA       2 C-classification  [NULL]
     value
    <list>
 1: [NULL]
 2: [NULL]
 3: [NULL]
 4: [NULL]
 5: [NULL]
 6: [NULL]
 7: [NULL]
 8: [NULL]
 9: [NULL]
10: [NULL]
11: [NULL]
12: [NULL]
13: [NULL]
14: [NULL]
15: [NULL]
16: [NULL]
```

```r
lrn('classif.svm')$param_set$deps
```

<table class='dataframe'>
<caption>A data.table: 5 x 3</caption>
<thead>
 <tr><th scope=col>id</th><th scope=col>on</th><th scope=col>cond</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>coef0 </td><td>kernel</td><td>polynomial    , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>cost  </td><td>type  </td><td>C-classification, %s == %s        </td></tr>
 <tr><td>degree</td><td>kernel</td><td>polynomial, %s == %s  </td></tr>
 <tr><td>gamma </td><td>kernel</td><td>polynomial    , radial        , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>nu    </td><td>type  </td><td>nu-classification, %s == %s         </td></tr>
</tbody>
</table>

#### è§¦å‘è°ƒä¼˜è¿‡ç¨‹

- è¿™ä¸ªæ˜¯ä¹‹å‰æ„å»ºå¥½çš„å®ä¾‹

```r
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚`cose`å’Œ`gamma`
 cost  = to_tune(1e-1, 1e5),
 gamma = to_tune(1e-1, 1),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
```

- åˆ›å»ºè°ƒä¼˜å™¨

```r
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
```

- æ¥ä¸‹æ¥ä½¿ç”¨`Tuner$optimize(TuningInstanceBatchSingleCrit)`è¿›è¡Œè°ƒå‚
  - ç»“æœè¿”å›äº†æœ€ä½³çš„è°ƒä¼˜å‚æ•°ï¼Œå¹¶ä¸”å‚¨å­˜åœ¨äº†  
   `TuningInstanceBatchSingleCrit$result`ä¸­

```r
tuner$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>25000.08</td><td>0.1</td><td>radial          , C-classification, 25000.075       , 0.1             </td><td>25000.08, 0.10</td><td>0.27902</td></tr>
</tbody>
</table>

```r
instance$result
instance$result$learner_param_vals
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>25000.08</td><td>0.1</td><td>radial          , C-classification, 25000.075       , 0.1             </td><td>25000.08, 0.10</td><td>0.27902</td></tr>
</tbody>
</table>

```css
$kernel
'radial'
$type
'C-classification'
$cost
25000.075
$gamma
0.1
```

### å¯¹æ•°å˜æ¢

- å¯¹äºè®¸å¤šå…·æœ‰è¾ƒå¤§ä¸Šç•Œçš„éè´Ÿè¶…å‚æ•°ï¼Œ  
  åœ¨å¯¹æ•°å°ºåº¦ä¸Šè¿›è¡Œè°ƒä¼˜å¯èƒ½æ¯”åœ¨çº¿æ€§å°ºåº¦ä¸Šæ›´æœ‰æ•ˆ
- å¯¹æ•°å˜åŒ–ä¹‹åå¯ä»¥è®©å¤‡é€‰å‚æ•°çš„èŒƒå›´æ›´é›†ä¸­

```r
# library(patchwork)
data.frame(x=cost) %>% ggplot(aes(x=x)) + geom_histogram() + theme_bw() & data.frame(x=exp_cost) %>% ggplot(aes(x=x)) + geom_histogram() + theme_bw()
```

![image_8](./image_8.png)

- åœ¨è°ƒä¼˜æ—¶ï¼Œåªç”¨å°†`logscale = TRUE` ä¼ é€’ç»™ `to_tune()` å³å¯

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚`cose`å’Œ`gamma`
 # é€‰æ‹©å°†å¯¹æ•°å˜æ¢çš„ç»“æœä¼ é€’ç»™`Learner`
 cost  = to_tune(1e-1, 1e5, logscale = TRUE),
 gamma = to_tune(1e-1, 1e5, logscale = TRUE),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
# æ„å»ºè°ƒä¼˜å™¨
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
# è°ƒä¼˜å®ä¾‹
tuner$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1.151293</td><td>-2.302585</td><td>radial          , C-classification, 3.16227766016838, 0.1             </td><td>3.162278, 0.100000</td><td>0.2408558</td></tr>
</tbody>
</table>

- `cost`å’Œ`gamma`æ˜¯å¯¹æ•°å˜æ¢å‰çš„æœ€ä¼˜å€¼ï¼Œ  
  è€Œ`learner_param_vals`å’Œ`x_domain`åŒ…å«çš„æ˜¯æ˜¯å¯¹æ•°å˜æ¢åçš„

```r
instance$result_learner_param_vals
instance$result$learner_param_vals
```

```css
$kernel
'radial'
$type
'C-classification'
$cost
3.16227766016838
$gamma
0.1
```

```r
instance$result_x_domain
instance$result$x_domain
```

```css
$cost
3.16227766016838
$gamma
0.1
```

- å¯ä»¥ç®€å•éªŒç®—ä¸€ä¸‹ç»“æœ
  - ç»“æœå’Œä¸Šæ–¹çš„ç»“æœå®Œå…¨ä¸€è‡´

```r
instance$result$cost
exp(instance$result$cost)
```

```css
1.15129254649702
3.16227766016838
```

### åˆ†æå’Œä½¿ç”¨ç»“æœ

- è¯„ä¼°å®Œçš„ç»“æœå‚¨å­˜åœ¨`Instance$archive`é‡Œé¢
- ä¸€å…±æœ‰25ç»„ï¼Œè¿™æ˜¯å› ä¸ºè®¾å®šçš„`Tuner`çš„`resulution`æ˜¯5ï¼Œ  
  æ‰€ä»¥å¯ä»¥å¾—åˆ°$5^{2}= 25$

```r
instance$archive
```

<table class='dataframe'>
<caption>A data.table: 25 x 10</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>runtime_learners</th><th scope=col>timestamp</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>x_domain</th><th scope=col>batch_nr</th><th scope=col>resample_result</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-2.302585</td><td>11.512925</td><td>0.4665286</td><td>0.039</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e-01, 1e+05</td><td>1</td><td>&lt;environment: 0x1734a6650&gt;</td></tr>
 <tr><td> 1.151293</td><td>-2.302585</td><td>0.2408558</td><td>0.046</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 0.100000</td><td>1</td><td>&lt;environment: 0x173467a08&gt;</td></tr>
 <tr><td> 1.151293</td><td> 1.151293</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3.162278</td><td>1</td><td>&lt;environment: 0x173430338&gt;</td></tr>
 <tr><td> 1.151293</td><td> 8.059048</td><td>0.4665286</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3162.277660</td><td>1</td><td>&lt;environment: 0x1733e7c38&gt;</td></tr>
 <tr><td> 1.151293</td><td>11.512925</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278e+00, 1.000000e+05</td><td>1</td><td>&lt;environment: 0x1733b1f48&gt;</td></tr>
 <tr><td> 4.605170</td><td>-2.302585</td><td>0.2408558</td><td>0.100</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.0, 0.1</td><td>1</td><td>&lt;environment: 0x173087ad0&gt;</td></tr>
 <tr><td> 8.059048</td><td>-2.302585</td><td>0.2408558</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 0.100</td><td>1</td><td>&lt;environment: 0x17361d128&gt;</td></tr>
 <tr><td> 8.059048</td><td>11.512925</td><td>0.4665286</td><td>0.027</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 100000.000</td><td>1</td><td>&lt;environment: 0x173397c08&gt;</td></tr>
 <tr><td>11.512925</td><td>11.512925</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e+05, 1e+05</td><td>1</td><td>&lt;environment: 0x173350e78&gt;</td></tr>
 <tr><td>-2.302585</td><td>-2.302585</td><td>0.4665286</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.1, 0.1</td><td>2</td><td>&lt;environment: 0x173313660&gt;</td></tr>
 <tr><td>-2.302585</td><td> 8.059048</td><td>0.4665286</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.100, 3162.278</td><td>2</td><td>&lt;environment: 0x1732e5170&gt;</td></tr>
 <tr><td> 1.151293</td><td> 4.605170</td><td>0.4665286</td><td>0.025</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 100.000000</td><td>2</td><td>&lt;environment: 0x1732b32b0&gt;</td></tr>
 <tr><td> 4.605170</td><td> 1.151293</td><td>0.4665286</td><td>0.038</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.000000, 3.162278</td><td>2</td><td>&lt;environment: 0x1732860c8&gt;</td></tr>
 <tr><td> 8.059048</td><td> 1.151293</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.277660, 3.162278</td><td>2</td><td>&lt;environment: 0x171620ab0&gt;</td></tr>
 <tr><td> 8.059048</td><td> 8.059048</td><td>0.4665286</td><td>0.031</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 3162.278</td><td>2</td><td>&lt;environment: 0x1715e60b0&gt;</td></tr>
 <tr><td>11.512925</td><td> 1.151293</td><td>0.4665286</td><td>0.035</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1.000000e+05, 3.162278e+00</td><td>2</td><td>&lt;environment: 0x173054958&gt;</td></tr>
 <tr><td>11.512925</td><td> 8.059048</td><td>0.4665286</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100000.000, 3162.278</td><td>2</td><td>&lt;environment: 0x173214b00&gt;</td></tr>
 <tr><td>-2.302585</td><td> 1.151293</td><td>0.4665286</td><td>0.031</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.100000, 3.162278</td><td>3</td><td>&lt;environment: 0x1731baa20&gt;</td></tr>
 <tr><td>-2.302585</td><td> 4.605170</td><td>0.4665286</td><td>0.027</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.1, 100.0</td><td>3</td><td>&lt;environment: 0x173160e10&gt;</td></tr>
 <tr><td> 4.605170</td><td> 4.605170</td><td>0.4665286</td><td>0.026</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100, 100</td><td>3</td><td>&lt;environment: 0x1730f8d98&gt;</td></tr>
 <tr><td> 4.605170</td><td> 8.059048</td><td>0.4665286</td><td>0.040</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100.000, 3162.278</td><td>3</td><td>&lt;environment: 0x173064ba0&gt;</td></tr>
 <tr><td> 4.605170</td><td>11.512925</td><td>0.4665286</td><td>0.064</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+02, 1e+05</td><td>3</td><td>&lt;environment: 0x13a1f7410&gt;</td></tr>
 <tr><td> 8.059048</td><td> 4.605170</td><td>0.4665286</td><td>0.033</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>3162.278, 100.000</td><td>3</td><td>&lt;environment: 0x176b02dd8&gt;</td></tr>
 <tr><td>11.512925</td><td>-2.302585</td><td>0.2408558</td><td>0.035</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e-01</td><td>3</td><td>&lt;environment: 0x176c46388&gt;</td></tr>
 <tr><td>11.512925</td><td> 4.605170</td><td>0.4665286</td><td>0.039</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e+02</td><td>3</td><td>&lt;environment: 0x176bf3e68&gt;</td></tr>
</tbody>
</table>

- å¯ä»¥æ ¹æ®ä¸åŒçš„æ€§èƒ½æŒ‡æ ‡å¯¹å†…éƒ¨`ResampleResult`è¿›è¡Œè¯„åˆ†
  - zhe lè¿™é‡Œæ˜¯è€ƒå¯Ÿæ¼æŠ¥ç‡ã€è¯¯æŠ¥ç‡ä»¥åŠåˆ†ç±»é”™è¯¯

```r
as.data.table(
 instance$archive,
 measures = msrs(c('classif.fpr', 'classif.fnr'))
)
```

<table class='dataframe'>
<caption>A data.table: 25 x 12</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>classif.fpr</th><th scope=col>classif.fnr</th><th scope=col>runtime_learners</th><th scope=col>timestamp</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>x_domain</th><th scope=col>batch_nr</th><th scope=col>resample_result</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-2.302585</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.039</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e-01, 1e+05</td><td>1</td><td>&lt;environment: 0x17b2d4438&gt;</td></tr>
 <tr><td> 1.151293</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.046</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 0.100000</td><td>1</td><td>&lt;environment: 0x17b2bce48&gt;</td></tr>
 <tr><td> 1.151293</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3.162278</td><td>1</td><td>&lt;environment: 0x17b2a6070&gt;</td></tr>
 <tr><td> 1.151293</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3162.277660</td><td>1</td><td>&lt;environment: 0x17b288a58&gt;</td></tr>
 <tr><td> 1.151293</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278e+00, 1.000000e+05</td><td>1</td><td>&lt;environment: 0x17b2719e0&gt;</td></tr>
 <tr><td> 4.605170</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.100</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.0, 0.1</td><td>1</td><td>&lt;environment: 0x17b254208&gt;</td></tr>
 <tr><td> 8.059048</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 0.100</td><td>1</td><td>&lt;environment: 0x17b23cb00&gt;</td></tr>
 <tr><td> 8.059048</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.027</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 100000.000</td><td>1</td><td>&lt;environment: 0x17b19f510&gt;</td></tr>
 <tr><td>11.512925</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e+05, 1e+05</td><td>1</td><td>&lt;environment: 0x17b17e0e0&gt;</td></tr>
 <tr><td>-2.302585</td><td>-2.302585</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.1, 0.1</td><td>2</td><td>&lt;environment: 0x17b1639e0&gt;</td></tr>
 <tr><td>-2.302585</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.100, 3162.278</td><td>2</td><td>&lt;environment: 0x17b140828&gt;</td></tr>
 <tr><td> 1.151293</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.025</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 100.000000</td><td>2</td><td>&lt;environment: 0x17b1184e0&gt;</td></tr>
 <tr><td> 4.605170</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.038</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.000000, 3.162278</td><td>2</td><td>&lt;environment: 0x17b0ffee8&gt;</td></tr>
 <tr><td> 8.059048</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.277660, 3.162278</td><td>2</td><td>&lt;environment: 0x17b0e54d8&gt;</td></tr>
 <tr><td> 8.059048</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.031</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 3162.278</td><td>2</td><td>&lt;environment: 0x17b0c9120&gt;</td></tr>
 <tr><td>11.512925</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.035</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1.000000e+05, 3.162278e+00</td><td>2</td><td>&lt;environment: 0x17b0ae860&gt;</td></tr>
 <tr><td>11.512925</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100000.000, 3162.278</td><td>2</td><td>&lt;environment: 0x17b0978c8&gt;</td></tr>
 <tr><td>-2.302585</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.031</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.100000, 3.162278</td><td>3</td><td>&lt;environment: 0x17b07ce80&gt;</td></tr>
 <tr><td>-2.302585</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.027</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.1, 100.0</td><td>3</td><td>&lt;environment: 0x17b062f60&gt;</td></tr>
 <tr><td> 4.605170</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.026</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100, 100</td><td>3</td><td>&lt;environment: 0x17b049820&gt;</td></tr>
 <tr><td> 4.605170</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.040</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100.000, 3162.278</td><td>3</td><td>&lt;environment: 0x17b02c320&gt;</td></tr>
 <tr><td> 4.605170</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.064</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+02, 1e+05</td><td>3</td><td>&lt;environment: 0x17b015b30&gt;</td></tr>
 <tr><td> 8.059048</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.033</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>3162.278, 100.000</td><td>3</td><td>&lt;environment: 0x1797f0da0&gt;</td></tr>
 <tr><td>11.512925</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.035</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e-01</td><td>3</td><td>&lt;environment: 0x1797d1698&gt;</td></tr>
 <tr><td>11.512925</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.039</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e+02</td><td>3</td><td>&lt;environment: 0x1797b2a90&gt;</td></tr>
</tbody>
</table>

- åªæŒ‘å‰äº”ä¸ªçš„ä¸€éƒ¨åˆ†

```r
as.data.table(
 instance$archive,
 measures = msrs(c('classif.fpr', 'classif.fnr'))
)[1:5 ,.(cost, gamma, classif.ce, classif.fpr, classif.fnr)]
```

<table class='dataframe'>
<caption>A data.table: 5 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>classif.fpr</th><th scope=col>classif.fnr</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-2.302585</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
 <tr><td> 1.151293</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td></tr>
 <tr><td> 1.151293</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
 <tr><td> 1.151293</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
 <tr><td> 1.151293</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
</tbody>
</table>

- `Instance$archive$benchmark_result`ä¸­å‚¨å­˜äº†æ‰€æœ‰çš„`BenchmarkResult`å¯¹è±¡

```r
{instance$archive$benchmark_result %>% as.data.table()}[1:5]
```

<table class="dataframe">
<caption>A data.table: 5 x 9</caption>
<thead>
 <tr><th scope=col>uhash</th><th scope=col>task</th><th scope=col>learner</th><th scope=col>resampling</th><th scope=col>iteration</th><th scope=col>prediction</th><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>resampling_id</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>e31b69c6-41d4-4d7f-81c2-ed3b4bd3b75f</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x3064c38c0&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>1</td><td>&lt;environment: 0x3202d2ac0&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>e31b69c6-41d4-4d7f-81c2-ed3b4bd3b75f</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x306425260&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>2</td><td>&lt;environment: 0x32023dcf0&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>e31b69c6-41d4-4d7f-81c2-ed3b4bd3b75f</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x30a0e4660&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>3</td><td>&lt;environment: 0x32019c9d0&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>5413c20f-f67c-4741-bc1e-6535ac83e266</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x300847120&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>1</td><td>&lt;environment: 0x320379c40&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>5413c20f-f67c-4741-bc1e-6535ac83e266</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x31f42b8c0&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>2</td><td>&lt;environment: 0x17ede9278&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
</tbody>
</table>

- å¯ä»¥å°†`type = "surface"`ä¼ é€’ç»™`autoplot.TuningInstanceBatchSingleCrit`æ¥å¯è§†åŒ–å®ä¾‹è°ƒä¼˜çš„ç»“æœ
  - è“è‰²çš„åŒºåŸŸè¡¨ç¤º`classif.ce`è¯„ä¼°å™¨çš„è¾ƒå°ç»“æœï¼Œè¡¨æ˜æ¨¡å‹æ›´ä¼˜

```r
autoplot(instance, type = "surface")
```

![image_9](./image_9.png)

### è®­ç»ƒä¼˜åŒ–æ¨¡å‹

- å½“ç¡®å®šå¥½è¶…å‚åï¼Œå°†`Instance`ä¸­çš„è¶…å‚ä¼ é€’ç»™æ–°å»ºå­¦ä¹ å™¨ä¸­

```r
lrn_svm_tuned <- lrn("classif.svm")
lrn_svm_tuned$param_set$values <- instance$result_learner_param_vals
```

- ä¹‹åè¿›è¡Œæœ€åŸºç¡€çš„è®­ç»ƒæµç¨‹å³å¯

```r
lrn_svm_tuned$train(tsk_sonar)$model
```

```r
Call:
svm.default(x = data, y = task$truth(), type = "C-classification", 
    kernel = "radial", gamma = 0.1, cost = 3.16227766016838, probability = (self$predict_type == 
        "prob"))


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  radial 
       cost:  3.162278 

Number of Support Vectors:  205
```

## æ›´ä¾¿æ·çš„è°ƒä¼˜æ–¹æ³•

- åŸºæœ¬è°ƒå‚æ–¹æ³•ä¸­ç”¨çš„æ˜¯`ti()`åˆ›å»ºè°ƒä¼˜å®ä¾‹ï¼Œ  
  ä¹‹åç”¨`Tuner$optimize()`è¿›è¡Œè°ƒä¼˜

### `tune()`

- `tune()`å¯ä»¥åœ¨åˆ›å»ºå®ä¾‹åç›´æ¥è¿›è¡Œè°ƒä¼˜ï¼Œ  
  çœç•¥æ‰‹åŠ¨å…ˆåˆ›å»ºè°ƒä¼˜å®ä¾‹ï¼Œå
- ä¸‹é¢çš„ä¾‹å­å¯ä»¥è¿›è¡Œç®€å•çš„å¯¹æ¯”

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')

# ---------------ä¹‹å‰çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚`cose`å’Œ`gamma`
 # é€‰æ‹©å°†å¯¹æ•°å˜æ¢çš„ç»“æœä¼ é€’ç»™`Learner`
 cost  = to_tune(1e-1, 1e5, logscale = TRUE),
 gamma = to_tune(1e-1, 1e5, logscale = TRUE),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
# æ„å»ºè°ƒä¼˜å™¨
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
# è°ƒä¼˜å®ä¾‹
tuner$optimize(instance)

# ---------------`tune()`çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
lrn_svm <- lrn("classif.svm",
  cost  = to_tune(1e-5, 1e5, logscale = TRUE),
  gamma = to_tune(1e-5, 1e5, logscale = TRUE),
  kernel = "radial",
  type = "C-classification"
)
# [æ„å»ºè°ƒä¼˜å™¨]
# éœ€è¦å…ˆæ„å»ºè°ƒä¼˜å™¨ï¼Œä¹‹åä¼ é€’åˆ°`tune()`ä¸­
tnr_grid_search <- tnr("grid_search", resolution = 5, batch_size = 5)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <- tune(
 # [è¿™é‡Œå¤šäº†`tuner`å‚æ•°]
 # æ‰€ä»¥å…ˆæ„å»ºçš„è°ƒä¼˜å™¨ï¼Œåä¼ é€’åˆ°`tune()`ä¸­
 # å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥`tnr("grid_search", resolution = 5, batch_size = 5)`
 tuner = tnr_grid_search,
 task = tsk_sonar,
 learner = lrn_svm,
 resampling = rsmp("cv", folds = 3),
 measures = msr("classif.ce")
)
instance$result
```

### `auto_tune()`

- `auto_tune()` åˆ›å»ºä¸€ä¸ª`AutoTuner`ç±»çš„å¯¹è±¡
- `AutoTuner`ç»§æ‰¿è‡ªLearnerç±»ï¼Œå¹¶å°è£…äº†è°ƒä¼˜æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œ  
  è¿™æ„å‘³ç€`AutoTuner`å°±æ˜¯ä¸€ä¸ª`Learner`
- åœ¨åº•å±‚ï¼Œ`AutoTuner`æœ¬è´¨ä¸Šæ˜¯åœ¨è°ƒç”¨`Learner$train()`æ—¶ä¼ é€’ç»™æ¨¡å‹çš„æ•°æ®ä¸Šè¿è¡Œ`tune()`ï¼Œç„¶åå°†`Learner$param_set`å‚æ•°è®¾ç½®ä¸ºæœ€ä¼˜é…ç½®

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')

# ---------------ä¹‹å‰çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚`cose`å’Œ`gamma`
 # é€‰æ‹©å°†å¯¹æ•°å˜æ¢çš„ç»“æœä¼ é€’ç»™`Learner`
 cost  = to_tune(1e-1, 1e5, logscale = TRUE),
 gamma = to_tune(1e-1, 1e5, logscale = TRUE),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
# æ„å»ºè°ƒä¼˜å™¨
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
# è°ƒä¼˜å®ä¾‹
tuner$optimize(instance)

# ---------------`auto_tune()`çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
lrn_svm <- lrn("classif.svm",
  cost  = to_tune(1e-5, 1e5, logscale = TRUE),
  gamma = to_tune(1e-5, 1e5, logscale = TRUE),
  kernel = "radial",
  type = "C-classification3333"
)
# [æ„å»ºè°ƒä¼˜å™¨]
# éœ€è¦å…ˆæ„å»ºè°ƒä¼˜å™¨ï¼Œä¹‹åä¼ é€’åˆ°`auto_tune()`ä¸­
tnr_grid_search <- tnr("grid_search", resolution = 5, batch_size = 5)
# åˆ›å»º`AutoTuner`
at <- auto_tuner(
  tuner = tnr_grid_search,
  learner = lrn_svm,
  resampling = rsmp('cv', folds = 3),
  measure = msr('classif.ce')
)
# åˆ†å‰²`Task`çš„æ•°æ®
split <- partition(tsk_sonar) 
# è®­ç»ƒæ¨¡å‹ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è‡ªåŠ¨è°ƒä¼˜é€‰æ‹©å‡ºæœ€ä½³çš„è¶…å‚
at$train(tsk_sonar, row_ids = split$train) 
# é¢„æµ‹æ¨¡å‹ï¼Œè·å¾—è¯„ä¼°ç»“æœ
pred <- at$predict(tsk_sonar, row_ids = split$test)
pred$score()
```

```css
classif.ce: 0.159420289855072
```

- `AutoTuner`ä¸­è¿˜åŒ…å«ä¸€ä¸ªè°ƒä¼˜å®ä¾‹`Intance`
  - ç”¨æ³•å’Œå‰è¿°ä¸€æ ·

```r
at$tuning_instance$result %>% as.data.table()
```

<table class="dataframe">
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>11.51293</td><td>-5.756463</td><td>radial             , C-classification   , 1e+05              , 0.00316227766016838</td><td>1.000000e+05, 3.162278e-03</td><td>0.2008942</td></tr>
</tbody>
</table>

![image_10](./image_10.png)
> Illustration of an Auto-Tuner.

## åµŒå¥—é‡é‡‡æ ·ï¼ˆNested Resamplingï¼‰

### ç®€ä»‹

- è¶…å‚æ•°ä¼˜åŒ–åœ¨ä¸è¿›è¡Œé¢å¤–çš„é‡é‡‡æ ·æ—¶ä¼šäº§ç”Ÿè®­ç»ƒè¯¯å·®å¯¼è‡´çš„ä¹è§‚åå·®

![image_11](./image_11.png)

åµŒå¥—é‡é‡‡æ ·ç¤ºæ„å›¾ã€‚å¤§å—ä»£è¡¨ç”¨äºæ¨¡å‹è¯„ä¼°çš„å¤–éƒ¨é‡é‡‡æ ·çš„ä¸‰æŠ˜äº¤å‰éªŒè¯ï¼Œå°å—ä»£è¡¨ç”¨äºè°ƒå‚çš„å†…éƒ¨é‡é‡‡æ ·çš„å››æŠ˜äº¤å‰éªŒè¯ã€‚æµ…è“è‰²å—ä¸ºè®­ç»ƒé›†ï¼Œæ·±è“è‰²å—ä¸ºæµ‹è¯•é›†ã€‚

- çœ‹ç€æŒºæŒºå¤æ‚çš„ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼š
  - å…¶å®å°±æ˜¯å…ˆå¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œ3æŠ˜äº¤å‰éªŒè¯çš„åˆ‡åˆ†ï¼Œ  
   è¿™ä¸ªé‡Œé¢2/3çš„ç”¨äºè®­ç»ƒé›†ï¼Œ1/3çš„ç”¨äºéªŒè¯é›†  
   ï¼ˆæœ¬è´¨æ˜¯æµ‹è¯•é›†ï¼Œä¸è¿‡ä¸€èˆ¬æµ‹è¯•é›†æ˜¯çº¯ç”¨äºæµ‹è¯•çš„é‚£ç§ï¼‰ï¼Œ
   è¿™ä¸ªéƒ¨åˆ†å«**å¤–éƒ¨é‡é‡‡æ ·ï¼ˆouter resamplingï¼‰**
    - å¯¹2/3è®­ç»ƒé›†ä¸­å†è¿›è¡Œ4æŠ˜äº¤å‰éªŒè¯çš„åˆ‡åˆ†ï¼Œ  
    è¿™ä¸ªéƒ¨åˆ†å«**å†…éƒ¨é‡é‡‡æ ·ï¼ˆinner resamplingï¼‰**
    - å†…éƒ¨é‡é‡‡æ ·è®­ç»ƒå‡ºæ¥çš„Nä¸ªæ¨¡å‹ç”¨å¤–éƒ¨çš„éªŒè¯é›†è¿›è¡Œè¯„ä¼°ï¼Œ  
    é€‰å‡ºæœ€ä½³è¶…å‚ï¼Œ  
    è¿™ä¸ªéƒ¨åˆ†å«**è¶…å‚æ•°ä¼˜åŒ–ï¼ˆHPOï¼‰**
      - Nå–å†³äºè¶…å‚ä¸ªæ•°ä»¥åŠç½‘æ ¼æœç´¢åˆ†è¾¨ç‡ï¼Œ  
     2ä¸ªè¶…å‚ï¼Œç½‘æ ¼æœç´¢åˆ†è¾¨ç‡ä¸º2å°±æ˜¯$2^2=4$ï¼Œ  
     2ä¸ªè¶…å‚ï¼Œç½‘æ ¼æœç´¢åˆ†è¾¨ç‡ä¸º3å°±æ˜¯$3^2=9$ï¼Œ  
     è¿™ä¸ªç»“æœå†ä¹˜ä»¥å†…éƒ¨é‡é‡‡æ ·çš„kå€¼
      - æœ¬ä¾‹ä¸­å‡è®¾å†…éƒ¨é‡é‡‡æ ·æ˜¯4æŠ˜ï¼Œ2ä¸ªå‚æ•°ï¼Œ2ä¸ªç½‘æ ¼ï¼Œ  
     é‚£ä¹ˆå…±äº§ç”Ÿ $4\times2^2=16$ ä¸ªæ¨¡å‹
      - è¿™äº›æ¨¡å‹ä¸ç›´æ¥ç”¨äº1/3æ•°æ®çš„éªŒè¯é›†ï¼Œ  
     è€Œæ˜¯ç”¨å†…éƒ¨é‡é‡‡æ ·çš„å°éªŒè¯é›†è¿›è¡Œæ€§èƒ½è¯„ä¼°ï¼Œ  
     æœ€ç»ˆé€‰å‡º16ä¸ªæ¨¡å‹é‡Œåœ¨è‡ªå·±å°éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹çš„è¶…å‚
    - ç”¨é€‰æ‹©çš„è¶…å‚åœ¨**æ•´ä¸ª**2/3æ•°æ®çš„çš„è®­ç»ƒé›†è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œ  
    å†åœ¨1/3æ•°æ®çš„æµ‹è¯•é›†ä¸Šè¿›è¡Œæ¨¡å‹è¯„ä¼°
  - ä¸Šè¿°ä¸€è½®çš„å†…å¤–é‡é‡‡æ ·ç»“æŸåï¼Œå†é‡å¤ä¸¤è½®
  - ä¸‰æ¬¡ç»“æŸåï¼Œè·å¾—æœ€ç»ˆ3ä¸ªæ¨¡å‹ï¼Œ  
   æœ€è¿™ä¸‰ä¸ªæ¨¡å‹è¿›è¡Œç»¼åˆè¯„ä¼°å¹¶é€‰æ‹©æœ€ä½³å‚æ•°å»ºæ¨¡ï¼Œ  
   å¹¶æœ€ç»ˆç”¨æµ‹è¯•é›†è¯„ä¼°æœ€ç»ˆæ€§èƒ½

- **æ³¨æ„**ï¼šåµŒå¥—é‡é‡‡æ ·çš„è®¡ç®—æˆæœ¬å¾ˆé«˜
  - æ­£å¦‚ä¸Šæ‰€è¿°ï¼Œè¶…å‚çš„ä¸ªæ•°å’Œç½‘æ ¼æ•°åˆ†è¾¨ç‡å†³å®šäº†è®­ç»ƒæ¨¡å‹çš„è¿­ä»£æ¬¡æ•°ï¼›  
   å¦‚æœ2è¶…å‚å¤–3æŠ˜å†…4æŠ˜ä¸º5çš„åˆ†è¾¨ç‡ï¼Œé‚£ä¹ˆæ€»å…±éœ€è¦è¿­ä»£ $3\times4\times5^{2}= 300$æ¬¡
  - å¦‚æœè®¡ç®—èµ„æºæ”¯æŒï¼Œå¯ä»¥é€šè¿‡å¹¶è¡ŒåŒ–æé«˜é€Ÿåº¦

### ä½¿ç”¨`auto_tuner()`è¿›è¡ŒåµŒå¥—é‡é‡‡æ ·

- åªéœ€å°† `AutoTuner` ä¼ é€’ç»™ `resample()`æˆ– `benchmark()` å³å¯

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
lrn_svm <- lrn('classif.svm',
 cost  = to_tune(1e-5, 1e5, logscale = TRUE),
 gamma = to_tune(1e-5, 1e5, logscale = TRUE),
 kernel = 'radial',
 type = 'C-classification'
)
# æ„å»ºè°ƒä¼˜å™¨
tnr_grid_search <- tnr('grid_search', resolution = 5, batch_size = 5)
# æ„å»º`AutoTuner`
at <- auto_tuner(
 tuner = tnr_grid_search,
 learner = lrn_svm,
 # æ„å»ºå†…éƒ¨`Resampling`
 resampling = rsmp('cv', folds = 4),
 measure = msr('classif.ce')
)
# æ„å»ºå¤–éƒ¨`Resampling`
rsmp_cv3 <- rsmp('cv', folds = 3)
# å°†`AutoTuner`ä¼ é€’ç»™`resample()`
# è¿™é‡Œçš„`store_models=TRUE`ä»…èƒ½å‚¨å­˜å¤–éƒ¨é‡é‡‡æ ·çš„3ä¸ªæ¨¡å‹
rr <- resample(tsk_sonar, at, rsmp_cv3, store_models = TRUE)
# æ‰“å°
rr
```

```css
[36m--[39m [1m[34m<ResampleResult>[39m with [34m3[39m resampling iterations[22m [36m-------------------------------[39m
 task_id        learner_id resampling_id iteration     prediction_test warnings
   sonar classif.svm.tuned            cv         1 <PredictionClassif>        0
   sonar classif.svm.tuned            cv         2 <PredictionClassif>        0
   sonar classif.svm.tuned            cv         3 <PredictionClassif>        0
 errors
      0
      0
      0
```

- æŸ¥çœ‹æœ€ç»ˆæ¨¡å‹çš„

```r
rr$aggregate()
```

```css
classif.ce: 0.163285024154589
```

- `extract_inner_tuning_results(ResampleResult)` è¿”å›å¤–éƒ¨é‡é‡‡æ ·çš„å…¨éƒ¨ç»“æœ  
- `extract_inner_tuning_archives(ResampleResult)` è¿”å›å†…å¤–éƒ¨é‡é‡‡æ ·çš„å…¨éƒ¨ç»“æœ

```r
extract_inner_tuning_results(rr)
```

<table class='dataframe'>
<caption>A data.table: 3 x 9</caption>
<thead>
 <tr><th scope=col>iteration</th><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>resampling_id</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1</td><td>5.756463</td><td> -5.756463</td><td>0.1882353</td><td>radial             , C-classification   , 316.227766016838   , 0.00316227766016838</td><td>3.162278e+02, 3.162278e-03</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td>5.756463</td><td>-11.512925</td><td>0.2376050</td><td>radial          , C-classification, 316.227766016838, 1e-05           </td><td>316.22777, 0.00001</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>5.756463</td><td> -5.756463</td><td>0.2006303</td><td>radial             , C-classification   , 316.227766016838   , 0.00316227766016838</td><td>3.162278e+02, 3.162278e-03</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
</tbody>
</table>

```r
extract_inner_tuning_archives(rr)
```

<table class='dataframe'>
<caption>A data.table: 75 x 15</caption>
<thead>
 <tr><th scope=col>iteration</th><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>x_domain_cost</th><th scope=col>x_domain_gamma</th><th scope=col>runtime_learners</th><th scope=col>timestamp</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>batch_nr</th><th scope=col>resample_result</th><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>resampling_id</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>1.000000e-05</td><td>3.162278e+02</td><td>0.088</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec87bc8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> -5.756463</td><td>0.2689076</td><td>1.000000e+00</td><td>3.162278e-03</td><td>0.042</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec63f78&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>1.000000e+00</td><td>1.000000e+00</td><td>0.074</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec47d10&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>-11.512925</td><td>0.3126050</td><td>3.162278e+02</td><td>1.000000e-05</td><td>0.033</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec1b1c8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>3.162278e+02</td><td>1.000000e+00</td><td>0.035</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ebf3920&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td> -5.756463</td><td>0.4632353</td><td>3.162278e-03</td><td>3.162278e-03</td><td>0.026</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16ebda1e0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>3.162278e-03</td><td>1.000000e+00</td><td>0.029</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eba3970&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>3.162278e-03</td><td>3.162278e+02</td><td>0.037</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eb76288&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> 11.512925</td><td>0.4632353</td><td>1.000000e+00</td><td>1.000000e+05</td><td>0.028</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eb1ca18&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>1.000000e+05</td><td>3.162278e+02</td><td>0.034</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eaf0358&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td> -5.756463</td><td>0.4632353</td><td>1.000000e-05</td><td>3.162278e-03</td><td>0.035</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16eac7780&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>1.000000e-05</td><td>1.000000e+00</td><td>0.029</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16e7cc3a0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td> 11.512925</td><td>0.4632353</td><td>1.000000e-05</td><td>1.000000e+05</td><td>0.055</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x134617800&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>1.000000e+00</td><td>3.162278e+02</td><td>0.044</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x164f9f808&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>1.000000e+05</td><td>1.000000e+00</td><td>0.039</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x164f80080&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td> 11.512925</td><td>0.4632353</td><td>3.162278e-03</td><td>1.000000e+05</td><td>0.029</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164f5c5f8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> -5.756463</td><td>0.1882353</td><td>3.162278e+02</td><td>3.162278e-03</td><td>0.025</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164f362f0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> 11.512925</td><td>0.4632353</td><td>3.162278e+02</td><td>1.000000e+05</td><td>0.050</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164f0c570&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td> -5.756463</td><td>0.1882353</td><td>1.000000e+05</td><td>3.162278e-03</td><td>0.024</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164eec7c8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td> 11.512925</td><td>0.4632353</td><td>1.000000e+05</td><td>1.000000e+05</td><td>0.792</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164ec0b48&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td>-11.512925</td><td>0.4632353</td><td>1.000000e-05</td><td>1.000000e-05</td><td>0.030</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e8ab88&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td>-11.512925</td><td>0.4632353</td><td>3.162278e-03</td><td>1.000000e-05</td><td>0.029</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e5e2d0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>-11.512925</td><td>0.4632353</td><td>1.000000e+00</td><td>1.000000e-05</td><td>0.043</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e34400&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>3.162278e+02</td><td>3.162278e+02</td><td>0.074</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e02020&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td>-11.512925</td><td>0.2542017</td><td>1.000000e+05</td><td>1.000000e-05</td><td>0.026</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164de4160&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> -5.756463</td><td>-11.512925</td><td>0.4672269</td><td>3.162278e-03</td><td>1.000000e-05</td><td>0.030</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e41f860&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>1.000000e+00</td><td>3.162278e+02</td><td>0.050</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e3e9f40&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>3.162278e+02</td><td>3.162278e+02</td><td>0.035</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e3c77f8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>1.000000e+05</td><td>3.162278e+02</td><td>0.032</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x1345eef68&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> 11.512925</td><td> 11.512925</td><td>0.4672269</td><td>1.000000e+05</td><td>1.000000e+05</td><td>0.029</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x1345c8a18&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
 <tr><td>2</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>1.000000e-05</td><td>3.162278e+02</td><td>0.027</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164ca6460&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> -5.756463</td><td> -5.756463</td><td>0.4672269</td><td>3.162278e-03</td><td>3.162278e-03</td><td>0.029</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164c86108&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>3.162278e-03</td><td>3.162278e+02</td><td>0.023</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x13452b258&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4672269</td><td>1.000000e+00</td><td>1.000000e+00</td><td>0.026</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x1345010e8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4672269</td><td>1.000000e+05</td><td>1.000000e+00</td><td>0.028</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x1344dd2a8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>1.000000e-05</td><td>1.000000e+00</td><td>0.033</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e8c96d8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>3.162278e-03</td><td>1.000000e+00</td><td>0.042</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e8a5b28&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> -5.756463</td><td>0.2518908</td><td>1.000000e+00</td><td>3.162278e-03</td><td>0.025</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e87db78&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>3.162278e+02</td><td>1.000000e+00</td><td>0.026</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x164b0ec00&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td>-11.512925</td><td>0.2371849</td><td>1.000000e+05</td><td>1.000000e-05</td><td>0.051</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x164aede90&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td> -5.756463</td><td>0.4680672</td><td>1.000000e-05</td><td>3.162278e-03</td><td>0.027</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164aadb78&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td> 11.512925</td><td>0.4680672</td><td>1.000000e-05</td><td>1.000000e+05</td><td>0.026</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a8cee8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>3.162278e-03</td><td>3.162278e+02</td><td>0.024</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a46ef8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> -5.756463</td><td>0.2006303</td><td>3.162278e+02</td><td>3.162278e-03</td><td>0.024</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a275b0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>3.162278e+02</td><td>3.162278e+02</td><td>0.025</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a0a2e0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td>-11.512925</td><td>0.4823529</td><td>3.162278e-03</td><td>1.000000e-05</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x1649ea238&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td> -5.756463</td><td>0.4680672</td><td>3.162278e-03</td><td>3.162278e-03</td><td>0.030</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x1649d0c80&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td> 11.512925</td><td>0.4680672</td><td>3.162278e-03</td><td>1.000000e+05</td><td>0.052</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x1649b6c10&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>-11.512925</td><td>0.4823529</td><td>1.000000e+00</td><td>1.000000e-05</td><td>0.029</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16e865190&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> 11.512925</td><td>0.4680672</td><td>1.000000e+00</td><td>1.000000e+05</td><td>0.028</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16e84baf8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td>-11.512925</td><td>0.4823529</td><td>1.000000e-05</td><td>1.000000e-05</td><td>0.037</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x16e82a278&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>1.000000e-05</td><td>3.162278e+02</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133ff9c88&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>-11.512925</td><td>0.2802521</td><td>3.162278e+02</td><td>1.000000e-05</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133fde710&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> 11.512925</td><td>0.4680672</td><td>3.162278e+02</td><td>1.000000e+05</td><td>0.026</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133fc2fd0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>1.000000e+05</td><td>3.162278e+02</td><td>0.027</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133f06cb0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>1.000000e+00</td><td>1.000000e+00</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x133eca480&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>1.000000e+00</td><td>3.162278e+02</td><td>0.024</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x133e9dd28&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td> -5.756463</td><td>0.2006303</td><td>1.000000e+05</td><td>3.162278e-03</td><td>0.033</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x133e7f238&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>1.000000e+05</td><td>1.000000e+00</td><td>0.029</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x16e33a6d8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td> 11.512925</td><td>0.4680672</td><td>1.000000e+05</td><td>1.000000e+05</td><td>0.027</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x16e319e18&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
</tbody>
</table>

### è¯„ä¼°æ€§èƒ½çš„æ­£ç¡®ï¼ˆä¸é”™è¯¯ï¼‰æ–¹å¼

- è¿™é‡Œè¿›è¡Œä¸€ä¸ªå¯¹æ¯”ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆè¦ç”¨åµŒå¥—é‡é‡‡æ ·è€Œä¸æ˜¯ç®€å•çš„æ— åµŒå¥—é‡é‡‡æ ·

```r
# ---------------å‡†å¤‡æ•°æ®
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(5)
# æ„å»ºå­¦ä¹ å™¨
lrn_xgboost <- lrn(
 # é€‰æ‹©xgboostç®—æ³•ä½œä¸ºå­¦ä¹ å™¨
 'classif.xgboost',
 # è®¾ç½®è¶…å‚çš„é€‰æ‹©èŒƒå›´
 eta = to_tune(1e-4, 1, logscale = TRUE),
 max_depth = to_tune(1, 20),
 colsample_bytree  = to_tune(1e-1, 1),
 colsample_bylevel = to_tune(1e-1, 1),
 lambda = to_tune(1e-3, 1e3, logscale = TRUE),
 alpha = to_tune(1e-3, 1e3, logscale = TRUE),
 subsample = to_tune(1e-1, 1)
)
# æ„å»ºä»»åŠ¡ç”Ÿæˆå™¨ï¼Œå‘½åä¸º'moons'
tsk_moons <- tgen('moons')
# éšæœºç”Ÿæˆ100ä¸ªè®­ç»ƒæ ·æœ¬å’Œ1000000ä¸ªæµ‹è¯•æ ·æœ¬
tsk_moons_train <- tsk_moons$generate(100)
tsk_moons_test <- tsk_moons$generate(1000000)
# æ„å»ºè¯„ä¼°å™¨
msr_ce <- msr('classif.ce')
# è°ƒä¼˜å™¨ç”¨éšæœºæœç´¢æ³•
tnr_random <- tnr('random_search')
# ä½¿ç”¨ç•™å‡ºæ³•é‡é‡‡æ ·
rsmp_holdout <- rsmp('holdout')
# è®¾ç½®ç»ˆæ­¢å™¨ï¼Œä½¿ç”¨æ¬¡æ•°é™åˆ¶æ³•ï¼Œéšæœºæœç´¢700æ¬¡ç»ˆæ­¢
trm_evals700 <- trm('evals', n_evals = 700)

# -------æ— åµŒå¥—é‡é‡‡æ ·
# ä½¿ç”¨`tune()`è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <- tune(
 tuner = tnr_random,
 task = tsk_moons_train,
 learner = lrn_xgboost,
 resampling = rsmp_holdout,
 measures = msr_ce,
 terminator = trm_evals700
)
# è®°å½•æœ€ä¼˜å‚æ•°åœ¨è°ƒä¼˜é›†ä¸Šçš„æ€§èƒ½
insample <- instance$result_y

# -------åµŒå¥—é‡é‡‡æ ·
# ä½¿ç”¨`auto_tuner()`åˆ›å»ºä¸€ä¸ªè°ƒä¼˜å­¦ä¹ å™¨`AutoTuner`
at <- auto_tuner(
 tuner = tnr_random,
 learner = lrn_xgboost,
 # è¿™é‡Œçš„ç•™å‡ºæ³•ç”¨äºå†…éƒ¨é‡é‡‡æ ·
 resampling = rsmp_holdout,
 measure = msr_ce,
 terminator = trm_evals700
)
# åˆ›å»ºä¸€ä¸ª5æŠ˜CVï¼Œç”¨äºåç»­çš„å¤–éƒ¨é‡é‡‡æ ·
rsmp_cv5 <- rsmp('cv', folds = 5)
# å°†`Task`ï¼Œ`AutoTuner`å’Œå¤–éƒ¨é‡é‡‡æ ·å™¨`Resampling`ä¼ é€’ç»™`resample()`
# `ResampleResult$aggregate()`ç»™å‡ºæ•´åˆç»“æœ
rr <- resample(tsk_moons_train, at, rsmp_cv5)
outsample <- rr$aggregate()

# ------ç”¨æ— åµŒå¥—é‡é‡‡æ ·çš„è¶…å‚å»ºæ¨¡
# åˆ›å»ºxgboostçš„å­¦ä¹ å™¨
lrn_xgboost_tuned <- lrn('classif.xgboost')
# å°†æ— åµŒå¥—é‡é‡‡æ ·çš„å®ä¾‹è°ƒä¼˜å¾—åˆ°çš„æœ€ä½³è¶…å‚ä¼ é€’ç»™xgboostå­¦ä¹ å™¨
lrn_xgboost_tuned$param_set$set_values(
 # `instance`æ˜¯æ— åµŒå¥—é‡é‡‡æ ·çš„è°ƒä¼˜å®ä¾‹
 .values = instance$result_learner_param_vals
)
# è®­ç»ƒæ¨¡å‹ -> æµ‹è¯•æ¨¡å‹ -> è¯„ä¼°
generalization <- lrn_xgboost_tuned$train(
 tsk_moons_train
)$
 predict(tsk_moons_test)$
 score()

# æ±‡æ€»ä¸€ä¸‹ç»“æœ
round(
 c(
  # ç”¨æ— åµŒå¥—é‡é‡‡æ ·é€‰æ‹©çš„æœ€ä½³è¶…å‚æ„å»ºçš„æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœ
  true_generalization = as.numeric(generalization),
  # æ— åµŒå¥—é‡é‡‡æ ·é€‰æ‹©çš„æœ€ä½³è¶…å‚æ„å»ºçš„æ¨¡å‹åœ¨å†…éƒ¨è®­ç»ƒçš„è¯„ä¼°ç»“æœ
  # è¿™é‡Œçš„å†…éƒ¨æ˜¯ä»…åœ¨è®­ç»ƒé›†ä¸Šç”Ÿæˆçš„è°ƒä¼˜æ¨¡å‹å¾—åˆ°çš„ç»“æœ
  without_nested_resampling = as.numeric(insample),
  # åµŒå¥—é‡é‡‡æ ·é€‰æ‹©çš„æœ€ä½³è¶…å‚æ„å»ºçš„æ¨¡å‹åœ¨å†…éƒ¨è®­ç»ƒçš„è¯„ä¼°ç»“æœ
  with_nested_resampling = as.numeric(outsample)
 ), 
 2
)
```

```css
true_generalization 0.1 
without_nested_resampling 0.06 
with_nested_resampling 0.14
```

- **ä»ä¸Šé¢å¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿ**
  - æ— åµŒå¥—é‡é‡‡æ ·çš„å†…éƒ¨è¯„ä¼°å¾—åˆ°çš„äº¤å‰ç†µå¾ˆä½ï¼Œä¸å®é™…åœ¨æµ‹è¯•é›†çš„è¯„ä¼°ç»“æœå·®å¼‚å¾ˆå¤§
  - è¿™å¯èƒ½è¡¨æ˜å¯¹ç‰¹å®šçš„å†…éƒ¨ç•™å‡ºåˆ’åˆ†å­˜åœ¨**å…ƒè¿‡æ‹Ÿåˆï¼ˆmeta-overfittingï¼‰**
  - ç›¸æ¯”ä¹‹ä¸‹åµŒå¥—é‡é‡‡æ ·å¾—åˆ°çš„å¤–éƒ¨ä¼°è®¡æ•ˆæœæ›´ç¨³å¥

## æ›´é«˜çº§çš„æœç´¢ç©ºé—´

### æ ‡é‡å‚æ•°è°ƒä¼˜ï¼ˆScalar Parameter Tuningï¼‰

- å½“åœ¨å­¦ä¹ å™¨ä¸­ä½¿ç”¨`to_tune()`æ—¶ï¼Œä¼šéšå¼åœ°ä¸ºè°ƒä¼˜æœç´¢ç©ºé—´åˆ›å»ºä¸€ä¸ª`ParamSet`

```r
learner <- lrn('classif.svm',
  cost  = to_tune(1e-1, 1e5),
  kernel = to_tune(c('radial', 'linear')),
  shrinking = to_tune(),
  type = 'C-classification'
)

learner$param_set$search_space()
```

```css
<ParamSet(3)>
          id    class lower upper nlevels        default  value
      <char>   <char> <num> <num>   <num>         <list> <list>
1:      cost ParamDbl   0.1 1e+05     Inf <NoDefault[0]> [NULL]
2:    kernel ParamFct    NA    NA       2 <NoDefault[0]> [NULL]
3: shrinking ParamLgl    NA    NA       2           TRUE [NULL]
```

- å¯ä»¥çœ‹åˆ°
  - `kernel`æ˜¯å› å­ï¼Œåªéœ€è¦ä¼ å…¥æƒ³è¦è°ƒæ•´çš„æ°´å¹³ç›¸å¯¹åº”çš„å‘é‡
  - `shrinking`è¶…å‚æ•°æ˜¯ä¸€ä¸ªé€»è¾‘å€¼ï¼Œå®ƒåªæœ‰ä¸¤ç§å¯èƒ½çš„å€¼ï¼Œ  
   æ‰€ä»¥ä¸éœ€è¦å‘`to_tune()`ä¼ é€’ä»»ä½•å†…å®¹ï¼Œ  
   å®ƒä¼šè‡ªåŠ¨ä»`learner$param_set`ä¸­è¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ªé€»è¾‘å€¼ï¼Œ  
   å¹¶å°†è¿™ä¸ªç»†èŠ‚ä¼ é€’ç»™`learner$param_set$search_space()`
  - å¯¹äºå› å­å‚æ•°ï¼Œå¦‚æœæƒ³åœ¨æ‰€æœ‰å¯èƒ½çš„å€¼ä¸Šè¿›è¡Œè°ƒæ•´ï¼Œ  
   ä¹Ÿå¯ä»¥åœ¨ä¸ä¼ é€’ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ä½¿ç”¨`to_tune()`
  - å¦‚æœæƒ³åœ¨ä¸€å°éƒ¨åˆ†å¯èƒ½çš„å€¼ä¸Šç¦»æ•£åŒ–æ•°å€¼å‚æ•°ï¼Œ  
   å¯ä»¥ä½¿ç”¨to_tune()å°†æ•°å€¼å‚æ•°è§†ä¸ºå› å­
    - ä¾‹å¦‚ï¼Œæƒ³æ‰¾åˆ°éšæœºæ£®æ—ä¸­æœ€ä¼˜çš„æ ‘çš„æ•°é‡ï¼Œ  
    æˆ‘ä»¬å¯èƒ½åªè€ƒè™‘ä¸‰ç§æƒ…å†µï¼š100æ£µã€200æ£µæˆ–400æ£µæ ‘

```r
lrn('classif.ranger', num.trees = to_tune(c(100, 200, 400)))
```

- å°†**æ•´æ•°å˜åšå› å­**ä¼šå¯¼è‡´è¶…å‚æ•°**æ— åº**
  - å› æ­¤ï¼Œåˆ©ç”¨é¡ºåºä¿¡æ¯çš„ç®—æ³•åœ¨å¿½ç•¥é¡ºåºæ—¶æ€§èƒ½ä¼šå˜å·®
  - å¯¹äºè¿™äº›ç®—æ³•ï¼Œ  
   ä½¿ç”¨è‡ªå®šä¹‰å˜æ¢å®šä¹‰ä¸€ä¸ªÂ `ParamDbl`Â æˆ–Â `ParamInt`æ›´æœ‰æ„ä¹‰
   ï¼ˆåç»­å†…å®¹ï¼‰

### å®šä¹‰æœç´¢ç©ºé—´

- ä¸‹åˆ—`p_*()`åˆ›å»º`Param`å¯¹è±¡

| ConstructorÂ æ„é€ å‡½æ•° | DescriptionÂ æè¿°                       | Underlying ClassÂ åŸºç¡€ç±» |
| ---------------- | ------------------------------------ | -------------------- |
| `p_dbl()`        | Real valued parameter (â€œdoubleâ€)     | `ParamDbl`           |
| `p_int()`        | Integer parameter                    | `ParamInt`           |
| `p_fct()`        | Discrete valued parameter (â€œfactorâ€) | `ParamFct`           |
| `p_lgl()`        | Logical / Boolean parameter          | `ParamLgl`           |
| `p_uty()`        | Untyped parameter                    | `ParamUty`           |

- ä½¿ç”¨`ps()`æ‰‹åŠ¨åˆ›é€ æœç´¢ç©ºé—´ï¼Œå¯¹è±¡ä¸º`ParamSet`

```r
search_space <- ps(
 cost  = p_dbl(lower = 1e-1, upper = 1e5),
 kernel = p_fct(c('radial', 'linear')),
 shrinking = p_lgl()
)
```

- å°†æœç´¢ç©ºé—´ä¼ é€’ç»™`ti()`
  - å®˜æ–¹æ–‡æ¡£å†™é”™äº†ï¼Œä»–ç»™çš„ä¾‹å­æ˜¯`ti()`
   `auto_tuner()`åº”è¯¥ä¼ é€’äº†`Tuner`ä½†æ˜¯ä¾‹å­é‡Œæ²¡æœ‰`Tuner`

```r
tsk_sonar <- tsk('sonar')
rsmp_cv3 <- rsmp('cv', folds = 3)
msr_ce <- msr('classif.ce')

ists <- ti(
    tsk_sonar, 
    lrn('classif.svm', type = 'C-classification'), 
    rsmp_cv3,
    msr_ce, 
    trm('none'), 
    # å°†æœç´¢ç©ºé—´ä¼ é€’åˆ°å‚æ•°`search_space`
    search_space = search_space
)

ists
```

```css
[36m--[39m [1m[34m<TuningInstanceBatchSingleCrit>[39m[22m [36m---------------------------------------------[39m
* State: Not optimized
* Objective: [34m<ObjectiveTuningBatch>[39m
* Search Space:
          id    class lower upper nlevels
      <char>   <char> <num> <num>   <num>
1:      cost ParamDbl   0.1 1e+05     Inf
2:    kernel ParamFct    NA    NA       2
3: shrinking ParamLgl    NA    NA       2
* Terminator: [34m<TerminatorNone>[39m
```

- **æœ‰ç•Œæœç´¢ç©ºé—´**
  - æ‰‹åŠ¨åˆ›å»ºæœç´¢ç©ºé—´æ—¶ï¼Œå¯¹æœç´¢ç©ºé—´ä¸­çš„æ‰€æœ‰è¶…å‚æ˜¯å¦æœ‰è¾¹ç•Œä¿æŒè°¨æ…
  - å¦‚æœæ²¡æœ‰ç»™`p_dbl()` æˆ– `p_int()` ä¼ é€’ä¸‹é™å’Œä¸Šé™ï¼Œ  
   å‡ ä¹æ‰€æœ‰è°ƒè°å™¨åœ¨è°ƒä¼˜è¿‡ç¨‹ä¸­éƒ½ä¼šæŠ›å‡ºé”™è¯¯
  - å¦‚æœä¸ç¡®å®šï¼Œæ‚¨å¯ä»¥åœ¨æ„é€ çš„ `ParamSet` ï¼ˆ`ps()`åˆ›å»ºçš„å¯¹è±¡ï¼‰ä¸Š  
   ä½¿ç”¨`ParamSet$is_bounded`æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†ä¸‹é™å’Œä¸Šé™

```r
ps(cost = p_dbl(lower = 0.1, upper = 1))$is_bounded
ps(cost = p_dbl(lower = 0.1, upper = Inf))$is_bounded
search_space
```

```css
cost: TRUE

cost: FALSE

cost TRUE 
kernel TRUE 
shrinking TRUE
```

### å‘é‡ä¸Šçš„å˜æ¢ä¸è°ƒä¼˜

#### ä½¿ç”¨`p_*()`çš„è‡ªå®šä¹‰å˜æ¢

- ä¹‹å‰è®¨è®ºè¿‡å¯¹æ•°å˜æ¢çš„ç”¨æ³•
- ç®€å•å›é¡¾ä¸€ä¸‹ä¹‹å‰ç”¨ç»™`lrn()`ä¼ é€’ç”¨`to_tune()`åˆ›å»ºçš„å­¦ä¹ å™¨çš„æœç´¢ç©ºé—´

```r
svm <- lrn(
 'classif.svm',
 cost = to_tune(1e-5,1e5, logscale = TRUE)
)
svm$param_set
```

```css
<ParamSet(1)>
       id    class     lower    upper nlevels        default  value
   <char>   <char>     <num>    <num>   <num>         <list> <list>
1:   cost ParamDbl -11.51293 11.51293     Inf <NoDefault[0]> [NULL]
Trafo is set.
```

- å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„`lower`å’Œ`upper`å¹¶é`1e-5`å’Œ`1e5`è€Œæ˜¯`-11.5`å’Œ`11.5` ã€€
  æ‰€ä»¥è¾“å…¥åˆ°å­¦ä¹ å™¨çš„èŒƒå›´å…¶å®æ˜¯`log(1e-5)`å’Œ`log(1e5)`

- æ‰‹åŠ¨åˆ›å»ºå¯¹æ•°å˜æ¢
  - `trafo`ä¸­ä¼ é€’çš„æ˜¯å¯¹é‡‡æ ·ç»“æœçš„æ“ä½œå‡½æ•°
  - è¿™é‡Œçš„è¾“å‡ºç»“æœå’Œ`svm$param_set`ä¸€è‡´

```r
ss <- ps(
 cost = p_dbl(
  # æ³¨æ„ï¼šè¿™é‡Œæ˜¯log(1e-5)å’Œlog(1e5)
  log(1e-5), log(1e5),
  # å¯¹ç»“æœåšæŒ‡æ•°å˜æ¢
  trafo = function(x) ruturn(exp(x))
 )
) 
ss
```

```css
<ParamSet(1)>
       id    class     lower    upper nlevels        default  value
   <char>   <char>     <num>    <num>   <num>         <list> <list>
1:   cost ParamDbl -11.51293 11.51293     Inf <NoDefault[0]> [NULL]
Trafo is set.
```

- è™½ç„¶`ParamSet`ç»™å‡ºäº†`Trafo is set.`çš„ä¿¡æ¯ï¼Œ  
  ä¹Ÿå¯ä»¥é€šè¿‡`ParamSet$trafo()`æ‰‹åŠ¨è¾“å…¥ä¿¡æ¯æ¥æŸ¥çœ‹æ˜¯å¦æœ‰è½¬æ¢
- çœ‹çœ‹`ParamSet$trafo()`çš„è½¬æ¢
  - ç»“æœä¹Ÿæ˜¯å®Œå…¨ä¸€è‡´

```r
svm$param_set$search_space()$trafo(list(cost = 1))
ss$trafo(list(cost = 1))
```

```R
$cost = 2.71828182845905
$cost = 2.71828182845905
```

- ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œ`to_tune(1e-5,1e5, logscale = TRUE)`çš„åŸç†æ˜¯ï¼š
  - å°†ä¸‹é™ä¸ä¸Šé™åšå¯¹æ•°å˜æ¢
  - åœ¨å¯¹æ•°å˜æ¢åçš„ä¸Šä¸‹é™å½¢æˆçš„åŒºé—´åšå‡åŒ€å–æ ·
  - å°†å‡åŒ€å–æ ·çš„ç»“æœè¿›è¡ŒæŒ‡æ•°å˜æ¢ï¼Œä¼ é€’ç»™`Learner`

- `to_tune()`é™¤äº†æ¥å—`to_tune(1e-5, 1e5, logscale = TRUE)`è¿™æ ·çš„æ ¼å¼å¤–ï¼Œ  
  ä¹Ÿæ¥å—`Param`å¯¹è±¡
- åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œå–æ ·åœ¨åŒºé—´$[0,3]$å‡åŒ€å–æ ·ï¼Œå°†å–æ ·çš„ç»“æœ$+2$ä¼ é€’åˆ°`Learner`ä¸­

```r
lrn(
 "classif.svm",
 cost = to_tune(
  p_dbl(
   0, 3, 
   trafo = function(x) return(x + 2)
  )
 )
)
```

- å¯¹äºå¤šä¸ªå¤æ‚å˜æ¢ï¼Œéœ€è¦å°†å‡½æ•°ä¼ é€’åˆ°`.extra_trafo`ä¸­
  - `.extra_trafo`æ¥å—ä¸€ä¸ªå¸¦æœ‰å‚æ•°`x`å’Œ`param_set`çš„å‡½æ•°
  - åœ¨è°ƒä¼˜è¿‡ç¨‹ä¸­ï¼Œ  
   `x`æ˜¯ä¸€ä¸ªåŒ…å«æ­£åœ¨æµ‹è¯•çš„é…ç½®çš„åˆ—è¡¨ï¼Œ  
   `param_set`æ˜¯æ•´ä¸ªå‚æ•°é›†
    - æµ‹è¯•äº†ä¸€ä¸‹ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œçœç•¥`param_set`ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ  
   ä½†æ˜¯ä¸ç¡®å®šå…¶ä»–ç”¨æ³•ä¸­èƒ½ä¸èƒ½çœï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯åˆ«çœäº†

```r
search_space <- ps(
 # `cost`åœ¨åŒºé—´[-1,1]å‡åŒ€å–æ ·ï¼Œå–æ ·ç»“æœåšæŒ‡æ•°è½¬æ¢
 cost = p_dbl(-1, 1, trafo = function(x) return(exp(x))),
 # `kernel`æœ‰'polynomial'å’Œ'radial'ä¸¤ç§é€‰æ‹©
 kernel = p_fct(c('polynomial', 'radial')),
 # ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼šå½“kernel == 'polynomial'æ—¶ï¼Œ
 # `cost`æŠ½æ ·åæŒ‡æ•°è½¬æ¢çš„æœ€ç»ˆç»“æœ+2ï¼›å¦åˆ™å°±ä¿æŒæœ€ç»ˆç»“æœ
 .extra_trafo = function(x, param_set) {
     if (x$kernel == 'polynomial') {
       x$cost = x$cost + 2
  }
  return(x)
 }
)

search_space$trafo(list(cost = 1, kernel = 'polynomial'))
search_space$trafo(list(cost = 1, kernel = 'radial'))
```

```css
$cost
4.71828182845904
$kernel
'polynomial'


$cost
2.71828182845905
$kernel
'radial'
```
