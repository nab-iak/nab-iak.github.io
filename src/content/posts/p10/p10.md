---
title: 'ä½¿ç”¨mlr3è¿›è¡Œæœºå™¨å­¦ä¹ '
published: 2025-06-14
image: './p10_cover.jpg'
description: 'mlr3çš„ç®€æ˜æ•™ç¨‹'
category: 'Machine Learning'
tags: [mlr3,R,ZH-CN]
draft: false 
lang: 'en'
---
> - Cover Pic by [@æŠ è‚‰è‚šè„](https://www.pixiv.net/artworks/126561187)
> [Applied Machine Learning Using mlr3 in R](https://mlr3book.mlr-org.com/)

## æœºå™¨å­¦ä¹ æµç¨‹

![image_1](./image_1.png)

## é¢„è®¾å­—å…¸

### é¢„è®¾çš„Taskåˆ—è¡¨

```r
mlr_tasks
```

```css
<DictionaryTask> with 11 stored values
Keys: breast_cancer, california_housing, german_credit, iris, mtcars,
  penguins, pima, sonar, spam, wine, zoo
```

### é¢„è®¾å­¦ä¹ å™¨åˆ—è¡¨

```r
mlr_learners
```

```css
<DictionaryLearner> with 27 stored values
Keys: classif.cv_glmnet, classif.debug, classif.featureless,
  classif.glmnet, classif.kknn, classif.lda, classif.log_reg,
  classif.multinom, classif.naive_bayes, classif.nnet, classif.qda,
  classif.ranger, classif.rpart, classif.svm, classif.xgboost,
  regr.cv_glmnet, regr.debug, regr.featureless, regr.glmnet, regr.kknn,
  regr.km, regr.lm, regr.nnet, regr.ranger, regr.rpart, regr.svm,
  regr.xgboost
```

### é¢„è®¾çš„è¯„ä¼°å™¨åˆ—è¡¨

```r
# 1
mlr_measures
# 2
msr()
```

```css
<DictionaryMeasure> with 62 stored values
Keys: aic, bic, classif.acc, classif.auc, classif.bacc, classif.bbrier,
  classif.ce, classif.costs, classif.dor, classif.fbeta, classif.fdr,
  classif.fn, classif.fnr, classif.fomr, classif.fp, classif.fpr,
  classif.logloss, classif.mauc_au1p, classif.mauc_au1u,
  classif.mauc_aunp, classif.mauc_aunu, classif.mauc_mu,
  classif.mbrier, classif.mcc, classif.npv, classif.ppv, classif.prauc,
  classif.precision, classif.recall, classif.sensitivity,
  classif.specificity, classif.tn, classif.tnr, classif.tp,
  classif.tpr, debug_classif, internal_valid_score, oob_error,
  regr.bias, regr.ktau, regr.mae, regr.mape, regr.maxae, regr.medae,
  regr.medse, regr.mse, regr.msle, regr.pbias, regr.pinball, regr.rmse,
  regr.rmsle, regr.rsq, regr.sae, regr.smape, regr.srho, regr.sse,
  selected_features, sim.jaccard, sim.phi, time_both, time_predict,
  time_train
```

```r
msr() %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 62 x 7</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>task_type</th><th scope=col>packages</th><th scope=col>predict_type</th><th scope=col>properties</th><th scope=col>task_properties</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>aic                </td><td>Akaike Information Criterion              </td><td>NA     </td><td>mlr3</td><td>NA      </td><td>na_score              , requires_learner      , requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>bic                </td><td>Bayesian Information Criterion            </td><td>NA     </td><td>mlr3</td><td>NA      </td><td>na_score              , requires_learner      , requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>classif.acc        </td><td>Classification Accuracy                   </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.auc        </td><td>Area Under the ROC Curve                  </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.bacc       </td><td>Balanced Accuracy                         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.bbrier     </td><td>Binary Brier Score                        </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td>weights</td><td>twoclass</td></tr>
 <tr><td>classif.ce         </td><td>Classification Error                      </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.costs      </td><td>Cost-sensitive Classification             </td><td>classif</td><td>mlr3</td><td>response</td><td>weights</td><td></td></tr>
 <tr><td>classif.dor        </td><td>Diagnostic Odds Ratio                     </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fbeta      </td><td>F-beta score                              </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fdr        </td><td>False Discovery Rate                      </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fn         </td><td>False Negatives                           </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fnr        </td><td>False Negative Rate                       </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fomr       </td><td>False Omission Rate                       </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fp         </td><td>False Positives                           </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.fpr        </td><td>False Positive Rate                       </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.logloss    </td><td>Log Loss                                  </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td>weights</td><td></td></tr>
 <tr><td>classif.mauc_au1p  </td><td>Weighted average 1 vs. 1 multiclass AUC   </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_au1u  </td><td>Average 1 vs. 1 multiclass AUC            </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunp  </td><td>Weighted average 1 vs. rest multiclass AUC</td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunu  </td><td>Average 1 vs. rest multiclass AUC         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mauc_mu    </td><td>Multiclass mu AUC                         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mbrier     </td><td>Multiclass Brier Score                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td></td></tr>
 <tr><td>classif.mcc        </td><td>Matthews Correlation Coefficient          </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td></td></tr>
 <tr><td>classif.npv        </td><td>Negative Predictive Value                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.ppv        </td><td>Positive Predictive Value                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.prauc      </td><td>Precision-Recall Curve                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob    </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.precision  </td><td>Precision                                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.recall     </td><td>Recall                                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>classif.sensitivity</td><td>Sensitivity                               </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response</td><td></td><td>twoclass</td></tr>
 <tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
 <tr><td>classif.tnr         </td><td>True Negative Rate                                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.tp          </td><td>True Positives                                     </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td>twoclass</td></tr>
 <tr><td>classif.tpr         </td><td>True Positive Rate                                 </td><td>classif</td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td>twoclass</td></tr>
 <tr><td>debug_classif       </td><td>Debug Classification Measure                       </td><td>NA     </td><td>mlr3</td><td>response </td><td>na_score</td><td></td></tr>
 <tr><td>internal_valid_score</td><td>Internal Validation Score                          </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>na_score              , requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>oob_error           </td><td>Out-of-bag Error                                   </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>na_score              , requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>regr.bias           </td><td>Bias                                               </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.ktau           </td><td>Kendall's tau                                      </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.mae            </td><td>Mean Absolute Error                                </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.mape           </td><td>Mean Absolute Percent Error                        </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.maxae          </td><td>Max Absolute Error                                 </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.medae          </td><td>Median Absolute Error                              </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.medse          </td><td>Median Squared Error                               </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.mse            </td><td>Mean Squared Error                                 </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.msle           </td><td>Mean Squared Log Error                             </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.pbias          </td><td>Percent Bias                                       </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.pinball        </td><td>NA                                                 </td><td>regr   </td><td>mlr3</td><td>quantiles</td><td></td><td></td></tr>
 <tr><td>regr.rmse           </td><td>Root Mean Squared Error                            </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.rmsle          </td><td>Root Mean Squared Log Error                        </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.rsq            </td><td>NA                                                 </td><td>regr   </td><td>mlr3</td><td>response </td><td>weights</td><td></td></tr>
 <tr><td>regr.sae            </td><td>Sum of Absolute Errors                             </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.smape          </td><td>Symmetric Mean Absolute Percent Error              </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.srho           </td><td>Spearman's rho                                     </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>regr.sse            </td><td>Sum of Squared Errors                              </td><td>regr   </td><td>mlr3        , mlr3measures</td><td>response </td><td></td><td></td></tr>
 <tr><td>selected_features   </td><td>Absolute or Relative Frequency of Selected Features</td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_task         , requires_learner      , requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>sim.jaccard         </td><td>Jaccard Similarity Index                           </td><td>NA     </td><td>mlr3        , mlr3measures</td><td>NA       </td><td>requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>sim.phi             </td><td>Phi Coefficient Similarity                         </td><td>NA     </td><td>mlr3        , mlr3measures</td><td>NA       </td><td>requires_model        , requires_no_prediction</td><td></td></tr>
 <tr><td>time_both           </td><td>Elapsed Time                                       </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>time_predict        </td><td>Elapsed Time                                       </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_learner      , requires_no_prediction</td><td></td></tr>
 <tr><td>time_train          </td><td>Elapsed Time                                       </td><td>NA     </td><td>mlr3</td><td>NA       </td><td>requires_learner      , requires_no_prediction</td><td></td></tr>
</tbody>
</table>

### è°ƒå–è¯¦æƒ…

```r
mlr_tasks$get('california_housing')
mlr_learners$get('classif.xgboost')
mlr_measures$get('regr.mse')
```

```css
[36m--[39m [1m[34m<TaskRegr>[39m (20640x10): California House Value[22m [36m-------------------------------[39m
* Target: median_house_value
* Properties: -
* Features (9):
  * dbl (8): households, housing_median_age, latitude, longitude,
  median_income, population, total_bedrooms, total_rooms
  * fct (1): ocean_proximity



[36m--[39m [1m[34m<LearnerClassifXgboost>[39m (classif.xgboost): Extreme Gradient Boosting[22m [36m--------[39m
* Model: -
* Parameters: nrounds=1000, nthread=1, verbose=0
* Validate: [34m<NULL>[39m
* Packages: [34mmlr3[39m, [34mmlr3learners[39m, and [34mxgboost[39m
* Predict Types: [response] and prob
* Feature Types: logical, integer, and numeric
* Encapsulation: none (fallback: -)
* Properties: hotstart_forward, importance, internal_tuning, missings,
multiclass, offset, twoclass, validation, and weights
* Other settings: use_weights = 'use'



[36m--[39m [1m[34m<MeasureRegrSimple>[39m (regr.mse): Mean Squared Error[22m [36m--------------------------[39m
* Packages: [34mmlr3[39m and [34mmlr3measures[39m
* Range: [0, Inf]
* Minimize: [34mTRUE[39m
* Average: macro
* Parameters: list()
* Properties: weights
* Predict type: response
* Predict sets: test
* Aggregator: mean()
```

## å›å½’çš„æµç¨‹

### ä»»åŠ¡åŒ–

#### åˆ›å»ºä»»åŠ¡

- `as_task_*()`
 	- targetï¼šoutcome
 	- idï¼šä»»åŠ¡åç§°
- è¿™é‡Œå°±ç”¨`as_task_regr()`ä»£æ›¿ä¸‹

```r
dt.tskR <- as_task_regr(dt, target = 'outcome')
```

- å¯¹outcomeä¸ç‰¹å¾å€¼çš„å›¾å½¢åŒ–æ¦‚æ‹¬
 	- ç‰¹å¾å€¼è¿‡å¤šä¸å»ºè®®ï¼Œåˆæ…¢åˆçœ‹ä¸æ¸…

```r
library(mlr3viz)
autoplot(dt.tskR, type = 'pairs')
```

#### æ•°æ®æ£€ç´¢åŠæ•°æ®å¤„ç†

- å¯ä»¥é€šè¿‡`$`æ¢ç´¢ä»»åŠ¡é‡Œçš„å„ç§ä¿¡æ¯
- å¯¹äºå¯¼å…¥çš„åŸå§‹æ•°æ®è€Œè¨€
 	- `dt.tskR$nrow`
 	- `dt.tskR$ncol`
 	- `dt.tskR$feature_names`
 	- `dt.tskR$target_names`
 	- `dt.tskR$row_ids`
 	- `dt.tskR$col_info`
 	- ......
- æœ‰äº›æ˜¯å‡½æ•°
 	- `dt.tskR$clone()`
 	- `dt.tskR$data()`
 	- `dt.tskR$cbind()`
 	- `dt.tskR$rbind()`
 	- `dt.tskR$filter()`
 	- `dt.tskR$select()`
 	- `dt.tskR$head()`
 	- ......

- è¿™ä¸¤ä¸ªè™½ç„¶ç»“æœä¸€æ ·ï¼Œ  
  ä½†æ˜¯ç¬¬ä¸€ä¸ªæ˜¯å…ˆè°ƒå–æ•´ä¸ªdataå†ç­›é€‰ï¼Œ  
  ç¬¬äºŒä¸ªåˆ™æ˜¯ç›´æ¥å……taské‡Œè°ƒå–ç¬¬äºŒè¡Œ

```r
housing.tskR$data()[2]
housing.tskR$data(rows = housing.tskR$row_ids[2])
```

- å‡½æ•°çš„ç”¨æ³•å’Œå¹³æ—¶çš„ç±»ä¼¼ï¼Œåªæ˜¯é›†æˆåˆ°äº†Taské‡Œé¢è€Œå·²

#### æ•°æ®å¤„ç†çš„å®ä¾‹

- æ³¨æ„ï¼Œ`dt.tskR$func()`æ˜¯å¯¹`dt.tsk`çš„å°±åœ°ä¿®æ”¹ï¼Œ  
  **ä¸éœ€è¦ä¿å­˜åˆ°æ–°çš„å˜é‡é‡Œ**

```r
# å…‹éš†ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„ä»»åŠ¡
dt.tskR2 <- dt.tskR$clone()
# é€‰æ‹©ç¬¬1â€“2è¡Œ
dt.tskR2$filter(1:2)
```

```r
# æ·»åŠ åˆ—
dt.tskR$cbind( 
  data.frame(x = c(150, 160))
)
# æ·»åŠ è¡Œ
dt.tskR_small$rbind( 
  data.frame(x1 = 23, x2 = 5, x3 = 170)
)
dt.tskR_small$data()
```

### å­¦ä¹ å™¨
>
> [mlr-org: Learners](https://mlr-org.com/learners.html)

- å­¦ä¹ å™¨çš„ç±»å‹æ˜¯`Learner`

#### åŒ…çš„åˆ†ç±»

- **mlr3**ï¼šä»…åŒ…å«ä¸€äº›åŸºç¡€çš„å­¦ä¹ å™¨
- **mlr3learners**ï¼šæ¯”`mlr3`åŒ…æ›´ä¸°å¯Œä¸”å¸¸ç”¨çš„å­¦ä¹ å™¨
- **mlr3proba**ï¼šç”Ÿå­˜å­¦ä¹ å™¨
- **mlr3cluster**ï¼šèšç±»å­¦ä¹ å™¨
- **mlr3extralearners**ï¼šä¸€äº›ä¸ç¨³å®šæˆ–è€…CRANä¸Šä¸å¯ç”¨çš„å­¦ä¹ å™¨
- **mlr3torch**ï¼šç¥ç»ç½‘ç»œç›¸å…³å­¦ä¹ å™¨

#### æŸ¥çœ‹å­¦ä¹ å™¨

- `lrn()`å¯ä»¥è°ƒå–å¯¹åº”å­¦ä¹ å™¨çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åŒ…å«ä¸‹åˆ—æ•°æ®
 	- `$feature_types`ï¼šå­¦ä¹ å™¨å¯ä»¥å¤„ç†çš„ç‰¹å¾ç±»å‹
 	- `$packages`ï¼šä½¿ç”¨è¯¥å­¦ä¹ å™¨éœ€è¦å®‰è£…çš„è½¯ä»¶åŒ…
 	- `$properties`ï¼šå­¦ä¹ è€…çš„å±æ€§ï¼›ä¾‹å¦‚ï¼Œ**'missings'** å±æ€§è¡¨ç¤ºæ¨¡å‹å¯ä»¥å¤„ç†ç¼ºå¤±æ•°æ®ï¼Œè€Œ **'importance'** è¡¨ç¤ºå®ƒå¯ä»¥è®¡ç®—æ¯ä¸ªç‰¹å¾çš„ç›¸å¯¹é‡è¦æ€§
 	- `$predict_types`ï¼šæ¨¡å‹èƒ½å¤Ÿåšå‡ºçš„é¢„æµ‹ç±»å‹
 	- `$param_set`ï¼šå¯ç”¨è¶…å‚æ•°é›†

```r
lrn('regr.rpart')
```

```css
[36m--[39m [1m[34m<LearnerRegrRpart>[39m (regr.rpart): Regression Tree[22m [36m----------------------------[39m
* Model: -
* Parameters: xval=0
* Packages: [34mmlr3[39m and [34mrpart[39m
* Predict Types: [response]
* Feature Types: logical, integer, numeric, factor, and ordered
* Encapsulation: none (fallback: -)
* Properties: importance, missings, selected_features, and weights
* Other settings: use_weights = 'use'
```

#### ä¼ é€’å¤šä¸ªå­¦ä¹ å™¨

- `lrn()`çš„å¤æ•°å½¢`lrns()`å¯ä»¥è°ƒå–å¤šä¸ªå­¦ä¹ å™¨
- å…¶ä»–çš„ç±»ä¼¼çš„è¿˜æœ‰`tsks()`å’Œåç»­å‡ºç°çš„`msrs()`

```r
dt.lrnR.rpart_lm <- lrns(c('regr.rpart', 'regr.lm'))
dt.lrnR.rpart_lm
```

### åˆ†å‰²è®­ç»ƒé›†å’Œæµ‹è¯•é›†

- `partition()`ä¸­`ratio`ä¸ºè®­ç»ƒé›†å æ•´ä¸ªæ•°æ®é›†æ¯”ä¾‹

```r
dt.tskR.splits <- partition(dt.tsk, ratio = 0.7)
dt.tskR.splits
```

### è®­ç»ƒæ¨¡å‹

- `Learner`ä½œç”¨äº`Task`

```r
dt.lrnR.rpart <- lrn('regr.rpart')
dt.lrnR.rpart$train(dt.tsk)
```

- æ‹Ÿåˆçš„æ¨¡å‹å‚¨å­˜åœ¨`Learner$model`ä¸­

```r
dt.lrnR.rpart$model
```

- é€šè¿‡æŒ‡å®šå‚æ•°`row_ids`åˆ†é…è®­ç»ƒé›†

```r
dt.lrnR.rpart$train(dt.tskR, row_ids = dt.tskR.splits$train)
```

- ä¹Ÿå¯ä»¥æŒ‡å®šé¢„æµ‹ç±»å‹
 	- `regr.rpart`ä¸èƒ½é€‰æ‹©responseä»¥å¤–çš„ç±»å‹
 	- è¿™é‡Œé€‰æ‹©ç”¨ `regr.lm`æ¥é¢„æµ‹æ ‡å‡†è¯¯å·®

```r
dt.lrnR.lm <- lrn('regr.lm', predict_type = 'se')
```

- å¯ä»¥éšä¾¿çœ‹çœ‹åŒºåˆ«
 	- åœ¨æŒ‡å®šäº†**se**åoutputé‡Œ`Predict Types`çš„æ¡†æ¡†ç»™åˆ°äº†`[se]`

```r
lrn('regr.lm')
lrn('regr.lm', predict_type = 'se')
```

```css

[36m--[39m [1m[34m<LearnerRegrLM>[39m (regr.lm): Linear Model[22m [36m-------------------------------------[39m
* Model: -
* Parameters: use_pred_offset=TRUE
* Packages: [34mmlr3[39m, [34mmlr3learners[39m, and [34mstats[39m
* Predict Types: [response] and se
* Feature Types: logical, integer, numeric, character, and factor
* Encapsulation: none (fallback: -)
* Properties: offset and weights
* Other settings: use_weights = 'use'


[36m--[39m [1m[34m<LearnerRegrLM>[39m (regr.lm): Linear Model[22m [36m-------------------------------------[39m
* Model: -
* Parameters: use_pred_offset=TRUE
* Packages: [34mmlr3[39m, [34mmlr3learners[39m, and [34mstats[39m
* Predict Types: response and [se]
* Feature Types: logical, integer, numeric, character, and factor
* Encapsulation: none (fallback: -)
* Properties: offset and weights
* Other settings: use_weights = 'use'
```

### é¢„æµ‹æ•°æ®

- ç”±äº`Learner$predict()`ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦å¦å¤–ä¿å­˜

```r
dt.lrnR.rpart.pred <- dt.lrnR.rpart$predict(dt.tskR, row_ids = dt.tskR.splits$test)
```

- å¯ä»¥ç®€å•çœ‹çœ‹è¿™äº›å¯¹è±¡çš„ç±»åˆ«

```r
dt.tskR %>% class()
dt.lrnR.rpart %>% class()
dt.lrnR.rpart.pred %>% class()
```

```css
'TaskRegr''TaskSupervised''Task''R6'
'LearnerRegrRpart''LearnerRegr''Learner''R6'
'PredictionRegr''Prediction''R6'
```

- `dt.lrnR.rpart.pred`ï¼šè¿”å›ä¸€ä¸ªé¢„æµ‹ç»“æœçš„æ–‡æœ¬è¾“å‡º
- `dt.lrnR.rpart.pred$truth`ï¼šè¿”å›çœŸå®å€¼å‘é‡
- `dt.lrnR.rpart.pred$responese`ï¼šè¿”å›é¢„æµ‹å“åº”å€¼å‘é‡

### å¯¹çœŸå®å€¼-é¢„æµ‹å€¼è¿›è¡Œç»˜å›¾

```r
autoplot(dt.lrnR.rpart.pred)
```

### è¶…å‚æ•°

- è®­ç»ƒæ¨¡å‹å‰éœ€è¦**é¢„å…ˆæŒ‡å®šçš„å‚æ•°**

#### è·å–è¶…å‚æ•°

```r
# 1
dt.lrnR.rpart$param_set
# 2
lrn('regr.rpart')$param_set
```

```css
<ParamSet(10)>
                id    class lower upper nlevels        default  value
            <char>   <char> <num> <num>   <num>         <list> <list>
 1:             cp ParamDbl     0     1     Inf           0.01 [NULL]
 2:     keep_model ParamLgl    NA    NA       2          FALSE [NULL]
 3:     maxcompete ParamInt     0   Inf     Inf              4 [NULL]
 4:       maxdepth ParamInt     1    30      30             30 [NULL]
 5:   maxsurrogate ParamInt     0   Inf     Inf              5 [NULL]
 6:      minbucket ParamInt     1   Inf     Inf <NoDefault[0]> [NULL]
 7:       minsplit ParamInt     1   Inf     Inf             20 [NULL]
 8: surrogatestyle ParamInt     0     1       2              0 [NULL]
 9:   usesurrogate ParamInt     0     2       3              2 [NULL]
10:           xval ParamInt     0   Inf     Inf             10      0
```

- å…¶ä¸­
 	- **id**ï¼šè¶…å‚å
 	- **class**ï¼šç±»åˆ«
 	- **lower**ï¼šæœ€å°å¯è®¾å®šå€¼
 	- **upper**ï¼šæœ€å¤§å¯è®¾å®šå€¼
 	- **nlevels**ï¼šå¯è®¾å®šå€¼çš„ç§ç±»æ•°ç›®
 	- **default**ï¼šåŸå‡½æ•°çš„é»˜è®¤å–å€¼
 	- **value**ï¼šå½“å‰å–å€¼ï¼Œ`[NULL]`æ—¶ä½¿ç”¨`default`çš„å€¼

- å½“`cp`è®¾ç½®ä¸º`0.5`åï¼Œå¯ä»¥çœ‹åˆ°outputä¸­`cp`çš„valueå˜æˆäº†`0.5`

```r
lrn('regr.rpart', cp = 0.5)$param_set
```

```css
<ParamSet(10)>
                id    class lower upper nlevels        default  value
            <char>   <char> <num> <num>   <num>         <list> <list>
 1:             cp ParamDbl     0     1     Inf           0.01    0.5
 2:     keep_model ParamLgl    NA    NA       2          FALSE [NULL]
 3:     maxcompete ParamInt     0   Inf     Inf              4 [NULL]
 4:       maxdepth ParamInt     1    30      30             30 [NULL]
 5:   maxsurrogate ParamInt     0   Inf     Inf              5 [NULL]
 6:      minbucket ParamInt     1   Inf     Inf <NoDefault[0]> [NULL]
 7:       minsplit ParamInt     1   Inf     Inf             20 [NULL]
 8: surrogatestyle ParamInt     0     1       2              0 [NULL]
 9:   usesurrogate ParamInt     0     2       3              2 [NULL]
10:           xval ParamInt     0   Inf     Inf             10      0
```

- æŸ¥çœ‹å½“å‰æ¨¡å‹çš„è¶…å‚è®¾å®šæƒ…å†µ

```r
dt.lrnR.rpart$param_set$values
```

- å¯¹æŸ¥çœ‹å½“å‰æ¨¡å‹çš„è¶…å‚è®¾å®šå°±åœ°ä¿®æ”¹

```r
dt.lrnR.rpart$param_set$set_values(cp = 0.02ï¼Œminsplit = 10)
```

#### è¶…å‚ä¾èµ–å…³ç³»

- æ”¯æŒå‘é‡æœºä¸­çš„è¶…å‚æ›´åŠ å¤æ‚

```r
lrn('regr.svm')$param_set
```

```css
<ParamSet(14)>
Key: <id>
           id    class lower upper nlevels        default parents  value
       <char>   <char> <num> <num>   <num>         <list>  <list> <list>
 1: cachesize ParamDbl  -Inf   Inf     Inf             40  [NULL] [NULL]
 2:     coef0 ParamDbl  -Inf   Inf     Inf              0  kernel [NULL]
 3:      cost ParamDbl     0   Inf     Inf              1    type [NULL]
 4:     cross ParamInt     0   Inf     Inf              0  [NULL] [NULL]
 5:    degree ParamInt     1   Inf     Inf              3  kernel [NULL]
 6:   epsilon ParamDbl     0   Inf     Inf            0.1    type [NULL]
 7:    fitted ParamLgl    NA    NA       2           TRUE  [NULL] [NULL]
 8:     gamma ParamDbl     0   Inf     Inf <NoDefault[0]>  kernel [NULL]
 9:    kernel ParamFct    NA    NA       4         radial  [NULL] [NULL]
10:        nu ParamDbl  -Inf   Inf     Inf            0.5    type [NULL]
11:     scale ParamUty    NA    NA     Inf           TRUE  [NULL] [NULL]
12: shrinking ParamLgl    NA    NA       2           TRUE  [NULL] [NULL]
13: tolerance ParamDbl     0   Inf     Inf          0.001  [NULL] [NULL]
14:      type ParamFct    NA    NA       2 eps-regression  [NULL] [NULL]
```

- å¯ä»¥ä»`Learner$param_set$deps`ä¸­è·å¾—è¶…å‚ä¹‹é—´çš„ä¾èµ–å…³ç³»æ€»ç»“

```r
lrn('regr.svm')$param_set$deps
```

<table class='dataframe'>
<caption>A data.table: 6 x 3</caption>
<thead>
 <tr><th scope=col>id</th><th scope=col>on</th><th scope=col>cond</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>coef0  </td><td>kernel</td><td>polynomial    , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>cost   </td><td>type  </td><td>eps-regression, nu-regression , %s %%in%% {%s}</td></tr>
 <tr><td>degree </td><td>kernel</td><td>polynomial, %s == %s  </td></tr>
 <tr><td>epsilon</td><td>type  </td><td>eps-regression, %s == %s      </td></tr>
 <tr><td>gamma  </td><td>kernel</td><td>polynomial    , radial        , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>nu     </td><td>type  </td><td>nu-regression, %s == %s     </td></tr>
</tbody>
</table>

- æŸ¥çœ‹ä¸€ä¸‹è®¾ç½®çš„æ¡ä»¶

```r
for (i in 1:6){
 print(lrn('regr.svm')$param_set$deps[[i, 'cond']])
}
```

```css
CondAnyOf: x %in% {polynomial, sigmoid}
CondAnyOf: x %in% {eps-regression, nu-regression}
CondEqual: x == polynomial
CondEqual: x == eps-regression
CondAnyOf: x %in% {polynomial, radial, sigmoid}
CondEqual: x == nu-regression
```

- è¾“å‡ºä¸­`x`æ˜¯`on`çš„æŒ‡ä»£ï¼Œ  
  å½“è¢«ä¾èµ–çš„è¶…å‚`on`çš„è®¾ç½®æ»¡è¶³æŸæ¡ä»¶æ—¶ï¼Œ  
  `id`ä¸­çš„è¶…å‚æ‰èƒ½è¢«è®¾ç½®
- å¦‚æœ`on`è¶…å‚ä¸æ»¡è¶³æ¡ä»¶ï¼Œè®¾ç½®`id`è¶…å‚ä¼šæŠ¥é”™

#### åŸºå‡†å­¦ä¹ å™¨

- `regr.featureless`
 	- å®ƒæ€»æ˜¯å°†æ–°å€¼é¢„æµ‹ä¸ºè®­ç»ƒæ•°æ®ä¸­ç›®æ ‡çš„å‡å€¼
 	- å¦‚æœÂ `robust`Â è¶…å‚æ•°è®¾ç½®ä¸ºÂ `TRUE`ï¼Œåˆ™ä¸ºä¸­ä½æ•°
- ç”¨äº
 	- æ¨¡å‹æ¯”è¾ƒ
 	- å¤‡ç”¨å­¦ä¹ å™¨

```r
lrn('regr.featureless')
```

### æ¨¡å‹è¯„ä¼°

- `msr()`ç”¨äºå•ä¸ªè¯„ä¼°å™¨çš„è¯„ä¼°
- `msrs()`å¯ä»¥è¾“å…¥ä½¿ç”¨å¤šä¸ªè¯„ä¼°å™¨åç§°çš„å‘é‡

```r
# 1
msrR.mse_mae <- msrs(c('regr.mse', 'regr.mae'))
housing.lrnR.rpart.pred$score(msrR.mse_mae)
# 2
housing.lrnR.rpart.pred$score(msrs(c('regr.mse', 'regr.mae')))
```

- `mlr3`è¿˜æœ‰ä¸€äº›å…¶ä»–éè´¨é‡è¯„ä»·çš„è¯„ä¼°æŒ‡æ ‡
 	- `msr('time_train')`ï¼šè®­ç»ƒæ¨¡å‹æ‰€èŠ±è´¹çš„æ—¶é—´
 	- `msr('time_predict')`ï¼šæ¨¡å‹è¿›è¡Œé¢„æµ‹æ‰€éœ€çš„æ—¶é—´
 	- `msr('time_both')`ï¼šè®­ç»ƒæ¨¡å‹ç„¶åè¿›è¡Œé¢„æµ‹æ‰€èŠ±è´¹çš„æ€»æ—¶é—´
 	- `msr('selected_features')`ï¼š  
   æ¨¡å‹é€‰æ‹©çš„ç‰¹å¾æ•°é‡ï¼Œä»…å½“æ¨¡å‹å…·æœ‰`selected_features`å±æ€§æ—¶æ‰å¯ä½¿ç”¨

- `Measure$properties`æä¾›äº†è¯„ä¼°å™¨çš„å±æ€§

```r
msr('regr.mse')$properties
msr('time_train')$properties
```

```css
'weights'
'requires_learner''requires_no_prediction'
```

- è¯„ä¼°å™¨çš„è¶…å‚
 	- å¯ä»¥æ³¨æ„åˆ°`time_train`çš„`Parameters`æ˜¯`list()`ï¼Œ  
   è¿™ä»£è¡¨æ˜¯ç©ºçš„
 	- `selected_features`çš„`Parameters`æœ‰`normalize=FALSE`ï¼Œ  
   è¯´æ˜å¯ä»¥æå‰è®¾ç½®

```r
msr('time_train')
msr('selected_features')
```

```css
[36m--[39m [1m[34m<MeasureElapsedTime>[39m (time_train): Elapsed Time[22m [36m-----------------------------[39m
* Packages: [34mmlr3[39m
* Range: [0, Inf]
* Minimize: [34mTRUE[39m
* Average: macro
* Parameters: list()
* Properties: requires_learner and requires_no_prediction
* Predict type: NA
* Predict sets:
* Aggregator: mean()


[36m--[39m [1m[34m<MeasureSelectedFeatures>[39m (selected_features): Absolute or Relative Frequency[22m
* Packages: [34mmlr3[39m
* Range: [0, Inf]
* Minimize: [34mTRUE[39m
* Average: macro
* Parameters: normalize=FALSE
* Properties: requires_task, requires_learner, requires_model, and
requires_no_prediction
* Predict type: NA
* Predict sets:
* Aggregator: mean()
```

- è®¿é—®è¯„ä¼°å™¨çš„è¶…å‚ä¹Ÿæ˜¯ç”¨`$param_set`

```r
msr.sf <- msr('selected_features')
msr.sf$param_set
```

```css
<ParamSet(1)>
          id    class lower upper nlevels        default  value
      <char>   <char> <num> <num>   <num>         <list> <list>
1: normalize ParamLgl    NA    NA       2 <NoDefault[0]>  FALSE
```

- ä¿®æ”¹

```r
# 1
msr.sf$param_set$set_values(normalize = TRUE)
# 2
msr.sf$param_set$normalize <- TRUE
```

## åˆ†ç±»çš„æµç¨‹

- ä¸å›å½’çš„æµç¨‹ç›¸åŒï¼Œ  
  åªæ˜¯åŸºç¡€å¯¹è±¡åˆ†åˆ«ç»§æ‰¿è‡ª `TaskClassif`ã€`LearnerClassif` å’Œ `MeasureClassif`
- åˆ†ç±»æœ‰**äºŒå…ƒåˆ†ç±»**å’Œ**å¤šå…ƒåˆ†ç±»**ä¸¤ç§

### ä»»åŠ¡åŒ–

- è¿™é‡Œå°±ç›´æ¥è°ƒå–é¢„è®¾çš„ä»»åŠ¡è¿›è¡Œç»ƒä¹ 

```r
mlr_tasks %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 11 x 14</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>task_type</th><th scope=col>nrow</th><th scope=col>ncol</th><th scope=col>properties</th><th scope=col>lgl</th><th scope=col>int</th><th scope=col>dbl</th><th scope=col>chr</th><th scope=col>fct</th><th scope=col>ord</th><th scope=col>pxc</th><th scope=col>dte</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
 <tr><td>breast_cancer     </td><td>Wisconsin Breast Cancer</td><td>classif</td><td>  683</td><td>10</td><td>twoclass</td><td> 0</td><td>0</td><td> 0</td><td>0</td><td> 0</td><td>9</td><td>0</td><td>0</td></tr>
 <tr><td>california_housing</td><td>California House Value </td><td>regr   </td><td>20640</td><td>10</td><td></td><td> 0</td><td>0</td><td> 8</td><td>0</td><td> 1</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>german_credit     </td><td>German Credit          </td><td>classif</td><td> 1000</td><td>21</td><td>twoclass</td><td> 0</td><td>3</td><td> 0</td><td>0</td><td>14</td><td>3</td><td>0</td><td>0</td></tr>
 <tr><td>iris              </td><td>Iris Flowers           </td><td>classif</td><td>  150</td><td> 5</td><td>multiclass</td><td> 0</td><td>0</td><td> 4</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>mtcars            </td><td>Motor Trends           </td><td>regr   </td><td>   32</td><td>11</td><td></td><td> 0</td><td>0</td><td>10</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>penguins          </td><td>Palmer Penguins        </td><td>classif</td><td>  344</td><td> 8</td><td>multiclass</td><td> 0</td><td>3</td><td> 2</td><td>0</td><td> 2</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>pima              </td><td>Pima Indian Diabetes   </td><td>classif</td><td>  768</td><td> 9</td><td>twoclass</td><td> 0</td><td>0</td><td> 8</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>sonar             </td><td>Sonar: Mines vs. Rocks </td><td>classif</td><td>  208</td><td>61</td><td>twoclass</td><td> 0</td><td>0</td><td>60</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>spam              </td><td>HP Spam Detection      </td><td>classif</td><td> 4601</td><td>58</td><td>twoclass</td><td> 0</td><td>0</td><td>57</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>wine              </td><td>Wine Regions           </td><td>classif</td><td>  178</td><td>14</td><td>multiclass</td><td> 0</td><td>2</td><td>11</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
 <tr><td>zoo               </td><td>Zoo Animals            </td><td>classif</td><td>  101</td><td>17</td><td>multiclass</td><td>15</td><td>1</td><td> 0</td><td>0</td><td> 0</td><td>0</td><td>0</td><td>0</td></tr>
</tbody>
</table>

- åˆ†åˆ«ç”¨`german_credit`å’Œ`penguins`ä½œä¸ºäºŒå…ƒåˆ†ç±»å’Œå¤šå…ƒåˆ†ç±»çš„ä¾‹å­

```R
gc.tskC <- tsk('german_credit')
peng.tskC <- tsk('penguins')

gc.tskC
peng.tskC
```

```css
[36m--[39m [1m[34m<TaskClassif>[39m (1000x21): German Credit[22m [36m--------------------------------------[39m
* Target: credit_risk
* Target classes: good (positive class, 70%), bad (30%)
* Properties: twoclass
* Features (20):
  * fct (14): credit_history, employment_duration, foreign_worker, housing,
  job, other_debtors, other_installment_plans, people_liable,
  personal_status_sex, property, purpose, savings, status, telephone
  * int (3): age, amount, duration
  * ord (3): installment_rate, number_credits, present_residence


[36m--[39m [1m[34m<TaskClassif>[39m (344x8): Palmer Penguins[22m [36m--------------------------------------[39m
* Target: species
* Target classes: Adelie (44%), Gentoo (36%), Chinstrap (20%)
* Properties: multiclass
* Features (7):
  * int (3): body_mass, flipper_length, year
  * dbl (2): bill_depth, bill_length
  * fct (2): island, sex
```

### äºŒå…ƒåˆ†ç±»

#### Outcomeçš„åˆ†ç±»

```r
gc.tskC$class_names
gc.tskC$properties
```

```css
'good''bad'
'twoclass'
```

#### å®šä¹‰æ­£ç±»

```r
gc.tskC$positive <- 'good'
```

- å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªçº§åˆ«æ˜¯æ­£ç±»

#### å¯¹çœŸå®å€¼-é¢„æµ‹å€¼è¿›è¡Œç»˜å›¾

```r
autoplot(gc.tskC, type = 'duo') +
  theme(strip.text.y = element_text(angle = -45, size = 8))
```

#### é¢„æµ‹ç»“æœ

- `predict_type`å¯ä»¥é€‰æ‹©é¢„æµ‹å“åº”ç±»åˆ«`'response'`æˆ–è€…æ¦‚ç‡`'prob'`
 	- é€‰æ‹©æ¦‚ç‡ä¹Ÿä¼šç»™å‡º`response`çš„ç»“æœ
 	- æ‰€ä»¥å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œç”¨æ¦‚ç‡ä¼šæ›´å¥½

```r
lrn('classif.rpart') # 'response'æ˜¯é»˜è®¤
lrn('classif.rpart', predict_type = 'prob')
```

```r
# gc.tskC.splits <- partition(gc.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

gc.lrnC.rpart <- lrn('classif.rpart', predict_type = 'response')
gc.lrnC.rpart$train(gc.tskC, gc.tskC.splits$train)
gc.lrnC.rpart.pred <- gc.lrnC.rpart$predict(gc.tskC, gc.tskC.splits$test)
gc.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m300[39m observations:[22m [36m-----------------------------------[39m
 row_ids truth response
       6  good     good
       8  good      bad
      10   bad      bad
     ---   ---      ---
     992  good     good
     995  good     good
    1000  good      bad
```

```r
# gc.tskC.splits <- partition(gc.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

gc.lrnC.rpart <- lrn('classif.rpart', predict_type = 'prob')
gc.lrnC.rpart$train(gc.tskC, gc.tskC.splits$train)
gc.lrnC.rpart.pred <- gc.lrnC.rpart$predict(gc.tskC, gc.tskC.splits$test)
gc.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m300[39m observations:[22m [36m-----------------------------------[39m
 row_ids truth response  prob.good  prob.bad
       6  good     good 0.85667752 0.1433225
       8  good      bad 0.21739130 0.7826087
      10   bad      bad 0.29411765 0.7058824
     ---   ---      ---        ---       ---
     992  good     good 0.85667752 0.1433225
     995  good     good 0.85667752 0.1433225
    1000  good      bad 0.07692308 0.9230769
```

#### æ¨¡å‹è¯„ä¼°

- ä¸åŒç§ç±»çš„è¯„ä¼°å™¨å¯¹äº`response`å’Œ`prob`çš„é€‚ç”¨æ€§æ˜¯ä¸åŒçš„ï¼Œ  
  éœ€è¦æ‰¾åˆ°åˆé€‚çš„è¯„ä¼°å™¨

- å¯»æ‰¾æ”¯æŒåˆ†ç±»å¹¶ç”¨äºè¯„ä¼°æ¦‚ç‡çš„è¯„ä¼°å™¨

```r
as.data.table(msr())[
    task_type == 'classif' & predict_type == 'prob']
```

<table class='dataframe'>
<caption>A data.table: 7 x 7</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>task_type</th><th scope=col>packages</th><th scope=col>predict_type</th><th scope=col>properties</th><th scope=col>task_properties</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>classif.logloss  </td><td>Log Loss                                  </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td>weights</td><td></td></tr>
 <tr><td>classif.mauc_au1p</td><td>Weighted average 1 vs. 1 multiclass AUC   </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_au1u</td><td>Average 1 vs. 1 multiclass AUC            </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunp</td><td>Weighted average 1 vs. rest multiclass AUC</td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_aunu</td><td>Average 1 vs. rest multiclass AUC         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mauc_mu  </td><td>Multiclass mu AUC                         </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
 <tr><td>classif.mbrier   </td><td>Multiclass Brier Score                    </td><td>classif</td><td>mlr3        , mlr3measures</td><td>prob</td><td></td><td></td></tr>
</tbody>
</table>

- è¿™é‡Œä½¿ç”¨äº†3ç§è¯„ä¼°å™¨
 	- `classif.mbrier`ï¼šç”¨é¢„æµ‹æ¦‚ç‡ä¸çœŸå®å€¼ä¹‹é—´çš„å¹³æ–¹å·®è¯„ä¼°`prob`çš„é¢„æµ‹ç»“æœ
 	- `classif.logloss`ï¼šç”¨çœŸå®ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡çš„è´Ÿå¯¹æ•°è¯„ä¼°`prob`çš„é¢„æµ‹ç»“æœ
 	- `classif.acc`ï¼šè¯„ä¼°`response`çš„é¢„æµ‹åˆ†ç±»ç»“æœ

```R
gc.lrnC.rpart.pred$score(msrs(c('classif.mbrier', 'classif.logloss', 'classif.acc')))
```

#### æ··æ·†çŸ©é˜µ

- `Prediction$confution`æŸ¥çœ‹æ··æ·†çŸ©é˜µ

```r
gc.lrnC.rpart.pred$confusion
```

```css
        truth
response good bad
    good  177  45
    bad    41  37
```

- é€šè¿‡`autoplot(Prediction)`å¯è§†åŒ–æ··æ·†çŸ©é˜µ

```R
autoplot(gc.lrnC.rpart.pred)
```

#### é˜ˆå€¼è®¾å®š

- `Prediction$set_threshold()`è®¾å®šé˜ˆå€¼
 	- é˜ˆå€¼æ˜¯**åˆ¤æ–­ä¸ºæ­£ç±»**çš„é˜ˆå€¼ï¼Œå› æ­¤éœ€è¦æ­£ç¡®è®¾ç½®æ­£ç±»

```r
gc.lrnC.rpart.pred$set_threshold(YourThreshold)
```

### å¤šå…ƒåˆ†ç±»

#### Outcomeçš„åˆ†ç±»

```r
peng.tskC$class_names
peng.tskC$properties
```

```css
'Adelie''Chinstrap''Gentoo'
'multiclass'
```

#### æ²¡æœ‰å®šä¹‰æ­£ç±»

- å®šä¹‰äº†åè€Œä¼šæŠ¥é”™çš„

```r
peng.tskC$positive <- 'Adelie'
```

```css
Error in (function (rhs) : Setting the positive class is only feasible for binary classification
```

#### å¯¹çœŸå®å€¼-é¢„æµ‹å€¼è¿›è¡Œç»˜å›¾

```r
autoplot(peng.tskC, type = 'duo') +
  theme(strip.text.y = element_text(angle = -45, size = 8))
```

#### é¢„æµ‹ç»“æœ

```r
# peng.tskC.splits <- partition(peng.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

peng.lrnC.rpart <- lrn('classif.rpart', predict_type = 'response')
peng.lrnC.rpart$train(peng.tskC, peng.tskC.splits$train)
peng.lrnC.rpart.pred <- peng.lrnC.rpart$predict(peng.tskC, peng.lrnC.splits$test)
peng.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m103[39m observations:[22m [36m-----------------------------------[39m
 row_ids     truth  response
      11    Adelie    Adelie
      13    Adelie    Adelie
      14    Adelie    Adelie
     ---       ---       ---
     326 Chinstrap Chinstrap
     331 Chinstrap    Adelie
     338 Chinstrap Chinstrap
```

```r
# peng.tskC.splits <- partition(peng.tskC,ratio = 0.7) # äº‹å…ˆè®¾å®šå¥½

peng.lrnC.rpart <- lrn('classif.rpart', predict_type = 'prob')
peng.lrnC.rpart$train(peng.tskC, peng.tskC.splits$train)
peng.lrnC.rpart.pred <- peng.lrnC.rpart$predict(peng.tskC, peng.lrnC.splits$test)
peng.lrnC.rpart.pred
```

```css
[36m--[39m [1m[34m<PredictionClassif>[39m for [34m103[39m observations:[22m [36m-----------------------------------[39m
 row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
      11    Adelie    Adelie   0.9537037     0.01851852  0.02777778
      13    Adelie    Adelie   0.9537037     0.01851852  0.02777778
      14    Adelie    Adelie   0.9537037     0.01851852  0.02777778
     ---       ---       ---         ---            ---         ---
     326 Chinstrap Chinstrap   0.0000000     1.00000000  0.00000000
     331 Chinstrap    Adelie   0.9537037     0.01851852  0.02777778
     338 Chinstrap Chinstrap   0.0000000     1.00000000  0.00000000
```

#### æ¨¡å‹è¯„ä¼°

- å¯»æ‰¾æ”¯æŒå¤šå…ƒåˆ†ç±»å¹¶ç”¨äºè¯„ä¼°æ¦‚ç‡çš„è¯„ä¼°å™¨

```r
as.data.table(msr())[
    task_type == 'classif' & predict_type == 'prob' &
    !sapply(task_properties, function(x) 'twoclass' %in% x)]
```

```r
peng.lrnC.rpart.pred$score(msrs(c('classif.mbrier', 'classif.logloss', 'classif.acc')))
```

#### æ··æ·†çŸ©é˜µ

- `Prediction$confution`æŸ¥çœ‹æ··æ·†çŸ©é˜µ

```r
gc.lrnC.rpart.pred$confusion
```

```css
        truth
response good bad
    good  177  45
    bad    41  37
```

- é€šè¿‡`autoplot(Prediction)`å¯è§†åŒ–æ··æ·†çŸ©é˜µ

```R
autoplot(gc.lrnC.rpart.pred)
```

#### é˜ˆå€¼è®¾å®š

- `Prediction$set_threshold()`è®¾å®šé˜ˆå€¼
 	- ä¸äºŒå…ƒåˆ†ç±»ä¸åŒçš„æ˜¯ï¼Œå¤šå…ƒåˆ†ç±»éœ€è¦**ç»™æ¯ä¸€ä¸ªåˆ†ç±»**å•ç‹¬è®¾ç½®ä¸€ä¸ªé˜ˆå€¼

- åœ¨å¤šåˆ†ç±»é—®é¢˜ä¸­é˜ˆå€¼åŒ–çš„å·¥ä½œåŸç†
 	- é¦–å…ˆä¸ºÂ `n`Â ä¸ªç±»åˆ«ä¸­çš„æ¯ä¸ªç±»åˆ«åˆ†é…ä¸€ä¸ªé˜ˆå€¼ï¼Œ  
   å°†æ¯ä¸ªç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡é™¤ä»¥è¿™äº›é˜ˆå€¼ï¼Œ  
   ä»¥è¿”å›Â `n`Â ä¸ªæ¯”ç‡ï¼Œç„¶åé€‰æ‹©æ¯”ç‡æœ€é«˜çš„ç±»åˆ«  
   ï¼ˆè¿™é‡Œçš„é˜ˆå€¼å…¶å®å°±æ˜¯æƒé‡äº†ï¼Œé˜ˆå€¼è¶Šå°ï¼Œæƒé‡è¶Šé«˜ï¼‰

- é€šè¿‡ä¼ é€’ä¸€ä¸ªå‘½åå‘é‡è¿›è¡Œæ›´æ”¹

```r
# éšä¾¿è®¾ç½®
peng.lrnC.rpart.pred$set_threshold(c(
 'Adelie' = 0.8,
 'Chinstrap' = 0.5,
 'Gentoo' = 0.2
))
```

- é€†åŠ æƒè®¾å®šé˜ˆå€¼
 	- å°†æ–°é˜ˆå€¼è®¾ç½®ä¸ºè®­ç»ƒé›†ä¸­æ¯ä¸ªç±»åˆ«çš„æ¯”ä¾‹
 	- åœ¨é€‰æ‹©æ¯”ç‡æœ€é«˜çš„æ ‡ç­¾ä¹‹å‰ï¼Œç”¨é¢„æµ‹æ¦‚ç‡é™¤ä»¥è¿™äº›ç±»åˆ«æ¯”ä¾‹

```r
# é€†åŠ æƒæ³•è®¾ç½®
peng.lrnC.rpart.pred$set_threshold(
 peng.tskC$truth(peng.tskC.splits$train) %>% 
  table() %>% 
  proportions()
)
```

## å®šä¹‰æ•°æ®role

- `Task$col_roles`èƒ½æ˜¾ç¤ºæ‰€æœ‰çš„role

```r
peng.tskC$col_roles
```

```css
$feature
'bill_depth''bill_length''flipper_length''island''sex''year''body_mass'
$target
'species'
$name
$order
$stratum
$group
$offset
$weights_learner
$weights_measure
```

- é€šè¿‡`Task$set_col_roles('col', roles = 'role')`æ¥é‡æ–°å®šä¹‰

```r
set_col_roles('body_mass', roles = 'feature')
```

## è¯„ä¼°ä¸åŸºå‡†æµ‹è¯•

### ç•™å‡ºæ³•ä¸è¯„åˆ†

- ç•™å‡ºæ³•å°±æ˜¯`partition()`çš„ç®€å•åˆ’åˆ†æ–¹æ³•
- è¯„ä¼°`Prediction$score`æ˜¯ç”¨æ¥ä¼°è®¡æœ€ç»ˆæ¨¡å‹çš„**æ³›åŒ–èƒ½åŠ›**
![image_2](./image_2.png)

### é‡é‡‡æ ·

![image_3](./image_3.png)
