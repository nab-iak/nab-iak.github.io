---
title: 'ã€mlr3ã€‘2.è°ƒä¼˜'
published: 2025-07-21
image: './p11_cover.jpg'
description: 'mlr3è°ƒä¼˜'
category: 'Machine Learning'
tags: [mlr3,R,ZH-CN]
draft: false 
lang: 'en'
---
> - Cover Pic by [@æ™•æ¬§æ¬§](https://www.pixiv.net/artworks/132528204)  

> [Applied Machine Learning Using mlr3 in R](https://mlr3book.mlr-org.com/)

## åŸºæœ¬è°ƒä¼˜æ–¹æ³•

### è°ƒä¼˜çš„æ•´ä½“æµç¨‹

![image_1](./image_1.png)

### æ¨¡å‹è°ƒä¼˜ï¼ˆModel Tuningï¼‰

- **æœç´¢ç©ºé—´ï¼ˆsearch spaceï¼‰/è°ƒä¼˜ç©ºé—´ï¼ˆtuning spaceï¼‰**
  - å¯ä¾›è°ƒæ•´çš„è¶…å‚æ•°é›†åˆ
- **ä¸å¯è°ƒè¶…å‚æ•°**
  - å°‘æ•°æ¨¡å‹çš„è®­ç»ƒå‡½æ•°æä¾›äº†å’Œè®­ç»ƒæ¨¡å‹ä¸ç›¸å¹²çš„è¶…å‚æ•°
  - ä¾‹å¦‚`lrn('classif.ranger')` ä¸­çš„ `verbose` æ§åˆ¶è®­ç»ƒæœŸé—´å‘ç”¨æˆ·æ˜¾ç¤ºå¤šå°‘ä¿¡æ¯

- å¯¹äºæ•°å€¼å‹çš„è¶…å‚æ•°ï¼Œéœ€è¦æŒ‡å®šè°ƒæ•´çš„èŒƒå›´
- ä½¿ç”¨`to_tune()`æ¥æ„å»ºè°ƒæ•´èŒƒå›´çš„ä¸‹é™ä¸ä¸Šé™

```r
learner <- lrn('classif.svm',
  type  = 'C-classification',
  kernel = 'radial',
  cost  = to_tune(1e-1, 1e5),
  gamma = to_tune(1e-1, 1)
)
learner
```

- å¦‚æœå¯¹ç”¨`to_tune()`æ ‡è®°äº†è¶…å‚æ•°çš„å­¦ä¹ å™¨è°ƒç”¨`Learner$train()`çš„è¯ä¼šæŠ›å‡ºé”™è¯¯

### ç»ˆæ­¢å™¨ï¼ˆTerminatorï¼‰

- ~~ç»ˆç»“è€…~~
- `mlr_terminators`å­˜å‚¨äº†æ‰€æœ‰ç»ˆæ­¢å™¨çš„ç§ç±»ï¼Œ  
  ä½¿ç”¨ `trm()` åˆ›å»ºç»ˆæ­¢å™¨

| Terminator <br>ç»ˆæ­¢å™¨             | Function call and default parameters <br>å‡½æ•°è°ƒç”¨å’Œé»˜è®¤å‚æ•° |
| ------------------------------ | -------------------------------------------------- |
| Clock TimeÂ <br>æ—¶é’Ÿæ—¶é—´            | `trm('clock_time')`                                |
| ComboÂ <br>ç»„åˆ                   | `trm('combo', any = TRUE)`                         |
| NoneÂ <br>æ—                      | `trm('none')`                                      |
| Number of EvaluationsÂ <br>è¯„ä¼°æ¬¡æ•° | `trm('evals', n_evals = 100, k = 0)`               |
| Performance LevelÂ <br>æ€§èƒ½æ°´å¹³     | `trm('perf_reached', level = 0.1)`                 |
| Run TimeÂ <br>è¿è¡Œæ—¶é—´              | `trm('run_time', secs = 30)`                       |
| StagnationÂ <br>åœæ»              | `trm('stagnation', iters = 10, threshold = 0)`     |

```r
mlr_terminators %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 9 x 4</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>properties</th><th scope=col>unit</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>clock_time            </td><td>Clock Time            </td><td>single-crit, multi-crit </td><td>seconds    </td></tr>
 <tr><td>combo                 </td><td>Combination           </td><td>single-crit, multi-crit </td><td>percent    </td></tr>
 <tr><td>evals                 </td><td>Number of Evaluation  </td><td>single-crit, multi-crit </td><td>evaluations</td></tr>
 <tr><td>none                  </td><td>None                  </td><td>single-crit, multi-crit </td><td>percent    </td></tr>
 <tr><td>perf_reached          </td><td>Performance Level     </td><td>single-crit</td><td>percent    </td></tr>
 <tr><td>run_time              </td><td>Run Time              </td><td>single-crit, multi-crit </td><td>seconds    </td></tr>
 <tr><td>stagnation            </td><td>Stagnation            </td><td>single-crit</td><td>percent    </td></tr>
 <tr><td>stagnation_batch      </td><td>Stagnation Batch      </td><td>single-crit</td><td>percent    </td></tr>
 <tr><td>stagnation_hypervolume</td><td>Stagnation Hypervolume</td><td>multi-crit</td><td>percent    </td></tr>
</tbody>
</table>

- æœ€å¸¸ç”¨çš„ç»ˆæ­¢æ¡ä»¶æ˜¯åœ¨ç‰¹å®šæ—¶é—´ï¼ˆ`trm('run_time'`ï¼‰ï¼Œ  
  æˆ–ç»™å®šè¯„ä¼°æ¬¡æ•°ï¼ˆ`trm('evals')`ï¼‰ååœæ­¢è°ƒä¼˜
  - é€‰æ‹©è¿è¡Œæ—¶é—´é€šå¸¸åŸºäºå®é™…è€ƒè™‘å’Œç›´è§‰
    - åœ¨è®¡ç®—é›†ç¾¤ä¸Šï¼Œä½¿ç”¨æ—¶é—´é™åˆ¶å¯èƒ½å¾ˆé‡è¦ï¼Œ  
    å› ä¸ºå¯èƒ½éœ€è¦ä¸ºè®¡ç®—ä»»åŠ¡æŒ‡å®šæœ€é•¿è¿è¡Œæ—¶é—´
  - `trm('perf_reached')`åœ¨è¾¾åˆ°æŒ‡å®šæ€§èƒ½æ°´å¹³æ—¶åœæ­¢è°ƒä¼˜
    - å¦‚æœæŸä¸ªæ€§èƒ½æ°´å¹³è¢«è®¤ä¸ºè¶³ä»¥æ»¡è¶³æ¨¡å‹çš„å®é™…åº”ç”¨ï¼Œè¿™ä¼šå¾ˆæœ‰å¸®åŠ©
    - ä½†æ˜¯ï¼Œå¦‚æœè®¾ç½®å¾—è¿‡äºä¹è§‚ï¼Œè°ƒä¼˜å¯èƒ½æ°¸è¿œä¸ä¼šç»ˆæ­¢
- `trm('stagnation')`åœ¨è®¾å®šæ•°é‡çš„`iterations`ä¸­æ²¡æœ‰å–å¾—å¤§äº`threshold`çš„è¿›å±•æ—¶åœæ­¢
  - å¯¹äºå¤æ‚çš„æœç´¢ç©ºé—´ï¼Œé˜ˆå€¼å¯èƒ½å¾ˆéš¾é€‰æ‹©
  - å› ä¸ºå°½ç®¡ä»æœ‰ï¼ˆå¯èƒ½å¾ˆå¤§çš„ï¼‰æ”¹è¿›ç©ºé—´ï¼Œä½†ä¼˜åŒ–å¯èƒ½ä¼šè¿‡æ—©åœæ­¢
- `trm('none')`ç”¨äºè‡ªè¡Œæ§åˆ¶ç»ˆæ­¢çš„è°ƒè°å™¨ï¼Œå› æ­¤æ­¤ç»ˆæ­¢æ¡ä»¶ä¸èµ·ä½œç”¨
- è¿™äº›ç»ˆæ­¢æ¡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨`trm('combo')`è‡ªç”±ç»„åˆï¼Œ  
  å¯ç”¨äºæŒ‡å®šè¶…å‚æ•°ä¼˜åŒ–åœ¨ä»»ä½•ç»ˆæ­¢æ¡ä»¶è§¦å‘æ—¶å®Œæˆï¼ˆ`any = TRUE`ï¼‰ï¼Œ  
  æˆ–è€…åœ¨æ‰€æœ‰ç»ˆæ­¢æ¡ä»¶è§¦å‘æ—¶å®Œæˆï¼ˆ`any = FALSE`ï¼‰

### ä½¿ç”¨`ti()`è¿›è¡Œå®ä¾‹è°ƒä¼˜ï¼ˆTuning Instanceï¼‰

- è¿™é‡Œç”¨`ti()`åˆ›å»ºäº†ä¸€ä¸ªå•ç›®æ ‡è°ƒä¼˜çš„`TuningInstanceBatchSingleCrit`å¯¹è±¡
- æ‰€è°“çš„å®ä¾‹ï¼Œå°±æ˜¯å°†`Task`ï¼Œ`Learner`ï¼Œ`Resampling`ï¼Œ`Measure`ï¼Œå’Œ`Terminator`è¿™äº›è¦ç´ æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæä¾›ç»™`Tuner`è¿›è¡Œè°ƒä¼˜
- è°ƒä¼˜çš„ç»“æœä¹Ÿä¼šå‚¨å­˜åœ¨`Instance`é‡Œé¢

```r
# è°ƒå–é¢„è®¾ä»»åŠ¡`'sonar'`
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚æ•°`cose`å’Œ`gamma`
 cost  = to_tune(1e-1, 1e5),
 gamma = to_tune(1e-1, 1),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚æ•°
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 # è¿™é‡Œåªæœ‰ä¸€ä¸ª`Measure`ï¼Œæ‰€ä»¥æ˜¯å•ç›®æ ‡è°ƒä¼˜
 # å¦‚æœè¿™é‡Œæ˜¯`msrs(c('msr1','msr2'))`ï¼Œé‚£ä¹ˆå°±æ˜¯å¤šç›®æ ‡è°ƒä¼˜
 measures = msr('classif.ce'),
 # éå†æ•´ä¸ªç½‘æ ¼ï¼Œä¸è¿‡æ—©åœæ­¢ï¼Œå› æ­¤ä¸è®¾å®šç»ˆæ­¢å™¨
 terminator = trm('none')
)
# æŸ¥çœ‹å®ä¾‹
instance
```

```js
<TuningInstanceBatchSingleCrit>
* State:  Not optimized
* Objective: <ObjectiveTuningBatch:classif.svm_on_sonar>
* Search Space:
       id    class lower upper nlevels
   <char>   <char> <num> <num>   <num>
1:   cost ParamDbl   0.1 1e+05     Inf
2:  gamma ParamDbl   0.1 1e+00     Inf
* Terminator: <TerminatorNone>
```

- å…¶å®è¿™é‡Œ`<TuningInstanceBatchSingleCrit>`å·²ç»çœ‹å¾—å‡ºæ˜¯å•ç›®æ ‡è°ƒä¼˜å¯¹è±¡äº†
- å¯ä»¥éšä¾¿çœ‹çœ‹`instance`çš„ç±»

```r
instance %>% class()
```

```js
'TuningInstanceBatchSingleCrit''OptimInstanceBatchSingleCrit''OptimInstanceBatch''OptimInstance''R6'
```

### è°ƒä¼˜å™¨ï¼ˆTunerï¼‰

#### è°ƒä¼˜å™¨ç§ç±»

- ä¸‹è¡¨ç»™å‡ºäº†å¯ç”¨çš„`Tuner`

| TunerÂ <br>è°ƒè°å™¨                                | Function callÂ <br>å‡½æ•°è°ƒç”¨ | PackageÂ <br>åŒ…   |
| -------------------------------------------- | ---------------------- | --------------- |
| Random SearchÂ <br>éšæœºæœç´¢                       | `tnr('random_search')` | `mlr3tuning`    |
| Grid SearchÂ <br>ç½‘æ ¼æœç´¢                         | `tnr('grid_search')`   | `mlr3tuning`    |
| Bayesian OptimizationÂ <br>è´å¶æ–¯ä¼˜åŒ–              | `tnr('mbo')`           | `mlr3mbo`       |
| CMA-ESÂ <br>åæ–¹å·®çŸ©é˜µè‡ªé€‚åº”è¿›åŒ–ç­–ç•¥                      | `tnr('cmaes')`         | `adagio`        |
| Iterated RacingÂ <br>è¿­ä»£ç«èµ›                     | `tnr('irace')`         | `irace`         |
| HyperbandÂ <br>è¶…å‚æ•°ä¼˜åŒ–ç®—æ³•                        | `tnr('hyperband')`     | `mlr3hyperband` |
| Generalized Simulated AnnealingÂ <br>å¹¿ä¹‰æ¨¡æ‹Ÿé€€ç«ç®—æ³• | `tnr('gensa')`         | `GenSA`         |
| Nonlinear OptimizationÂ <br>éçº¿æ€§ä¼˜åŒ–             | `tnr('nloptr')`        | `nloptr`        |

- ä½¿ç”¨`tnr()`æ¥è°ƒç”¨è°ƒä¼˜å™¨

```r
tnr('grid_search')
```

```js
<TunerBatchGridSearch>: Grid Search
* Parameters: batch_size=1, resolution=10
* Parameter classes: ParamLgl, ParamInt, ParamDbl, ParamFct
* Properties: dependencies, single-crit, multi-crit
* Packages: mlr3tuning, bbotk
```

#### è°ƒä¼˜ç­–ç•¥

- **æœç´¢ç­–ç•¥ï¼ˆSearch strategiesï¼‰**
  - ç½‘æ ¼æœç´¢å’Œéšæœºæœç´¢æ˜¯æœ€åŸºæœ¬çš„ç®—æ³•ï¼Œåœ¨åˆå§‹å®éªŒä¸­é€šå¸¸é¦–å…ˆè¢«é€‰ç”¨
  - **ç½‘æ ¼æœç´¢**
    - æ€è·¯æ˜¯è¯¦å°½åœ°è¯„ä¼°ç»™å®šè¶…å‚æ•°å€¼çš„æ¯ä¸€ç§å¯èƒ½ç»„åˆ
    - åˆ†ç±»è¶…å‚æ•°é€šå¸¸ä¼šåœ¨å…¶æ‰€æœ‰å¯èƒ½å–å€¼ä¸Šè¿›è¡Œè¯„ä¼°
    - æ•°å€¼å‹å’Œæ•´å‹è¶…å‚æ•°å€¼ä¼šæ ¹æ®ç»™å®šçš„åˆ†è¾¨ç‡  
    ï¼ˆå³æ¯ä¸ªè¶…å‚æ•°è¦å°è¯•çš„ä¸åŒå€¼çš„æ•°é‡ï¼‰ï¼Œ  
    åœ¨å…¶è¾¹ç•Œçº¦æŸï¼ˆä¸Šé™å’Œä¸‹é™ï¼‰å†…ç­‰è·åˆ†å¸ƒ
  - **éšæœºæœç´¢**
    - ä»é¢„å…ˆæŒ‡å®šçš„åˆ†å¸ƒï¼ˆé€šå¸¸æ˜¯å‡åŒ€åˆ†å¸ƒï¼‰ä¸­ä¸ºæ¯ä¸ªè¶…å‚æ•°ç‹¬ç«‹åœ°éšæœºé€‰æ‹©å€¼
  - è¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸å…·å¤‡é€‚åº”æ€§ï¼Œ  
   ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æå‡ºçš„é…ç½®éƒ½å¿½ç•¥äº†å…ˆå‰é…ç½®çš„æ€§èƒ½
  - ç”±äºå…¶ç®€å•æ€§ï¼Œ  
   ç½‘æ ¼æœç´¢å’Œéšæœºæœç´¢éƒ½å¯ä»¥å¤„ç†æ··åˆæœç´¢ç©ºé—´
   ï¼ˆå³è¶…å‚æ•°å¯ä»¥æ˜¯æ•°å€¼å‹ã€æ•´å‹æˆ–åˆ†ç±»å‹ï¼‰ä»¥åŠåˆ†å±‚æœç´¢ç©ºé—´

- **è‡ªé€‚åº”ç®—æ³•ï¼ˆAdaptive Algorithmsï¼‰**
  - è‡ªé€‚åº”ç®—æ³•ä»**å…ˆå‰è¯„ä¼°**çš„é…ç½®ä¸­å­¦ä¹ ï¼Œä»¥å¿«é€Ÿæ‰¾åˆ°è‰¯å¥½çš„é…ç½®
  - **è´å¶æ–¯ä¼˜åŒ–ï¼ˆBayesian Optimizationï¼‰**
    - ä½¿ç”¨**ä»£ç†æ¨¡å‹**æ¥è¿‘ä¼¼å¾…ä¼˜åŒ–çš„æœªçŸ¥å‡½æ•°
      - åœ¨è¶…å‚æ•°ä¼˜åŒ–ä¸­ï¼Œè¿™å°†æ˜¯ä»è¶…å‚æ•°é…ç½®åˆ°ä¼°è®¡çš„æ³›åŒ–æ€§èƒ½çš„æ˜ å°„
    - å¦‚æœé€‰æ‹©äº†åˆé€‚çš„ä»£ç†æ¨¡å‹ï¼Œä¾‹å¦‚éšæœºæ£®æ—ï¼Œ  
    è´å¶æ–¯ä¼˜åŒ–å¯ä»¥ç›¸å½“çµæ´»ï¼Œç”šè‡³å¯ä»¥å¤„ç†æ··åˆå’Œåˆ†å±‚æœç´¢ç©ºé—´
  - **åæ–¹å·®çŸ©é˜µè‡ªé€‚åº”è¿›åŒ–ç­–ç•¥**  
   **ï¼ˆCovariance Matrix Adaptation Evolution Strategyï¼‰**
    - åœ¨å€™é€‰ç‚¹ä¸Šç»´æŒä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œè¯¥åˆ†å¸ƒç”±ä¸€ä¸ªå‡å€¼å‘é‡å’Œåæ–¹å·®çŸ©é˜µè¡¨ç¤º  
    é€šè¿‡ä»è¿™ä¸ªåˆ†å¸ƒä¸­é‡‡æ ·ç”Ÿæˆä¸€ç»„æ–°çš„å€™é€‰ç‚¹ï¼Œæ¯ä¸ªå€™é€‰ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸å…¶æ€§èƒ½æˆæ­£æ¯”
    - åæ–¹å·®çŸ©é˜µä¼šéšç€æ—¶é—´è¿›è¡Œè°ƒæ•´ï¼Œä»¥åæ˜ æ€§èƒ½æ€åŠ¿
    - é€šè¿‡`miesmuschel`åŒ…ï¼Œåœ¨mlr3ä¸­è¿˜å¯ä½¿ç”¨æ›´å¤šè¿›åŒ–ç­–ç•¥
  - **è¿­ä»£ç«èµ›ç®—æ³•ï¼ˆIterated Racingï¼‰**
    - è¿­ä»£èˆå¼ƒé‚£äº›ç»ç»Ÿè®¡æ£€éªŒæ˜¾ç¤ºæ€§èƒ½ä¸ä½³çš„é…ç½®
    - é¦–å…ˆä»å‚æ•°åŒ–å¯†åº¦ä¸­éšæœºé‡‡æ ·çš„åˆå§‹é…ç½®ç¾¤ä½“ä¸­è¿›è¡Œ â€œç«èµ›â€ï¼Œ  
    ç„¶ååˆ©ç”¨ç«èµ›ä¸­å¹¸å­˜çš„é…ç½®æ¥éšæœºæ›´æ–°åç»­ç«èµ›çš„å¯†åº¦ï¼Œ  
    ä»¥ä¾¿èšç„¦äºæœç´¢ç©ºé—´ä¸­æœ‰å‰æ™¯çš„åŒºåŸŸï¼Œ  
    ä¾æ­¤ç±»æ¨
  - **è¶…å¸¦ç®—æ³•ï¼ˆHyperbandï¼‰/ å¤šä¿çœŸåº¦è¶…å‚æ•°ä¼˜åŒ–ï¼ˆMulti-fidelity HPOï¼‰**
    - ä¸€ç§è‡ªé€‚åº”æ–¹æ³•ï¼Œ  
    åˆ©ç”¨è®¡ç®—æˆæœ¬è¾ƒä½çš„ä½ä¿çœŸåº¦è¯„ä¼°çš„é¢„æµ‹èƒ½åŠ›  
    ï¼ˆå³è´¨é‡è¾ƒå·®çš„é¢„æµ‹ä¾‹å¦‚é‚£äº›ç”±è®­ç»ƒè½®æ•°è¾ƒå°‘çš„ç¥ç»ç½‘ç»œäº§ç”Ÿçš„é¢„æµ‹ï¼‰  
    æ¥æé«˜æ•´ä½“ä¼˜åŒ–æ•ˆç‡

#### ç­–ç•¥é€‰æ‹©

- **æœç´¢ç­–ç•¥**
  - å¦‚æœæœç´¢ç©ºé—´**è¾ƒå°**æˆ–ç»“æ„**ä¸å¤æ‚**ï¼Œ  
   ç½‘æ ¼æœç´¢æˆ–è®¸èƒ½å¤Ÿåœ¨åˆç†æ—¶é—´å†…è¯¦å°½è¯„ä¼°æ•´ä¸ªæœç´¢ç©ºé—´
  - ç”±äºé«˜çº¬åº¦çš„æœç´¢ç©ºé—´å¯¼è‡´çš„çš„**ç»´åº¦ç¾éš¾**ä»¥åŠå¯¹æ•°å€¼**æœç´¢ç©ºé—´çš„è¦†ç›–ä¸è¶³**ï¼Œ  
   é€šå¸¸**ä¸æ¨èä½¿ç”¨ç½‘æ ¼æœç´¢**
    - æ­¤æ—¶ï¼Œ**éšæœºæœç´¢**å¾€å¾€æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œ  
    å› ä¸ºå¯ä»¥è€ƒè™‘æ›´å¤šç‹¬ç‰¹å€¼
- **æ›´ä¼˜çš„ç®—æ³•**
  - é€‚ç”¨äºé«˜ç»´åº¦æˆ–ç»“æ„æ›´å¤æ‚çš„æœç´¢ç©ºé—´
  - **è¿›åŒ–ç­–ç•¥å’Œè´å¶æ–¯ä¼˜åŒ–**é—´çš„é€‰æ‹©
    - æ ¹æ®å‡½æ•°è¯„ä¼°çš„æˆæœ¬è¿›è¡Œé€‰æ‹©
    - **è¿›åŒ–ç­–ç•¥ï¼ˆevolutionary strategiesï¼‰**
      - è¶…å‚æ•°é…ç½®èƒ½å¤Ÿå¿«é€Ÿè¯„ä¼°æ—¶
    - **è´å¶æ–¯ä¼˜åŒ–ï¼ˆBayesian optimizationï¼‰**
      - æ¨¡å‹è¯„ä¼°è€—æ—¶ä¸”ä¼˜åŒ–é¢„ç®—æœ‰é™æ—¶
    - é€šå¸¸æ¨èåœ¨è¶…å‚æ•°ä¼˜åŒ–ä¸­ä½¿ç”¨**è´å¶æ–¯ä¼˜åŒ–**
      - è™½ç„¶è´å¶æ–¯ä¼˜åŒ–çš„ä¼˜åŒ–æˆæœ¬ç›¸å¯¹è¾ƒå¤§  
     ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œéƒ½è¦è®­ç»ƒä»£ç†æ¨¡å‹å¹¶ä¼˜åŒ–é‡‡é›†å‡½æ•°ï¼‰ï¼Œ  
     ä½†åœ¨è¯¸å¦‚æœºå™¨å­¦ä¹ æ¨¡å‹é‡é‡‡æ ·ç­‰å‡½æ•°è¯„ä¼°æˆæœ¬ç›¸å¯¹è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œ  
     è¿™ç§å½±å“è¾ƒå°
  - åœ¨è¶…å‚æ•°ä¼˜åŒ–é—®é¢˜æ¶‰åŠæœ‰æ„ä¹‰çš„**ä¿çœŸåº¦å‚æ•°**ï¼ˆä¾‹å¦‚ï¼Œè½®æ•°ã€æ ‘çš„æ•°é‡ã€æå‡è½®æ•°ï¼‰  
   ä¸”éœ€è¦**é«˜æ•ˆä½¿ç”¨ä¼˜åŒ–é¢„ç®—**çš„æƒ…å†µä¸‹ï¼Œ  
   åƒHyperbandè¿™æ ·çš„å¤šä¿çœŸåº¦è¶…å‚æ•°ä¼˜åŒ–ç®—æ³•å¯èƒ½å€¼å¾—è€ƒè™‘

#### è°ƒä¼˜å™¨å¤„ç†çš„ç±»å‹

- `Learner$param_classes`
  - æä¾›å¯ä»¥å¤„ç†å“ªäº›ç±»åˆ«çš„è¶…å‚æ•°
- `Learner$param_classes`
  - æä¾›å¯ä»¥å¤„ç†å“ªäº›ç‰¹æ€§

```r
tnr('grid_search')$param_classes
tnr('grid_search')$properties
```

```js
'ParamLgl''ParamInt''ParamDbl''ParamFct'
'dependencies''single-crit''multi-crit'
```

- ï¼ˆé‡æ–°å›é¡¾ä¸€ä¸‹å¦‚ä½•å»çœ‹è¶…å‚æ•°ç±»å‹ï¼‰
  - è¿™é‡Œçš„`class`å°±æ˜¯äº†

```r
lrn('classif.svm')$param_set
```

```js
<ParamSet(16)>
Key: <id>
                 id    class lower upper nlevels          default parents
             <char>   <char> <num> <num>   <num>           <list>  <list>
 1:       cachesize ParamDbl  -Inf   Inf     Inf               40  [NULL]
 2:   class.weights ParamUty    NA    NA     Inf           [NULL]  [NULL]
 3:           coef0 ParamDbl  -Inf   Inf     Inf                0  kernel
 4:            cost ParamDbl     0   Inf     Inf                1    type
 5:           cross ParamInt     0   Inf     Inf                0  [NULL]
 6: decision.values ParamLgl    NA    NA       2            FALSE  [NULL]
 7:          degree ParamInt     1   Inf     Inf                3  kernel
 8:         epsilon ParamDbl     0   Inf     Inf              0.1  [NULL]
 9:          fitted ParamLgl    NA    NA       2             TRUE  [NULL]
10:           gamma ParamDbl     0   Inf     Inf   <NoDefault[0]>  kernel
11:          kernel ParamFct    NA    NA       4           radial  [NULL]
12:              nu ParamDbl  -Inf   Inf     Inf              0.5    type
13:           scale ParamUty    NA    NA     Inf             TRUE  [NULL]
14:       shrinking ParamLgl    NA    NA       2             TRUE  [NULL]
15:       tolerance ParamDbl     0   Inf     Inf            0.001  [NULL]
16:            type ParamFct    NA    NA       2 C-classification  [NULL]
     value
    <list>
 1: [NULL]
 2: [NULL]
 3: [NULL]
 4: [NULL]
 5: [NULL]
 6: [NULL]
 7: [NULL]
 8: [NULL]
 9: [NULL]
10: [NULL]
11: [NULL]
12: [NULL]
13: [NULL]
14: [NULL]
15: [NULL]
16: [NULL]
```

```r
lrn('classif.svm')$param_set$deps
```

<table class='dataframe'>
<caption>A data.table: 5 x 3</caption>
<thead>
 <tr><th scope=col>id</th><th scope=col>on</th><th scope=col>cond</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>coef0 </td><td>kernel</td><td>polynomial    , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>cost  </td><td>type  </td><td>C-classification, %s == %s        </td></tr>
 <tr><td>degree</td><td>kernel</td><td>polynomial, %s == %s  </td></tr>
 <tr><td>gamma </td><td>kernel</td><td>polynomial    , radial        , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>nu    </td><td>type  </td><td>nu-classification, %s == %s         </td></tr>
</tbody>
</table>

#### è§¦å‘è°ƒä¼˜è¿‡ç¨‹

- è¿™ä¸ªæ˜¯ä¹‹å‰æ„å»ºå¥½çš„å®ä¾‹

```r
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚æ•°`cose`å’Œ`gamma`
 cost  = to_tune(1e-1, 1e5),
 gamma = to_tune(1e-1, 1),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚æ•°
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
```

- åˆ›å»ºè°ƒä¼˜å™¨
  - `resolution`ï¼šæ§åˆ¶ç½‘æ ¼æœç´¢ä¸­æ¯ä¸ªè¶…å‚æ•°çš„å€™é€‰å€¼æ•°é‡ï¼Œå†³å®šæœç´¢çš„ç»†è‡´ç¨‹åº¦
  - `batch_size`ï¼šæ§åˆ¶è¯„ä¼°è¶…å‚æ•°ç»„åˆæ—¶çš„åˆ†æ‰¹è§„æ¨¡ï¼Œå¹³è¡¡è®¡ç®—èµ„æºä¸æ•ˆç‡

```r
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
```

- æ¥ä¸‹æ¥ä½¿ç”¨`Tuner$optimize(TuningInstanceBatchSingleCrit)`è¿›è¡Œè°ƒä¼˜
  - ç»“æœè¿”å›äº†æœ€ä½³çš„è°ƒä¼˜å‚æ•°ï¼Œå¹¶ä¸”å‚¨å­˜åœ¨äº†  
   `TuningInstanceBatchSingleCrit$result`ä¸­

```r
tuner$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>25000.08</td><td>0.1</td><td>radial          , C-classification, 25000.075       , 0.1             </td><td>25000.08, 0.10</td><td>0.27902</td></tr>
</tbody>
</table>

```r
instance$result
instance$result$learner_param_vals
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>25000.08</td><td>0.1</td><td>radial          , C-classification, 25000.075       , 0.1             </td><td>25000.08, 0.10</td><td>0.27902</td></tr>
</tbody>
</table>

```js
$kernel
'radial'
$type
'C-classification'
$cost
25000.075
$gamma
0.1
```

### å¯¹æ•°å˜æ¢

- å¯¹äºè®¸å¤šå…·æœ‰è¾ƒå¤§ä¸Šç•Œçš„éè´Ÿè¶…å‚æ•°ï¼Œ  
  åœ¨å¯¹æ•°å°ºåº¦ä¸Šè¿›è¡Œè°ƒä¼˜å¯èƒ½æ¯”åœ¨çº¿æ€§å°ºåº¦ä¸Šæ›´æœ‰æ•ˆ
- å¯¹æ•°å˜åŒ–ä¹‹åå¯ä»¥è®©å¤‡é€‰å‚æ•°çš„èŒƒå›´æ›´é›†ä¸­

```r
cost <- runif(1000, log(1e-5), log(1e5))
exp_cost <- exp(cost)

# library(patchwork)
data.frame(x=cost) %>% ggplot(aes(x=x)) + geom_histogram() + theme_bw() & data.frame(x=exp_cost) %>% ggplot(aes(x=x)) + geom_histogram() + theme_bw()
```

![image_2](./image_2.png)

- å·¦è¾¹æ˜¯`Tuner`ä¸­é‡‡æ ·çš„ç»“æœé¢‘æ•°
- å³è¾¹

- åœ¨è°ƒä¼˜æ—¶ï¼Œåªç”¨å°†`logscale = TRUE` ä¼ é€’ç»™ `to_tune()` å³å¯

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚æ•°`cose`å’Œ`gamma`
 # é€‰æ‹©å°†å¯¹æ•°å˜æ¢çš„ç»“æœä¼ é€’ç»™`Learner`
 cost  = to_tune(1e-1, 1e5, logscale = TRUE),
 gamma = to_tune(1e-1, 1e5, logscale = TRUE),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚æ•°
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
# æ„å»ºè°ƒä¼˜å™¨
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
# è°ƒä¼˜å®ä¾‹
tuner$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1.151293</td><td>-2.302585</td><td>radial          , C-classification, 3.16227766016838, 0.1             </td><td>3.162278, 0.100000</td><td>0.2408558</td></tr>
</tbody>
</table>

- `cost`å’Œ`gamma`æ˜¯å¯¹æ•°å˜æ¢å‰çš„æœ€ä¼˜å€¼ï¼Œ  
  è€Œ`learner_param_vals`å’Œ`x_domain`åŒ…å«çš„æ˜¯æ˜¯å¯¹æ•°å˜æ¢åçš„

```r
instance$result_learner_param_vals
instance$result$learner_param_vals
```

```js
$kernel
'radial'
$type
'C-classification'
$cost
3.16227766016838
$gamma
0.1
```

```r
instance$result_x_domain
instance$result$x_domain
```

```js
$cost
3.16227766016838
$gamma
0.1
```

- å¯ä»¥ç®€å•éªŒç®—ä¸€ä¸‹ç»“æœ
  - ç»“æœå’Œä¸Šæ–¹çš„ç»“æœå®Œå…¨ä¸€è‡´

```r
instance$result$cost
exp(instance$result$cost)
```

```js
1.15129254649702
3.16227766016838
```

### åˆ†æå’Œä½¿ç”¨ç»“æœ

- è¯„ä¼°å®Œçš„ç»“æœå‚¨å­˜åœ¨`Instance$archive`é‡Œé¢
- ä¸€å…±æœ‰25ç»„ï¼Œè¿™æ˜¯å› ä¸ºè®¾å®šçš„`Tuner`çš„`resulution`æ˜¯5ï¼Œ  
  æ‰€ä»¥å¯ä»¥å¾—åˆ°$5^{2}= 25$

```r
instance$archive
```

<table class='dataframe'>
<caption>A data.table: 25 x 10</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>runtime_learners</th><th scope=col>timestamp</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>x_domain</th><th scope=col>batch_nr</th><th scope=col>resample_result</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-2.302585</td><td>11.512925</td><td>0.4665286</td><td>0.039</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e-01, 1e+05</td><td>1</td><td>&lt;environment: 0x1734a6650&gt;</td></tr>
 <tr><td> 1.151293</td><td>-2.302585</td><td>0.2408558</td><td>0.046</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 0.100000</td><td>1</td><td>&lt;environment: 0x173467a08&gt;</td></tr>
 <tr><td> 1.151293</td><td> 1.151293</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3.162278</td><td>1</td><td>&lt;environment: 0x173430338&gt;</td></tr>
 <tr><td> 1.151293</td><td> 8.059048</td><td>0.4665286</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3162.277660</td><td>1</td><td>&lt;environment: 0x1733e7c38&gt;</td></tr>
 <tr><td> 1.151293</td><td>11.512925</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278e+00, 1.000000e+05</td><td>1</td><td>&lt;environment: 0x1733b1f48&gt;</td></tr>
 <tr><td> 4.605170</td><td>-2.302585</td><td>0.2408558</td><td>0.100</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.0, 0.1</td><td>1</td><td>&lt;environment: 0x173087ad0&gt;</td></tr>
 <tr><td> 8.059048</td><td>-2.302585</td><td>0.2408558</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 0.100</td><td>1</td><td>&lt;environment: 0x17361d128&gt;</td></tr>
 <tr><td> 8.059048</td><td>11.512925</td><td>0.4665286</td><td>0.027</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 100000.000</td><td>1</td><td>&lt;environment: 0x173397c08&gt;</td></tr>
 <tr><td>11.512925</td><td>11.512925</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e+05, 1e+05</td><td>1</td><td>&lt;environment: 0x173350e78&gt;</td></tr>
 <tr><td>-2.302585</td><td>-2.302585</td><td>0.4665286</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.1, 0.1</td><td>2</td><td>&lt;environment: 0x173313660&gt;</td></tr>
 <tr><td>-2.302585</td><td> 8.059048</td><td>0.4665286</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.100, 3162.278</td><td>2</td><td>&lt;environment: 0x1732e5170&gt;</td></tr>
 <tr><td> 1.151293</td><td> 4.605170</td><td>0.4665286</td><td>0.025</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 100.000000</td><td>2</td><td>&lt;environment: 0x1732b32b0&gt;</td></tr>
 <tr><td> 4.605170</td><td> 1.151293</td><td>0.4665286</td><td>0.038</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.000000, 3.162278</td><td>2</td><td>&lt;environment: 0x1732860c8&gt;</td></tr>
 <tr><td> 8.059048</td><td> 1.151293</td><td>0.4665286</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.277660, 3.162278</td><td>2</td><td>&lt;environment: 0x171620ab0&gt;</td></tr>
 <tr><td> 8.059048</td><td> 8.059048</td><td>0.4665286</td><td>0.031</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 3162.278</td><td>2</td><td>&lt;environment: 0x1715e60b0&gt;</td></tr>
 <tr><td>11.512925</td><td> 1.151293</td><td>0.4665286</td><td>0.035</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1.000000e+05, 3.162278e+00</td><td>2</td><td>&lt;environment: 0x173054958&gt;</td></tr>
 <tr><td>11.512925</td><td> 8.059048</td><td>0.4665286</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100000.000, 3162.278</td><td>2</td><td>&lt;environment: 0x173214b00&gt;</td></tr>
 <tr><td>-2.302585</td><td> 1.151293</td><td>0.4665286</td><td>0.031</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.100000, 3.162278</td><td>3</td><td>&lt;environment: 0x1731baa20&gt;</td></tr>
 <tr><td>-2.302585</td><td> 4.605170</td><td>0.4665286</td><td>0.027</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.1, 100.0</td><td>3</td><td>&lt;environment: 0x173160e10&gt;</td></tr>
 <tr><td> 4.605170</td><td> 4.605170</td><td>0.4665286</td><td>0.026</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100, 100</td><td>3</td><td>&lt;environment: 0x1730f8d98&gt;</td></tr>
 <tr><td> 4.605170</td><td> 8.059048</td><td>0.4665286</td><td>0.040</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100.000, 3162.278</td><td>3</td><td>&lt;environment: 0x173064ba0&gt;</td></tr>
 <tr><td> 4.605170</td><td>11.512925</td><td>0.4665286</td><td>0.064</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+02, 1e+05</td><td>3</td><td>&lt;environment: 0x13a1f7410&gt;</td></tr>
 <tr><td> 8.059048</td><td> 4.605170</td><td>0.4665286</td><td>0.033</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>3162.278, 100.000</td><td>3</td><td>&lt;environment: 0x176b02dd8&gt;</td></tr>
 <tr><td>11.512925</td><td>-2.302585</td><td>0.2408558</td><td>0.035</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e-01</td><td>3</td><td>&lt;environment: 0x176c46388&gt;</td></tr>
 <tr><td>11.512925</td><td> 4.605170</td><td>0.4665286</td><td>0.039</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e+02</td><td>3</td><td>&lt;environment: 0x176bf3e68&gt;</td></tr>
</tbody>
</table>

- å¯ä»¥æ ¹æ®ä¸åŒçš„æ€§èƒ½æŒ‡æ ‡å¯¹å†…éƒ¨`ResampleResult`è¿›è¡Œè¯„åˆ†
  - zhe lè¿™é‡Œæ˜¯è€ƒå¯Ÿæ¼æŠ¥ç‡ã€è¯¯æŠ¥ç‡ä»¥åŠåˆ†ç±»é”™è¯¯

```r
as.data.table(
 instance$archive,
 measures = msrs(c('classif.fpr', 'classif.fnr'))
)
```

<table class='dataframe'>
<caption>A data.table: 25 x 12</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>classif.fpr</th><th scope=col>classif.fnr</th><th scope=col>runtime_learners</th><th scope=col>timestamp</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>x_domain</th><th scope=col>batch_nr</th><th scope=col>resample_result</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-2.302585</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.039</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e-01, 1e+05</td><td>1</td><td>&lt;environment: 0x17b2d4438&gt;</td></tr>
 <tr><td> 1.151293</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.046</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 0.100000</td><td>1</td><td>&lt;environment: 0x17b2bce48&gt;</td></tr>
 <tr><td> 1.151293</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3.162278</td><td>1</td><td>&lt;environment: 0x17b2a6070&gt;</td></tr>
 <tr><td> 1.151293</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 3162.277660</td><td>1</td><td>&lt;environment: 0x17b288a58&gt;</td></tr>
 <tr><td> 1.151293</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278e+00, 1.000000e+05</td><td>1</td><td>&lt;environment: 0x17b2719e0&gt;</td></tr>
 <tr><td> 4.605170</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.100</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.0, 0.1</td><td>1</td><td>&lt;environment: 0x17b254208&gt;</td></tr>
 <tr><td> 8.059048</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 0.100</td><td>1</td><td>&lt;environment: 0x17b23cb00&gt;</td></tr>
 <tr><td> 8.059048</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.027</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 100000.000</td><td>1</td><td>&lt;environment: 0x17b19f510&gt;</td></tr>
 <tr><td>11.512925</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1e+05, 1e+05</td><td>1</td><td>&lt;environment: 0x17b17e0e0&gt;</td></tr>
 <tr><td>-2.302585</td><td>-2.302585</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.1, 0.1</td><td>2</td><td>&lt;environment: 0x17b1639e0&gt;</td></tr>
 <tr><td>-2.302585</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.026</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>0.100, 3162.278</td><td>2</td><td>&lt;environment: 0x17b140828&gt;</td></tr>
 <tr><td> 1.151293</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.025</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3.162278, 100.000000</td><td>2</td><td>&lt;environment: 0x17b1184e0&gt;</td></tr>
 <tr><td> 4.605170</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.038</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100.000000, 3.162278</td><td>2</td><td>&lt;environment: 0x17b0ffee8&gt;</td></tr>
 <tr><td> 8.059048</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.030</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.277660, 3.162278</td><td>2</td><td>&lt;environment: 0x17b0e54d8&gt;</td></tr>
 <tr><td> 8.059048</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.031</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>3162.278, 3162.278</td><td>2</td><td>&lt;environment: 0x17b0c9120&gt;</td></tr>
 <tr><td>11.512925</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.035</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>1.000000e+05, 3.162278e+00</td><td>2</td><td>&lt;environment: 0x17b0ae860&gt;</td></tr>
 <tr><td>11.512925</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.029</td><td>2025-06-17 14:29:56</td><td>0</td><td>0</td><td>100000.000, 3162.278</td><td>2</td><td>&lt;environment: 0x17b0978c8&gt;</td></tr>
 <tr><td>-2.302585</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.031</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.100000, 3.162278</td><td>3</td><td>&lt;environment: 0x17b07ce80&gt;</td></tr>
 <tr><td>-2.302585</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.027</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>0.1, 100.0</td><td>3</td><td>&lt;environment: 0x17b062f60&gt;</td></tr>
 <tr><td> 4.605170</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.026</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100, 100</td><td>3</td><td>&lt;environment: 0x17b049820&gt;</td></tr>
 <tr><td> 4.605170</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.040</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>100.000, 3162.278</td><td>3</td><td>&lt;environment: 0x17b02c320&gt;</td></tr>
 <tr><td> 4.605170</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.064</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+02, 1e+05</td><td>3</td><td>&lt;environment: 0x17b015b30&gt;</td></tr>
 <tr><td> 8.059048</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.033</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>3162.278, 100.000</td><td>3</td><td>&lt;environment: 0x1797f0da0&gt;</td></tr>
 <tr><td>11.512925</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td><td>0.035</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e-01</td><td>3</td><td>&lt;environment: 0x1797d1698&gt;</td></tr>
 <tr><td>11.512925</td><td> 4.605170</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td><td>0.039</td><td>2025-06-17 14:29:57</td><td>0</td><td>0</td><td>1e+05, 1e+02</td><td>3</td><td>&lt;environment: 0x1797b2a90&gt;</td></tr>
</tbody>
</table>

- åªæŒ‘å‰äº”ä¸ªçš„ä¸€éƒ¨åˆ†

```r
as.data.table(
 instance$archive,
 measures = msrs(c('classif.fpr', 'classif.fnr'))
)[1:5 ,.(cost, gamma, classif.ce, classif.fpr, classif.fnr)]
```

<table class='dataframe'>
<caption>A data.table: 5 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>classif.fpr</th><th scope=col>classif.fnr</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-2.302585</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
 <tr><td> 1.151293</td><td>-2.302585</td><td>0.2408558</td><td>0.4606607</td><td>0.03397436</td></tr>
 <tr><td> 1.151293</td><td> 1.151293</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
 <tr><td> 1.151293</td><td> 8.059048</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
 <tr><td> 1.151293</td><td>11.512925</td><td>0.4665286</td><td>1.0000000</td><td>0.00000000</td></tr>
</tbody>
</table>

- `Instance$archive$benchmark_result`ä¸­å‚¨å­˜äº†æ‰€æœ‰çš„`BenchmarkResult`å¯¹è±¡

```r
{instance$archive$benchmark_result %>% as.data.table()}[1:5]
```

<table class='dataframe'>
<caption>A data.table: 5 x 9</caption>
<thead>
 <tr><th scope=col>uhash</th><th scope=col>task</th><th scope=col>learner</th><th scope=col>resampling</th><th scope=col>iteration</th><th scope=col>prediction</th><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>resampling_id</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>e31b69c6-41d4-4d7f-81c2-ed3b4bd3b75f</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x3064c38c0&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>1</td><td>&lt;environment: 0x3202d2ac0&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>e31b69c6-41d4-4d7f-81c2-ed3b4bd3b75f</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x306425260&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>2</td><td>&lt;environment: 0x32023dcf0&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>e31b69c6-41d4-4d7f-81c2-ed3b4bd3b75f</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x30a0e4660&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>3</td><td>&lt;environment: 0x32019c9d0&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>5413c20f-f67c-4741-bc1e-6535ac83e266</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x300847120&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>1</td><td>&lt;environment: 0x320379c40&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
 <tr><td>5413c20f-f67c-4741-bc1e-6535ac83e266</td><td>&lt;environment: 0x17cd32908&gt;</td><td>&lt;environment: 0x31f42b8c0&gt;</td><td>&lt;environment: 0x17269e738&gt;</td><td>2</td><td>&lt;environment: 0x17ede9278&gt;</td><td>sonar</td><td>classif.svm</td><td>cv</td></tr>
</tbody>
</table>

- å¯ä»¥å°†`type = 'surface'`ä¼ é€’ç»™`autoplot.TuningInstanceBatchSingleCrit`æ¥å¯è§†åŒ–å®ä¾‹è°ƒä¼˜çš„ç»“æœ
  - è“è‰²çš„åŒºåŸŸè¡¨ç¤º`classif.ce`è¯„ä¼°å™¨çš„è¾ƒå°ç»“æœï¼Œè¡¨æ˜æ¨¡å‹æ›´ä¼˜

```r
autoplot(instance, type = 'surface')
```

![image_3](./image_3.png)

### è®­ç»ƒä¼˜åŒ–æ¨¡å‹

- å½“ç¡®å®šå¥½è¶…å‚æ•°åï¼Œå°†`Instance`ä¸­çš„è¶…å‚æ•°ä¼ é€’ç»™æ–°å»ºå­¦ä¹ å™¨ä¸­

```r
lrn_svm_tuned <- lrn('classif.svm')
lrn_svm_tuned$param_set$values <- instance$result_learner_param_vals
```

- ä¹‹åè¿›è¡Œæœ€åŸºç¡€çš„è®­ç»ƒæµç¨‹å³å¯

```r
lrn_svm_tuned$train(tsk_sonar)$model
```

```r
Call:
svm.default(x = data, y = task$truth(), type = 'C-classification', 
    kernel = 'radial', gamma = 0.1, cost = 3.16227766016838, probability = (self$predict_type == 
        'prob'))


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  radial 
       cost:  3.162278 

Number of Support Vectors:  205
```

---

## æ›´ä¾¿æ·çš„è°ƒä¼˜æ–¹æ³•

- åŸºæœ¬è°ƒä¼˜æ–¹æ³•ä¸­ç”¨çš„æ˜¯`ti()`åˆ›å»ºè°ƒä¼˜å®ä¾‹ï¼Œ  
  ä¹‹åç”¨`Tuner$optimize()`è¿›è¡Œè°ƒä¼˜

### `tune()`

- `tune()`å¯ä»¥åœ¨åˆ›å»ºå®ä¾‹åç›´æ¥è¿›è¡Œè°ƒä¼˜ï¼Œ  
  çœç•¥æ‰‹åŠ¨å…ˆåˆ›å»ºè°ƒä¼˜å®ä¾‹ï¼Œå
- ä¸‹é¢çš„ä¾‹å­å¯ä»¥è¿›è¡Œç®€å•çš„å¯¹æ¯”

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')

# ---------------ä¹‹å‰çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚æ•°`cose`å’Œ`gamma`
 # é€‰æ‹©å°†å¯¹æ•°å˜æ¢çš„ç»“æœä¼ é€’ç»™`Learner`
 cost  = to_tune(1e-1, 1e5, logscale = TRUE),
 gamma = to_tune(1e-1, 1e5, logscale = TRUE),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚æ•°
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
# æ„å»ºè°ƒä¼˜å™¨
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
# è°ƒä¼˜å®ä¾‹
tuner$optimize(instance)

# ---------------`tune()`çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
lrn_svm <- lrn('classif.svm',
  cost  = to_tune(1e-5, 1e5, logscale = TRUE),
  gamma = to_tune(1e-5, 1e5, logscale = TRUE),
  kernel = 'radial',
  type = 'C-classification'
)
# [æ„å»ºè°ƒä¼˜å™¨]
# éœ€è¦å…ˆæ„å»ºè°ƒä¼˜å™¨ï¼Œä¹‹åä¼ é€’åˆ°`tune()`ä¸­
tnr_grid_search <- tnr('grid_search', resolution = 5, batch_size = 5)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <- tune(
 # [è¿™é‡Œå¤šäº†`tuner`å‚æ•°]
 # æ‰€ä»¥å…ˆæ„å»ºçš„è°ƒä¼˜å™¨ï¼Œåä¼ é€’åˆ°`tune()`ä¸­
 # ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥`tnr('grid_search', resolution = 5, batch_size = 5)`
 tuner = tnr_grid_search,
 task = tsk_sonar,
 learner = lrn_svm,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce')
)
instance$result
```

### `auto_tune()`

- `auto_tune()` åˆ›å»ºä¸€ä¸ª`AutoTuner`ç±»çš„å¯¹è±¡
- `AutoTuner`ç»§æ‰¿è‡ªLearnerç±»ï¼Œå¹¶å°è£…äº†è°ƒä¼˜æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œ  
  è¿™æ„å‘³ç€`AutoTuner`å°±æ˜¯ä¸€ä¸ª`Learner`
- åœ¨åº•å±‚ï¼Œ`AutoTuner`æœ¬è´¨ä¸Šæ˜¯åœ¨è°ƒç”¨`Learner$train()`æ—¶ä¼ é€’ç»™æ¨¡å‹çš„æ•°æ®ä¸Šè¿è¡Œ`tune()`ï¼Œç„¶åå°†`Learner$param_set`å‚æ•°è®¾ç½®ä¸ºæœ€ä¼˜é…ç½®

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')

# ---------------ä¹‹å‰çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
learner <-  lrn('classif.svm',
 # æŒ‡å®šè°ƒä¼˜çš„è¶…å‚æ•°`cose`å’Œ`gamma`
 # é€‰æ‹©å°†å¯¹æ•°å˜æ¢çš„ç»“æœä¼ é€’ç»™`Learner`
 cost  = to_tune(1e-1, 1e5, logscale = TRUE),
 gamma = to_tune(1e-1, 1e5, logscale = TRUE),
 # è®¾ç½®å…¶ä»–çš„è¶…å‚æ•°
 kernel = 'radial',
 type = 'C-classification'
)
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <-  ti(
 task = tsk_sonar,
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('none')
)
# æ„å»ºè°ƒä¼˜å™¨
tuner <- tnr('grid_search', resolution = 5, batch_size = 10)
# è°ƒä¼˜å®ä¾‹
tuner$optimize(instance)

# ---------------`auto_tune()`çš„æ–¹æ³•
# æ„å»ºå­¦ä¹ å™¨
lrn_svm <- lrn('classif.svm',
 cost  = to_tune(1e-5, 1e5, logscale = TRUE),
 gamma = to_tune(1e-5, 1e5, logscale = TRUE),
 kernel = 'radial',
 type = 'C-classification'
)
# [æ„å»ºè°ƒä¼˜å™¨]
# éœ€è¦å…ˆæ„å»ºè°ƒä¼˜å™¨ï¼Œä¹‹åä¼ é€’åˆ°`auto_tune()`ä¸­
tnr_grid_search <- tnr('grid_search', resolution = 5, batch_size = 5)
# åˆ›å»º`AutoTuner`
at <- auto_tuner(
 tuner = tnr_grid_search,
 learner = lrn_svm,
 resampling = rsmp('cv', folds = 3),
 measure = msr('classif.ce')
)
# åˆ†å‰²`Task`çš„æ•°æ®
split <- partition(tsk_sonar) 
# è®­ç»ƒæ¨¡å‹ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è‡ªåŠ¨è°ƒä¼˜é€‰æ‹©å‡ºæœ€ä½³çš„è¶…å‚æ•°
at$train(tsk_sonar, row_ids = split$train) 
# é¢„æµ‹æ¨¡å‹ï¼Œè·å¾—è¯„ä¼°ç»“æœ
pred <- at$predict(tsk_sonar, row_ids = split$test)
pred$score()
```

```js
classif.ce: 0.159420289855072
```

- `AutoTuner`ä¸­è¿˜åŒ…å«ä¸€ä¸ªè°ƒä¼˜å®ä¾‹`Intance`
  - ç”¨æ³•å’Œå‰è¿°ä¸€æ ·

```r
at$tuning_instance$result %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>11.51293</td><td>-5.756463</td><td>radial             , C-classification   , 1e+05              , 0.00316227766016838</td><td>1.000000e+05, 3.162278e-03</td><td>0.2008942</td></tr>
</tbody>
</table>

![image_4](./image_4.png)

> Illustration of an Auto-Tuner.

---

## åµŒå¥—é‡é‡‡æ ·ï¼ˆNested Resamplingï¼‰

### ç®€ä»‹

- è¶…å‚æ•°ä¼˜åŒ–åœ¨ä¸è¿›è¡Œé¢å¤–çš„é‡é‡‡æ ·æ—¶ä¼šäº§ç”Ÿè®­ç»ƒè¯¯å·®å¯¼è‡´çš„ä¹è§‚åå·®

![image_5](./image_5.png)

> åµŒå¥—é‡é‡‡æ ·ç¤ºæ„å›¾å¤§å—ä»£è¡¨ç”¨äºæ¨¡å‹è¯„ä¼°çš„å¤–éƒ¨é‡é‡‡æ ·çš„ä¸‰æŠ˜äº¤å‰éªŒè¯ï¼Œå°å—ä»£è¡¨ç”¨äºè°ƒä¼˜çš„å†…éƒ¨é‡é‡‡æ ·çš„å››æŠ˜äº¤å‰éªŒè¯æµ…è“è‰²å—ä¸ºè®­ç»ƒé›†ï¼Œæ·±è“è‰²å—ä¸ºæµ‹è¯•é›†

- çœ‹ç€æŒºæŒºå¤æ‚çš„ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼š
  - å…¶å®å°±æ˜¯å…ˆå¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œ3æŠ˜äº¤å‰éªŒè¯çš„åˆ‡åˆ†ï¼Œ  
   è¿™ä¸ªé‡Œé¢2/3çš„ç”¨äºè®­ç»ƒé›†ï¼Œ1/3çš„ç”¨äºéªŒè¯é›†  
   ï¼ˆæœ¬è´¨æ˜¯æµ‹è¯•é›†ï¼Œä¸è¿‡ä¸€èˆ¬æµ‹è¯•é›†æ˜¯çº¯ç”¨äºæµ‹è¯•çš„é‚£ç§ï¼‰ï¼Œ
   è¿™ä¸ªéƒ¨åˆ†å«**å¤–éƒ¨é‡é‡‡æ ·ï¼ˆouter resamplingï¼‰**
    - å¯¹2/3è®­ç»ƒé›†ä¸­å†è¿›è¡Œ4æŠ˜äº¤å‰éªŒè¯çš„åˆ‡åˆ†ï¼Œ  
    è¿™ä¸ªéƒ¨åˆ†å«**å†…éƒ¨é‡é‡‡æ ·ï¼ˆinner resamplingï¼‰**
    - å†…éƒ¨é‡é‡‡æ ·è®­ç»ƒå‡ºæ¥çš„Nä¸ªæ¨¡å‹ç”¨å¤–éƒ¨çš„éªŒè¯é›†è¿›è¡Œè¯„ä¼°ï¼Œ  
    é€‰å‡ºæœ€ä½³è¶…å‚æ•°ï¼Œ  
    è¿™ä¸ªéƒ¨åˆ†å«**è¶…å‚æ•°ä¼˜åŒ–ï¼ˆHPOï¼‰**
      - Nå–å†³äºè¶…å‚æ•°ä¸ªæ•°ä»¥åŠç½‘æ ¼æœç´¢åˆ†è¾¨ç‡ï¼Œ  
     2ä¸ªè¶…å‚æ•°ï¼Œç½‘æ ¼æœç´¢åˆ†è¾¨ç‡ä¸º2å°±æ˜¯$2^2=4$ï¼Œ  
     2ä¸ªè¶…å‚æ•°ï¼Œç½‘æ ¼æœç´¢åˆ†è¾¨ç‡ä¸º3å°±æ˜¯$3^2=9$ï¼Œ  
     è¿™ä¸ªç»“æœå†ä¹˜ä»¥å†…éƒ¨é‡é‡‡æ ·çš„kå€¼
      - æœ¬ä¾‹ä¸­å‡è®¾å†…éƒ¨é‡é‡‡æ ·æ˜¯4æŠ˜ï¼Œ2ä¸ªå‚æ•°ï¼Œ2ä¸ªç½‘æ ¼ï¼Œ  
     é‚£ä¹ˆå…±äº§ç”Ÿ $4\times2^2=16$ ä¸ªæ¨¡å‹
      - è¿™äº›æ¨¡å‹ä¸ç›´æ¥ç”¨äº1/3æ•°æ®çš„éªŒè¯é›†ï¼Œ  
     è€Œæ˜¯ç”¨å†…éƒ¨é‡é‡‡æ ·çš„å°éªŒè¯é›†è¿›è¡Œæ€§èƒ½è¯„ä¼°ï¼Œ  
     æœ€ç»ˆé€‰å‡º16ä¸ªæ¨¡å‹é‡Œåœ¨è‡ªå·±å°éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹çš„è¶…å‚æ•°
    - ç”¨é€‰æ‹©çš„è¶…å‚æ•°åœ¨**æ•´ä¸ª**2/3æ•°æ®çš„çš„è®­ç»ƒé›†è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œ  
    å†åœ¨1/3æ•°æ®çš„æµ‹è¯•é›†ä¸Šè¿›è¡Œæ¨¡å‹è¯„ä¼°
  - ä¸Šè¿°ä¸€è½®çš„å†…å¤–é‡é‡‡æ ·ç»“æŸåï¼Œå†é‡å¤ä¸¤è½®
  - ä¸‰æ¬¡ç»“æŸåï¼Œè·å¾—æœ€ç»ˆ3ä¸ªæ¨¡å‹ï¼Œ  
   æœ€è¿™ä¸‰ä¸ªæ¨¡å‹è¿›è¡Œç»¼åˆè¯„ä¼°å¹¶é€‰æ‹©æœ€ä½³å‚æ•°å»ºæ¨¡ï¼Œ  
   å¹¶æœ€ç»ˆç”¨æµ‹è¯•é›†è¯„ä¼°æœ€ç»ˆæ€§èƒ½

- **æ³¨æ„**ï¼šåµŒå¥—é‡é‡‡æ ·çš„è®¡ç®—æˆæœ¬å¾ˆé«˜
  - æ­£å¦‚ä¸Šæ‰€è¿°ï¼Œè¶…å‚æ•°çš„ä¸ªæ•°å’Œç½‘æ ¼æ•°åˆ†è¾¨ç‡å†³å®šäº†è®­ç»ƒæ¨¡å‹çš„è¿­ä»£æ¬¡æ•°ï¼›  
   å¦‚æœ2è¶…å‚æ•°å¤–3æŠ˜å†…4æŠ˜ä¸º5çš„åˆ†è¾¨ç‡ï¼Œé‚£ä¹ˆæ€»å…±éœ€è¦è¿­ä»£ $3\times4\times5^{2}= 300$æ¬¡
  - å¦‚æœè®¡ç®—èµ„æºæ”¯æŒï¼Œå¯ä»¥é€šè¿‡å¹¶è¡ŒåŒ–æé«˜é€Ÿåº¦

### ä½¿ç”¨`auto_tuner()`è¿›è¡ŒåµŒå¥—é‡é‡‡æ ·

- åªéœ€å°† `AutoTuner` ä¼ é€’ç»™ `resample()`æˆ– `benchmark()` å³å¯

```r
# è°ƒå–ä»»åŠ¡
tsk_sonar <-  tsk('sonar')
# æ„å»ºå­¦ä¹ å™¨
lrn_svm <- lrn('classif.svm',
 cost  = to_tune(1e-5, 1e5, logscale = TRUE),
 gamma = to_tune(1e-5, 1e5, logscale = TRUE),
 kernel = 'radial',
 type = 'C-classification'
)
# æ„å»ºè°ƒä¼˜å™¨
tnr_grid_search <- tnr('grid_search', resolution = 5, batch_size = 5)
# æ„å»º`AutoTuner`
at <- auto_tuner(
 tuner = tnr_grid_search,
 learner = lrn_svm,
 # æ„å»ºå†…éƒ¨`Resampling`
 resampling = rsmp('cv', folds = 4),
 measure = msr('classif.ce')
)
# æ„å»ºå¤–éƒ¨`Resampling`
rsmp_cv3 <- rsmp('cv', folds = 3)
# å°†`AutoTuner`ä¼ é€’ç»™`resample()`
# è¿™é‡Œçš„`store_models=TRUE`ä»…èƒ½å‚¨å­˜å¤–éƒ¨é‡é‡‡æ ·çš„3ä¸ªæ¨¡å‹
rr <- resample(tsk_sonar, at, rsmp_cv3, store_models = TRUE)
# æ‰“å°
rr
```

```js
[36m--[39m [1m[34m<ResampleResult>[39m with [34m3[39m resampling iterations[22m [36m-------------------------------[39m
 task_id        learner_id resampling_id iteration     prediction_test warnings
   sonar classif.svm.tuned            cv         1 <PredictionClassif>        0
   sonar classif.svm.tuned            cv         2 <PredictionClassif>        0
   sonar classif.svm.tuned            cv         3 <PredictionClassif>        0
 errors
      0
      0
      0
```

- æŸ¥çœ‹æœ€ç»ˆæ¨¡å‹çš„

```r
rr$aggregate()
```

```js
classif.ce: 0.163285024154589
```

- `extract_inner_tuning_results(ResampleResult)` è¿”å›å¤–éƒ¨é‡é‡‡æ ·çš„å…¨éƒ¨ç»“æœ  
- `extract_inner_tuning_archives(ResampleResult)` è¿”å›å†…å¤–éƒ¨é‡é‡‡æ ·çš„å…¨éƒ¨ç»“æœ

```r
extract_inner_tuning_results(rr)
```

<table class='dataframe'>
<caption>A data.table: 3 x 9</caption>
<thead>
 <tr><th scope=col>iteration</th><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>resampling_id</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1</td><td>5.756463</td><td> -5.756463</td><td>0.1882353</td><td>radial             , C-classification   , 316.227766016838   , 0.00316227766016838</td><td>3.162278e+02, 3.162278e-03</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td>5.756463</td><td>-11.512925</td><td>0.2376050</td><td>radial          , C-classification, 316.227766016838, 1e-05           </td><td>316.22777, 0.00001</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>5.756463</td><td> -5.756463</td><td>0.2006303</td><td>radial             , C-classification   , 316.227766016838   , 0.00316227766016838</td><td>3.162278e+02, 3.162278e-03</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
</tbody>
</table>

```r
extract_inner_tuning_archives(rr)
```

<table class='dataframe'>
<caption>A data.table: 75 x 15</caption>
<thead>
 <tr><th scope=col>iteration</th><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>classif.ce</th><th scope=col>x_domain_cost</th><th scope=col>x_domain_gamma</th><th scope=col>runtime_learners</th><th scope=col>timestamp</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>batch_nr</th><th scope=col>resample_result</th><th scope=col>task_id</th><th scope=col>learner_id</th><th scope=col>resampling_id</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>1.000000e-05</td><td>3.162278e+02</td><td>0.088</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec87bc8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> -5.756463</td><td>0.2689076</td><td>1.000000e+00</td><td>3.162278e-03</td><td>0.042</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec63f78&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>1.000000e+00</td><td>1.000000e+00</td><td>0.074</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec47d10&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>-11.512925</td><td>0.3126050</td><td>3.162278e+02</td><td>1.000000e-05</td><td>0.033</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ec1b1c8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>3.162278e+02</td><td>1.000000e+00</td><td>0.035</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16ebf3920&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td> -5.756463</td><td>0.4632353</td><td>3.162278e-03</td><td>3.162278e-03</td><td>0.026</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16ebda1e0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>3.162278e-03</td><td>1.000000e+00</td><td>0.029</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eba3970&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>3.162278e-03</td><td>3.162278e+02</td><td>0.037</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eb76288&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> 11.512925</td><td>0.4632353</td><td>1.000000e+00</td><td>1.000000e+05</td><td>0.028</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eb1ca18&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>1.000000e+05</td><td>3.162278e+02</td><td>0.034</td><td>2025-06-17 23:57:50</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x16eaf0358&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td> -5.756463</td><td>0.4632353</td><td>1.000000e-05</td><td>3.162278e-03</td><td>0.035</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16eac7780&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>1.000000e-05</td><td>1.000000e+00</td><td>0.029</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16e7cc3a0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td> 11.512925</td><td>0.4632353</td><td>1.000000e-05</td><td>1.000000e+05</td><td>0.055</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x134617800&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>1.000000e+00</td><td>3.162278e+02</td><td>0.044</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x164f9f808&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4632353</td><td>1.000000e+05</td><td>1.000000e+00</td><td>0.039</td><td>2025-06-17 23:57:51</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x164f80080&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td> 11.512925</td><td>0.4632353</td><td>3.162278e-03</td><td>1.000000e+05</td><td>0.029</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164f5c5f8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> -5.756463</td><td>0.1882353</td><td>3.162278e+02</td><td>3.162278e-03</td><td>0.025</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164f362f0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> 11.512925</td><td>0.4632353</td><td>3.162278e+02</td><td>1.000000e+05</td><td>0.050</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164f0c570&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td> -5.756463</td><td>0.1882353</td><td>1.000000e+05</td><td>3.162278e-03</td><td>0.024</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164eec7c8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td> 11.512925</td><td>0.4632353</td><td>1.000000e+05</td><td>1.000000e+05</td><td>0.792</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x164ec0b48&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td>-11.512925</td><td>-11.512925</td><td>0.4632353</td><td>1.000000e-05</td><td>1.000000e-05</td><td>0.030</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e8ab88&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> -5.756463</td><td>-11.512925</td><td>0.4632353</td><td>3.162278e-03</td><td>1.000000e-05</td><td>0.029</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e5e2d0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>-11.512925</td><td>0.4632353</td><td>1.000000e+00</td><td>1.000000e-05</td><td>0.043</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e34400&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4632353</td><td>3.162278e+02</td><td>3.162278e+02</td><td>0.074</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164e02020&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>1</td><td> 11.512925</td><td>-11.512925</td><td>0.2542017</td><td>1.000000e+05</td><td>1.000000e-05</td><td>0.026</td><td>2025-06-17 23:57:52</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164de4160&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> -5.756463</td><td>-11.512925</td><td>0.4672269</td><td>3.162278e-03</td><td>1.000000e-05</td><td>0.030</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e41f860&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>1.000000e+00</td><td>3.162278e+02</td><td>0.050</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e3e9f40&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>3.162278e+02</td><td>3.162278e+02</td><td>0.035</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e3c77f8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>1.000000e+05</td><td>3.162278e+02</td><td>0.032</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x1345eef68&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> 11.512925</td><td> 11.512925</td><td>0.4672269</td><td>1.000000e+05</td><td>1.000000e+05</td><td>0.029</td><td>2025-06-17 23:57:53</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x1345c8a18&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
 <tr><td>2</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>1.000000e-05</td><td>3.162278e+02</td><td>0.027</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164ca6460&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> -5.756463</td><td> -5.756463</td><td>0.4672269</td><td>3.162278e-03</td><td>3.162278e-03</td><td>0.029</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x164c86108&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4672269</td><td>3.162278e-03</td><td>3.162278e+02</td><td>0.023</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x13452b258&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4672269</td><td>1.000000e+00</td><td>1.000000e+00</td><td>0.026</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x1345010e8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>2</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4672269</td><td>1.000000e+05</td><td>1.000000e+00</td><td>0.028</td><td>2025-06-17 23:57:54</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x1344dd2a8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>1.000000e-05</td><td>1.000000e+00</td><td>0.033</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e8c96d8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>3.162278e-03</td><td>1.000000e+00</td><td>0.042</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e8a5b28&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> -5.756463</td><td>0.2518908</td><td>1.000000e+00</td><td>3.162278e-03</td><td>0.025</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x16e87db78&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>3.162278e+02</td><td>1.000000e+00</td><td>0.026</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x164b0ec00&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td>-11.512925</td><td>0.2371849</td><td>1.000000e+05</td><td>1.000000e-05</td><td>0.051</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>1</td><td>&lt;environment: 0x164aede90&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td> -5.756463</td><td>0.4680672</td><td>1.000000e-05</td><td>3.162278e-03</td><td>0.027</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164aadb78&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td> 11.512925</td><td>0.4680672</td><td>1.000000e-05</td><td>1.000000e+05</td><td>0.026</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a8cee8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>3.162278e-03</td><td>3.162278e+02</td><td>0.024</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a46ef8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> -5.756463</td><td>0.2006303</td><td>3.162278e+02</td><td>3.162278e-03</td><td>0.024</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a275b0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>3.162278e+02</td><td>3.162278e+02</td><td>0.025</td><td>2025-06-17 23:57:55</td><td>0</td><td>0</td><td>2</td><td>&lt;environment: 0x164a0a2e0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td>-11.512925</td><td>0.4823529</td><td>3.162278e-03</td><td>1.000000e-05</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x1649ea238&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td> -5.756463</td><td>0.4680672</td><td>3.162278e-03</td><td>3.162278e-03</td><td>0.030</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x1649d0c80&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> -5.756463</td><td> 11.512925</td><td>0.4680672</td><td>3.162278e-03</td><td>1.000000e+05</td><td>0.052</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x1649b6c10&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>-11.512925</td><td>0.4823529</td><td>1.000000e+00</td><td>1.000000e-05</td><td>0.029</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16e865190&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td> 11.512925</td><td>0.4680672</td><td>1.000000e+00</td><td>1.000000e+05</td><td>0.028</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>3</td><td>&lt;environment: 0x16e84baf8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td>-11.512925</td><td>0.4823529</td><td>1.000000e-05</td><td>1.000000e-05</td><td>0.037</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x16e82a278&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td>-11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>1.000000e-05</td><td>3.162278e+02</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133ff9c88&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>-11.512925</td><td>0.2802521</td><td>3.162278e+02</td><td>1.000000e-05</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133fde710&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td> 11.512925</td><td>0.4680672</td><td>3.162278e+02</td><td>1.000000e+05</td><td>0.026</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133fc2fd0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>1.000000e+05</td><td>3.162278e+02</td><td>0.027</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>4</td><td>&lt;environment: 0x133f06cb0&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>1.000000e+00</td><td>1.000000e+00</td><td>0.025</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x133eca480&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td><span style=white-space:pre-wrap>  5.756463</span></td><td>0.4680672</td><td>1.000000e+00</td><td>3.162278e+02</td><td>0.024</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x133e9dd28&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td> -5.756463</td><td>0.2006303</td><td>1.000000e+05</td><td>3.162278e-03</td><td>0.033</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x133e7f238&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td><span style=white-space:pre-wrap>  0.000000</span></td><td>0.4680672</td><td>1.000000e+05</td><td>1.000000e+00</td><td>0.029</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x16e33a6d8&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
 <tr><td>3</td><td> 11.512925</td><td> 11.512925</td><td>0.4680672</td><td>1.000000e+05</td><td>1.000000e+05</td><td>0.027</td><td>2025-06-17 23:57:56</td><td>0</td><td>0</td><td>5</td><td>&lt;environment: 0x16e319e18&gt;</td><td>sonar</td><td>classif.svm.tuned</td><td>cv</td></tr>
</tbody>
</table>

### è¯„ä¼°æ€§èƒ½çš„æ­£ç¡®ï¼ˆä¸é”™è¯¯ï¼‰æ–¹å¼

- è¿™é‡Œè¿›è¡Œä¸€ä¸ªå¯¹æ¯”ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆè¦ç”¨åµŒå¥—é‡é‡‡æ ·è€Œä¸æ˜¯ç®€å•çš„æ— åµŒå¥—é‡é‡‡æ ·

```r
# ---------------å‡†å¤‡æ•°æ®
# è®¾ç½®éšæœºæ•°ç§å­
set.seed(5)
# æ„å»ºå­¦ä¹ å™¨
lrn_xgboost <- lrn(
 # é€‰æ‹©xgboostç®—æ³•ä½œä¸ºå­¦ä¹ å™¨
 'classif.xgboost',
 # è®¾ç½®è¶…å‚æ•°çš„é€‰æ‹©èŒƒå›´
 eta = to_tune(1e-4, 1, logscale = TRUE),
 max_depth = to_tune(1, 20),
 colsample_bytree  = to_tune(1e-1, 1),
 colsample_bylevel = to_tune(1e-1, 1),
 lambda = to_tune(1e-3, 1e3, logscale = TRUE),
 alpha = to_tune(1e-3, 1e3, logscale = TRUE),
 subsample = to_tune(1e-1, 1)
)
# æ„å»ºä»»åŠ¡ç”Ÿæˆå™¨ï¼Œå‘½åä¸º'moons'
tsk_moons <- tgen('moons')
# éšæœºç”Ÿæˆ100ä¸ªè®­ç»ƒæ ·æœ¬å’Œ1000000ä¸ªæµ‹è¯•æ ·æœ¬
tsk_moons_train <- tsk_moons$generate(100)
tsk_moons_test <- tsk_moons$generate(1000000)
# æ„å»ºè¯„ä¼°å™¨
msr_ce <- msr('classif.ce')
# è°ƒä¼˜å™¨ç”¨éšæœºæœç´¢æ³•
tnr_random <- tnr('random_search')
# ä½¿ç”¨ç•™å‡ºæ³•é‡é‡‡æ ·
rsmp_holdout <- rsmp('holdout')
# è®¾ç½®ç»ˆæ­¢å™¨ï¼Œä½¿ç”¨æ¬¡æ•°é™åˆ¶æ³•ï¼Œéšæœºæœç´¢700æ¬¡ç»ˆæ­¢
trm_evals700 <- trm('evals', n_evals = 700)

# -------æ— åµŒå¥—é‡é‡‡æ ·
# ä½¿ç”¨`tune()`è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <- tune(
 tuner = tnr_random,
 task = tsk_moons_train,
 learner = lrn_xgboost,
 resampling = rsmp_holdout,
 measures = msr_ce,
 terminator = trm_evals700
)
# è®°å½•æœ€ä¼˜å‚æ•°åœ¨è°ƒä¼˜é›†ä¸Šçš„æ€§èƒ½
insample <- instance$result_y

# -------åµŒå¥—é‡é‡‡æ ·
# ä½¿ç”¨`auto_tuner()`åˆ›å»ºä¸€ä¸ªè°ƒä¼˜å­¦ä¹ å™¨`AutoTuner`
at <- auto_tuner(
 tuner = tnr_random,
 learner = lrn_xgboost,
 # è¿™é‡Œçš„ç•™å‡ºæ³•ç”¨äºå†…éƒ¨é‡é‡‡æ ·
 resampling = rsmp_holdout,
 measure = msr_ce,
 terminator = trm_evals700
)
# åˆ›å»ºä¸€ä¸ª5æŠ˜CVï¼Œç”¨äºåç»­çš„å¤–éƒ¨é‡é‡‡æ ·
rsmp_cv5 <- rsmp('cv', folds = 5)
# å°†`Task`ï¼Œ`AutoTuner`å’Œå¤–éƒ¨é‡é‡‡æ ·å™¨`Resampling`ä¼ é€’ç»™`resample()`
# `ResampleResult$aggregate()`ç»™å‡ºæ•´åˆç»“æœ
rr <- resample(tsk_moons_train, at, rsmp_cv5)
outsample <- rr$aggregate()

# ------ç”¨æ— åµŒå¥—é‡é‡‡æ ·çš„è¶…å‚æ•°å»ºæ¨¡
# åˆ›å»ºxgboostçš„å­¦ä¹ å™¨
lrn_xgboost_tuned <- lrn('classif.xgboost')
# å°†æ— åµŒå¥—é‡é‡‡æ ·çš„å®ä¾‹è°ƒä¼˜å¾—åˆ°çš„æœ€ä½³è¶…å‚æ•°ä¼ é€’ç»™xgboostå­¦ä¹ å™¨
lrn_xgboost_tuned$param_set$set_values(
 # `instance`æ˜¯æ— åµŒå¥—é‡é‡‡æ ·çš„è°ƒä¼˜å®ä¾‹
 .values = instance$result_learner_param_vals
)
# è®­ç»ƒæ¨¡å‹ -> æµ‹è¯•æ¨¡å‹ -> è¯„ä¼°
generalization <- lrn_xgboost_tuned$train(
 tsk_moons_train
)$
 predict(tsk_moons_test)$
 score()

# æ±‡æ€»ä¸€ä¸‹ç»“æœ
round(
 c(
  # ç”¨æ— åµŒå¥—é‡é‡‡æ ·é€‰æ‹©çš„æœ€ä½³è¶…å‚æ•°æ„å»ºçš„æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ç»“æœ
  true_generalization = as.numeric(generalization),
  # æ— åµŒå¥—é‡é‡‡æ ·é€‰æ‹©çš„æœ€ä½³è¶…å‚æ•°æ„å»ºçš„æ¨¡å‹åœ¨å†…éƒ¨è®­ç»ƒçš„è¯„ä¼°ç»“æœ
  # è¿™é‡Œçš„å†…éƒ¨æ˜¯ä»…åœ¨è®­ç»ƒé›†ä¸Šç”Ÿæˆçš„è°ƒä¼˜æ¨¡å‹å¾—åˆ°çš„ç»“æœ
  without_nested_resampling = as.numeric(insample),
  # åµŒå¥—é‡é‡‡æ ·é€‰æ‹©çš„æœ€ä½³è¶…å‚æ•°æ„å»ºçš„æ¨¡å‹åœ¨å†…éƒ¨è®­ç»ƒçš„è¯„ä¼°ç»“æœ
  with_nested_resampling = as.numeric(outsample)
 ), 
 2
)
```

```js
true_generalization 0.1 
without_nested_resampling 0.06 
with_nested_resampling 0.14
```

- **ä»ä¸Šé¢å¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿ**
  - æ— åµŒå¥—é‡é‡‡æ ·çš„å†…éƒ¨è¯„ä¼°å¾—åˆ°çš„äº¤å‰ç†µå¾ˆä½ï¼Œä¸å®é™…åœ¨æµ‹è¯•é›†çš„è¯„ä¼°ç»“æœå·®å¼‚å¾ˆå¤§
  - è¿™å¯èƒ½è¡¨æ˜å¯¹ç‰¹å®šçš„å†…éƒ¨ç•™å‡ºåˆ’åˆ†å­˜åœ¨**å…ƒè¿‡æ‹Ÿåˆï¼ˆmeta-overfittingï¼‰**
  - ç›¸æ¯”ä¹‹ä¸‹åµŒå¥—é‡é‡‡æ ·å¾—åˆ°çš„å¤–éƒ¨ä¼°è®¡æ•ˆæœæ›´ç¨³å¥

---

## æ›´é«˜çº§çš„æœç´¢ç©ºé—´

### æ ‡é‡å‚æ•°è°ƒä¼˜ï¼ˆScalar Parameter Tuningï¼‰

- å½“åœ¨å­¦ä¹ å™¨ä¸­ä½¿ç”¨`to_tune()`æ—¶ï¼Œä¼šéšå¼åœ°ä¸ºè°ƒä¼˜æœç´¢ç©ºé—´åˆ›å»ºä¸€ä¸ª`ParamSet`

```r
learner <- lrn('classif.svm',
  cost  = to_tune(1e-1, 1e5),
  kernel = to_tune(c('radial', 'linear')),
  shrinking = to_tune(),
  type = 'C-classification'
)

learner$param_set$search_space()
```

```js
<ParamSet(3)>
          id    class lower upper nlevels        default  value
      <char>   <char> <num> <num>   <num>         <list> <list>
1:      cost ParamDbl   0.1 1e+05     Inf <NoDefault[0]> [NULL]
2:    kernel ParamFct    NA    NA       2 <NoDefault[0]> [NULL]
3: shrinking ParamLgl    NA    NA       2           TRUE [NULL]
```

- å¯ä»¥çœ‹åˆ°
  - `kernel`æ˜¯å› å­ï¼Œåªéœ€è¦ä¼ å…¥æƒ³è¦è°ƒæ•´çš„æ°´å¹³ç›¸å¯¹åº”çš„å‘é‡
  - `shrinking`è¶…å‚æ•°æ˜¯ä¸€ä¸ªé€»è¾‘å€¼ï¼Œå®ƒåªæœ‰ä¸¤ç§å¯èƒ½çš„å€¼ï¼Œ  
   æ‰€ä»¥ä¸éœ€è¦å‘`to_tune()`ä¼ é€’ä»»ä½•å†…å®¹ï¼Œ  
   å®ƒä¼šè‡ªåŠ¨ä»`learner$param_set`ä¸­è¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ªé€»è¾‘å€¼ï¼Œ  
   å¹¶å°†è¿™ä¸ªç»†èŠ‚ä¼ é€’ç»™`learner$param_set$search_space()`
  - å¯¹äºå› å­å‚æ•°ï¼Œå¦‚æœæƒ³åœ¨æ‰€æœ‰å¯èƒ½çš„å€¼ä¸Šè¿›è¡Œè°ƒæ•´ï¼Œ  
   ä¹Ÿå¯ä»¥åœ¨ä¸ä¼ é€’ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ä½¿ç”¨`to_tune()`
  - å¦‚æœæƒ³åœ¨ä¸€å°éƒ¨åˆ†å¯èƒ½çš„å€¼ä¸Šç¦»æ•£åŒ–æ•°å€¼å‚æ•°ï¼Œ  
   å¯ä»¥ä½¿ç”¨to_tune()å°†æ•°å€¼å‚æ•°è§†ä¸ºå› å­
    - ä¾‹å¦‚ï¼Œæƒ³æ‰¾åˆ°éšæœºæ£®æ—ä¸­æœ€ä¼˜çš„æ ‘çš„æ•°é‡ï¼Œ  
    æˆ‘ä»¬å¯èƒ½åªè€ƒè™‘ä¸‰ç§æƒ…å†µï¼š100æ£µã€200æ£µæˆ–400æ£µæ ‘

```r
lrn('classif.ranger', num.trees = to_tune(c(100, 200, 400)))
```

- å°†**æ•´æ•°å˜åšå› å­**ä¼šå¯¼è‡´è¶…å‚æ•°**æ— åº**
  - å› æ­¤ï¼Œåˆ©ç”¨é¡ºåºä¿¡æ¯çš„ç®—æ³•åœ¨å¿½ç•¥é¡ºåºæ—¶æ€§èƒ½ä¼šå˜å·®
  - å¯¹äºè¿™äº›ç®—æ³•ï¼Œ  
   ä½¿ç”¨è‡ªå®šä¹‰å˜æ¢å®šä¹‰ä¸€ä¸ªÂ `ParamDbl`Â æˆ–Â `ParamInt`æ›´æœ‰æ„ä¹‰
   ï¼ˆåç»­å†…å®¹ï¼‰

### å®šä¹‰æœç´¢ç©ºé—´

- ä¸‹åˆ—`p_*()`åˆ›å»º`Param`å¯¹è±¡

| ConstructorÂ æ„é€ å‡½æ•° | DescriptionÂ æè¿°                       | Underlying ClassÂ åŸºç¡€ç±» |
| ---------------- | ------------------------------------ | -------------------- |
| `p_dbl()`        | Real valued parameter (â€œdoubleâ€)     | `ParamDbl`           |
| `p_int()`        | Integer parameter                    | `ParamInt`           |
| `p_fct()`        | Discrete valued parameter (â€œfactorâ€) | `ParamFct`           |
| `p_lgl()`        | Logical / Boolean parameter          | `ParamLgl`           |
| `p_uty()`        | Untyped parameter                    | `ParamUty`           |

- ä½¿ç”¨`ps()`æ‰‹åŠ¨åˆ›é€ æœç´¢ç©ºé—´ï¼Œå¯¹è±¡ä¸º`ParamSet`

```r
search_space <- ps(
 cost  = p_dbl(lower = 1e-1, upper = 1e5),
 kernel = p_fct(c('radial', 'linear')),
 shrinking = p_lgl()
)
```

- å°†æœç´¢ç©ºé—´ä¼ é€’ç»™`ti()`
  - å®˜æ–¹æ–‡æ¡£å†™é”™äº†ï¼Œä»–ç»™çš„ä¾‹å­æ˜¯`ti()`
   `auto_tuner()`åº”è¯¥ä¼ é€’äº†`Tuner`ä½†æ˜¯ä¾‹å­é‡Œæ²¡æœ‰`Tuner`

```r
tsk_sonar <- tsk('sonar')
rsmp_cv3 <- rsmp('cv', folds = 3)
msr_ce <- msr('classif.ce')

ists <- ti(
    tsk_sonar, 
    lrn('classif.svm', type = 'C-classification'), 
    rsmp_cv3,
    msr_ce, 
    trm('none'), 
    # å°†æœç´¢ç©ºé—´ä¼ é€’åˆ°å‚æ•°`search_space`
    search_space = search_space
)

ists
```

```js
[36m--[39m [1m[34m<TuningInstanceBatchSingleCrit>[39m[22m [36m---------------------------------------------[39m
* State: Not optimized
* Objective: [34m<ObjectiveTuningBatch>[39m
* Search Space:
          id    class lower upper nlevels
      <char>   <char> <num> <num>   <num>
1:      cost ParamDbl   0.1 1e+05     Inf
2:    kernel ParamFct    NA    NA       2
3: shrinking ParamLgl    NA    NA       2
* Terminator: [34m<TerminatorNone>[39m
```

- **æœ‰ç•Œæœç´¢ç©ºé—´**
  - æ‰‹åŠ¨åˆ›å»ºæœç´¢ç©ºé—´æ—¶ï¼Œå¯¹æœç´¢ç©ºé—´ä¸­çš„æ‰€æœ‰è¶…å‚æ•°æ˜¯å¦æœ‰è¾¹ç•Œä¿æŒè°¨æ…
  - å¦‚æœæ²¡æœ‰ç»™`p_dbl()` æˆ– `p_int()` ä¼ é€’ä¸‹é™å’Œä¸Šé™ï¼Œ  
   å‡ ä¹æ‰€æœ‰è°ƒè°å™¨åœ¨è°ƒä¼˜è¿‡ç¨‹ä¸­éƒ½ä¼šæŠ›å‡ºé”™è¯¯
  - å¦‚æœä¸ç¡®å®šï¼Œæ‚¨å¯ä»¥åœ¨æ„é€ çš„ `ParamSet` ï¼ˆ`ps()`åˆ›å»ºçš„å¯¹è±¡ï¼‰ä¸Š  
   ä½¿ç”¨`ParamSet$is_bounded`æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†ä¸‹é™å’Œä¸Šé™

```r
ps(cost = p_dbl(lower = 0.1, upper = 1))$is_bounded
ps(cost = p_dbl(lower = 0.1, upper = Inf))$is_bounded
search_space
```

```js
cost: TRUE

cost: FALSE

cost TRUE 
kernel TRUE 
shrinking TRUE
```

### å‘é‡ä¸Šçš„å˜æ¢ä¸è°ƒä¼˜

#### ä½¿ç”¨`p_*()`çš„è‡ªå®šä¹‰å˜æ¢

- ä¹‹å‰è®¨è®ºè¿‡å¯¹æ•°å˜æ¢çš„ç”¨æ³•
- ç®€å•å›é¡¾ä¸€ä¸‹ä¹‹å‰ç”¨ç»™`lrn()`ä¼ é€’ç”¨`to_tune()`åˆ›å»ºçš„å­¦ä¹ å™¨çš„æœç´¢ç©ºé—´

```r
svm <- lrn(
 'classif.svm',
 cost = to_tune(1e-5,1e5, logscale = TRUE)
)
svm$param_set
```

```js
<ParamSet(1)>
       id    class     lower    upper nlevels        default  value
   <char>   <char>     <num>    <num>   <num>         <list> <list>
1:   cost ParamDbl -11.51293 11.51293     Inf <NoDefault[0]> [NULL]
Trafo is set.
```

- å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„`lower`å’Œ`upper`å¹¶é`1e-5`å’Œ`1e5`è€Œæ˜¯`-11.5`å’Œ`11.5` ã€€
  æ‰€ä»¥è¾“å…¥åˆ°å­¦ä¹ å™¨çš„èŒƒå›´å…¶å®æ˜¯`log(1e-5)`å’Œ`log(1e5)`

- æ‰‹åŠ¨åˆ›å»ºå¯¹æ•°å˜æ¢
  - `trafo`ä¸­ä¼ é€’çš„æ˜¯å¯¹é‡‡æ ·ç»“æœçš„æ“ä½œå‡½æ•°
  - è¿™é‡Œçš„è¾“å‡ºç»“æœå’Œ`svm$param_set`ä¸€è‡´

```r
ss <- ps(
 cost = p_dbl(
  # æ³¨æ„ï¼šè¿™é‡Œæ˜¯log(1e-5)å’Œlog(1e5)
  log(1e-5), log(1e5),
  # å¯¹ç»“æœåšæŒ‡æ•°å˜æ¢
  trafo = function(x) ruturn(exp(x))
 )
) 
ss
```

```js
<ParamSet(1)>
       id    class     lower    upper nlevels        default  value
   <char>   <char>     <num>    <num>   <num>         <list> <list>
1:   cost ParamDbl -11.51293 11.51293     Inf <NoDefault[0]> [NULL]
Trafo is set.
```

- è™½ç„¶`ParamSet`ç»™å‡ºäº†`Trafo is set.`çš„ä¿¡æ¯ï¼Œ  
  ä¹Ÿå¯ä»¥é€šè¿‡`ParamSet$trafo()`æ‰‹åŠ¨è¾“å…¥ä¿¡æ¯æ¥æŸ¥çœ‹æ˜¯å¦æœ‰è½¬æ¢
- çœ‹çœ‹`ParamSet$trafo()`çš„è½¬æ¢
  - ç»“æœä¹Ÿæ˜¯å®Œå…¨ä¸€è‡´

```r
svm$param_set$search_space()$trafo(list(cost = 1))
ss$trafo(list(cost = 1))
```

```r
$cost = 2.71828182845905
$cost = 2.71828182845905
```

- ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œ`to_tune(1e-5,1e5, logscale = TRUE)`çš„åŸç†æ˜¯ï¼š
  - å°†ä¸‹é™ä¸ä¸Šé™åšå¯¹æ•°å˜æ¢
  - åœ¨å¯¹æ•°å˜æ¢åçš„ä¸Šä¸‹é™å½¢æˆçš„åŒºé—´åšå‡åŒ€å–æ ·
  - å°†å‡åŒ€å–æ ·çš„ç»“æœè¿›è¡ŒæŒ‡æ•°å˜æ¢ï¼Œä¼ é€’ç»™`Learner`

- `to_tune()`é™¤äº†æ¥å—`to_tune(1e-5, 1e5, logscale = TRUE)`è¿™æ ·çš„æ ¼å¼å¤–ï¼Œ  
  ä¹Ÿæ¥å—`Param`å¯¹è±¡
- åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œå–æ ·åœ¨åŒºé—´$[0,3]$å‡åŒ€å–æ ·ï¼Œå°†å–æ ·çš„ç»“æœ$+2$ä¼ é€’åˆ°`Learner`ä¸­

```r
lrn(
 'classif.svm',
 cost = to_tune(
  p_dbl(
   0, 3, 
   trafo = function(x) return(x + 2)
  )
 )
)
```

- å¯¹äºå¤šä¸ªå¤æ‚å˜æ¢ï¼Œéœ€è¦å°†å‡½æ•°ä¼ é€’åˆ°`.extra_trafo`ä¸­
  - `.extra_trafo`æ¥å—ä¸€ä¸ªå¸¦æœ‰å‚æ•°`x`å’Œ`param_set`çš„å‡½æ•°
  - åœ¨è°ƒä¼˜è¿‡ç¨‹ä¸­ï¼Œ  
   `x`æ˜¯ä¸€ä¸ªåŒ…å«æ­£åœ¨æµ‹è¯•çš„é…ç½®çš„åˆ—è¡¨ï¼Œ  
   `param_set`æ˜¯æ•´ä¸ªå‚æ•°é›†
  - æµ‹è¯•äº†ä¸€ä¸‹ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œçœç•¥`param_set`ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ  
   ä½†æ˜¯ä¸ç¡®å®šå…¶ä»–ç”¨æ³•ä¸­èƒ½ä¸èƒ½çœï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯åˆ«çœäº†

```r
search_space <- ps(
 # `cost`åœ¨åŒºé—´[-1,1]å‡åŒ€å–æ ·ï¼Œå–æ ·ç»“æœåšæŒ‡æ•°è½¬æ¢
 cost = p_dbl(-1, 1, trafo = function(x) return(exp(x))),
 # `kernel`æœ‰'polynomial'å’Œ'radial'ä¸¤ç§é€‰æ‹©
 kernel = p_fct(c('polynomial', 'radial')),
 # ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼šå½“kernel == 'polynomial'æ—¶ï¼Œ
 # `cost`æŠ½æ ·åæŒ‡æ•°è½¬æ¢çš„æœ€ç»ˆç»“æœ+2ï¼›å¦åˆ™å°±ä¿æŒæœ€ç»ˆç»“æœ
 .extra_trafo = function(x, param_set) {
     if (x$kernel == 'polynomial') {
       x$cost = x$cost + 2
  }
  return(x)
 }
)

search_space$trafo(list(cost = 1, kernel = 'polynomial'))
search_space$trafo(list(cost = 1, kernel = 'radial'))
```

```js
$cost
4.71828182845904
$kernel
'polynomial'


$cost
2.71828182845905
$kernel
'radial'
```

#### å‘é‡å˜æ¢

- ä»»ä½•å‡½æ•°éƒ½å¯ä»¥ä¼ é€’ç»™`trafo`å’Œ`.extra_trafo`ï¼Œ  
  è¿™ä½¿å¾—å¯ä»¥è°ƒæ•´`ParamUty`ç±»å‚æ•°ï¼Œ  
  è¿™äº›å‚æ•°å¯ä»¥æ˜¯å‘é‡ã€å‡½æ•°æˆ–ä»»ä½•éåŸå­ç±»
- ä¸‹ä¾‹ä¸­ï¼Œæ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰çš„`class.weights`å‚æ•°æ¥å—ä¸€ä¸ªç±»æƒé‡çš„å‘½åå‘é‡ï¼Œ  
  æ¯ä¸ªç›®æ ‡ç±»éƒ½æœ‰ä¸€ä¸ªæ¡ç›®
  - ä¸ºäº†è°ƒæ•´è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥è°ƒæ•´ä¸€ä¸ªæ ‡é‡ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå‘é‡
  - ä¸‹é¢çš„ä»£ç å°†é‡‡æ ·ä¸€ä¸ªä»‹äº`0.1`å’Œ`0.9`ä¹‹é—´çš„å€¼`x`ï¼Œ  
   ç„¶åå°†ç»“æœè½¬æ¢ä¸º(`x`,Â `1 - x`)ï¼Œç„¶åä¼ é€’ç»™`Learner`

- å…ˆçœ‹çœ‹`class.weights`é•¿ä»€ä¹ˆæ ·
  - å®ƒçš„ç±»å‹æ˜¯`ParamUty`ï¼Œæ‰€ä»¥å¯ä»¥ä¼ é€’ä»»ä½•ä¸œè¥¿ç»™å®ƒ

```r
{
    lrn('classif.svm')$param_set %>% 
        as.data.table()
} %>% 
    filter(id == 'class.weights')
```

<table class='dataframe'>
<caption>A data.table: 1 x 11</caption>
<thead>
 <tr><th scope=col>id</th><th scope=col>class</th><th scope=col>lower</th><th scope=col>upper</th><th scope=col>levels</th><th scope=col>nlevels</th><th scope=col>is_bounded</th><th scope=col>special_vals</th><th scope=col>default</th><th scope=col>storage_type</th><th scope=col>tags</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;lgl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>class.weights</td><td>ParamUty</td><td>NA</td><td>NA</td><td>NULL</td><td>Inf</td><td>FALSE</td><td>NULL</td><td>NULL</td><td>list</td><td>train</td></tr>
</tbody>
</table>

- å¯¹äº`ParamUty`è€Œè¨€ï¼Œè¦æ…é‡ç¡®å®šå®ƒ**åŸæœ¬æ¥å—ä»€ä¹ˆå½¢å¼çš„è¾“å…¥**
  - `class.weights`æ¥å—ä¸€ä¸ªå‘½åå‘é‡ï¼Œ  
   å…¶ä¸­åŒ…å«åˆ†ç±»çš„levelä»¥åŠå¸Œæœ›åˆ†é…çš„æƒé‡ï¼ˆ0â€“1ä¹‹é—´ï¼‰

```r
search_space <- ps(
 class.weights = p_dbl(
  lower = 0.1, upper = 0.9,
  # è¿™é‡Œçš„Må’ŒRæ˜¯`tsk_sonar`é‡Œçš„åˆ†ç±»
  # Mæ˜¯Minesï¼ŒRæ˜¯Rocks
  trafo = function(x) return(c(M = x, R = 1 - x))
 )
)
```

- æœ‰æ—¶å€™éœ€è¦è°ƒèŠ‚å¤šä¸ªä¸å­˜åœ¨å­¦ä¹ å™¨`param_set`é‡Œçš„**ä¼ªå‚æ•°**
  - è¿™äº›ä¼ªå‚æ•°ä¼šè¢«ç”¨äºè°ƒæ•´å‘é‡å‚æ•°
- ä¸‹ä¾‹ä¸­ä»¥`lrn('surv.coxtime')`ä¸ºä¾‹
  - `num_nodes`éœ€è¦ç»™æ¯ä¸ªå±‚ä¼ é€’èŠ‚ç‚¹ï¼Œ  
   å¦‚æœæœ‰5ä¸ªå±‚ï¼Œæ¯ä¸ªå±‚ç”Ÿæˆ4ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±è¦è¾“å…¥å‘é‡ï¼š  
   `num_nodes = c(4, 4, 4, 4, 4)`ï¼Œ
   å½“ç„¶ä¹Ÿå¯ä»¥è¿™æ ·ä¼ é€’ï¼š`num_nodes = rep(4, 5)
  - æ‰€ä»¥`num_nodes`å®é™…ä¾èµ–ä¸¤ä¸ªå‚æ•°ï¼š
    - å±‚æ•°
    - æ¯å±‚èŠ‚ç‚¹æ•°
  - å› æ­¤å¯ä»¥è‡ªå®šä¹‰å±‚æ•°å’Œæ¯å±‚èŠ‚ç‚¹æ•°çš„ä¸¤ä¸ªä¼ªå‚æ•°ï¼Œ  
   é€šè¿‡ç»„åˆè¿™ä¸¤ä¸ªä¼ªå‡½æ•°æ¥ç”Ÿæˆç›®æ ‡è¶…å‚æ•°`num_nodes`
- `num_nodes`å¹¶ä¸ä¼šåœ¨`ParamSet`çš„æ‰“å°ç»“æœä¸­å‡ºç°ï¼Œ  
  å› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨`ps()`ä¸­ç›´æ¥å®šä¹‰å®ƒ

```r
search_space <- ps(
 num_layers = p_int(lower = 1, upper = 20),
 num_nodes_per_layer = p_int(4, 64),
 .extra_trafo = function(x, param_set) {
  x$num_nodes = rep(x$num_nodes_per_layer, x$num_layers)
  x$num_layers = NULL
  x$num_nodes_per_layer = NULL
  return(x)
  }
)

search_space
```

```js
<ParamSet(2)>
                    id    class lower upper nlevels        default  value
                <char>   <char> <num> <num>   <num>         <list> <list>
1:          num_layers ParamInt     1    20      20 <NoDefault[0]> [NULL]
2: num_nodes_per_layer ParamInt     4    64      61 <NoDefault[0]> [NULL]
Trafo is set.
```

- ä½†æ˜¯å¯ä»¥é€šè¿‡`ParamSet$trafo()`æ¥éªŒè¯
  - ç»“æœä¹Ÿæ˜¯å¾ˆæ¸…æ™°äº†ï¼Œ  
   åœ¨å®é™…çš„è¿ç®—ä¸­è¦ä¼ é€’ç»™`Learner`çš„æ˜¯ç”Ÿæˆçš„`num_nodes`

```r
search_space$trafo(list(num_layers = 4, num_nodes_per_layer = 12))
```

```js
$num_nodes =
12 12 12 12
```

- å¯ä»¥é€šè¿‡`Learner$param_set$set_values()`ä¼ é€’ä¸Šè¿°è‡ªå®šä¹‰çš„æœç´¢ç©ºé—´

```r
learner <- lrn('surv.coxtime')
learner$param_set$search_space()

learner$param_set$set_values(num_nodes = to_tune(search_space))
learner$param_set$search_space()
```

```js
<ParamSet(0)>
Empty.


<ParamSet(2)>
                    id    class lower upper nlevels        default  value
                <char>   <char> <num> <num>   <num>         <list> <list>
1:          num_layers ParamInt     1    20      20 <NoDefault[0]> [NULL]
2: num_nodes_per_layer ParamInt     4    64      61 <NoDefault[0]> [NULL]
Trafo is set.
```

### è¶…å‚æ•°ä¾èµ–å…³ç³»

- ä¾‹å¦‚ï¼ŒSVMä¸­çš„`degree`å‚æ•°ä»…åœ¨`kernel`ä¸º`'polynomial'`æ—¶æ‰æœ‰æ•ˆ
  - åœ¨`ps()`å‡½æ•°ä¸­ï¼Œä½¿ç”¨`depends`å‚æ•°æ¥æŒ‡å®šè¿™ç§ä¾èµ–å…³ç³»ï¼Œ  
   è¯¥å‚æ•°æ¥å—ä¸€ä¸ªå‘½åå‚æ•°ï¼Œ  
   å½¢å¼ä¸º`<param> == value`Â æˆ–Â `<param> %in% <vector>`

- ä¸‹é¢ä¾‹å­ä¸­ï¼Œå¯¹3ä¸ªè¶…å‚æ•°è¿›è¡Œè°ƒä¼˜
- å…ˆç®€å•çœ‹çœ‹`lrn('classif.svm')`ä¸­çš„ä¾èµ–å…³ç³»
  - `degree`å’Œ`gamma`éƒ½ä¾èµ–äº`kernel`

```r
learner <- lrn('classif.svm')
learner$param_set$deps
```

<table class='dataframe'>
<caption>A data.table: 5 x 3</caption>
<thead>
 <tr><th scope=col>id</th><th scope=col>on</th><th scope=col>cond</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>coef0 </td><td>kernel</td><td>polynomial    , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>cost  </td><td>type  </td><td>C-classification, %s == %s        </td></tr>
 <tr><td>degree</td><td>kernel</td><td>polynomial, %s == %s  </td></tr>
 <tr><td>gamma </td><td>kernel</td><td>polynomial    , radial        , sigmoid       , %s %%in%% {%s}</td></tr>
 <tr><td>nu    </td><td>type  </td><td>nu-classification, %s == %s         </td></tr>
</tbody>
</table>

- ä½¿ç”¨`depends`å‚æ•°æ¥æŒ‡å®šè¿™ç§ä¾èµ–å…³ç³»
  - è¯¥å‚æ•°æ¥å—ä¸€ä¸ªå‘½åå‚æ•°ï¼Œå½¢å¼ä¸º`<param> == value`Â æˆ–Â `<param> %in% <vector>`

```r
ps(
 kernel = p_fct(c('polynomial', 'radial')),
 degree = p_int(1, 3, depends = (kernel == 'polynomial')),
 gamma = p_dbl(
  1e-5, 1e5,
  depends = (kernel %in% c('polynomial', 'radial'))
 )
)
```

```js
<ParamSet(3)>
Key: <id>
       id    class lower upper nlevels        default parents  value
   <char>   <char> <num> <num>   <num>         <list>  <list> <list>
1: degree ParamInt 1e+00 3e+00       3 <NoDefault[0]>  kernel [NULL]
2:  gamma ParamDbl 1e-05 1e+05     Inf <NoDefault[0]>  kernel [NULL]
3: kernel ParamFct    NA    NA       2 <NoDefault[0]>  [NULL] [NULL]
```

- ä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’åˆ°`to_tune()`å‡½æ•°

```r
lrn(
 'classif.svm',
 kernel = to_tune(c('polynomial', 'radial')),
 degree = to_tune(
  p_int(
   1, 3, 
   depends = (kernel == 'polynomial')
  )
 ),
 gamma = to_tune(
  p_dbl(
   1e-5, 1e5,
   depends = (kernel %in% c('polynomial', 'radial'))
  )
 )
)$param_set$search_space()
```

```js
<ParamSet(3)>
Key: <id>
       id    class lower upper nlevels        default       parents  value
   <char>   <char> <num> <num>   <num>         <list>        <list> <list>
1: degree ParamInt 1e+00 3e+00       3 <NoDefault[0]> kernel,kernel [NULL]
2:  gamma ParamDbl 1e-05 1e+05     Inf <NoDefault[0]> kernel,kernel [NULL]
3: kernel ParamFct    NA    NA       2 <NoDefault[0]>        [NULL] [NULL]
```

### ä½¿ç”¨ `mlr3tuningspaces` æ¨èçš„æœç´¢ç©ºé—´

- é€‰å®šçš„æœç´¢ç©ºé—´å¯èƒ½éœ€è¦å¤§é‡çš„èƒŒæ™¯çŸ¥è¯†æˆ–ä¸“ä¸šæŠ€èƒ½
- `mlr3tuningspaces` åŒ…ä¸ºè®¸å¤šæµè¡Œçš„æœºå™¨å­¦ä¹ ç®—æ³•æä¾›å·²å‘å¸ƒæœç´¢ç©ºé—´çš„å®ç°ï¼Œ  
  è®©è¶…å‚æ•°ä¼˜åŒ–æ›´å®¹æ˜“ä¸Šæ‰‹
- æœç´¢ç©ºé—´å­˜å‚¨åœ¨å­—å…¸ `mlr_tuning_spaces` ä¸­

```r
# library(mlr3tuningspaces)
mlr_tuning_spaces
```

<table class='dataframe'>
<caption>A data.table: 30 x 4</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>learner</th><th scope=col>n_values</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
 <tr><td>classif.glmnet.default </td><td>Classification GLM with Default      </td><td>classif.glmnet </td><td> 2</td></tr>
 <tr><td>classif.glmnet.rbv1    </td><td>Classification GLM with RandomBot    </td><td>classif.glmnet </td><td> 2</td></tr>
 <tr><td>classif.glmnet.rbv2    </td><td>Classification GLM with RandomBot    </td><td>classif.glmnet </td><td> 2</td></tr>
 <tr><td>classif.ranger.default </td><td>Classification Ranger with Default   </td><td>classif.ranger </td><td> 4</td></tr>
 <tr><td>classif.ranger.rbv1    </td><td>Classification Ranger with RandomBot </td><td>classif.ranger </td><td> 6</td></tr>
 <tr><td>classif.ranger.rbv2    </td><td>Classification Ranger with RandomBot </td><td>classif.ranger </td><td> 8</td></tr>
 <tr><td>classif.rpart.default  </td><td>Classification Rpart with Default    </td><td>classif.rpart  </td><td> 3</td></tr>
 <tr><td>classif.rpart.rbv1     </td><td>Classification Rpart with RandomBot  </td><td>classif.rpart  </td><td> 4</td></tr>
 <tr><td>classif.rpart.rbv2     </td><td>Classification Rpart with RandomBot  </td><td>classif.rpart  </td><td> 4</td></tr>
 <tr><td>classif.svm.default    </td><td>Classification SVM with Default      </td><td>classif.svm    </td><td> 4</td></tr>
 <tr><td>classif.svm.rbv1       </td><td>Classification SVM with RandomBot    </td><td>classif.svm    </td><td> 4</td></tr>
 <tr><td>classif.svm.rbv2       </td><td>Classification SVM with RandomBot    </td><td>classif.svm    </td><td> 5</td></tr>
 <tr><td>classif.xgboost.default</td><td>Classification XGBoost with Default  </td><td>classif.xgboost</td><td> 8</td></tr>
 <tr><td>classif.xgboost.rbv1   </td><td>Classification XGBoost with RandomBot</td><td>classif.xgboost</td><td>10</td></tr>
 <tr><td>classif.xgboost.rbv2   </td><td>Classification XGBoost with RandomBot</td><td>classif.xgboost</td><td>13</td></tr>
 <tr><td>regr.glmnet.default    </td><td>Regression GLM with Default          </td><td>regr.glmnet    </td><td> 2</td></tr>
 <tr><td>regr.glmnet.rbv1       </td><td>Regression GLM with RandomBot        </td><td>regr.glmnet    </td><td> 2</td></tr>
 <tr><td>regr.glmnet.rbv2       </td><td>Regression GLM with RandomBot        </td><td>regr.glmnet    </td><td> 2</td></tr>
 <tr><td>regr.ranger.default    </td><td>Regression Ranger with Default       </td><td>regr.ranger    </td><td> 4</td></tr>
 <tr><td>regr.ranger.rbv1       </td><td>Regression Ranger with RandomBot     </td><td>regr.ranger    </td><td> 6</td></tr>
 <tr><td>regr.ranger.rbv2       </td><td>Regression Ranger with RandomBot     </td><td>regr.ranger    </td><td> 7</td></tr>
 <tr><td>regr.rpart.default     </td><td>Regression Rpart with Default        </td><td>regr.rpart     </td><td> 3</td></tr>
 <tr><td>regr.rpart.rbv1        </td><td>Regression Rpart with RandomBot      </td><td>regr.rpart     </td><td> 4</td></tr>
 <tr><td>regr.rpart.rbv2        </td><td>Regression Rpart with RandomBot      </td><td>regr.rpart     </td><td> 4</td></tr>
 <tr><td>regr.svm.default       </td><td>Regression SVM with Default          </td><td>regr.svm       </td><td> 4</td></tr>
 <tr><td>regr.svm.rbv1          </td><td>Regression SVM with RandomBot        </td><td>regr.svm       </td><td> 4</td></tr>
 <tr><td>regr.svm.rbv2          </td><td>Regression SVM with RandomBot        </td><td>regr.svm       </td><td> 5</td></tr>
 <tr><td>regr.xgboost.default   </td><td>Regression XGBoost with Default      </td><td>regr.xgboost   </td><td> 8</td></tr>
 <tr><td>regr.xgboost.rbv1      </td><td>Regression XGBoost with RandomBot    </td><td>regr.xgboost   </td><td>10</td></tr>
 <tr><td>regr.xgboost.rbv2      </td><td>Regression XGBoost with RandomBot    </td><td>regr.xgboost   </td><td>13</td></tr>
</tbody>
</table>

- `lts()`ï¼ˆlearner tuning spaceï¼‰å¯ä»¥å¿«é€Ÿè°ƒå–æ¨èçš„æœç´¢ç©ºé—´

```r
lts_rpart <- lts('classif.rpart.default')
lts_rpart
```

```js
[36m--[39m [1m[34m<TuningSpace>[39m (classif.rpart.default): Classification Rpart with Default[22m [36m----[39m
          id lower upper levels logscale
      <char> <num> <num> <list>   <lgcl>
1:  minsplit 2e+00 128.0 [NULL]     TRUE
2: minbucket 1e+00  64.0 [NULL]     TRUE
3:        cp 1e-04   0.1 [NULL]     TRUE
```

- ä¹‹åå¯ä»¥ä¼ é€’ç»™`ti()`æˆ–`auto_tuner()`ä¸­çš„`search_space`å‚æ•°ï¼Œ  
  ä¹Ÿå¯ä»¥ç›´æ¥è°ƒå–`TuningSpace$values`ï¼ˆ`TuneToken`ç±»ï¼‰ä¼ é€’åˆ°`Learner$param_set`ä¸­

```r
# `ti()`
instance <- ti(
 task = tsk_sonar,
 learner = lrn('classif.rpart'),
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('evals', n_evals = 20),
 # åœ¨è¿™é‡Œ
 search_space = lts_rpart
)

# `auto_tuner()`
at <- auto_tuner(
 learner = lrn('classif.rpart'),
 resampling = rsmp('cv', folds = 3),
 measures = msr('classif.ce'),
 terminator = trm('evals', n_evals = 20),
 # # åœ¨è¿™é‡Œ
 search_space = lts_rpart
)

# ç›´æ¥ä¼ é€’ç»™`Learner`
learner <- lrn('classif.rpart')
learner$param_set$set_values(.values = lts_rpart$values)
learner$param_set
```

- ä¹Ÿå¯ä»¥ç›´æ¥å°†`Learner`ä¼ é€’ç»™`lts()`æ¥è°ƒç”¨é»˜è®¤çš„æœç´¢ç©ºé—´ï¼Œ  
  ä»¥åŠåœ¨`lts()`è°ƒç”¨é»˜è®¤æœç´¢ç©ºé—´çš„æ—¶å€™è‡ªå®šä¹‰æ›´æ”¹è¶…å‚æ•°è°ƒä¼˜å†…å®¹

```r
lts(lrn('classif.rpart'))
lts('classif.rpart.rbv2', maxdepth = to_tune(1, 20))
```

---

## é”™è¯¯å¤„ç†ä¸å†…å­˜ç®¡ç†

### å°è£…ä¸å›é€€å­¦ä¹ å™¨

- å³ä½¿åœ¨ç®€å•çš„æœºå™¨å­¦ä¹ é—®é¢˜ä¸­ï¼Œä¹Ÿæœ‰å¾ˆå¤§çš„å‡ºé”™å¯èƒ½æ€§
  - ä¾‹å¦‚ï¼Œå½“å­¦ä¹ å™¨æ— æ³•æ”¶æ•›ã€å†…å­˜è€—å°½ï¼Œ  
   æˆ–è€…ç”±äºåº•å±‚æ•°æ®çš„é—®é¢˜è€Œå‡ºç°é”™è¯¯å¹¶ç»ˆæ­¢è¿è¡Œ
- ä½œä¸ºä¸€ä¸ªå¸¸è§é—®é¢˜ï¼šå¦‚æœæµ‹è¯•æ•°æ®ä¸­å­˜åœ¨è®­ç»ƒæ•°æ®ä¸­æ²¡æœ‰çš„å› å­æ°´å¹³ï¼Œ  
  å­¦ä¹ å™¨å¯èƒ½ä¼šå¤±è´¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å»ºæ¨¡ä¼šå¤±è´¥ï¼Œ  
  å› ä¸ºæ²¡æœ‰é’ˆå¯¹è¿™äº›æ–°çš„å› å­æ°´å¹³è®­ç»ƒæƒé‡/ç³»æ•°ï¼š

```r
# è°ƒå–`Task`
tsk_pen <- tsk('penguins')
# å»é™¤æœ‰ç¼ºæŸå€¼çš„è¡Œ
tsk_pen$filter(tsk_pen$row_ids[complete.cases(tsk_pen$data())])
# åˆ›å»ºä¸€ä¸ªcustomæ–¹æ³•çš„é‡é‡‡æ ·å™¨(ResamplingCustomç±»)ï¼š
# customéœ€è¦æ‰‹åŠ¨æä¾›çš„ç´¢å¼•å°†æ•°æ®æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†
rsmp_custom <- rsmp('custom')
# ä¸ºäº†ä¸¾ä¾‹å­ï¼Œè¿™é‡Œé€‰æ‹©æ‰‹åŠ¨åˆ†é…è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š
# ä¸åŒ…å«â€œTorgersenâ€å’Œä»…åŒ…å«â€œTorgersenâ€çš„è¡Œçš„æ•°æ®é›†
rsmp_custom$instantiate(
 task = tsk_pen,
 # é€‰æ‹©æ‰€æœ‰`island`ä¸ä¸º'Torgersen'çš„è¡Œçš„æ•°æ®é›†ä½œä¸ºè®­ç»ƒé›†
 train_sets = list(
  tsk_pen$
   row_ids[
    tsk_pen$
     data()$
     island != 'Torgersen'
   ]
 ),
 # é€‰æ‹©æ‰€æœ‰`island`ä¸º'Torgersen'çš„è¡Œçš„æ•°æ®é›†ä½œä¸ºæµ‹è¯•é›†
 test_sets = list(
  tsk_pen$
   row_ids[
    tsk_pen$
     data()$
     island == 'Torgersen'
   ]
 )
)
# è¿™æ ·åˆ†é…å®Œåï¼Œæµ‹è¯•é›†ä¸­çš„`island`æ˜¯æ²¡æœ‰'Torgersen'çš„ï¼ˆç¼ºä¹å› å­ï¼‰
# è¿™ç§ç»“æœä¼šå¯¼è‡´åé¢çš„`tune()`å¤±è´¥

# åˆ›å»ºäº¤å‰ç†µè¯„ä¼°å™¨
msr_ce <- msr('classif.ce')
# åˆ›å»ºéšæœºæœç´¢è°ƒä¼˜å™¨
tnr_random <- tnr('random_search')
# åˆ›å»ºldaå­¦ä¹ å™¨
learner <- lrn(
 'classif.lda', 
 method = 't', 
 nu = to_tune(3, 10)
)

# ----------ç”±äºè®­ç»ƒé›†æ²¡æœ‰æµ‹è¯•é›†çš„å› å­â€œTorgersenâ€
# ----------ä¸‹é¢æŠ¥é”™
# è¿›è¡Œå®ä¾‹è°ƒä¼˜
tune(
 tuner = tnr_random, 
 task = tsk_pen, 
 learner = learner, 
 resampling = rsmp_custom, 
 measure = msr_ce, 
 term_evals = 10)
```

```js
Error in lda.default(x, grouping, ...): variable 6 appears to be constant within groups
```

- å°è£…ï¼ˆencapsulationï¼‰å…è®¸åœ¨ä¸å¹²æ‰°è°ƒä¼˜è¿‡ç¨‹çš„æƒ…å†µä¸‹éš”ç¦»å’Œå¤„ç†é”™è¯¯
- å¯ä»¥ä½¿ç”¨Â `$encapsulate()`Â æ–¹æ³•è®©å­¦ä¹ å™¨å°è£…é”™è¯¯
  - ä¼ é€’çš„`method = 'evaluate'`æ˜¯å‘Šè¯‰å­¦ä¹ å™¨åœ¨è®­ç»ƒå’Œé¢„æµ‹é˜¶æ®µéƒ½è®¾ç½®å°è£…

```r
learner$encapsulate(
 method = 'evaluate', 
 fallback = lrn('classif.featureless')
)
```

- åœ¨HPOè¿‡ç¨‹ä¸­ï¼Œå­¦ä¹ å™¨ä¸æ”¶æ•›æ˜¯æ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼Œ  
  è¿™å¯¼è‡´è¿›ç¨‹æ— é™æœŸè¿è¡Œ
  - å¯ä»¥é€šè¿‡åœ¨å­¦ä¹ å™¨ä¸­è®¾ç½®Â `timeout`å­—æ®µæ¥é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿ
  - å¦‚æœå­¦ä¹ å™¨è¿è¡Œäº†æŒ‡å®šçš„æ—¶é•¿ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œ  
   è¯¥å­—æ®µä¼šå‘å­¦ä¹ å™¨å‘å‡ºåœæ­¢ä¿¡å·
  - å¯ä»¥åˆ†åˆ«é’ˆå¯¹è®­ç»ƒå’Œé¢„æµ‹è¿›è¡Œè®¾ç½®

```r
learner$timeout = c(train = 30, predict = 30)
```

- å¦‚æœå‡ºç°é”™è¯¯ï¼Œæˆ–è€…è¾¾åˆ°æ¨¡å‹è¶…æ—¶é˜ˆå€¼ï¼Œ  
  é‚£ä¹ˆå­¦ä¹ è€…ä¸ä¼šä¸­æ–­ï¼Œè€Œæ˜¯åœ¨å‘ç°é”™è¯¯æ—¶ä¸è¿›è¡Œé¢„æµ‹
  - å¯¹äºå‡ºç°é”™è¯¯çš„é‡é‡‡æ ·è¿­ä»£ï¼Œç»“æœå°†æ˜¾ç¤ºä¸º`NA`
- ä¸Šè¿°æƒ…å†µæ—¶ï¼Œè¶…å‚æ•°ä¼˜åŒ–å°†ä¼šå¤±è´¥
  - å› ä¸ºæ— æ³•æ±‡æ€»ä¸åŒé‡é‡‡æ ·è¿­ä»£çš„ç»“æœ
  - é€šè¿‡ä½¿ç”¨å¤‡æ‹©å­¦ä¹ å™¨ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜
    - å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ— ç‰¹å¾åŸºçº¿  
    `lrn('regr.featureless')`Â æˆ–  
    Â `lrn('classif.featureless')`
    - `lrn('classif.featureless')`æ€»æ˜¯é¢„æµ‹å¤šæ•°ç±»ï¼ˆå æ¯”æœ€é«˜çš„åˆ†ç±»ï¼‰

```r
instance <- tune(
 tuner = tnr_random, 
 task = tsk_pen, 
 learner = learner, 
 resampling = rsmp_custom, 
 measure = msr_ce,
 term_evals = 10
)

as.data.table(instance$archive)
```

<table class='dataframe'>
<caption>A data.table: 10 x 9</caption>
<thead>
 <tr><th scope=col>nu</th><th scope=col>classif.ce</th><th scope=col>runtime_learners</th><th scope=col>timestamp</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>x_domain</th><th scope=col>batch_nr</th><th scope=col>resample_result</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>8</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>8</td><td> 1</td><td>&lt;environment: 0x16642a5a8&gt;</td></tr>
 <tr><td>9</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>9</td><td> 2</td><td>&lt;environment: 0x165f622c8&gt;</td></tr>
 <tr><td>5</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>5</td><td> 3</td><td>&lt;environment: 0x165f7da40&gt;</td></tr>
 <tr><td>5</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>5</td><td> 4</td><td>&lt;environment: 0x165f9bbc8&gt;</td></tr>
 <tr><td>6</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>6</td><td> 5</td><td>&lt;environment: 0x165fbb758&gt;</td></tr>
 <tr><td>9</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>9</td><td> 6</td><td>&lt;environment: 0x165fd78a8&gt;</td></tr>
 <tr><td>5</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>5</td><td> 7</td><td>&lt;environment: 0x165fedbc8&gt;</td></tr>
 <tr><td>4</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>4</td><td> 8</td><td>&lt;environment: 0x16644c068&gt;</td></tr>
 <tr><td>8</td><td>1</td><td>NA</td><td>2025-06-20 18:42:40</td><td>0</td><td>1</td><td>8</td><td> 9</td><td>&lt;environment: 0x16646a458&gt;</td></tr>
 <tr><td>6</td><td>1</td><td>NA</td><td>2025-06-20 18:42:41</td><td>0</td><td>1</td><td>6</td><td>10</td><td>&lt;environment: 0x166ac1458&gt;</td></tr>
</tbody>
</table>

- ç”¨`Instance$archive$resample_result()`è°ƒå–é‡é‡‡æ ·ä¸­å‘ç”Ÿçš„é”™è¯¯

```r
instance$archive$resample_result(1)$errors
```

<table class='dataframe'>
<caption>A data.table: 1 x 2</caption>
<thead>
 <tr><th scope=col>iteration</th><th scope=col>msg</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1</td><td>variable 6 appears to be constant within groups</td></tr>
</tbody>
</table>

- è°ƒä¼˜åˆ™æ˜¯å¯ä»¥è¿›è¡Œçš„ï¼Œå¹¶ä¸”å¾—åˆ°æœ€ç»ˆé€‰æ‹©å‡ºæ¥çš„è¶…å‚æ•°

```r
instance$result
```

<table class='dataframe'>
<caption>A data.table: 1 x 4</caption>
<thead>
 <tr><th scope=col>nu</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>8</td><td>t, 8</td><td>8</td><td>1</td></tr>
</tbody>
</table>

### å†…å­˜ç®¡ç†

- `ti()`å’Œ`auto_tuner()`ä¸­çš„`store_models`å‚æ•°  
  å¯ä»¥é€‰æ‹©æ˜¯å¦å‚¨å­˜è®­ç»ƒä¸­ç”Ÿæˆçš„æ¨¡å‹
- `ti()` å’Œ `auto_tuner()`ä¸­çš„`store_benchmark_result`å‚æ•°  
  å¯ä»¥é€‰æ‹©æ˜¯å¦å‚¨å­˜é‡é‡‡æ ·ç»“æœ
  - ä½†å¦‚æœæ²¡æœ‰é‡é‡‡æ ·ç»“æœï¼Œ  
   å°±æ— æ³•å†ç”¨å…¶ä»–æŒ‡æ ‡å¯¹é…ç½®è¿›è¡Œè¯„åˆ†
- å½“ä½¿ç”¨å¤§é‡å¤–éƒ¨é‡é‡‡æ ·è¿­ä»£è¿è¡ŒåµŒå¥—é‡é‡‡æ ·æ—¶ï¼Œ  
  å¦‚æœåœ¨ `auto_tuner()` å‡½æ•°ä¸­è®¾ç½® `store_tuning_instance = FALSE`ï¼Œ  
  åˆ™å¯ä»¥èŠ‚çœé¢å¤–çš„å†…å­˜
  - ä½†æ˜¯ï¼Œ  
   `extract_inner_tuning_results()` å’Œ  
    `extract_inner_tuning_archives()` å‡½æ•°å°†ä¸å†èµ·ä½œç”¨
- é€‰é¡¹`store_models = TRUE`ä¼šå°†  
  `store_benchmark_result`å’Œ  
  `store_tuning_instance`è®¾ç½®ä¸º`TRUE`
  - å› ä¸ºæ¨¡å‹å­˜å‚¨åœ¨åŸºå‡†æµ‹è¯•ç»“æœä¸­ï¼Œ  
   è€ŒåŸºå‡†æµ‹è¯•ç»“æœåˆæ˜¯å®ä¾‹çš„ä¸€éƒ¨åˆ†
  - è¿™ä¹Ÿæ„å‘³ç€`store_benchmark_result = TRUE`ä¼šå°†  
   `store_tuning_instance`è®¾ç½®ä¸º`TRUE`
- åœ¨ `resample()` æˆ– `benchmark()` ä¸­è®¾ç½® `store_models = FALSE`ï¼Œ  
  ä»¥åœ¨è¿è¡ŒåµŒå¥—é‡é‡‡æ ·æ—¶ç¦ç”¨è‡ªåŠ¨è°ƒè°å™¨çš„å­˜å‚¨
   ä»ç„¶å¯ä»¥é€šè¿‡`ResampleResult$aggregate()` æŸ¥çœ‹æ•´åˆè¯„ä¼°çš„ç»“æœï¼Œ  
   ä½†ä¼šä¸¢å¤±æœ‰å…³å†…éƒ¨é‡é‡‡æ ·çš„ä¿¡æ¯

---

## å¤šç›®æ ‡è°ƒä¼˜

- æ›´å¤šæ—¶å€™ï¼Œæ¯”èµ·æ¨¡å‹åœ¨å•ä¸€è¯„ä¼°æŒ‡æ ‡ä¸Šä¼˜ç§€ï¼Œ  
  åœ¨å¤šä¸ªè¯„ä¼°æŒ‡æ ‡ä¸Šéƒ½æœ‰è¾ƒå¥½çš„è¯„ä¼°ç»“æœæ˜¯æˆ‘ä»¬æƒ³çœ‹åˆ°çš„
- ä»å®šä¹‰ä¸Šè®²ï¼Œå¯¹å¤šä¸ªè¯„ä¼°æŒ‡æ ‡è¿›è¡Œä¼˜åŒ–æ„å‘³ç€è¿™äº›æŒ‡æ ‡ä¹‹é—´ä¼šç›¸äº’ç«äº‰  
  ï¼ˆå¦åˆ™æˆ‘ä»¬åªéœ€ä¼˜åŒ–å…¶ä¸­ä¸€ä¸ªæŒ‡æ ‡ï¼‰
  - å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œä¸å­˜åœ¨ä¸€ç§èƒ½ä¼˜åŒ–æ‰€æœ‰æŒ‡æ ‡çš„å•ä¸€è¯„ä¼°å™¨
- **å¸•ç´¯æ‰˜æœ€ä¼˜ï¼ˆPareto optimalityï¼‰**
  - å‡è®¾è¦æœ€å°åŒ–åˆ†ç±»è¯¯å·®$CE$å’Œå¤æ‚åº¦$CP$ï¼Œ  
   é…ç½®Aå’Œé…ç½®Bçš„åˆ†ç±»è¯¯å·®åˆ†åˆ«ä¸º$CE_A$å’Œ$CE_B$ï¼Œå¤æ‚åº¦åˆ†åˆ«ä¸º$CP_A$å’Œ$CP_B$
  - è‹¥æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™Aå¸•ç´¯æ‰˜æ”¯é…Bï¼š
    - 1ï¼‰CEAâ‰¤CEBä¸”CPA<CPBï¼›æˆ–è€…  
    2ï¼‰CEA<CEBä¸”CPAâ‰¤CPB
    - æ‰€æœ‰ä¸è¢«å…¶ä»–ä»»ä½•é…ç½®å¸•ç´¯æ‰˜æ”¯é…çš„é…ç½®ç§°ä¸º  
    **å¸•ç´¯æ‰˜æœ‰æ•ˆé…ç½®ï¼ˆPareto-efficientï¼‰**
    - æ‰€æœ‰è¿™äº›é…ç½®çš„é›†åˆå°±æ˜¯**å¸•ç´¯æ‰˜é›†ï¼ˆPareto setï¼‰**
    - ä¸å¸•ç´¯æ‰˜é›†ç›¸å¯¹åº”çš„æŒ‡æ ‡å€¼ç§°ä¸º**å¸•ç´¯æ‰˜å‰æ²¿ï¼ˆPareto frontï¼‰**
- å¤šç›®æ ‡è¶…å‚æ•°ä¼˜åŒ–çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ç»„éæ”¯é…è§£ï¼Œ  
  ä½¿å…¶å¯¹åº”çš„æŒ‡æ ‡å€¼**é€¼è¿‘å¸•ç´¯æ‰˜å‰æ²¿**

- ä¸‹ä¾‹ä¸­ï¼Œå¯¹ `tsk('sonar')`Â æ•°æ®é›†ä¸Šè°ƒæ•´å†³ç­–æ ‘æ¥æ¼”ç¤ºå¤šç›®æ ‡è¶…å‚æ•°ä¼˜åŒ–
  - å…¶ä¸­åˆ†ç±»è¯¯å·®ä½œä¸ºæ¨¡å‹æ€§èƒ½çš„åº¦é‡
  - æ‰€é€‰ç‰¹å¾çš„æ•°é‡ä½œä¸ºæ¨¡å‹å¤æ‚åº¦çš„åº¦é‡

```r
learner <- lrn(
 'classif.rpart', 
 cp = to_tune(1e-04, 1e-1),
 minsplit = to_tune(2, 64), 
 maxdepth = to_tune(1, 30)
)

measures <- msrs(c('classif.ce', 'selected_features'))
```

- ç”¨`ti()`è°ƒä¼˜
  - ç”±äºæ˜¯å¤šè¯„ä¼°æŒ‡æ ‡è°ƒä¼˜ï¼Œæ‰€ä»¥åˆ›å»ºçš„ä¸æ˜¯  
    `TuningInstanceBatchSingleCrit`ï¼Œè€Œæ˜¯  
    `TuningInstanceBatchMultiCrit`

```r
# åˆ›å»ºè°ƒä¼˜å®ä¾‹
instance <- ti(
 task = tsk('sonar'),
 learner = learner,
 resampling = rsmp('cv', folds = 3),
 # æ³¨æ„ä¸æ˜¯`measure`è€Œæ˜¯`measures`å¤æ•°
 measures = measures,
 terminator = trm('evals', n_evals = 30),
 # 
 store_models = TRUE
)

# åˆ›å»ºè°ƒä¼˜å™¨
tuner <- tnr('random_search')
# è°ƒä¼˜
tuner$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 16 x 7</caption>
<thead>
 <tr><th scope=col>cp</th><th scope=col>maxdepth</th><th scope=col>minsplit</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th><th scope=col>selected_features</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.05426979</td><td> 2</td><td>28</td><td>0.00000000, 0.05426979, 2.00000000, 28.00000000</td><td>0.05426979, 2.00000000, 28.00000000</td><td>0.2739821</td><td>1.666667</td></tr>
 <tr><td>0.08910768</td><td>24</td><td>44</td><td>0.00000000, 0.08910768, 24.00000000, 44.00000000</td><td>0.08910768, 24.00000000, 44.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.08880381</td><td> 4</td><td> 9</td><td>0.00000000, 0.08880381, 4.00000000, 9.00000000</td><td>0.08880381, 4.00000000, 9.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.07884068</td><td> 4</td><td>36</td><td>0.00000000, 0.07884068, 4.00000000, 36.00000000</td><td>0.07884068, 4.00000000, 36.00000000</td><td>0.2787440</td><td>1.333333</td></tr>
 <tr><td>0.07125967</td><td> 8</td><td>16</td><td>0.00000000, 0.07125967, 8.00000000, 16.00000000</td><td>0.07125967, 8.00000000, 16.00000000</td><td>0.2692892</td><td>3.000000</td></tr>
 <tr><td>0.09373661</td><td>15</td><td>32</td><td>0.00000000, 0.09373661, 15.00000000, 32.00000000</td><td>0.09373661, 15.00000000, 32.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.09580900</td><td> 3</td><td>47</td><td>0.000000, 0.095809, 3.000000, 47.000000</td><td>0.095809, 3.000000, 47.000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.09714774</td><td> 6</td><td>57</td><td>0.00000000, 0.09714774, 6.00000000, 57.00000000</td><td>0.09714774, 6.00000000, 57.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.09435243</td><td>26</td><td>33</td><td>0.00000000, 0.09435243, 26.00000000, 33.00000000</td><td>0.09435243, 26.00000000, 33.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.01511812</td><td> 1</td><td>20</td><td>0.00000000, 0.01511812, 1.00000000, 20.00000000</td><td>0.01511812, 1.00000000, 20.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.06956784</td><td>18</td><td> 9</td><td>0.00000000, 0.06956784, 18.00000000, 9.00000000</td><td>0.06956784, 18.00000000, 9.00000000</td><td>0.2692892</td><td>3.000000</td></tr>
 <tr><td>0.05564576</td><td> 3</td><td>51</td><td>0.00000000, 0.05564576, 3.00000000, 51.00000000</td><td>0.05564576, 3.00000000, 51.00000000</td><td>0.2739821</td><td>1.666667</td></tr>
 <tr><td>0.08578581</td><td> 1</td><td>64</td><td>0.00000000, 0.08578581, 1.00000000, 64.00000000</td><td>0.08578581, 1.00000000, 64.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.07160058</td><td>24</td><td>12</td><td>0.00000000, 0.07160058, 24.00000000, 12.00000000</td><td>0.07160058, 24.00000000, 12.00000000</td><td>0.2692892</td><td>3.000000</td></tr>
 <tr><td>0.06709319</td><td>14</td><td>15</td><td>0.00000000, 0.06709319, 14.00000000, 15.00000000</td><td>0.06709319, 14.00000000, 15.00000000</td><td>0.2644582</td><td>3.333333</td></tr>
 <tr><td>0.06516315</td><td> 8</td><td>59</td><td>0.00000000, 0.06516315, 8.00000000, 59.00000000</td><td>0.06516315, 8.00000000, 59.00000000</td><td>0.2835749</td><td>1.000000</td></tr>
</tbody>
</table>

<table class='dataframe'>
<caption>A data.table: 16 x 12</caption>
<thead>
 <tr><th scope=col>cp</th><th scope=col>maxdepth</th><th scope=col>minsplit</th><th scope=col>classif.ce</th><th scope=col>selected_features</th><th scope=col>warnings</th><th scope=col>errors</th><th scope=col>runtime_learners</th><th scope=col>uhash</th><th scope=col>x_domain</th><th scope=col>timestamp</th><th scope=col>batch_nr</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.05426979</td><td> 2</td><td>28</td><td>0.2739821</td><td>1.666667</td><td>0</td><td>0</td><td>0.021</td><td>6be71e58-e259-4c8b-878b-e29817f2a6d8</td><td>0.05426979, 2.00000000, 28.00000000</td><td>2025-06-20 19:51:32</td><td> 2</td></tr>
 <tr><td>0.08910768</td><td>24</td><td>44</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.025</td><td>9e2e9e87-1080-47a8-b919-76d94a86dda6</td><td>0.08910768, 24.00000000, 44.00000000</td><td>2025-06-20 19:51:32</td><td> 3</td></tr>
 <tr><td>0.08880381</td><td> 4</td><td> 9</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.020</td><td>a97a1800-f583-43fa-9598-98e94f489fc3</td><td>0.08880381, 4.00000000, 9.00000000</td><td>2025-06-20 19:51:33</td><td> 4</td></tr>
 <tr><td>0.07884068</td><td> 4</td><td>36</td><td>0.2787440</td><td>1.333333</td><td>0</td><td>0</td><td>0.024</td><td>d068028d-b167-4a10-868c-0ad4dc41645e</td><td>0.07884068, 4.00000000, 36.00000000</td><td>2025-06-20 19:51:33</td><td> 5</td></tr>
 <tr><td>0.07125967</td><td> 8</td><td>16</td><td>0.2692892</td><td>3.000000</td><td>0</td><td>0</td><td>0.026</td><td>36f4c7a7-1d1f-4bc8-93ca-f3a4554e1ac0</td><td>0.07125967, 8.00000000, 16.00000000</td><td>2025-06-20 19:51:33</td><td> 6</td></tr>
 <tr><td>0.09373661</td><td>15</td><td>32</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.019</td><td>556f9677-9b7f-4141-83a9-b60005fa7b13</td><td>0.09373661, 15.00000000, 32.00000000</td><td>2025-06-20 19:51:33</td><td> 8</td></tr>
 <tr><td>0.09580900</td><td> 3</td><td>47</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.019</td><td>86f908bf-3e82-4520-af3a-44f79b6dc187</td><td>0.095809, 3.000000, 47.000000</td><td>2025-06-20 19:51:33</td><td> 9</td></tr>
 <tr><td>0.09714774</td><td> 6</td><td>57</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.019</td><td>9e15d7b5-70ed-4ad5-a25c-1a977bbe7c02</td><td>0.09714774, 6.00000000, 57.00000000</td><td>2025-06-20 19:51:33</td><td>11</td></tr>
 <tr><td>0.09435243</td><td>26</td><td>33</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.019</td><td>b6c82dee-e800-4ac2-92f4-3fed0ad3d7d7</td><td>0.09435243, 26.00000000, 33.00000000</td><td>2025-06-20 19:51:33</td><td>13</td></tr>
 <tr><td>0.01511812</td><td> 1</td><td>20</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.020</td><td>9624b63b-5a6e-4e33-b3d6-3c7d3f019c11</td><td>0.01511812, 1.00000000, 20.00000000</td><td>2025-06-20 19:51:34</td><td>15</td></tr>
 <tr><td>0.06956784</td><td>18</td><td> 9</td><td>0.2692892</td><td>3.000000</td><td>0</td><td>0</td><td>0.022</td><td>42137ac1-5ae4-4b5e-b115-a6595affbb7c</td><td>0.06956784, 18.00000000, 9.00000000</td><td>2025-06-20 19:51:34</td><td>20</td></tr>
 <tr><td>0.05564576</td><td> 3</td><td>51</td><td>0.2739821</td><td>1.666667</td><td>0</td><td>0</td><td>0.018</td><td>9474b0f3-4b88-45dd-a47f-d74b270d4b42</td><td>0.05564576, 3.00000000, 51.00000000</td><td>2025-06-20 19:51:34</td><td>24</td></tr>
 <tr><td>0.08578581</td><td> 1</td><td>64</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.017</td><td>d43220b1-93b9-44c7-84b4-7d3b59874a5e</td><td>0.08578581, 1.00000000, 64.00000000</td><td>2025-06-20 19:51:34</td><td>25</td></tr>
 <tr><td>0.07160058</td><td>24</td><td>12</td><td>0.2692892</td><td>3.000000</td><td>0</td><td>0</td><td>0.019</td><td>5bc304de-e3c7-4b7f-8e6a-34d8656effaf</td><td>0.07160058, 24.00000000, 12.00000000</td><td>2025-06-20 19:51:35</td><td>27</td></tr>
 <tr><td>0.06709319</td><td>14</td><td>15</td><td>0.2644582</td><td>3.333333</td><td>0</td><td>0</td><td>0.018</td><td>2f5dee32-6999-40cf-8587-0d3160c01c87</td><td>0.06709319, 14.00000000, 15.00000000</td><td>2025-06-20 19:51:35</td><td>29</td></tr>
 <tr><td>0.06516315</td><td> 8</td><td>59</td><td>0.2835749</td><td>1.000000</td><td>0</td><td>0</td><td>0.017</td><td>6227972f-90ad-4963-8fed-102fb71e697f</td><td>0.06516315, 8.00000000, 59.00000000</td><td>2025-06-20 19:51:35</td><td>30</td></tr>
</tbody>
</table>

- ä½¿ç”¨`Instance$archive$best()`è°ƒç”¨æ‰€æœ‰çš„å¯ç”¨é…ç½®
  - ä»å¸•ç´¯æ‰˜å‰æ²¿ä¸­ç¡®å®šéƒ¨ç½²å“ªç§é…ç½®å–å†³äºä¸ªäººåå¥½
    - æ ¹æ®å®šä¹‰ï¼Œä¸å­˜åœ¨æœ€ä¼˜é…ç½®
  - ä¾‹å¦‚ï¼Œå¦‚æœå®æ„¿ä»¥è¾ƒé«˜é”™è¯¯ç‡ä¸ºä»£ä»·æ¥æ¢å–è¾ƒä½çš„å¤æ‚åº¦ï¼Œ  
   é‚£ä¹ˆå¯ä»¥é€‰æ‹©Â `selected_features = 1`Â çš„é…ç½®

```r
instance$archive$best()[
 , 
 .(
  cp, minsplit, 
  maxdepth, 
  classif.ce,
  selected_features
 )
]
```

<table class='dataframe'>
<caption>A data.table: 16 x 5</caption>
<thead>
 <tr><th scope=col>cp</th><th scope=col>minsplit</th><th scope=col>maxdepth</th><th scope=col>classif.ce</th><th scope=col>selected_features</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.05426979</td><td>28</td><td> 2</td><td>0.2739821</td><td>1.666667</td></tr>
 <tr><td>0.08910768</td><td>44</td><td>24</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.08880381</td><td> 9</td><td> 4</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.07884068</td><td>36</td><td> 4</td><td>0.2787440</td><td>1.333333</td></tr>
 <tr><td>0.07125967</td><td>16</td><td> 8</td><td>0.2692892</td><td>3.000000</td></tr>
 <tr><td>0.09373661</td><td>32</td><td>15</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.09580900</td><td>47</td><td> 3</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.09714774</td><td>57</td><td> 6</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.09435243</td><td>33</td><td>26</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.01511812</td><td>20</td><td> 1</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.06956784</td><td> 9</td><td>18</td><td>0.2692892</td><td>3.000000</td></tr>
 <tr><td>0.05564576</td><td>51</td><td> 3</td><td>0.2739821</td><td>1.666667</td></tr>
 <tr><td>0.08578581</td><td>64</td><td> 1</td><td>0.2835749</td><td>1.000000</td></tr>
 <tr><td>0.07160058</td><td>12</td><td>24</td><td>0.2692892</td><td>3.000000</td></tr>
 <tr><td>0.06709319</td><td>15</td><td>14</td><td>0.2644582</td><td>3.333333</td></tr>
 <tr><td>0.06516315</td><td>59</td><td> 8</td><td>0.2835749</td><td>1.000000</td></tr>
</tbody>
</table>

- ä½¿ç”¨`Instance$result_learner_param_valsä¼ é€’ç»™`Learner`
  - ä¾‹å¦‚è¿™é‡Œé€‰æ‹©ç¬¬äºŒé¡¹é…ç½®

```r
learner <- lrn('classif.rpart')
learner$param_set$values <- instance$result_learner_param_vals[[2]]
```

- å› ä¸ºå¤šç›®æ ‡è°ƒä¼˜éœ€è¦äººä¸ºæ‰‹åŠ¨é…ç½®ï¼Œ  
  æ‰€ä»¥ä¸èƒ½ä½¿ç”¨`auto_tuner()`

## è¶…å¸¦ç®—æ³•ï¼ˆHyperbandï¼‰è¿›è¡Œå¤šä¿çœŸåº¦ï¼ˆFidelityï¼‰è°ƒä¼˜

### ç®€ä»‹

- **ä¿çœŸåº¦ï¼š**  
  æ ¸å¿ƒæŒ‡æ¨¡å‹æˆ–ç®—æ³•åœ¨å¤„ç†æ•°æ®ã€è¿›è¡Œé¢„æµ‹æˆ–è¿ç§»æ—¶å¯¹åŸå§‹ä¿¡æ¯çš„ä¿ç•™ç¨‹åº¦
- å¯¹äºè¶…å¤§çš„æ•°æ®é›†å’Œæœç´¢ç©ºé—´ï¼Œ  
  è°ƒä¼˜çš„è®¡ç®—æˆæœ¬ä¼šéå¸¸é«˜
- ç±»ä¼¼äº**Hyperband**çš„æ–¹æ³•ç›®çš„åœ¨äºï¼š  
  ç”¨**ä½ä¿çœŸåº¦**æ¨¡å‹çš„æ€§èƒ½å¯ä»¥ä»£æ›¿**å…¨ä¿çœŸåº¦**æ¨¡å‹çš„æ€§èƒ½
  - å¯¹äºé¢„æœŸè¿›è¡Œ1000è½®æ¢¯åº¦æå‡ç®—æ³•å®éªŒæ—¶ï¼Œ  
   1000è½®çš„è®­ç»ƒå°±æ˜¯å…¨ä¿çœŸï¼Œ  
   è½®æ•°è¶Šä½ä¿çœŸåº¦å°±è¶Šä½
- ä¸€äº›ç®—æ³•å…·æœ‰å¤©ç„¶çš„ä¿çœŸåº¦å‚æ•°
  - ç¥ç»ç½‘ç»œï¼šnumber of epochs
  - éšæœºæ£®æ—ï¼šnumber of trees

### è¶…å¸¦ç®—æ³•ä¸è¿ç»­å‡åŠç®—æ³•ï¼ˆSuccessive Halvingï¼‰

- **è¶…å¸¦ç®—æ³•**
  - å¯¹ä½ä¿çœŸåº¦ä¸‹éšæœºé‡‡æ ·çš„é…ç½®è¿›è¡Œè¯„ä¼°åï¼Œ  
   è¶…å¸¦ç®—æ³•ä¼šè¿­ä»£åœ°å°†æ›´å¤šèµ„æºåˆ†é…ç»™æœ‰å‰æ™¯çš„é…ç½®ï¼Œ  
   å¹¶å°½æ—©ç»ˆæ­¢æ€§èƒ½ä¸ä½³çš„é…ç½®
  - åŸºäºJamiesonå’ŒTalwalkaræå‡ºçš„è¿ç»­å‡åŠç®—æ³•
    - ç®€ä»‹
      - åˆå§‹åŒ–æ—¶éœ€è¦ä¸€äº›èµ·å§‹é…ç½®æ•°é‡$m_0$ï¼Œ  
     æ¯ä¸ªé˜¶æ®µä¸¢å¼ƒé…ç½®çš„æ¯”ä¾‹$Î·$ï¼Œ  
     ä»¥åŠå•æ¬¡è¯„ä¼°çš„æœ€å°é¢„ç®—ï¼ˆbudgetï¼Œ= ä¿çœŸåº¦ï¼‰$r_0$å’Œ  
     æœ€å¤§é¢„ç®—$r_{max}$
      - è¯¥ç®—æ³•é¦–å…ˆå¯¹$m_0$ä¸ªéšæœºé…ç½®è¿›è¡Œé‡‡æ ·ï¼Œå¹¶ä¸ºå®ƒä»¬åˆ†é…æœ€å°é¢„ç®—$r_0$
      - å¯¹è¿™äº›é…ç½®è¿›è¡Œè¯„ä¼°ï¼Œç„¶åä¸¢å¼ƒè¡¨ç°æœ€å·®çš„$\frac{Î·-1}{Î·}$çš„é…ç½®
      - å‰©ä½™çš„é…ç½®è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼ˆbracketï¼‰ï¼Œå¹¶åœ¨æ›´å¤§çš„é¢„ç®—ä¸‹è¿›è¡Œè¯„ä¼°ï¼›  
     è¿™ä¸ªè¿‡ç¨‹æŒç»­è¿›è¡Œï¼Œç›´åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®åœ¨æœ€å¤§é¢„ç®—$r_{max}$ä¸‹è¿›è¡Œè¯„ä¼°ï¼Œ  
     ç„¶åé€‰æ‹©è¡¨ç°æœ€ä½³çš„é…ç½®
      - è®¡ç®—é˜¶æ®µæ€»æ•°ï¼Œä»¥ä¾¿æ¯ä¸ªé˜¶æ®µæ¶ˆè€—å¤§è‡´ç›¸åŒçš„æ€»é¢„ç®—
      - è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªå¾ˆå¤§ç¼ºç‚¹æ˜¯ï¼Œ  
     ä¸æ¸…æ¥šæ˜¯ä»å¤§é‡é…ç½®ï¼ˆè¾ƒå¤§çš„$r_0$ï¼‰å’Œè¾ƒå°é¢„ç®—å¼€å§‹ï¼Œ  
     è¿˜æ˜¯ä»è¾ƒå°‘é…ç½®ï¼ˆè¾ƒå°çš„$r_0$ï¼‰ä½†è¾ƒå¤§é¢„ç®—å¼€å§‹æ›´å¥½
    - è¶…å¸¦ç®—æ³•ä¸­å¯¹å…¶çš„ä¼˜åŒ–
      - é€šè¿‡åœ¨ä¸åŒçš„èµ·å§‹é…ç½®æ•°é‡ä¸‹è¿è¡Œè¿ç»­å‡åŠæ³•ï¼Œ  
     æ¯ä¸ªèµ·å§‹é…ç½®æ•°é‡å¯¹åº”ä¸åŒçš„é¢„ç®—æ°´å¹³Â $r_0$ï¼Œ  
     è§£å†³ä¸Šè¿°é—®é¢˜
      - ä½¿ç”¨ç›¸åŒçš„Â $Î·$Â å’ŒÂ $r_{max}$ å‚æ•°è¿›è¡Œåˆå§‹åŒ–ï¼ˆä½†ä¸æ˜¯Â $m_0$ï¼‰
      - æ¯ä¸ªbracketä»ä¸åŒçš„é¢„ç®—Â $r_0$Â å¼€å§‹ï¼Œ  
     è¾ƒå°çš„å€¼æ„å‘³ç€å¯ä»¥è¯„ä¼°æ›´å¤šçš„é…ç½®ï¼Œ  
     å› æ­¤æœ€å…·æ¢ç´¢æ€§çš„æ‹¬å·ï¼ˆå³bracketæœ€å¤šçš„é‚£ä¸ªï¼‰è¢«åˆ†é…å…¨å±€æœ€å°é¢„ç®—Â $r_{min}$
      - åœ¨æ¯ä¸ªæ‹¬å·ä¸­ï¼Œèµ·å§‹é¢„ç®—ä»¥Â $Î·$Â å€çš„å› å­å¢åŠ ï¼Œ  
     ç›´åˆ°æœ€åä¸€ä¸ªæ‹¬å·åŸºæœ¬ä¸Šä½¿ç”¨å®Œæ•´é¢„ç®—Â $r_{max}$Â è¿›è¡Œéšæœºæœç´¢
      - æ‹¬å·çš„æ€»æ•°Â $s_{max} + 1$ è®¡ç®—ä¸ºÂ $s_{max}=log_Î·{\frac{r_max}{r_min}}$
      - æ¯ä¸ªæ‹¬å·çš„èµ·å§‹é…ç½®æ•°é‡Â $m_0$Â ç»è¿‡è®¡ç®—ï¼Œ  
     ä½¿å¾—æ¯ä¸ªæ‹¬å·ä½¿ç”¨çš„é¢„ç®—å¤§è‡´ç›¸åŒ
      - æ¯ä¸ªæ‹¬å·ä¸­çš„æœ€ä¼˜è¶…å‚æ•°é…ç½®æ˜¯æœ€åé˜¶æ®µæ€§èƒ½æœ€ä½³çš„é…ç½®
      - è°ƒä¼˜ç»“æŸæ—¶çš„æœ€ä¼˜è¶…å‚æ•°é…ç½®æ˜¯æ‰€æœ‰æ‹¬å·ä¸­æ€§èƒ½æœ€ä½³çš„é…ç½®

- ä¸‹è¡¨ä¾‹å­ä¸ºï¼šå½“$Î·=2$ï¼Œ$r_{min}=1$ï¼ŒÂ $r_{max}=8$æ—¶ï¼Œ  
  æ¯ä¸ªbracketÂ $s$Â ï¼Œé˜¶æ®µÂ $i$ çš„è¶…å¸¦è°ƒåº¦ï¼Œ  
  åŒ…å«é…ç½®æ•°é‡Â $m_i$Â å’Œèµ„æºé‡Â $r_i$

|     | s=3 |     | s=2 |     | s=1 |     | s=0 |     |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| i   | mi  | ri  | mi  | ri  | mi  | ri  | mi  | ri  |
| 0   | 8   | 1   | 6   | 2   | 4   | 4   | 4   | 8   |
| 1   | 4   | 2   | 3   | 4   | 2   | 8   |     |     |
| 2   | 2   | 4   | 1   | 8   |     |     |     |     |
| 3   | 1   | 8   |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |

- ä¸‹è¡¨æ˜¯å•†æ ‡ä¸­å…·ä½“çš„è¶…å‚æ•°é…ç½®
  - `HPCsâˆ—`Â æ˜¯bracketÂ $s$Â ä¸­çš„æœ€ä¼˜è¶…å‚æ•°é…ç½®
  - `HPCâˆ—`Â æ˜¯æ‰€æœ‰bracketä¸­çš„æœ€ä¼˜è¶…å‚æ•°é…ç½®

|       | s=3               | s=2                | s=1           | s=0           |
| ----- | ----------------- | ------------------ | ------------- | ------------- |
| i=0   | {1,2,3,4,5,6,7,8} | {9,10,11,12,13,14} | {15,16,17,18} | {19,20,21,22} |
| i=1   | {1,2,7,8}         | {9,14,15}          | {20,21}       |               |
| i=2   | {1,8}             | {15}               |               |               |
| i=3   | {1}               |                    |               |               |
| HPCsâˆ— | {1}               | {15}               | {21}          | {22}          |
| HPCâˆ—  | {15}              |                    |               |               |

### `mlr3hyperband`åŒ…

- è°ƒç”¨çš„æ–¹æ³•ä¸º
  - `tnr('successive_halving')`
  - `tnr('hyperband')`
- ä¸‹é¢çš„ä¾‹å­ä¸ºä½¿ç”¨è¶…å¸¦ç®—æ³•

```r
# è¶…å¸¦ç®—æ³•éœ€è¦å•ç‹¬åŠ è½½'mlr3hyperband'åŒ…
# library(mlr3hyperband)

# æ„å»ºå­¦ä¹ å™¨ï¼Œè¿™é‡Œæ˜¯xgboostç®—æ³•
learner <- lrn('classif.xgboost')
# è®¾ç½®è¶…çº§å‚æ•°çš„è°ƒæ•´èŒƒå›´
# è¿™é‡Œæ˜¯å…ˆåˆ›å»ºå­¦ä¹ å™¨ï¼Œå†è®¾å®šå‚æ•°
# ç›´æ¥åœ¨`lrn()`ä¸­ä¼ é€’è®¾ç½®ä¹Ÿè¡Œ
learner$param_set$set_values(
 nrounds = to_tune(p_int(16, 128, tags = 'budget')),
 eta = to_tune(1e-4, 1, logscale = TRUE),
 max_depth = to_tune(1, 20),
 colsample_bytree = to_tune(1e-1, 1),
 colsample_bylevel = to_tune(1e-1, 1),
 lambda = to_tune(1e-3, 1e3, logscale = TRUE),
 alpha = to_tune(1e-3, 1e3, logscale = TRUE),
 subsample = to_tune(1e-1, 1)
)
```

- æ„å»ºè¶…å¸¦ç®—æ³•è°ƒä¼˜å™¨
  - `eta`ï¼Œ$\eta$
  - `reprtitions`ï¼Œbracketsè¯„ä¼°çš„æ¬¡æ•°
    - å¦‚æœå¸Œæœ›ç»ˆæ­¢å™¨åŸºäºè¿è¡Œæ—¶é—´ç­‰æ¡ä»¶å…è®¸ï¼Œ  
    å¯ä»¥è®¾ç½®ä¸º`Inf`

```r
# åˆ›å»ºè°ƒä¼˜å®ä¾‹
instance <- ti(
 task = tsk('sonar'),
 learner = learner,
 resampling = rsmp('holdout'),
 measures = msr('classif.ce'),
 terminator = trm('none')
)

# å°†è°ƒä¼˜å™¨é€‰æ‹©ä¸º'hyperband'
tuner <- tnr('hyperband', eta = 2, repetitions = 1)
# æ˜¾ç¤ºç»™å®šä¿çœŸåº¦çº§åˆ«å’Œé¢„ç®—å¢åŠ å› å­çš„è°ƒåº¦æƒ…å†µ
hyperband_schedule(r_min = 16, r_max = 128, eta = 2)
```

<table class='dataframe'>
<caption>A data.table: 10 x 4</caption>
<thead>
 <tr><th scope=col>bracket</th><th scope=col>stage</th><th scope=col>budget</th><th scope=col>n</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>3</td><td>0</td><td> 16</td><td>8</td></tr>
 <tr><td>3</td><td>1</td><td> 32</td><td>4</td></tr>
 <tr><td>3</td><td>2</td><td> 64</td><td>2</td></tr>
 <tr><td>3</td><td>3</td><td>128</td><td>1</td></tr>
 <tr><td>2</td><td>0</td><td> 32</td><td>6</td></tr>
 <tr><td>2</td><td>1</td><td> 64</td><td>3</td></tr>
 <tr><td>2</td><td>2</td><td>128</td><td>1</td></tr>
 <tr><td>1</td><td>0</td><td> 64</td><td>4</td></tr>
 <tr><td>1</td><td>1</td><td>128</td><td>2</td></tr>
 <tr><td>0</td><td>0</td><td>128</td><td>4</td></tr>
</tbody>
</table>

- å¼€è°ƒ
  - è¶…å¸¦ç®—æ³•è¿è¡Œç”Ÿæˆçš„å­˜æ¡£åŒ…å«é¢å¤–çš„`Â `bracket`å’Œ`stage`å¯ä¾›æŸ¥è¯¢

```r
tuner$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 1 x 11</caption>
<thead>
 <tr><th scope=col>alpha</th><th scope=col>colsample_bylevel</th><th scope=col>colsample_bytree</th><th scope=col>eta</th><th scope=col>lambda</th><th scope=col>max_depth</th><th scope=col>nrounds</th><th scope=col>subsample</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-6.172833</td><td>0.3635065</td><td>0.8039435</td><td>-2.811107</td><td>-2.935965</td><td>10</td><td>32</td><td>0.8351367</td><td>1.00000000, 0.00000000, 0.00208532, 0.36350653, 0.80394345, 0.06013836, 0.05307950, 10.00000000, 32.00000000, 0.83513674</td><td>0.00208532, 0.36350653, 0.80394345, 0.06013836, 0.05307950, 10.00000000, 32.00000000, 0.83513674</td><td>0.08695652</td></tr>
</tbody>
</table>

- æŸ¥çœ‹ç»“æœ

```r
instance$result[, .(classif.ce, nrounds)]
```

<table class='dataframe'>
<caption>A data.table: 1 x 2</caption>
<thead>
 <tr><th scope=col>classif.ce</th><th scope=col>nrounds</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.08695652</td><td>32</td></tr>
</tbody>
</table>

-

```r
as.data.table(
 instance$
  archive
)[
 ,
 .(
  bracket, 
  stage, 
  classif.ce, 
  eta, 
  max_depth, 
  colsample_bytree
 )
]
```

<table class='dataframe'>
<caption>A data.table: 35 x 6</caption>
<thead>
 <tr><th scope=col>bracket</th><th scope=col>stage</th><th scope=col>classif.ce</th><th scope=col>eta</th><th scope=col>max_depth</th><th scope=col>colsample_bytree</th></tr>
 <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>3</td><td>0</td><td>0.18840580</td><td>-8.4184092</td><td>14</td><td>0.1132001</td></tr>
 <tr><td>3</td><td>0</td><td>0.14492754</td><td>-2.8111074</td><td>10</td><td>0.8039435</td></tr>
 <tr><td>3</td><td>0</td><td>0.17391304</td><td>-8.9243113</td><td>12</td><td>0.4971439</td></tr>
 <tr><td>3</td><td>0</td><td>0.47826087</td><td>-3.6697481</td><td> 3</td><td>0.8741933</td></tr>
 <tr><td>3</td><td>0</td><td>0.43478261</td><td>-4.3152031</td><td>13</td><td>0.5225918</td></tr>
 <tr><td>3</td><td>0</td><td>0.36231884</td><td>-8.4627255</td><td>19</td><td>0.1774070</td></tr>
 <tr><td>3</td><td>0</td><td>0.17391304</td><td>-4.0383421</td><td> 5</td><td>0.6494958</td></tr>
 <tr><td>3</td><td>0</td><td>0.49275362</td><td>-6.6481889</td><td> 4</td><td>0.2036302</td></tr>
 <tr><td>2</td><td>0</td><td>0.36231884</td><td>-1.6321229</td><td>16</td><td>0.8125073</td></tr>
 <tr><td>2</td><td>0</td><td>0.59420290</td><td>-2.9741057</td><td>12</td><td>0.9270787</td></tr>
 <tr><td>2</td><td>0</td><td>0.21739130</td><td>-3.5983812</td><td>12</td><td>0.4030144</td></tr>
 <tr><td>2</td><td>0</td><td>0.20289855</td><td>-8.9486226</td><td> 2</td><td>0.5908226</td></tr>
 <tr><td>2</td><td>0</td><td>0.20289855</td><td>-5.9648847</td><td>13</td><td>0.3665838</td></tr>
 <tr><td>2</td><td>0</td><td>0.52173913</td><td>-1.2237877</td><td>10</td><td>0.2762483</td></tr>
 <tr><td>3</td><td>1</td><td>0.08695652</td><td>-2.8111074</td><td>10</td><td>0.8039435</td></tr>
 <tr><td>3</td><td>1</td><td>0.18840580</td><td>-8.9243113</td><td>12</td><td>0.4971439</td></tr>
 <tr><td>3</td><td>1</td><td>0.17391304</td><td>-4.0383421</td><td> 5</td><td>0.6494958</td></tr>
 <tr><td>3</td><td>1</td><td>0.23188406</td><td>-8.4184092</td><td>14</td><td>0.1132001</td></tr>
 <tr><td>1</td><td>0</td><td>0.13043478</td><td>-4.2164773</td><td> 6</td><td>0.9656635</td></tr>
 <tr><td>1</td><td>0</td><td>0.15942029</td><td>-2.6815217</td><td>14</td><td>0.2158201</td></tr>
 <tr><td>1</td><td>0</td><td>0.43478261</td><td>-0.2845524</td><td>14</td><td>0.2034910</td></tr>
 <tr><td>1</td><td>0</td><td>0.47826087</td><td>-8.0905822</td><td> 6</td><td>0.4738960</td></tr>
 <tr><td>3</td><td>2</td><td>0.11594203</td><td>-2.8111074</td><td>10</td><td>0.8039435</td></tr>
 <tr><td>3</td><td>2</td><td>0.18840580</td><td>-4.0383421</td><td> 5</td><td>0.6494958</td></tr>
 <tr><td>2</td><td>1</td><td>0.18840580</td><td>-8.9486226</td><td> 2</td><td>0.5908226</td></tr>
 <tr><td>2</td><td>1</td><td>0.15942029</td><td>-5.9648847</td><td>13</td><td>0.3665838</td></tr>
 <tr><td>2</td><td>1</td><td>0.17391304</td><td>-3.5983812</td><td>12</td><td>0.4030144</td></tr>
 <tr><td>0</td><td>0</td><td>0.52173913</td><td>-5.9619021</td><td>16</td><td>0.6184736</td></tr>
 <tr><td>0</td><td>0</td><td>0.17391304</td><td>-5.1422637</td><td>16</td><td>0.1687332</td></tr>
 <tr><td>0</td><td>0</td><td>0.15942029</td><td>-5.7223769</td><td> 9</td><td>0.6430624</td></tr>
 <tr><td>0</td><td>0</td><td>0.17391304</td><td>-6.1107773</td><td>19</td><td>0.7558739</td></tr>
 <tr><td>3</td><td>3</td><td>0.10144928</td><td>-2.8111074</td><td>10</td><td>0.8039435</td></tr>
 <tr><td>2</td><td>2</td><td>0.14492754</td><td>-5.9648847</td><td>13</td><td>0.3665838</td></tr>
 <tr><td>1</td><td>1</td><td>0.15942029</td><td>-4.2164773</td><td> 6</td><td>0.9656635</td></tr>
 <tr><td>1</td><td>1</td><td>0.13043478</td><td>-2.6815217</td><td>14</td><td>0.2158201</td></tr>
</tbody>
</table>

## è´å¶æ–¯ä¼˜åŒ–ï¼ˆBayesian Optimization, BOï¼‰

### ç®€ä»‹

- è´å¶æ–¯ä¼˜åŒ–æ˜¯åŸºäºæ¨¡å‹çš„ä¼˜åŒ–ï¼ˆModel Based Optimizationï¼‰
- **é»‘ç›’ä¼˜åŒ–**
  - ç®€å•æ¥è¯´ï¼Œè™½ç„¶è¶…å‚æ•°çš„è®¾å®šå½±å“æ¨¡å‹çš„æ€§èƒ½ï¼Œ  
   ä½†æˆ‘ä»¬æ— æ³•åˆ¤æ–­ä»€ä¹ˆæ ·çš„è¶…å‚æ•°å’Œå¸¦æ¥ä»€ä¹ˆæ ·çš„æ€§èƒ½
  - è¿™ç§åªèƒ½é€šè¿‡è¾“å…¥è¾“å‡ºè¯•é”™å¹¶ä¸”ä¸èƒ½äº†è§£å†…éƒ¨åŸç†çš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œ  
   ç§°ä½œé»‘ç›’ä¼˜åŒ–
- **è´å¶æ–¯ä¼˜åŒ–**
  - ä¸€ç±»æ ·æœ¬é«˜æ•ˆçš„è¿­ä»£å…¨å±€é»‘ç›’ä¼˜åŒ–ç®—æ³•ï¼Œ  
   è¿™ç±»ç®—æ³•ä¾èµ–äºåœ¨è§‚æµ‹æ•°æ®ä¸Šè®­ç»ƒçš„ **ä»£ç†æ¨¡å‹** æ¥å¯¹é»‘ç›’å‡½æ•°è¿›è¡Œå»ºæ¨¡
    - ä»£ç†æ¨¡å‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªéçº¿æ€§å›å½’æ¨¡å‹
    - åˆ©ç”¨æœ‰é™çš„è§‚æµ‹æ•°æ®æ¥æ•æ‰æœªçŸ¥å‡½æ•°
  - æ¯æ¬¡è¿­ä»£ä¸­ï¼Œè´å¶æ–¯ä¼˜åŒ–ç®—æ³•é‡‡ç”¨ä¸€ä¸ª **é‡‡é›†å‡½æ•°ï¼ˆacquisition functionâ€™ï¼‰**
   æ¥ç¡®å®šä¸‹ä¸€ä¸ªå¾…è¯„ä¼°çš„å€™é€‰ç‚¹
    - é‡‡é›†å‡½æ•°åŸºäºä»£ç†æ¨¡å‹çš„é¢„æµ‹æ¥è¡¡é‡æœç´¢ç©ºé—´å†…æ¯ä¸ªç‚¹çš„é¢„æœŸ **æ•ˆç”¨ï¼ˆutilityï¼‰**
    - ç®—æ³•é€‰æ‹©å…·æœ‰æœ€ä½³é‡‡é›†å‡½æ•°å€¼çš„å€™é€‰ç‚¹ï¼Œå¹¶åœ¨è¯¥ç‚¹è¯„ä¼°é»‘ç›’å‡½æ•°ï¼Œè¿›è€Œæ›´æ–°ä»£ç†æ¨¡å‹
    - è¿™ä¸ªè¿­ä»£è¿‡ç¨‹æŒç»­è¿›è¡Œï¼Œç›´åˆ°æ»¡è¶³ç»ˆæ­¢æ¡ä»¶
      - ä¾‹å¦‚è¾¾åˆ°é¢„å…ˆæŒ‡å®šçš„æœ€å¤§è¯„ä¼°æ¬¡æ•°æˆ–å®ç°æ‰€éœ€çš„æ€§èƒ½æ°´å¹³
  - è´å¶æ–¯ä¼˜åŒ–æ˜¯ä¸€ç§å¼ºå¤§çš„æ–¹æ³•ï¼Œé€šå¸¸èƒ½äº§ç”Ÿè‰¯å¥½çš„ä¼˜åŒ–æ€§èƒ½ï¼Œ  
   ç‰¹åˆ«æ˜¯å½“é»‘ç›’**è¯„ä¼°æˆæœ¬é«˜æ˜‚ä¸”ä¼˜åŒ–é¢„ç®—ç´§å¼ **æ—¶

- åœ¨åç»­ä¸­ï¼Œä»¥ä¼˜åŒ–ä¸‹æ–¹æ­£å¼¦å‡½æ•°$f$ä¸ºç¤ºä¾‹ï¼›  
  è¯¥å‡½æ•°å…·æœ‰ä¸¤ä¸ªå±€éƒ¨æœ€å°å€¼å’Œä¸€ä¸ªå…¨å±€æœ€å°å€¼
$$f:[0,1] \rightarrow \mathbb{R}, x \mapsto 2x \times sin(14x) $$

### é»‘ç®±ä¼˜åŒ–

- `bbotk`æ˜¯ç”¨äºé»‘ç®±ä¼˜åŒ–å·¥å…·åŒ…ï¼Œ åœ¨`mlr3`ç”Ÿæ€ç¯å¢ƒä¸­ä¸»åŠ›è°ƒç”¨ç”¨äºè°ƒä¼˜
  - `OptimInstanceBatchSingleCrit`ç±»å’Œ`OptimInstanceBatchMultiCrit`ç±»
    - `TuningInstanceBatchSingleCrit` å’Œ `TuningInstanceBatchMultiCrit`  
    åˆ†åˆ«ç»§æ‰¿äºå®ƒä»¬
    - ç”¨äºæ„å»ºæè¿°ä¼˜åŒ–é—®é¢˜å¹¶ä¸”å­˜å‚¨ç»“æœçš„ä¼˜åŒ–å®ä¾‹
    - ä¾èµ–äºç›®æ ‡å‡½æ•°ç±»ï¼ˆ`Objective`ç±»ï¼‰
      - åŒ…å«ä»å®šä¹‰åŸŸï¼ˆæ‰€æœ‰å¯èƒ½çš„å‡½æ•°è¾“å…¥ï¼‰åˆ°é™ªåŸŸï¼ˆæ‰€æœ‰å¯èƒ½çš„å‡½æ•°è¾“å‡ºï¼‰çš„å®é™…æ˜ å°„
      - ç›®æ ‡å‡½æ•°å¯ä»¥é€šè¿‡ä¸åŒçš„ç±»æ¥åˆ›å»º
      - è¿™äº›ç±»éƒ½ç»§æ‰¿è‡ª`Objective`
      - è¿™äº›ç±»æä¾›äº†ä¸åŒçš„æ–¹å¼æ¥å®šä¹‰å’Œè¯„ä¼°ç›®æ ‡å‡½æ•°ï¼›  
     é€‰æ‹©åˆé€‚çš„ç±»å°†å‡å°‘ç±»å‹è½¬æ¢å¼€é”€
        - ObjectiveRFunï¼š
          - å°è£…äº†ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æè¿° **å•ä¸ªé…ç½®** çš„åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œ  
       å…¶ä¸­å…ƒç´ å¯ä»¥æ˜¯ä»»ä½•ç±»å‹
          - å½“åº•å±‚å‡½æ•°è¯„ä¼°æœºåˆ¶æ˜¯é€šè¿‡ä¸€æ¬¡è¯„ä¼°å•ä¸ªé…ç½®æ¥å®ç°æ—¶ï¼Œå®ƒå¾ˆé€‚ç”¨
        - ObjectiveRFunManyï¼š
          - å°è£…äº†ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªåŒ…å« **å¤šç§é…ç½®** çš„åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œ  
       å…¶ä¸­å…ƒç´ å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œç”šè‡³æ˜¯æ··åˆç±»å‹
          - å½“å¯¹å¤šç§é…ç½®çš„å‡½æ•°æ±‚å€¼å¯ä»¥å¹¶è¡ŒåŒ–æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨
        - ObjectiveRFunDtï¼š
          - å°è£…äº†ä¸€ä¸ªå¯¹ `data.table` è¿›è¡Œæ“ä½œçš„å‡½æ•°
          - å®ƒå…è®¸ç›´æ¥åœ¨ `data.table` å¯¹è±¡ä¸Šè¿›è¡Œé«˜æ•ˆçš„å‘é‡åŒ–æˆ–æ‰¹å¤„ç†è¯„ä¼°ï¼Œ  
       é¿å…ä¸å¿…è¦çš„æ•°æ®ç±»å‹è½¬æ¢
  - `OptimizerBatch`ç±»
    - ç”¨äºæ„å»ºå’Œé…ç½®ä¼˜åŒ–ç®—æ³•

- åˆ›å»º`ObjectiveRFun`ç±»ï¼Œä»¥å•ä¸ªé…ç½®ä½œä¸ºè¾“å…¥
- `Objective`éœ€è¦æŒ‡å®šè¦ä¼˜åŒ–çš„å‡½æ•°åŠå…¶å®šä¹‰åŸŸå’Œå€¼åŸŸ
- é€šè¿‡ä½¿ç”¨`'minimize'`æˆ–`'maximize'`æ ‡è®°å€¼åŸŸæ¥æŒ‡å®šä¼˜åŒ–æ–¹å‘
- ä¸‹é¢çš„ä¼˜åŒ–å‡½æ•°å¦‚ä½•ä»¥ä¸€ä¸ªåä¸º`x`çš„å•å…ƒç´ `list`ä½œä¸ºè¾“å…¥

```r
# library(bbotk)

# åˆ›å»ºä¸Šè¿°çš„å‡½æ•°f
sinus_1D <- function(xs) 2 * xs$x * sin(14 * xs$x)

# å®šä¹‰åŸŸ
domain <- ps(x = p_dbl(lower = 0, upper = 1))
# é™ªåŸŸ
codomain <- ps(y = p_dbl(tags = 'minimize'))

# åˆ›å»ºä¸€ä¸ª
objective <- ObjectiveRFun$new(
 sinus_1D,
 domain = domain, 
 codomain = codomain
)
```

- å†å®šä¹‰åŸŸèŒƒå›´å†…å°†å‡½æ•°å¯è§†åŒ–

```r
# åŠ è½½`ggplot2`åŒ…
# library(ggplot2)

# ç”Ÿæˆ1001ä¸ªè§‚æµ‹ï¼ŒèŒƒå›´åœ¨`domain`å®šä¹‰çš„å®šä¹‰åŸŸèŒƒå›´
xydt <- generate_design_grid(domain, resolution = 1001)$data
# `:=`æ˜¯`data.table`ç±»çš„ç‰¹æ®Šç”¨æ³•ï¼š
# å°±åœ°ä¿®æ”¹ï¼Œå°†`objective$eval_dt(xydt)$y`èµ‹å€¼åˆ°`y`
xydt[, y := objective$eval_dt(xydt)$y]

# è¿™é‡Œæ˜¯é¢„å…ˆè®¡ç®—å¥½çš„å±€éƒ¨å’Œå…¨å±€æœ€å°å€¼
# ç”¨äºä½œå›¾
optima <- data.table(x = c(0, 0.3509406, 0.7918238))
optima[, y := objective$eval_dt(optima)$y]
optima[, type := c('local', 'local', 'global')]

# ä½œå›¾
ggplot(aes(x = x, y = y), data = xydt) +
  geom_line() +
  geom_point(
   aes(pch = type), 
   color = 'black', 
   size = 4, 
   data = optima
  ) +
  theme_minimal() +
  theme(legend.position = 'none')
```

![image_6](./image_6.png)

- å®šä¹‰äº†ç›®æ ‡å‡½æ•°åï¼Œå¯ä»¥ä½¿ç”¨`OptimInstanceBatchSingleCrit`ç±»å¯¹å…¶è¿›è¡Œä¼˜åŒ–
  - è¿™ä¸ªç±»å…è®¸æˆ‘ä»¬å°è£…ç›®æ ‡å‡½æ•°ï¼Œå¹¶æ˜¾å¼æŒ‡å®šæœç´¢ç©ºé—´
  - æœç´¢ç©ºé—´å®šä¹‰äº†æˆ‘ä»¬æƒ³è¦ä¼˜åŒ–çš„è¾“å…¥å€¼é›†åˆï¼Œ  
   å®ƒé€šå¸¸æ˜¯å®šä¹‰åŸŸçš„ä¸€ä¸ªå­é›†æˆ–å˜æ¢ï¼Œ  
   å°½ç®¡é»˜è®¤æƒ…å†µä¸‹æ•´ä¸ªå®šä¹‰åŸŸè¢«ç”¨ä½œæœç´¢ç©ºé—´
  - åœ¨é»‘ç›’ä¼˜åŒ–ä¸­ï¼Œå®šä¹‰åŸŸä»¥åŠå› æ­¤çš„æœç´¢ç©ºé—´é€šå¸¸å…·æœ‰æœ‰é™çš„ç›’çº¦æŸ
  - ä¸è¶…å‚æ•°ä¼˜åŒ–ç±»ä¼¼ï¼Œæœ‰æ—¶å¯ä»¥ä½¿ç”¨å˜æ¢æ¥æ›´æœ‰æ•ˆåœ°æœç´¢ç©ºé—´

- æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ç®€å•éšæœºæœç´¢åœ¨æ•´ä¸ªåŸŸä¸Šä¼˜åŒ–æ­£å¼¦å‡½æ•°ï¼Œå¹¶ä»¥å¸¸è§„æ–¹å¼æ£€æŸ¥`instance`çš„ç»“æœ
  - ä½¿ç”¨`oi()`å‡½æ•°ï¼ˆoptimization instanceï¼‰æ„å»ºä¸€ä¸ªä¼˜åŒ–å®ä¾‹
  - ä¸`Tuner`ç±»ä¼¼ï¼Œ`bbotk`ä¸­çš„`Optimizer`å­˜å‚¨åœ¨`mlr_optimizers`å­—å…¸ä¸­ï¼Œ  
   å¹¶ä¸”å¯ä»¥ä½¿ç”¨`opt()`è¿›è¡Œæ„å»º

- é¦–å…ˆçœ‹çœ‹`mlr_optimizers`å‚¨å­˜äº†å“ªäº›ä¼˜åŒ–å™¨ï¼ˆ`Optimizer`ç±»ï¼‰

```r
mlr_optimizers
```

<table class='dataframe'>
<caption>A data.table: 15 x 5</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>param_classes</th><th scope=col>properties</th><th scope=col>packages</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>async_design_points</td><td>Asynchronous Design Points                     </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct, ParamUty</td><td>dependencies, single-crit , multi-crit  , async       </td><td>bbotk, rush </td></tr>
 <tr><td>async_grid_search  </td><td>Asynchronous Grid Search                       </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  , async       </td><td>bbotk, rush </td></tr>
 <tr><td>async_random_search</td><td>Asynchronous Random Search                     </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  , async       </td><td>bbotk, rush </td></tr>
 <tr><td>chain              </td><td>Chain Multiple Optimizers Sequentially         </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>cmaes              </td><td>Covariance Matrix Adaptation Evolution Strategy</td><td>ParamDbl</td><td>single-crit</td><td>bbotk , adagio</td></tr>
 <tr><td>design_points      </td><td>Design Points                                  </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct, ParamUty</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>focus_search       </td><td>Focus Search                                   </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit </td><td>bbotk</td></tr>
 <tr><td>gensa              </td><td>Generalized Simulated Annealing                </td><td>ParamDbl</td><td>single-crit</td><td>bbotk, GenSA</td></tr>
 <tr><td>grid_search        </td><td>Grid Search                                    </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>hyperband          </td><td>Hyperband                                      </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk        , mlr3hyperband</td></tr>
 <tr><td>irace              </td><td>Iterated Racing                                </td><td>ParamDbl, ParamInt, ParamFct, ParamLgl</td><td>dependencies, single-crit </td><td>bbotk, irace</td></tr>
 <tr><td>local_search       </td><td>Local Search                                   </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit </td><td>bbotk</td></tr>
 <tr><td>nloptr             </td><td>Non-linear Optimization                        </td><td>ParamDbl</td><td>single-crit</td><td>bbotk , nloptr</td></tr>
 <tr><td>random_search      </td><td>Random Search                                  </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>successive_halving </td><td>Successive Halving                             </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk        , mlr3hyperband</td></tr>
</tbody>
</table>
- ä½¿ç”¨`oi()`æ„å»ºä¼˜åŒ–å®ä¾‹å¹¶è¿›è¡Œä¼˜åŒ–ï¼ˆç±»ä¼¼äº`vi()`ï¼‰
```r
# æ„å»ºä¼˜åŒ–å®ä¾‹
instance <- oi(
 objective,
 # å®šä¹‰åŸŸä¼ é€’åˆ°æœç´¢ç©ºé—´
 search_space = domain,
 # è®¾å®šç»ˆæ­¢å™¨ï¼Œè¿­ä»£20æ¬¡åç»ˆæ­¢
 terminator = trm('evals', n_evals = 20)
)
# æ„å»ºä¼˜åŒ–å™¨ï¼Œç®—æ³•ä¸ºéšæœºæœç´¢
optimizer <- opt('random_search', batch_size = 20)
optimizer$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 1 x 3</caption>
<thead>
 <tr><th scope=col>x</th><th scope=col>x_domain</th><th scope=col>y</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.7732799</td><td>0.7732799</td><td>-1.524356</td></tr>
</tbody>
</table>

- ä¹Ÿå¯ä»¥ä½¿ç”¨`bb_optimize`è¿›è¡Œå®ä¾‹ä¼˜åŒ–ï¼ˆç±»ä¼¼äº`tune()`ï¼‰

```r
optimal <- bb_optimize(
 objective, 
 method = 'random_search',
 max_evals = 20
)
optimal$instance$result
```

<table class='dataframe'>
<caption>A data.table: 1 x 3</caption>
<thead>
 <tr><th scope=col>x</th><th scope=col>x_domain</th><th scope=col>y</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.7530768</td><td>0.7530768</td><td>-1.35457</td></tr>
</tbody>
</table>

### è´å¶æ–¯ä¼˜åŒ–çš„æ„å»ºæ¨¡å—ï¼ˆBuilding Blocksï¼‰

- æ­¥éª¤ï¼š

1. ç”Ÿæˆå¹¶è¯„ä¼°åˆå§‹è®¾è®¡
2. å¾ªç¯ï¼š
1. åœ¨ç›®å‰æ‰€åšçš„æ‰€æœ‰è§‚æµ‹æ•°æ®å­˜æ¡£ä¸Šæ‹Ÿåˆä¸€ä¸ªä»£ç†æ¨¡å‹ï¼Œä»¥å¯¹æœªçŸ¥çš„é»‘ç®±å‡½æ•°è¿›è¡Œå»ºæ¨¡
2. ä¼˜åŒ–é‡‡é›†å‡½æ•°ï¼Œä»¥ç¡®å®šæœç´¢ç©ºé—´ä¸­çš„å“ªäº›ç‚¹æ˜¯æœ‰å‰æ™¯çš„å€™é€‰ç‚¹ï¼Œåº”åœ¨ä¸‹ä¸€æ­¥è¿›è¡Œè¯„ä¼°
3. è¯„ä¼°ä¸‹ä¸€ä¸ªå€™é€‰å¯¹è±¡ï¼Œå¹¶æ›´æ–°åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„æ‰€æœ‰è§‚å¯Ÿè®°å½•æ¡£æ¡ˆ
4. æ£€æŸ¥æ˜¯å¦æ»¡è¶³ç»™å®šçš„ç»ˆæ­¢æ¡ä»¶ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™è¿”å›æ­¥éª¤ (1)

- é‡‡é›†å‡½æ•°ï¼ˆacquisition functionï¼‰ä¾èµ–äºä»£ç†æ¨¡å‹çš„å‡å€¼å’Œæ ‡å‡†å·®é¢„æµ‹ï¼Œ  
  æ— éœ€å¯¹çœŸå®é»‘ç®±å‡½æ•°è¿›è¡Œè¯„ä¼°ï¼Œå› æ­¤ä¼˜åŒ–æˆæœ¬ç›¸å¯¹è¾ƒä½
- å¥½çš„é‡‡é›†å‡½æ•°ä¼šåœ¨ä¸¤æ–¹é¢å–å¾—å¹³è¡¡ï¼š
  - åˆ©ç”¨è§‚å¯Ÿåˆ°æ€§èƒ½è‰¯å¥½ä¸”ä»£ç†æ¨¡å‹ä¸ç¡®å®šæ€§è¾ƒä½çš„åŒºåŸŸçš„çŸ¥è¯†
  - æ¢ç´¢å°šæœªè¯„ä¼°è¿‡çš„ç‚¹ä¸”å› æ­¤ä»£ç†æ¨¡å‹ä¸ç¡®å®šæ€§è¾ƒé«˜çš„åŒºåŸŸ

![image_7](./image_7.png)

- **æ„å»ºæ¨¡å—**ï¼š`OptimizerMbo`ç±»
  - BOç®—æ³•å¾ªç¯ç»“æ„ï¼ˆ`loop_function`ï¼‰
  - ä»£ç†æ¨¡å‹ï¼ˆ`Surrogate`ï¼‰
  - é‡‡é›†å‡½æ•°ï¼ˆ`AcqFunction`ï¼‰
  - é‡‡é›†å‡½æ•°ä¼˜åŒ–å™¨ï¼ˆ`AcqOptimizer`ï¼‰
- æ¨¡å—ç”±`mlr3mbo`è®¾è®¡å¹¶åæ˜ 

#### åˆæ­¥è®¾è®¡

- åœ¨æ‹Ÿåˆä»£ç†æ¨¡å‹ä¹‹å‰è¯„ä¼°çš„åˆå§‹ç‚¹é›†ç§°ä¸º**åˆå§‹è®¾è®¡ï¼ˆInitial Designï¼‰**
- å¯ä»¥ç”¨`mlr3mbo` æ‰‹åŠ¨æ„å»ºåˆå§‹è®¾è®¡ï¼Œ  
  ä¹Ÿå¯ä»¥ç”¨ loop_function ä¸ºæ„å»ºå¹¶è¯„ä¼°åˆå§‹è®¾è®¡
  - ç”¨`mlr3mbo` æ‰‹åŠ¨æ„å»ºåˆå§‹è®¾è®¡å¯ä»¥å¯¹åˆå§‹è®¾è®¡è¿›è¡Œæ›´å¤šæ§åˆ¶

- æ„å»ºåˆå§‹è®¾è®¡çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ `paradox` ä¸­çš„å››ä¸ªè®¾è®¡ç”Ÿæˆå™¨ä¹‹ä¸€
  - `generate_design_random()`ï¼šéšæœºå‡åŒ€ç”Ÿæˆç‚¹
  - `generate_design_grid()`ï¼šåœ¨å¤§å°å‡åŒ€çš„ç½‘æ ¼ä¸­ç”Ÿæˆç‚¹
  - `generate_design_lhs()`ï¼šæ‹‰ä¸è¶…ç«‹æ–¹æŠ½æ ·ï¼ˆLatin hypercube sampling, LHSï¼‰
    - å°†æ¯ä¸ªè¾“å…¥å˜é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„åŒºé—´ï¼Œ  
    å¹¶ç¡®ä¿æ¯ä¸ªåŒºé—´æ°å¥½ç”±ä¸€ä¸ªé‡‡æ ·ç‚¹è¡¨ç¤ºï¼Œä»è€Œå¾—åˆ°å‡åŒ€çš„è¾¹ç¼˜åˆ†å¸ƒ
    - åœ¨LHSè®¾è®¡ä¸­ï¼Œä¸¤ç‚¹ä¹‹é—´çš„æœ€å°è·ç¦»é€šå¸¸ä¼šæœ€å¤§åŒ–ï¼Œä»è€Œå®ç°å¯¹ç©ºé—´çš„ç©ºé—´å¡«å……è¦†ç›–
  - `generate_design_sobol()`ï¼šSobolåºåˆ—ï¼ˆSobol sequenceï¼‰
    - ä¸LHSçš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œä½†åœ¨ç»´åº¦æ•°é‡è¾ƒå¤§æ—¶ï¼Œå®ƒèƒ½æ¯”LHSæä¾›æ›´å¥½çš„è¦†ç›–
- é€šå¸¸å»ºè®®åœ¨è´å¶æ–¯ä¼˜åŒ–ï¼ˆBOï¼‰ä¸­ä½¿ç”¨LHSæˆ–Sobolè®¾è®¡ï¼Œ  
  ä½†ä¸BOçš„å…¶ä»–è®¾è®¡é€‰æ‹©ç›¸æ¯”ï¼Œåˆå§‹è®¾è®¡çš„å½±å“é€šå¸¸è¾ƒå°

![image_8](./image_8.png)

- ç”Ÿæˆçš„`Design`å¯¹è±¡æ˜¯å›´ç»•`data.table`çš„åŒ…è£…å™¨

```r
sample_domain <- ps(x1 = p_dbl(0, 1), x2 = p_dbl(0, 1))
generate_design_random(sample_domain, n = 3)
generate_design_random(sample_domain, n = 3)$data
```

```js
<Design> with 3 rows:
          x1        x2
       <num>     <num>
1: 0.5406415 0.3784440
2: 0.9641830 0.3064937
3: 0.2573565 0.7557893
```

<table class='dataframe'>
<caption>A data.table: 3 x 2</caption>
<thead>
 <tr><th scope=col>x1</th><th scope=col>x2</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.8539652</td><td>0.1333672</td></tr>
 <tr><td>0.8623679</td><td>0.1129187</td></tr>
 <tr><td>0.1020241</td><td>0.8403042</td></tr>
</tbody>
</table>

- åˆå§‹è®¾è®¡ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰`data.table`å®Œæˆ

- åœ¨æ„å»ºåˆå§‹è®¾è®¡åï¼Œè¿›è¡Œä¼˜åŒ–å‰ï¼Œ  
  éœ€è¦åœ¨`OptimInstance`ä¸Šè¿›è¡Œè¯„ä¼°

```r
# æ„å»ºç›®æ ‡å‡½æ•°çš„ä¼˜åŒ–å®ä¾‹
instance <- OptimInstanceSingleCrit$new(
 objective,
 terminator = trm('evals', n_evals = 20)
)
# æ„å»ºä¸€ä¸ª`data.table`ç±»çš„è®¾è®¡çŸ©é˜µ
design <- data.table(x = c(0.1, 0.34, 0.65, 1))
# è¾“å…¥è®¾è®¡çš„çŸ©é˜µ
instance$eval_batch(design)

# æŸ¥çœ‹è¾“å…¥çš„å®šä¹‰åŸŸæ•°å€¼å¯¹åº”äº§ç”Ÿçš„é™ªåŸŸæ•°å€¼
instance$archive$data
```

```js
INFO  [16:59:32.257] [bbotk] Evaluating 4 configuration(s)
INFO  [16:59:32.287] [bbotk] Result of batch 1:
INFO  [16:59:32.288] [bbotk]     x          y
INFO  [16:59:32.288] [bbotk]  0.10  0.1970899
INFO  [16:59:32.288] [bbotk]  0.34 -0.6792294
INFO  [16:59:32.288] [bbotk]  0.65  0.4148279
INFO  [16:59:32.288] [bbotk]  1.00  1.9812147
```

<table class='dataframe'>
<caption>A data.table: 4 x 5</caption>
<thead>
 <tr><th scope=col>x</th><th scope=col>y</th><th scope=col>x_domain</th><th scope=col>timestamp</th><th scope=col>batch_nr</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.10</td><td> 0.1970899</td><td>0.1</td><td>2025-06-23 16:59:32</td><td>1</td></tr>
 <tr><td>0.34</td><td>-0.6792294</td><td>0.34</td><td>2025-06-23 16:59:32</td><td>1</td></tr>
 <tr><td>0.65</td><td> 0.4148279</td><td>0.65</td><td>2025-06-23 16:59:32</td><td>1</td></tr>
 <tr><td>1.00</td><td> 1.9812147</td><td>1</td><td>2025-06-23 16:59:32</td><td>1</td></tr>
</tbody>
</table>

#### ä»£ç†æ¨¡å‹

- åœ¨`mlr3mbo`ä¸­ï¼Œ`SurrogateLearner`æ˜¯ä¸€ä¸ªR6ç±»
  - ç»§æ‰¿è‡ªåŸºç¡€`Surrogate`ç±»
  - æ—¨åœ¨æ„å»ºå’Œç®¡ç†ä»£ç†æ¨¡å‹ï¼Œ  åŒ…æ‹¬è‡ªåŠ¨æ„å»º`TaskRegr`
    - `TaskRegr`åœ¨æ¯æ¬¡BOå¾ªç¯çš„è¿­ä»£ä¸­è¢«è®­ç»ƒ
- ä»£ç†æ¨¡å‹åŒ…è£…äº†ä¸€ä¸ªå›å½’å­¦ä¹ å™¨ï¼Œ  
  è¯¥å­¦ä¹ å™¨åŸºäºè§‚æµ‹æ•°æ®å¯¹æœªçŸ¥çš„é»‘ç›’å‡½æ•°è¿›è¡Œå»ºæ¨¡
  - å›å½’å­¦ä¹ å™¨å¯ä»¥ç”¨ä»»ä½•`mlr3`ä¸­çš„å›å½’å­¦ä¹ å™¨
  - å¤§å¤šæ•°é‡‡é›†å‡½æ•°æ—¢ä¾èµ–äºä»£ç†æ¨¡å‹çš„**å‡å€¼é¢„æµ‹**ï¼Œ  
   ä¹Ÿä¾èµ–äº**æ ‡å‡†å·®é¢„æµ‹**ï¼Œè€Œåè€…è¦æ±‚æ”¯æŒ`predict_type = 'se'`
- ä»£ç†æ¨¡å‹çš„å›å½’å­¦ä¹ å™¨çš„å…¸å‹é€‰æ‹©
  - `lrn('regr.km')`ï¼šé«˜æ–¯è¿‡ç¨‹ï¼ˆGaussian processesï¼‰  
   å¯¹äºä½åˆ°ä¸­ç­‰ç»´åº¦çš„æ•°å€¼æœç´¢ç©ºé—´
  - `lrn('regr.ranger')`ï¼šéšæœºæ£®æ—  
   å¯¹äºé«˜ç»´åº¦æ··åˆï¼ˆå’Œ/æˆ–åˆ†å±‚ï¼‰æœç´¢ç©ºé—´

- ä¸‹é¢ä»¥é«˜æ–¯è¿‡ç¨‹ä½œä¸ºä»£ç†æ¨¡å‹çš„ç®—æ³•ä¸ºä¾‹

```r
lrn_gp <- lrn(
 # é€‰æ‹©é«˜æ–¯è¿‡ç¨‹ä¸ºå­¦ä¹ å™¨
 'regr.km', 
 # ä½¿ç”¨å…·æœ‰MatÃ©rn 5/2æ ¸çš„é«˜æ–¯è¿‡ç¨‹
 covtype = 'matern5_2', 
 # ä½¿ç”¨BFGSä½œä¸ºä¼˜åŒ–å™¨æ¥å¯»æ‰¾æœ€ä¼˜æ ¸å‚æ•°
 optim.method = 'BFGS',
 # è®¾ç½®`trace = FALSE`ä»¥é˜²æ­¢åœ¨æ‹Ÿåˆè¿‡ç¨‹ä¸­äº§ç”Ÿè¿‡å¤šè¾“å‡º
 control = list(trace = FALSE)
)
```

- æ„å»º`SurrogateLearner`å¯¹è±¡ï¼š`srlrn()`
  - éœ€è¦ä¼ é€’`LearnerRegr`å¯¹è±¡ä¸`Instance$archive`

```r
# éœ€è¦`mlr3mbo`åŒ…
# library(mlr3mbo)

# æ„å»º`SurrogateLearner`å¯¹è±¡
surrogate <- srlrn(
 lrn_gp, 
 archive = instance$archive
)

# é€šè¿‡`SurrogateLearner$update()`çš„æ›´æ–°æ¥æ‹Ÿåˆé«˜æ–¯è¿‡ç¨‹
surrogate$update() 
# è®¿é—®æ‹Ÿåˆåçš„æ¨¡å‹
surrogate$learner$model
```

```js
Call:
DiceKriging::km(design = data, response = truth, covtype = 'matern5_2', 
    optim.method = 'BFGS', control = pv$control)

Trend  coeff.:
               Estimate
 (Intercept)     0.7899

Covar. type  : matern5_2 
Covar. coeff.:
               Estimate
    theta(x)     0.3014

Variance estimate: 1.069737
```

#### é‡‡é›†å‡½æ•°

- é‡‡é›†å‡½æ•°ä¾èµ–äºä»£ç†æ¨¡å‹çš„é¢„æµ‹ï¼Œ  
  å¹¶é‡åŒ–æœç´¢ç©ºé—´ä¸­æ¯ä¸ªç‚¹åœ¨ä¸‹æ¬¡è¿­ä»£ä¸­è¿›è¡Œè¯„ä¼°æ—¶çš„é¢„æœŸ **æ•ˆç”¨ï¼ˆutilityï¼‰**
- ä»¥ä¸‹æ–¹çš„ **æœŸæœ›æ”¹å–„ï¼ˆexpected improvementï¼‰** ä¸ºä¾‹
  - åœ¨ç»™å®šä»£ç†æ¨¡å‹çš„æ€§èƒ½é¢„æµ‹çš„æƒ…å†µä¸‹ï¼Œ  
   ä¸ç›®å‰è§‚å¯Ÿåˆ°çš„æœ€ä½³å‡½æ•°å€¼ï¼ˆ**å½“å‰æœ€ä¼˜å€¼**ï¼‰ç›¸æ¯”ï¼Œ  
   å¯ä»¥æœŸæœ›ä¸€ä¸ªå€™é€‰ç‚¹æå‡å¤šå°‘
  - ä¸‹æ–¹å…¬å¼ä¸­ï¼š
    - $Y(x)$ï¼šç»™å®šè¾“å…¥ç‚¹Â $x$Â çš„ä»£ç†æ¨¡å‹é¢„æµ‹å€¼  
    ï¼ˆä¸€ä¸ªéšæœºå˜é‡ï¼Œåœ¨ä½¿ç”¨é«˜æ–¯è¿‡ç¨‹æ—¶æœä»æ­£æ€åˆ†å¸ƒï¼‰
    - $f_{min}$Â ï¼šç›®å‰è§‚æµ‹åˆ°çš„æœ€ä½³å‡½æ•°å€¼ï¼ˆå‡è®¾ä¸ºæœ€å°åŒ–é—®é¢˜ï¼‰
  - è®¡ç®—æœŸæœ›æå‡éœ€è¦æ¨¡å‹ç»™å‡º**å‡å€¼**å’Œ**æ ‡å‡†å·®**é¢„æµ‹

$$
\alpha_{\mathrm{EI}}(\mathbf{x}) = \mathbb{E} \left[ \max \left( f_{\mathrm{min}} - Y(\mathbf{x}), 0 \right) \right]
$$

- åœ¨ `mlr3mbo` ä¸­ï¼Œé‡‡é›†å‡½æ•°ä¸º`AcqFunction`ç±»
  - å­˜å‚¨åœ¨ `mlr_acqfunctions` å­—å…¸ä¸­ï¼Œå¯ä»¥é€šè¿‡ `acqf()` æ¥æ„å»º
  - åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨æœŸæœ›æ”¹å–„ï¼ˆ`acqf('ei')`ï¼‰æ¥é€‰æ‹©ä¸‹ä¸€ä¸ªå¾…è¯„ä¼°çš„å€™é€‰å¯¹è±¡
  - å¦‚ä¹‹å‰ç¤ºä¾‹ä¸€æ ·ï¼Œ  
   å¿…é¡»æ›´æ–°ï¼ˆ`AcqFunction$update()`ï¼‰`AcqFunction` å¯¹å½“å‰æœ€ä¼˜è§£çš„çœ‹æ³•ï¼Œ  
   ä»¥ç¡®ä¿å®ƒä»ç„¶ä½¿ç”¨ç›®å‰è§‚å¯Ÿåˆ°çš„æœ€ä½³å€¼

```r
acq_function <- acqf('ei', surrogate = surrogate)
acq_function$update()
acq_function$y_best
```

- ä½¿ç”¨Â `Objective$eval_dt()`Â å¯¹ä½œä¸ºÂ `data.table`Â ç»™å‡ºçš„åŸŸè¯„ä¼°é‡‡é›†å‡½æ•°
  - ä½¿ç”¨é«˜æ–¯è¿‡ç¨‹é¢„æµ‹å‡å€¼å’Œæ ‡å‡†è¯¯å·®
  - åœ¨0åˆ°1åŒºé—´çš„å‡åŒ€ç‚¹ç½‘æ ¼ä¸Šè¯„ä¼°æœŸæœ›æ”¹å–„

```r
# åœ¨0åˆ°1é—´ç”Ÿæˆ1001ä¸ªæ•°æ®ç‚¹
xydt <- generate_design_grid(domain, resolution = 1001)$data
# ç”¨å‡½æ•°fç”Ÿæˆxå¯¹åº”çš„çœŸå®yå€¼
xydt[, y := objective$eval_dt(xydt)$y]
# ä½¿ç”¨é«˜æ–¯è¿‡ç¨‹è®¡ç®—æœŸæœ›æ”¹å–„
xydt[, ei :=  acq_function$eval_dt(xydt[, 'x'])]
# ä½¿ç”¨ä»£ç†å‡½æ•°é¢„æµ‹xå¯¹åº”çš„yçš„å‡å€¼åŠæ ‡å‡†è¯¯å·®
xydt[, c('mean', 'se') :=  surrogate$predict(xydt[, 'x'])]
xydt[1:3]
```

- é€šè¿‡ä½œå›¾å¯ä»¥å‘ç°ï¼š  
  åœ¨é«˜æ–¯è¿‡ç¨‹çš„å¹³å‡é¢„æµ‹ï¼ˆç°è‰²ç‚¹çº¿ï¼‰è¾ƒä½æˆ–ä¸ç¡®å®šæ€§è¾ƒé«˜çš„åŒºåŸŸï¼ŒæœŸæœ›æå‡è¾ƒé«˜

```r
ggplot(xydt, mapping = aes(x = x, y = y)) +
 geom_point(
  size = 2, 
  data = instance$archive$data
 ) +
 # ç›®æ ‡å‡½æ•°ï¼ˆé»‘è‰²ï¼‰
 geom_line() +
 # ä»£ç†æ¨¡å‹é¢„æµ‹å‡å€¼ï¼ˆç°è‰²ç‚¹çº¿ï¼‰
 geom_line(
  aes(y = mean), 
  colour = 'gray', 
  linetype = 2
 ) +
 # ä»£ç†æ¨¡å‹æ ‡å‡†è¯¯å·®èŒƒå›´ï¼ˆç°è‰²ç‚¹çº¿çš„æ¡å¸¦ï¼‰
 geom_ribbon(
  aes(min = mean - se, max = mean + se),
  fill = 'gray',
  alpha = 0.3
 ) +
 # æœŸå¾…æå‡æ›²çº¿ï¼ˆç°è‰²å®çº¿ï¼‰
 geom_line(
  aes(y = ei * 40), 
  linewidth = 1, 
  colour = 'darkgray'
 ) +
 scale_y_continuous(
  'y',
     sec.axis = sec_axis(
      ~ . * 0.025, 
      name = 'EI',
      breaks = c(0, 0.025, 0.05)
  )
 ) +
 theme_minimal()
```

![image_9](./image_9.png)

#### é‡‡é›†å‡½æ•°ä¼˜åŒ–å™¨

- å¤§å¤šæ•°å¸¸ç”¨çš„é‡‡é›†å‡½æ•°å…·æœ‰**éå‡¸æ€§  
  ï¼ˆé¡ºç€æ¢¯åº¦æ–¹å‘èµ°åˆ°åº•åªèƒ½ä¿è¯æ˜¯å±€éƒ¨æœ€ä¼˜ï¼Œä¸èƒ½ä¿è¯æ˜¯å…¨å±€æœ€ä¼˜ï¼‰**ï¼Œ  
  å› æ­¤é€šå¸¸é‡‡ç”¨å…¨å±€ä¼˜åŒ–æŠ€æœ¯æ¥ä¼˜åŒ–é‡‡é›†å‡½æ•°
- ä¼˜åŒ–é‡‡é›†å‡½æ•°çš„å¹¿æ³›ä½¿ç”¨æ–¹æ³•åŒ…æ‹¬æ— å¯¼æ•°å…¨å±€ä¼˜åŒ–æ–¹æ³•ï¼Œå¦‚ï¼š
  - åˆ†æ”¯å®šç•Œç®—æ³•ï¼Œå¦‚DIRECTç®—æ³•
  - å¤šèµ·ç‚¹å±€éƒ¨ä¼˜åŒ–æ–¹æ³•ï¼Œå¦‚  
   å¤šæ¬¡ä»ä¸åŒèµ·ç‚¹è¿è¡ŒL - BFGS - Bç®—æ³•æˆ–è¿›è¡Œå±€éƒ¨æœç´¢
- å› æ­¤ï¼Œé‡‡é›†å‡½æ•°çš„ä¼˜åŒ–é—®é¢˜æœ¬èº«å¯ä»¥ä½œä¸ºä¸€ä¸ªé»‘ç›’ä¼˜åŒ–é—®é¢˜æ¥å¤„ç†ï¼Œ  
  ä½†å®ƒæ¯”åŸå§‹é—®é¢˜çš„æˆæœ¬è¦ä½å¾—å¤š
- `AcqOptimizer`ç±»
  - ç”¨äºåœ¨æœ‰é™çš„è®¡ç®—èµ„æºå†…ï¼Œé€šè¿‡é«˜æ•ˆæœç´¢æ½œåœ¨å€™é€‰ç©ºé—´æ¥ä¼˜åŒ–é‡‡é›†å‡½æ•°
  - ç”¨ `acqo()` æ„å»º
    - è¯¥å‡½æ•°å°† `Optimizer`ã€`Terminator`å’Œé‡‡é›†å‡½æ•°ä½œä¸ºè¾“å…¥
    - ä¼˜åŒ–å™¨å­˜å‚¨åœ¨ `mlr_optimizers` å­—å…¸ä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¾¿æ·å‡½æ•° `opt()` æ„å»º

```r
mlr_optimizers %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 18 x 5</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>param_classes</th><th scope=col>properties</th><th scope=col>packages</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th></tr>
</thead>
<tbody>
 <tr><td>adbo               </td><td>Asynchronous Decentralized Bayesian Optimization</td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit </td><td>mlr3mbo, rush   </td></tr>
 <tr><td>async_design_points</td><td>Asynchronous Design Points                      </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct, ParamUty</td><td>dependencies, single-crit , multi-crit  , async       </td><td>bbotk, rush </td></tr>
 <tr><td>async_grid_search  </td><td>Asynchronous Grid Search                        </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  , async       </td><td>bbotk, rush </td></tr>
 <tr><td>async_mbo          </td><td>Asynchronous Model Based Optimization           </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit </td><td>mlr3mbo, rush   </td></tr>
 <tr><td>async_random_search</td><td>Asynchronous Random Search                      </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  , async       </td><td>bbotk, rush </td></tr>
 <tr><td>chain              </td><td>Chain Multiple Optimizers Sequentially          </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>cmaes              </td><td>Covariance Matrix Adaptation Evolution Strategy </td><td>ParamDbl</td><td>single-crit</td><td>bbotk , adagio</td></tr>
 <tr><td>design_points      </td><td>Design Points                                   </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct, ParamUty</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>focus_search       </td><td>Focus Search                                    </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit </td><td>bbotk</td></tr>
 <tr><td>gensa              </td><td>Generalized Simulated Annealing                 </td><td>ParamDbl</td><td>single-crit</td><td>bbotk, GenSA</td></tr>
 <tr><td>grid_search        </td><td>Grid Search                                     </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>hyperband          </td><td>Hyperband                                       </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk        , mlr3hyperband</td></tr>
 <tr><td>irace              </td><td>Iterated Racing                                 </td><td>ParamDbl, ParamInt, ParamFct, ParamLgl</td><td>dependencies, single-crit </td><td>bbotk, irace</td></tr>
 <tr><td>local_search       </td><td>Local Search                                    </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit </td><td>bbotk</td></tr>
 <tr><td>mbo                </td><td>Model Based Optimization                        </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>mlr3mbo</td></tr>
 <tr><td>nloptr             </td><td>Non-linear Optimization                         </td><td>ParamDbl</td><td>single-crit</td><td>bbotk , nloptr</td></tr>
 <tr><td>random_search      </td><td>Random Search                                   </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk</td></tr>
 <tr><td>successive_halving </td><td>Successive Halving                              </td><td>ParamLgl, ParamInt, ParamDbl, ParamFct</td><td>dependencies, single-crit , multi-crit  </td><td>bbotk        , mlr3hyperband</td></tr>
</tbody>
</table>

```r
acq_optimizer <- acqo(
 # è°ƒä¼˜å™¨æ˜¯éçº¿æ€§è°ƒä¼˜
 # ç®—æ³•æ˜¯'NLOPT_GN_ORIG_DIRECT'
 optimizer = opt('nloptr', algorithm = 'NLOPT_GN_ORIG_DIRECT'),
 # ä½¿ç”¨åœæ»è¶…ä½“ç§¯ç»ˆæ­¢å™¨ï¼Œè¿­ä»£100æ¬¡ï¼Œå½“æå‡å°äº1e-5æ—¶ç»ˆæ­¢
 terminator = trm('stagnation', iters = 100, threshold = 1e-5),
 # ä¼ é€’è¦è°ƒä¼˜çš„
 acq_function = acq_function
)

candidate <- acq_optimizer$optimize()
candidate
```

<table class='dataframe'>
<caption>A data.table: 1 x 4</caption>
<thead>
 <tr><th scope=col>x</th><th scope=col>acq_ei</th><th scope=col>x_domain</th><th scope=col>.already_evaluated</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;lgl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.417289</td><td>0.06074387</td><td>0.417289</td><td>FALSE</td></tr>
</tbody>
</table>

#### ä½¿ç”¨å’Œæ„å»ºå¾ªç¯å‡½æ•°

- ä½¿ç”¨`loop_function`å¯ä»¥åœ¨å…¨å±€å±‚é¢å†³å®šè´å¶æ–¯ä¼˜åŒ–ç®—æ³•çš„è¡Œä¸º
  - é€šè¿‡å®šä¹‰æ¯æ¬¡è¿­ä»£æ—¶æ‰§è¡Œçš„å­ä¾‹ç¨‹ï¼ˆsubroutineï¼‰ï¼Œ  
   ä»¥ç”Ÿæˆæ–°çš„å¾…è¯„ä¼°å€™é€‰å¯¹è±¡
- `loop_function`å‚¨å­˜åœ¨`mlr_loop_functions`å­—å…¸ä¸­

```r
as.data.table(mlr_loop_functions)[, .(key, label, instance)]
```

<table class='dataframe'>
<caption>A data.table: 5 x 3</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>instance</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>bayesopt_ego   </td><td>Efficient Global Optimization</td><td>single-crit</td></tr>
 <tr><td>bayesopt_emo   </td><td>Multi-Objective EGO          </td><td>multi-crit </td></tr>
 <tr><td>bayesopt_mpcl  </td><td>Multipoint Constant Liar     </td><td>single-crit</td></tr>
 <tr><td>bayesopt_parego</td><td>ParEGO                       </td><td>multi-crit </td></tr>
 <tr><td>bayesopt_smsego</td><td>SMS-EGO                      </td><td>multi-crit </td></tr>
</tbody>
</table>

- å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„å¾ªç¯å‡½æ•°ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œç¼–å†™
- ä¸‹é¢ä½¿ç”¨ **é«˜æ•ˆå…¨å±€ä¼˜åŒ–ï¼ˆEfficient Global Optimization, EGOï¼‰** è¿›è¡Œå¾ªç¯å…¨å±€ä¼˜åŒ–
  - åœ¨è®¾å®šå¥½äº†è´å¶æ–¯ä¼˜åŒ–ç»„ä»¶åï¼Œå¾ªç¯æ‰§è¡Œï¼š
    - æ›´æ–°ä»£ç†æ¨¡å‹
    - æ›´æ–°é‡‡é›†å‡½æ•°
    - ä¼˜åŒ–é‡‡é›†å‡½æ•°ä»¥ç”Ÿæˆæ–°çš„å€™é€‰è§£
    - è¯„ä¼°å€™é€‰è§£å¹¶æ·»åŠ åˆ°å­˜æ¡£`archive`ä¸­
  - å¦‚æœåœ¨å¾ªç¯è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œåˆ™ä¼šä½¿ç”¨å›é€€æœºåˆ¶ï¼Œ  
   å³éšæœºå‡åŒ€åœ°æå‡ºä¸‹ä¸€ä¸ªå€™é€‰è§£ï¼Œ  
   ç¡®ä¿å³ä½¿å­˜åœ¨æ½œåœ¨é—®é¢˜ï¼Œè¯¥è¿‡ç¨‹ä»èƒ½ç»§ç»­è¿›è¡Œ

- è¿™é‡Œæ˜¯æ‰‹åŠ¨æ„å»ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„EGOç®—æ³•ä»£ç ï¼Œ  
  ä¹Ÿå¯ä»¥**ç”¨æ¥å›é¡¾ä¸Šæ–¹çš„æµç¨‹**

```r
my_simple_ego <- function(
 # è®¾å®šäº†è´å¶æ–¯ä¼˜åŒ–éƒ¨ä»¶
 instance, # å®ä¾‹
 surrogate, # ä»£ç†æ¨¡å‹
 acq_function, # é‡‡é›†å‡½æ•°
 acq_optimizer, # é‡‡é›†å‡½æ•°è°ƒä¼˜å™¨
 # è¿™é‡Œçš„åˆå§‹è®¾è®¡æ˜¯`generate_design_sobol()`çš„å‚æ•°`n`
 init_design_size 
  ) {

 # ä¸‹é¢è¿™æ®µå¯ä»¥çœ‹æ¸…æ¥šè¿™å‡ ä¸ªéƒ¨ä»¶ä¹‹é—´çš„ä¼ é€’å…³ç³»
 # å®ä¾‹å­˜æ¡£ä¼ é€’åˆ°ä»£ç†æ¨¡å‹å­˜æ¡£
 surrogate$archive <- instance$archive 
 # ä»£ç†æ¨¡å‹ä¼ é€’åˆ°é‡‡é›†å‡½æ•°
 acq_function$surrogate <- surrogate
 # é‡‡é›†å‡½æ•°ä¼ é€’åˆ°é‡‡é›†å‡½æ•°è°ƒæ•´å™¨
 acq_optimizer$acq_function <- acq_function 
 # è°ƒå–æœç´¢ç©ºé—´
 search_space <- instance$search_space

  # åˆå§‹è®¾è®¡
  design <- generate_design_sobol(
   search_space, 
   n = init_design_size
  )$data
  # ç”Ÿæˆy
  instance$eval_batch(design)

  # åŸºäºæ¨¡å‹çš„ä¼˜åŒ–ï¼ˆMBOï¼‰çš„å¾ªç¯
  repeat {
 candidate <- tryCatch({
  # æ›´æ–°ä»£ç†æ¨¡å‹
  acq_function$surrogate$update()
  # æ›´æ–°é‡‡é›†å‡½æ•°
  acq_function$update()
  # é‡‡é›†å‡½æ•°è°ƒä¼˜å™¨è°ƒä¼˜
  acq_optimizer$optimize()
 }, 
 # å½“å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä½¿ç”¨å¤‡é€‰æ–¹æ³•ï¼šéšæœºæœç´¢
 mbo_error = function(mbo_error_condition) {
      generate_design_random(search_space, n = 1L)$data
 }) # 1L è¡¨ç¤ºæ•´æ•°å‹çš„ 1

    # è¯„ä¼°å€™é€‰ç‚¹å¹¶ä¿å­˜åˆ°å­˜æ¡£ä¸­
    tryCatch({
      instance$eval_batch(candidate)
    }, 
    terminated_error = function(cond) {
      # è¿™é‡Œå†™ç»ˆæ­¢æ¡ä»¶ï¼ˆå¦‚è¾¾åˆ°æœ€å¤§è¯„ä¼°æ¬¡æ•°ï¼‰
      # ......
    })
    # æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶
    if (instance$is_terminated) break
  }

  return(instance)
}
```

### ä½¿ç”¨OptimizerMboå®ç°è´å¶æ–¯ä¼˜åŒ–è‡ªåŠ¨åŒ–

- ä¸Šé¢æ˜¯æ‰‹åŠ¨æ„å»ºè´å¶æ–¯ä¼˜åŒ–çš„æµç¨‹
- å¯ä»¥å°†ä¸Šè¿°æ„å»ºæ¨¡å—å°è£…åˆ°`opt()`æ„å»ºçš„`OptimizerMbo`å¯¹è±¡ä¸­æ‰§è¡Œè‡ªåŠ¨åŒ–è´å¶æ–¯ä¼˜åŒ–

```r
# æ„å»ºå¾ªç¯å‡½æ•°
bayesopt_ego <- mlr_loop_functions$get('bayesopt_ego')
# æ„å»ºä»£ç†æ¨¡å‹
surrogate <- srlrn(
 lrn(
  'regr.km', 
  covtype = 'matern5_2',
  optim.method = 'BFGS', 
  control = list(trace = FALSE)
 )
)
# æ„å»ºé‡‡é›†å‡½æ•°
acq_function <- acqf('ei')
# æ„å»ºé‡‡é›†å‡½æ•°æ¨¡æ‹Ÿå™¨ä¼˜åŒ–å™¨
acq_optimizer <- acqo(
 # ä¼˜åŒ–å™¨ç®—æ³•
 opt(
  'nloptr', 
  algorithm = 'NLOPT_GN_ORIG_DIRECT'
 ),
 # ç»ˆæ­¢å™¨ç®—æ³•
 terminator = trm(
  'stagnation', 
  iters = 100, 
  threshold = 1e-5
 )
)
# ç”¨`opt()`è¿›è¡Œè‡ªåŠ¨åŒ–BOå°è£…
optimizer <- opt(
 'mbo',
 loop_function = bayesopt_ego,
 surrogate = surrogate,
 acq_function = acq_function,
 acq_optimizer = acq_optimizer
)
```

- æ„å»ºä¼˜åŒ–å®ä¾‹

```r
instance <- OptimInstanceBatchSingleCrit$new(
 objective,
 terminator = trm('evals', n_evals = 20)
)
```

-

```r
design <- data.table(x = c(0.1, 0.34, 0.65, 1))
instance$eval_batch(design)
optimizer$optimize(instance)
```

<table class='dataframe'>
<caption>A data.table: 1 x 3</caption>
<thead>
 <tr><th scope=col>x</th><th scope=col>x_domain</th><th scope=col>y</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>0.7921811</td><td>0.7921811</td><td>-1.577224</td></tr>
</tbody>
</table>

- å¦‚æœç”¨`Instance$archive`åšå›¾çš„è¯å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸ªï¼š
  - è´å¶æ–¯ä¼˜åŒ–ç®—æ³•çš„é‡‡æ ·è½¨è¿¹åˆå§‹è®¾è®¡çš„ç‚¹ç”¨é»‘è‰²ä¸‰è§’å½¢è¡¨ç¤ºï¼›  
   éšç€ç®—æ³•çš„æ¨è¿›ï¼Œé‡‡æ ·ç‚¹ç”¨åœ†ç‚¹è¡¨ç¤ºï¼Œé¢œè‰²ä»é»‘è‰²é€æ¸å˜ä¸ºç™½è‰²
  - åœ¨ç¬¬17è½®è¿­ä»£çš„æ—¶å€™ï¼Œé‡‡æ ·ç‚¹å°±æ¥åˆ°äº†å…¨å±€æœ€ä¼˜å€¼çš„åœ°æ–¹
- ç„¶è€Œï¼Œå³ä½¿åœ¨ä¼˜åŒ–çš„åæœŸé˜¶æ®µï¼Œè¯¥ç®—æ³•ä»åœ¨æ¢ç´¢æ–°çš„åŒºåŸŸ
  - è¿™è¡¨æ˜æœŸæœ›æå‡é‡‡é›†å‡½æ•°ç¡®å®å¦‚æˆ‘ä»¬æ‰€è¦æ±‚çš„é‚£æ ·ï¼Œ  
   åœ¨æ¢ç´¢å’Œåˆ©ç”¨ä¹‹é—´å–å¾—äº†å¹³è¡¡

![image_10](./image_10.png)

-ã€€é¡ºä¾¿çœ‹çœ‹`Instance$archive` çš„ç»“æœ

```r
instance$archive %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 20 x 7</caption>
<thead>
 <tr><th scope=col>x</th><th scope=col>y</th><th scope=col>timestamp</th><th scope=col>batch_nr</th><th scope=col>acq_ei</th><th scope=col>.already_evaluated</th><th scope=col>x_domain_x</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dttm&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;lgl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>1.000000e-01</td><td> 1.970899e-01</td><td>2025-06-24 19:19:37</td><td> 1</td><td>           NA</td><td>   NA</td><td>1.000000e-01</td></tr>
 <tr><td>3.400000e-01</td><td>-6.792294e-01</td><td>2025-06-24 19:19:37</td><td> 1</td><td>           NA</td><td>   NA</td><td>3.400000e-01</td></tr>
 <tr><td>6.500000e-01</td><td> 4.148279e-01</td><td>2025-06-24 19:19:37</td><td> 1</td><td>           NA</td><td>   NA</td><td>6.500000e-01</td></tr>
 <tr><td>1.000000e+00</td><td> 1.981215e+00</td><td>2025-06-24 19:19:37</td><td> 1</td><td>           NA</td><td>   NA</td><td>1.000000e+00</td></tr>
 <tr><td>4.172890e-01</td><td>-3.563394e-01</td><td>2025-06-24 19:19:38</td><td> 2</td><td> 6.074387e-02</td><td>FALSE</td><td>4.172890e-01</td></tr>
 <tr><td>2.843317e-01</td><td>-4.230907e-01</td><td>2025-06-24 19:19:39</td><td> 3</td><td> 6.085101e-02</td><td>FALSE</td><td>2.843317e-01</td></tr>
 <tr><td>3.549510e-01</td><td>-6.866001e-01</td><td>2025-06-24 19:19:40</td><td> 4</td><td> 9.136180e-03</td><td>FALSE</td><td>3.549510e-01</td></tr>
 <tr><td>2.540263e-05</td><td> 1.806822e-08</td><td>2025-06-24 19:19:41</td><td> 5</td><td> 1.969525e-03</td><td>FALSE</td><td>2.540263e-05</td></tr>
 <tr><td>3.503277e-01</td><td>-6.877539e-01</td><td>2025-06-24 19:19:42</td><td> 6</td><td> 1.806029e-03</td><td>FALSE</td><td>3.503277e-01</td></tr>
 <tr><td>7.881166e-01</td><td>-1.575092e+00</td><td>2025-06-24 19:19:42</td><td> 7</td><td> 3.460028e-05</td><td>FALSE</td><td>7.881166e-01</td></tr>
 <tr><td>8.152467e-01</td><td>-1.490192e+00</td><td>2025-06-24 19:19:43</td><td> 8</td><td> 4.368291e-02</td><td>FALSE</td><td>8.152467e-01</td></tr>
 <tr><td>7.942641e-01</td><td>-1.576307e+00</td><td>2025-06-24 19:19:44</td><td> 9</td><td> 4.720211e-03</td><td>FALSE</td><td>7.942641e-01</td></tr>
 <tr><td>7.624092e-01</td><td>-1.446524e+00</td><td>2025-06-24 19:19:45</td><td>10</td><td> 6.985420e-09</td><td>FALSE</td><td>7.624092e-01</td></tr>
 <tr><td>7.921811e-01</td><td>-1.577224e+00</td><td>2025-06-24 19:19:47</td><td>11</td><td> 9.251675e-04</td><td>FALSE</td><td>7.921811e-01</td></tr>
 <tr><td>8.827160e-01</td><td>-3.651653e-01</td><td>2025-06-24 19:19:49</td><td>12</td><td> 7.987685e-20</td><td>FALSE</td><td>8.827160e-01</td></tr>
 <tr><td>5.246914e-01</td><td> 9.167112e-01</td><td>2025-06-24 19:19:50</td><td>13</td><td> 5.535251e-21</td><td>FALSE</td><td>5.246914e-01</td></tr>
 <tr><td>1.872428e-01</td><td> 1.861373e-01</td><td>2025-06-24 19:19:51</td><td>14</td><td> 1.408867e-24</td><td>FALSE</td><td>1.872428e-01</td></tr>
 <tr><td>7.222222e-01</td><td>-9.153515e-01</td><td>2025-06-24 19:19:53</td><td>15</td><td> 7.389664e-67</td><td>FALSE</td><td>7.222222e-01</td></tr>
 <tr><td>4.320988e-02</td><td> 4.914789e-02</td><td>2025-06-24 19:19:54</td><td>16</td><td>8.721303e-111</td><td>FALSE</td><td>4.320988e-02</td></tr>
 <tr><td>7.798354e-01</td><td>-1.554943e+00</td><td>2025-06-24 19:19:55</td><td>17</td><td>1.960345e-163</td><td>FALSE</td><td>7.798354e-01</td></tr>
</tbody>
</table>

- å¦‚æœå°†è´å¶æ–¯ä¼˜åŒ–ç®—æ³•è¿è¡Œåæ¬¡ï¼ˆé‡‡ç”¨éšæœºåˆå§‹è®¾è®¡å’Œä¸åŒçš„éšæœºç§å­ï¼‰ï¼Œ  
  å¹¶ä¸éšæœºæœç´¢è¿›è¡Œæ¯”è¾ƒ
  - å¯ä»¥çœ‹åˆ°ï¼Œè´å¶æ–¯ä¼˜åŒ–çš„æ€§èƒ½æ›´å¥½ï¼Œå¹³å‡åœ¨å¤§çº¦15æ¬¡å‡½æ•°è¯„ä¼°åå°±èƒ½è¾¾åˆ°å…¨å±€æœ€ä¼˜
  - æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œåˆå§‹è®¾è®¡è§„æ¨¡çš„æ€§èƒ½ä¸éšæœºæœç´¢çš„æ€§èƒ½ç›¸è¿‘

![image_11](./image_11.png)

### ç”¨äºè¶…å‚æ•°ä¼˜åŒ–çš„è´å¶æ–¯ä¼˜åŒ–

- ä½¿ç”¨`mlr3mbo`çš„`TunerMbo`ç±»å¯ä»¥è¿›è¡Œè¶…å‚æ•°ä¼˜åŒ–
  - `TunerMbo`ç±»æ˜¯`OptimizerMbo`çš„åŒ…è£…å™¨
- ä¸‹é¢ä¾‹å­ä¸­ï¼Œåœ¨`tsk('sonar'`)ä¸Šä½¿ç”¨å¾„å‘æ ¸ï¼Œé€šè¿‡3æŠ˜CVæ¥è°ƒæ•´  
  Â `lrn('classif.svm')`Â çš„Â `cost`Â å’ŒÂ `gamma`Â å‚æ•°

```r
# æ„å»ºè°ƒä¼˜å™¨
tuner <- tnr(
 # é€‰æ‹©åŸºäºæ¨¡å‹çš„è°ƒä¼˜
 'mbo',
 # é€‰æ‹©è´å¶æ–¯ä¼˜åŒ–çš„EGOç®—æ³•
 loop_function = bayesopt_ego,
 # ä¼ é€’ä»£ç†æ¨¡å‹
 surrogate = surrogate,
 # ä¼ é€’é‡‡é›†å‡½æ•°
 acq_function = acq_function,
 # ä¼ é€’é‡‡é›†å‡½æ•°è°ƒä¼˜å™¨
 acq_optimizer = acq_optimizer
)

# æ„å»ºå­¦ä¹ å™¨
lrn_svm <- lrn(
 # é€‰æ‹©æ”¯æŒå‘é‡æœº
 'classif.svm', 
 # é€‰æ‹©radialå†…æ ¸
 kernel = 'radial',
 # é€‰æ‹©åˆ†ç±»é—®é¢˜
 type = 'C-classification',
 # é€‰æ‹©`cost`å’Œ`gamma`çš„è°ƒä¼˜èŒƒå›´
 cost  = to_tune(1e-5, 1e5, logscale = TRUE),
 gamma = to_tune(1e-5, 1e5, logscale = TRUE)
)

# è¿›è¡Œå®ä¾‹è°ƒä¼˜
instance <- tune(
 tuner, 
 tsk('sonar'), 
 lrn_svm, 
 # ä½¿ç”¨3æŠ˜CVè¿›è¡Œé‡é‡‡æ ·
 rsmp('cv', folds = 3),
 # ä½¿ç”¨äº¤å‰ç†µè¯„ä¼°å™¨
 msr('classif.ce'), 
 # è¿­ä»£æ¬¡æ•°25æ¬¡
 25
)

instance$result
```

<table class='dataframe'>
<caption>A data.table: 1 x 5</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.ce</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>8.287107</td><td>-3.762188</td><td>radial            , C-classification  , 3972.32580037573  , 0.0232328628271241</td><td>3.972326e+03, 2.323286e-02</td><td>0.110628</td></tr>
</tbody>
</table>

- æ¥ä¸‹æ¥æ˜¯å¤šè¯„ä¼°æ ‡å‡†çš„ä¾‹å­
  - è¯„ä¼°çš„æ ‡å‡†æ˜¯ çœŸé˜³æ€§ç‡ï¼ˆTPRï¼‰ï¼Œå‡é˜³æ€§ç‡ï¼ˆFPRï¼‰
    - å‰è€…è¶Šå¤§è¶Šå¥½ï¼Œåè€…è¶Šå°è¶Šå¥½

```r
tuner <- tnr(
 'mbo',
 loop_function = bayesopt_parego,
 surrogate = surrogate,
 acq_function = acq_function,
 acq_optimizer = acq_optimizer
)

lrn_rpart <- lrn(
 'classif.rpart',
 cp = to_tune(1e-04, 1e-1),
 minsplit = to_tune(2, 64),
 maxdepth = to_tune(1, 30)
)

instance <- tune(
 tuner, 
 tsk('sonar'), 
 lrn_svm, 
 rsmp('cv', folds = 3),
 # è¿™é‡Œå°±æ˜¯2ä¸ªè¯„ä¼°å™¨ï¼š
 # çœŸé˜³æ€§ç‡ï¼ˆTPRï¼‰ï¼Œå‡é˜³æ€§ç‡ï¼ˆFPRï¼‰
 msrs(c('classif.tpr', 'classif.fpr')), 
 25
)

instance$result
```

<table class='dataframe'>
<caption>A data.table: 4 x 6</caption>
<thead>
 <tr><th scope=col>cost</th><th scope=col>gamma</th><th scope=col>learner_param_vals</th><th scope=col>x_domain</th><th scope=col>classif.tpr</th><th scope=col>classif.fpr</th></tr>
 <tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;list&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
 <tr><td>-2.078838</td><td>-4.156062</td><td>radial            , C-classification  , 0.125075520793627 , 0.0156691447439775</td><td>0.12507552, 0.01566914</td><td>1.0000000</td><td>0.7383860</td></tr>
 <tr><td> 3.126967</td><td>-4.221932</td><td>radial            , C-classification  , 22.8047172214673  , 0.0146702678401885</td><td>22.80471722, 0.01467027</td><td>0.9081787</td><td>0.1999920</td></tr>
 <tr><td> 3.411237</td><td>-4.264046</td><td>radial            , C-classification  , 30.302710828664   , 0.0140652724210524</td><td>30.30271083, 0.01406527</td><td>0.9081787</td><td>0.1999920</td></tr>
 <tr><td> 6.395485</td><td>-2.990097</td><td>radial            , C-classification  , 599.133704193403  , 0.0502825699974251</td><td>599.13370419, 0.05028257</td><td>0.9264098</td><td>0.2588602</td></tr>
</tbody>
</table>

### å«å™ªå£°è´å¶æ–¯ä¼˜åŒ–

- ç°å®ç”Ÿæ´»ä¸­æ¨¡å‹æ˜¯å—åˆ°å™ªå£°å½±å“çš„ -> è¯¯å·®
  - åœ¨`bbotk`ä¸­ï¼Œå¯ä»¥é€šè¿‡å°†`'noisy'`æ ‡ç­¾ä¼ é€’ç»™`properties`å‚æ•°ï¼Œ  
   å°†`Objective`å¯¹è±¡æ ‡è®°ä¸ºæœ‰å™ªå£°çš„
    - è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨å¯ä»¥å¯¹è¿™ç±»ç›®æ ‡è¿›è¡Œä¸åŒå¤„ç†çš„æ–¹æ³•

```r
# å®šä¹‰ä¸€ä¸ªå—åˆ°è¯¯å·®å¹²æ‰°çš„ç›®æ ‡å‡½æ•°
sinus_1D_noisy <- function(xs) {
  y <- 2 * xs$x * sin(14 * xs$x) + 
   # è¿™é‡Œä»¥æ­£æ€éšæœºåˆ†å¸ƒéšæœºç”Ÿæˆ1ä¸ªå‡å€¼ä¸º0æ ‡å‡†åå·®ä¸º0.1çš„è¯¯å·®é¡¹ä¸ºä¾‹
   rnorm(1, mean = 0, sd = 0.1)
  return(y)
}
# å®šä¹‰åŸŸ
domain <- ps(x = p_dbl(lower = 0, upper = 1))
# é™ªåŸŸ
codomain <- ps(y = p_dbl(tags = 'minimize'))
# 
objective_noisy <- ObjectiveRFun$new(
 sinus_1D_noisy,
 domain = domain, 
 codomain = codomain, 
 # å¯¹ç›®æ ‡å‡½æ•°æ ‡è®°æœ‰å™ªå£°
 properties = 'noisy'
)
```

- å¯¹äºå¸¦æœ‰å™ªå£°çš„ç›®æ ‡å‡½æ•°ï¼Œå¤„ç†æ–¹æ³•æœ‰ï¼š
  - ä½¿ç”¨ä»£ç†æ¨¡å‹æ¥è€ƒè™‘å™ªå£°
  - ä½¿ç”¨ä¸€ç§è€ƒè™‘å™ªå£°çš„é‡‡é›†å‡½æ•°
  - ä¼˜åŒ–åçš„æœ€ç»ˆæœ€ä½³ç‚¹ï¼ˆå³å®ä¾‹çš„Â `Instance$result`Â å­—æ®µï¼‰çš„é€‰æ‹©æ–¹å¼  
   å¯ä»¥åæ˜ å™ªå£°æƒ…å†µ

- å¦‚æœä½¿ç”¨ä»£ç†æ¨¡å‹æ¥è€ƒè™‘å™ªå£°ï¼Œ  
  å¯ä»¥ä¸ç”¨æ’å€¼é«˜æ–¯è¿‡ç¨‹ï¼ˆinterpolating Gaussian processï¼‰ï¼Œ  
  è€Œæ˜¯ä½¿ç”¨é«˜æ–¯è¿‡ç¨‹å›å½’ï¼ˆGaussian process regressionï¼‰
  - è¿™å°†å¯¼è‡´é«˜æ–¯è¿‡ç¨‹æ— æ³•å®Œç¾åœ°å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œæ’å€¼ï¼Œ  
   å¹¶ä¸”ä¸è®­ç»ƒæ•°æ®ç›¸å…³çš„æ ‡å‡†å·®é¢„æµ‹å°†ä¸ä¸ºé›¶
    - è¿™åæ˜ äº†ç”±äºæµ‹é‡è¯¯å·®å¯¼è‡´çš„è§‚æµ‹å‡½æ•°å€¼çš„ä¸ç¡®å®šæ€§

```r
srlrn(
 lrn(
  'regr.km', 
  # è®¾ç½®`nugget.estim = TRUE`ä½¿ç”¨é«˜æ–¯è¿‡ç¨‹å›å½’
  nugget.estim = TRUE
 )
)
```

- å¦‚æœä½¿ç”¨ä¸€ç§è€ƒè™‘å™ªå£°çš„é‡‡é›†å‡½æ•°ï¼Œ  
  å¯ä»¥ä½¿ç”¨å¢å¼ºæœŸæœ›æå‡ï¼ˆAugmented expected improvementï¼‰
  - æœ¬è´¨ä¸Šæ˜¯å¯¹æœŸæœ›æå‡è¿›è¡Œé‡æ–°ç¼©æ”¾ï¼ŒåŒæ—¶è€ƒè™‘äº†æµ‹é‡è¯¯å·®

```r
acq_function <- acqf('aei')
```

- æœ€åï¼Œ`mlr3mbo` å…è®¸é€šè¿‡ç»“æœåˆ†é…å™¨ï¼ˆassignerï¼‰  
  æ˜ç¡®æŒ‡å®šä¼˜åŒ–åçš„æœ€ç»ˆç»“æœå¦‚ä½•åˆ†é…ç»™ä¼˜åŒ–å®ä¾‹ï¼ˆå³ `Instance$result` ä¸­ä¿å­˜çš„å†…å®¹ï¼‰
  - å¯ä»¥åœ¨æ„å»º `OptimizerMbo` æˆ– `TunerMbo` æ—¶æŒ‡å®šç»“æœåˆ†é…å™¨
  - `ResultAssignerSurrogate` ä½¿ç”¨ä»£ç†æ¨¡å‹é¢„æµ‹æ‰€æœ‰è¯„ä¼°ç‚¹çš„å‡å€¼ï¼Œ  
   ç„¶åé€‰æ‹©å‡å€¼é¢„æµ‹æœ€ä½³çš„ç‚¹ä½œä¸ºæœ€ç»ˆä¼˜åŒ–ç»“æœ
  - é»˜è®¤æ–¹æ³• `ResultAssignerArchive` ä»…æ ¹æ® `archive` ä¸­è®°å½•çš„è¯„ä¼°ç»“æœé€‰æ‹©æœ€ä½³ç‚¹
  - ç»“æœåˆ†é…å™¨å­˜å‚¨åœ¨ `mlr_result_assigners` å­—å…¸ä¸­ï¼Œ  
   å¯ä»¥ä½¿ç”¨ `ras()` æ„å»º

```r
opt(
 'mbo',
 loop_function = bayesopt_ego,
 surrogate = surrogate,
 acq_function = acq_function,
 acq_optimizer = acq_optimizer,
 result_assigner = ras('surrogate')
)
```

- å…¶å®ç»“æœåˆ†é…å™¨å°±ä¸¤ç§

```r
mlr_result_assigners %>% as.data.table()
```

<table class='dataframe'>
<caption>A data.table: 2 x 3</caption>
<thead>
 <tr><th scope=col>key</th><th scope=col>label</th><th scope=col>man</th></tr>
 <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
 <tr><td>archive  </td><td>Archive                  </td><td>mlr3mbo::mlr_result_assigners_archive  </td></tr>
 <tr><td>surrogate</td><td>Mean Surrogate Prediction</td><td>mlr3mbo::mlr_result_assigners_surrogate</td></tr>
</tbody>
</table>

### è´å¶æ–¯ä¼˜åŒ–ä¸­çš„å®é™…è€ƒé‡

- `mlr3mbo`åŒ…åœ¨ä»£ç†æ¨¡å‹ã€é‡‡é›†å‡½æ•°ã€é‡‡é›†å‡½æ•°ä¼˜åŒ–å™¨ç”šè‡³å¾ªç¯å‡½æ•°çš„é€‰æ‹©ä¸Šä½¿ç”¨åˆç†çš„é»˜è®¤å€¼
  - ä¾‹å¦‚åœ¨çº¯æ•°å€¼æœç´¢ç©ºé—´çš„æƒ…å†µä¸‹ï¼Œ  
   `mlr3mbo`Â é»˜è®¤å°†ä½¿ç”¨é«˜æ–¯è¿‡ç¨‹ä½œä¸ºä»£ç†æ¨¡å‹ï¼Œ  
   å¹¶ä½¿ç”¨éšæœºæ£®æ—ä½œä¸ºå›é€€å­¦ä¹ å™¨ï¼Œ  
   æ­¤å¤–è¿˜å°è£…äº†å­¦ä¹ å™¨
  - åœ¨ä¸æŒ‡å®šä»»ä½•ä¸é»˜è®¤å€¼ä¸åŒçš„æƒ…å†µä¸‹æ‰§è¡Œè´å¶æ–¯ä¼˜åŒ–ï¼Œå¹¶ä¸”ä»ç„¶æœŸæœ›è·å¾—ä¸é”™çš„ä¼˜åŒ–æ€§èƒ½
  - Â [`mbo_defaults`](https://mlr3mbo.mlr-org.com/reference/mbo_defaults.html)Â çš„å¸®åŠ©é¡µé¢ç»™å‡ºäº†è¿™äº›é»˜è®¤å€¼

#### é”™è¯¯å¤„ç†ï¼ˆError Handlingï¼‰

- åœ¨è´å¶æ–¯ä¼˜åŒ–çš„èƒŒæ™¯ä¸‹ï¼Œæ„å»ºæ¨¡å—æœ‰**å¾ˆå¤§çš„æ½œåœ¨å¤±è´¥ç©ºé—´**ï¼Œè¿™å¯èƒ½ä¼šç ´åæ•´ä¸ªè¿‡ç¨‹
  - ä¾‹å¦‚ï¼Œå¦‚æœè®­ç»ƒæ•°æ®ä¸­çš„ä¸¤ä¸ªç‚¹å½¼æ­¤**è¿‡äºæ¥è¿‘**ï¼Œæ‹Ÿåˆé«˜æ–¯è¿‡ç¨‹ä»£ç†æ¨¡å‹å¯èƒ½ä¼šå¤±è´¥
- mlr3mbo æœ‰å‡ ä¸ªå†…ç½®çš„å®‰å…¨æœºåˆ¶æ¥æ•è·é”™è¯¯
  - `Surrogate` åŒ…å« `catch_errors` é…ç½®æ§åˆ¶å‚æ•°ï¼Œ  
   å¦‚æœå°†å…¶è®¾ç½®ä¸º TRUEï¼Œåˆ™ä¼šæ•è·åœ¨ä»£ç†æ¨¡å‹è®­ç»ƒæˆ–æ›´æ–°æœŸé—´å‘ç”Ÿçš„æ‰€æœ‰é”™è¯¯
  - `AcqOptimizer` ä¹Ÿæœ‰ `catch_errors` é…ç½®æ§åˆ¶å‚æ•°ï¼Œ  
   å¯ç”¨äºæ•è·åœ¨é‡‡é›†å‡½æ•°ä¼˜åŒ–æœŸé—´å‘ç”Ÿçš„æ‰€æœ‰é”™è¯¯ï¼Œ  
   æ— è®ºæ˜¯ç”±äºä»£ç†æ¨¡å‹é¢„æµ‹å¤±è´¥è¿˜æ˜¯é‡‡é›†å‡½æ•°ä¼˜åŒ–å™¨å‡ºé”™
  - å¦‚æœåœ¨è¿™äº›æ­¥éª¤ä¸­çš„ä»»ä½•ä¸€æ­¥æ•è·åˆ°é”™è¯¯ï¼Œ  
   ä»»ä½• `loop_function` çš„æ ‡å‡†è¡Œä¸ºæ˜¯**è§¦å‘å›é€€å­¦ä¹ å™¨**ï¼Œ  
   å³éšæœºå‡åŒ€åœ°æå‡ºä¸‹ä¸€ä¸ªå€™é€‰è§£
  - æ³¨æ„ï¼šä¸º `AcqOptimizer` è®¾ç½® `catch_errors = TRUE` æ—¶ï¼Œ  
   é€šå¸¸æ— éœ€ä¹Ÿä¸º `Surrogate` æ˜¾å¼è®¾ç½® `catch_errors = TRUE`
    - ä¸è¿‡è¿™åœ¨è°ƒè¯•æ—¶å¯èƒ½ä¼šæœ‰ç”¨
  - åœ¨**æœ€å**çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰è¿­ä»£éƒ½å‡ºé”™ï¼Œè´å¶æ–¯ä¼˜åŒ–ç®—æ³•å°†**ç›´æ¥è¿›è¡Œéšæœºæœç´¢**
  - **ç†æƒ³**æƒ…å†µä¸‹ï¼Œè¿˜åº”ä½¿ç”¨**å›é€€å­¦ä¹ å™¨**ï¼Œåœ¨éšæœºæå‡ºä¸‹ä¸€ä¸ªå€™é€‰è§£ä¹‹å‰å°†é‡‡ç”¨è¯¥å­¦ä¹ å™¨
  - é‡‡é›†å‡½æ•°çš„å€¼ä¹Ÿå§‹ç»ˆè®°å½•åœ¨ä¼˜åŒ–å®ä¾‹çš„å­˜æ¡£ä¸­ï¼Œ  
   å› æ­¤æ£€æŸ¥è¯¥å€¼æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä»¥ç¡®ä¿ç®—æ³•æŒ‰é¢„æœŸè¿è¡Œ

#### ä»£ç†æ¨¡å‹

- åœ¨å®è·µä¸­ï¼Œç”¨æˆ·å¯èƒ½æ›´å–œæ¬¢ä¸€ç§æ›´ç¨³å¥çš„è´å¶æ–¯ä¼˜åŒ–å˜ä½“ï¼Œ  
  è€Œä¸æ˜¯ä¸€ç§å¯èƒ½æ€§èƒ½æ›´å¥½ä½†ä¸ç¨³å®šçš„å˜ä½“
- å³ä½¿`catch_errors`å‚æ•°å·²æ‰“å¼€ä¸”ä»æœªè§¦å‘ï¼Œä¹Ÿä¸èƒ½ä¿è¯BOç®—æ³•æŒ‰é¢„æœŸè¿è¡Œ
  - ä¾‹å¦‚ï¼Œé«˜æ–¯è¿‡ç¨‹å¯¹æ ¸å‡½æ•°åŠå…¶å‚æ•°çš„é€‰æ‹©å¾ˆæ•æ„Ÿï¼Œ  
   è¿™äº›å‚æ•°é€šå¸¸é€šè¿‡æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ¥ä¼°ç®—ï¼Œ  
   æ¬¡ä¼˜çš„å‚æ•°å€¼å¯èƒ½ä¼šå¯¼è‡´å…·æœ‰æ’å®šå‡å€¼å’Œæ ‡å‡†å·®é¢„æµ‹çš„ç™½å™ªå£°æ¨¡å‹
  - åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç†æ¨¡å‹å°†æ— æ³•æä¾›æœ‰ç”¨çš„å‡å€¼å’Œæ ‡å‡†å·®é¢„æµ‹ï¼Œ  
   ä»è€Œå¯¼è‡´BOç®—æ³•çš„æ•´ä½“æ€§èƒ½ä¸ä½³
- å…³äºä»£ç†æ¨¡å‹é€‰æ‹©çš„å¦ä¸€ä¸ªå®é™…è€ƒè™‘å› ç´ å¯èƒ½æ˜¯å¼€é”€
  - æ‹Ÿåˆä¸€ä¸ªæ™®é€šé«˜æ–¯è¿‡ç¨‹çš„è®¡ç®—é‡ä¸æ•°æ®ç‚¹çš„æ•°é‡å‘ˆä¸‰æ¬¡æ–¹å…³ç³»ï¼Œ  
   å› æ­¤BOç®—æ³•çš„å¼€é”€ä¼šéšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ è€Œå¢é•¿
- æ™®é€šé«˜æ–¯è¿‡ç¨‹æœ¬èº«æ— æ³•å¤„ç†åˆ†ç±»è¾“å…¥å˜é‡æˆ–æœç´¢ç©ºé—´ä¸­çš„ä¾èµ–å…³ç³»  
  ï¼ˆåœ¨è¶…å‚æ•°ä¼˜åŒ–ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¤„ç†æ··åˆå±‚æ¬¡ç©ºé—´ï¼‰
  - ç›¸æ¯”ä¹‹ä¸‹ï¼Œéšæœºæ£®æ—ï¼ˆåœ¨SMACä¸­å¹¿æ³›ç”¨ä½œä»£ç†æ¨¡å‹ï¼‰è®­ç»ƒæˆæœ¬ä½ï¼Œ  
   åœ¨æŸç§æ„ä¹‰ä¸Šç›¸å½“ç¨³å¥
    - å› ä¸ºå®ƒä¸åƒé«˜æ–¯è¿‡ç¨‹é‚£æ ·å¯¹å…¶è¶…å‚æ•°æ•æ„Ÿ
    - å¹¶ä¸”å¯ä»¥è½»æ¾å¤„ç†æ··åˆå±‚æ¬¡ç©ºé—´
  - ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œéšæœºæ£®æ—å¹¶éçœŸæ­£çš„è´å¶æ–¯æ¨¡å‹ï¼ˆå³ä¸å­˜åœ¨åéªŒé¢„æµ‹åˆ†å¸ƒï¼‰ï¼Œ  
   å¹¶ä¸”åœ¨ä¸ç¡®å®šæ€§ä¼°è®¡å’Œå¤–æ¨æ–¹é¢è¡¨ç°ä¸ä½³

#### çƒ­å¯åŠ¨ï¼ˆWarmstartingï¼‰

- çƒ­å¯åŠ¨æ˜¯ä¼˜åŒ–ä¸­çš„ä¸€ç§æŠ€æœ¯
  - å®ƒåˆ©ç”¨å…ˆå‰çš„ä¼˜åŒ–è¿è¡Œæ¥æé«˜æ–°çš„ç›¸å…³ä¼˜åŒ–è¿è¡Œçš„æ”¶æ•›é€Ÿåº¦å’Œæœ€ç»ˆè§£å†³æ–¹æ¡ˆ
- åœ¨è´å¶æ–¯ä¼˜åŒ–ä¸­ï¼Œçƒ­å¯åŠ¨å¯ä»¥é€šè¿‡åœ¨åˆå§‹è®¾è®¡ä¸­  
  æä¾›ä¸€ç»„å¯èƒ½è¡¨ç°è‰¯å¥½çš„é…ç½®æ¥å®ç°
  - è¿™ç§æ–¹æ³•ç‰¹åˆ«æœ‰åˆ©ï¼Œå› ä¸ºå®ƒå…è®¸ä»£ç†æ¨¡å‹åœ¨ç›¸å…³åŒºåŸŸä¸­åˆ©ç”¨ä¼˜åŒ–ç©ºé—´çš„å…ˆéªŒçŸ¥è¯†å¼€å§‹
- åœ¨`mlr3mbo`ä¸­ï¼Œé€šè¿‡æŒ‡å®šè‡ªå®šä¹‰åˆå§‹è®¾è®¡ï¼Œçƒ­å¯åŠ¨å¾ˆç®€å•
- æ­¤å¤–ï¼Œ`mlr3mbo`çš„ä¸€ä¸ªä¾¿æ·åŠŸèƒ½æ˜¯ï¼Œå³ä½¿åœ¨ä¼˜åŒ–è¿è¡Œç»ˆæ­¢åï¼Œ  
  ä¹Ÿèƒ½å¤Ÿä»¥åœ¨çº¿æ–¹å¼ç»§ç»­ä¼˜åŒ–
  - `OptimizerMbo`å’Œ`TunerMbo`éƒ½æ”¯æŒæ­¤åŠŸèƒ½ï¼Œ  
   å³ä½¿å…ˆå‰çš„ä¼˜åŒ–è¢«ä¸­æ–­æˆ–ç»ˆæ­¢ï¼Œä¹Ÿèƒ½åœ¨ç»™å®šå®ä¾‹ä¸Šæ¢å¤ä¼˜åŒ–

#### ç»ˆæ­¢

- å¸¸è§çš„ç»ˆæ­¢å‡†åˆ™åŒ…æ‹¬ï¼š
  - åœ¨å›ºå®šæ¬¡æ•°çš„è¯„ä¼°ååœæ­¢
  - ä¸€æ—¦è¾¾åˆ°ç»™å®šçš„æ—¶é—´é¢„ç®—
  - å½“æ€§èƒ½è¾¾åˆ°ä¸€å®šæ°´å¹³æ—¶
  - å½“æ€§èƒ½æå‡åœæ»æ—¶
- åœ¨è´å¶æ–¯ä¼˜åŒ–çš„èƒŒæ™¯ä¸‹ï¼Œ  
  å¦‚æœæœ€ä½³é‡‡é›†å‡½æ•°å€¼é™è‡³æŸä¸ªé˜ˆå€¼ä»¥ä¸‹ï¼Œåœæ­¢ä¼˜åŒ–ä¹Ÿæ˜¯åˆç†çš„
  - ä¾‹å¦‚ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå€™é€‰è§£çš„é¢„æœŸæ”¹è¿›å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œ  
   ç»ˆæ­¢ä¼˜åŒ–å¯èƒ½æ˜¯ä¸€ç§åˆç†çš„æ–¹æ³•
- *ç„¶è€Œç›®å‰åŸºäºé‡‡é›†å‡½æ•°çš„ç»ˆæ­¢å™¨å°šæœªå®ç°*

#### å¹¶è¡ŒåŒ–

- å¤§å¤šæ•°è´å¶æ–¯ä¼˜åŒ–ç®—æ³•çš„æ ‡å‡†è¡Œä¸ºæ˜¯  
  æŒ‰é¡ºåºæå‡ºä¸‹ä¸€ä¸ªåº”è¯„ä¼°çš„å•ä¸ªå€™é€‰æ–¹æ¡ˆ
- å¦‚æœå°†è´å¶æ–¯ä¼˜åŒ–ç”¨äºè¶…å‚æ•°ä¼˜åŒ–ï¼Œé‚£ä¹ˆæœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å¯¹åµŒå¥—é‡é‡‡æ ·è¿›è¡Œå¹¶è¡ŒåŒ–
- å¦‚æœå¾ªç¯å‡½æ•°æ”¯æŒæ‰¹é‡æå‡ºå€™é€‰æ–¹æ¡ˆï¼ˆä¾‹å¦‚`bayesopt_parego()`ï¼‰ï¼Œ  
  é‚£ä¹ˆå¯ä»¥è®¾ç½®å¾ªç¯å‡½æ•°çš„ `q` å‚æ•°ï¼Œ  
  ä»¥ä¾¿åœ¨æ¯æ¬¡è¿­ä»£ä¸­æå‡º `q` ä¸ªå€™é€‰æ–¹æ¡ˆ
  - å¦‚æœ `Objective` å®ç°å¾—å½“ï¼Œè¿™äº›å€™é€‰æ–¹æ¡ˆå¯ä»¥å¹¶è¡Œè¯„ä¼°
